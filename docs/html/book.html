
<!-- A html document -->
<!-- 
with standard nbconvert css layout
with standard nbconvert input/output content
standard html tag wrapping
with mathjax loaded
with jupyter wigets
 caption and label elements according to ipub meta tags  
with fuzzingbook adaptations -->
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" /><title>About this Book - Generating Software Tests</title>

<style type="text/css">
    /*!
*
* Twitter Bootstrap
*
*/
/*!
 * Bootstrap v3.3.7 (http://getbootstrap.com)
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */
/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */
html {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
}
body {
  margin: 0;
}
article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
menu,
nav,
section,
summary {
  display: block;
}
audio,
canvas,
progress,
video {
  display: inline-block;
  vertical-align: baseline;
}
audio:not([controls]) {
  display: none;
  height: 0;
}
[hidden],
template {
  display: none;
}
a {
  background-color: transparent;
}
a:active,
a:hover {
  outline: 0;
}
abbr[title] {
  border-bottom: 1px dotted;
}
b,
strong {
  font-weight: bold;
}
dfn {
  font-style: italic;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
mark {
  background: #ff0;
  color: #000;
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sup {
  top: -0.5em;
}
sub {
  bottom: -0.25em;
}
img {
  border: 0;
}
svg:not(:root) {
  overflow: hidden;
}
figure {
  margin: 1em 40px;
}
hr {
  box-sizing: content-box;
  height: 0;
}
pre {
  overflow: auto;
}
code,
kbd,
pre,
samp {
  font-family: monospace, monospace;
  font-size: 1em;
}
button,
input,
optgroup,
select,
textarea {
  color: inherit;
  font: inherit;
  margin: 0;
}
button {
  overflow: visible;
}
button,
select {
  text-transform: none;
}
button,
html input[type="button"],
input[type="reset"],
input[type="submit"] {
  -webkit-appearance: button;
  cursor: pointer;
}
button[disabled],
html input[disabled] {
  cursor: default;
}
button::-moz-focus-inner,
input::-moz-focus-inner {
  border: 0;
  padding: 0;
}
input {
  line-height: normal;
}
input[type="checkbox"],
input[type="radio"] {
  box-sizing: border-box;
  padding: 0;
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  height: auto;
}
input[type="search"] {
  -webkit-appearance: textfield;
  box-sizing: content-box;
}
input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}
fieldset {
  border: 1px solid #c0c0c0;
  margin: 0 2px;
  padding: 0.35em 0.625em 0.75em;
}
legend {
  border: 0;
  padding: 0;
}
textarea {
  overflow: auto;
}
optgroup {
  font-weight: bold;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
}
td,
th {
  padding: 0;
}
/*! Source: https://github.com/h5bp/html5-boilerplate/blob/master/src/css/main.css */
@media print {
  *,
  *:before,
  *:after {
    background: transparent !important;
    color: #000 !important;
    box-shadow: none !important;
    text-shadow: none !important;
  }
  a,
  a:visited {
    text-decoration: underline;
  }
  a[href]:after {
    content: " (" attr(href) ")";
  }
  abbr[title]:after {
    content: " (" attr(title) ")";
  }
  a[href^="#"]:after,
  a[href^="javascript:"]:after {
    content: "";
  }
  pre,
  blockquote {
    border: 1px solid #999;
    page-break-inside: avoid;
  }
  thead {
    display: table-header-group;
  }
  tr,
  img {
    page-break-inside: avoid;
  }
  img {
    max-width: 100% !important;
  }
  p,
  h2,
  h3 {
    orphans: 3;
    widows: 3;
  }
  h2,
  h3 {
    page-break-after: avoid;
  }
  .navbar {
    display: none;
  }
  .btn > .caret,
  .dropup > .btn > .caret {
    border-top-color: #000 !important;
  }
  .label {
    border: 1px solid #000;
  }
  .table {
    border-collapse: collapse !important;
  }
  .table td,
  .table th {
    background-color: #fff !important;
  }
  .table-bordered th,
  .table-bordered td {
    border: 1px solid #ddd !important;
  }
}
@font-face {
  font-family: 'Glyphicons Halflings';
  src: url('../components/bootstrap/fonts/glyphicons-halflings-regular.eot');
  src: url('../components/bootstrap/fonts/glyphicons-halflings-regular.eot?#iefix') format('embedded-opentype'), url('../components/bootstrap/fonts/glyphicons-halflings-regular.woff2') format('woff2'), url('../components/bootstrap/fonts/glyphicons-halflings-regular.woff') format('woff'), url('../components/bootstrap/fonts/glyphicons-halflings-regular.ttf') format('truetype'), url('../components/bootstrap/fonts/glyphicons-halflings-regular.svg#glyphicons_halflingsregular') format('svg');
}
.glyphicon {
  position: relative;
  top: 1px;
  display: inline-block;
  font-family: 'Glyphicons Halflings';
  font-style: normal;
  font-weight: normal;
  line-height: 1;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
.glyphicon-asterisk:before {
  content: "\002a";
}
.glyphicon-plus:before {
  content: "\002b";
}
.glyphicon-euro:before,
.glyphicon-eur:before {
  content: "\20ac";
}
.glyphicon-minus:before {
  content: "\2212";
}
.glyphicon-cloud:before {
  content: "\2601";
}
.glyphicon-envelope:before {
  content: "\2709";
}
.glyphicon-pencil:before {
  content: "\270f";
}
.glyphicon-glass:before {
  content: "\e001";
}
.glyphicon-music:before {
  content: "\e002";
}
.glyphicon-search:before {
  content: "\e003";
}
.glyphicon-heart:before {
  content: "\e005";
}
.glyphicon-star:before {
  content: "\e006";
}
.glyphicon-star-empty:before {
  content: "\e007";
}
.glyphicon-user:before {
  content: "\e008";
}
.glyphicon-film:before {
  content: "\e009";
}
.glyphicon-th-large:before {
  content: "\e010";
}
.glyphicon-th:before {
  content: "\e011";
}
.glyphicon-th-list:before {
  content: "\e012";
}
.glyphicon-ok:before {
  content: "\e013";
}
.glyphicon-remove:before {
  content: "\e014";
}
.glyphicon-zoom-in:before {
  content: "\e015";
}
.glyphicon-zoom-out:before {
  content: "\e016";
}
.glyphicon-off:before {
  content: "\e017";
}
.glyphicon-signal:before {
  content: "\e018";
}
.glyphicon-cog:before {
  content: "\e019";
}
.glyphicon-trash:before {
  content: "\e020";
}
.glyphicon-home:before {
  content: "\e021";
}
.glyphicon-file:before {
  content: "\e022";
}
.glyphicon-time:before {
  content: "\e023";
}
.glyphicon-road:before {
  content: "\e024";
}
.glyphicon-download-alt:before {
  content: "\e025";
}
.glyphicon-download:before {
  content: "\e026";
}
.glyphicon-upload:before {
  content: "\e027";
}
.glyphicon-inbox:before {
  content: "\e028";
}
.glyphicon-play-circle:before {
  content: "\e029";
}
.glyphicon-repeat:before {
  content: "\e030";
}
.glyphicon-refresh:before {
  content: "\e031";
}
.glyphicon-list-alt:before {
  content: "\e032";
}
.glyphicon-lock:before {
  content: "\e033";
}
.glyphicon-flag:before {
  content: "\e034";
}
.glyphicon-headphones:before {
  content: "\e035";
}
.glyphicon-volume-off:before {
  content: "\e036";
}
.glyphicon-volume-down:before {
  content: "\e037";
}
.glyphicon-volume-up:before {
  content: "\e038";
}
.glyphicon-qrcode:before {
  content: "\e039";
}
.glyphicon-barcode:before {
  content: "\e040";
}
.glyphicon-tag:before {
  content: "\e041";
}
.glyphicon-tags:before {
  content: "\e042";
}
.glyphicon-book:before {
  content: "\e043";
}
.glyphicon-bookmark:before {
  content: "\e044";
}
.glyphicon-print:before {
  content: "\e045";
}
.glyphicon-camera:before {
  content: "\e046";
}
.glyphicon-font:before {
  content: "\e047";
}
.glyphicon-bold:before {
  content: "\e048";
}
.glyphicon-italic:before {
  content: "\e049";
}
.glyphicon-text-height:before {
  content: "\e050";
}
.glyphicon-text-width:before {
  content: "\e051";
}
.glyphicon-align-left:before {
  content: "\e052";
}
.glyphicon-align-center:before {
  content: "\e053";
}
.glyphicon-align-right:before {
  content: "\e054";
}
.glyphicon-align-justify:before {
  content: "\e055";
}
.glyphicon-list:before {
  content: "\e056";
}
.glyphicon-indent-left:before {
  content: "\e057";
}
.glyphicon-indent-right:before {
  content: "\e058";
}
.glyphicon-facetime-video:before {
  content: "\e059";
}
.glyphicon-picture:before {
  content: "\e060";
}
.glyphicon-map-marker:before {
  content: "\e062";
}
.glyphicon-adjust:before {
  content: "\e063";
}
.glyphicon-tint:before {
  content: "\e064";
}
.glyphicon-edit:before {
  content: "\e065";
}
.glyphicon-share:before {
  content: "\e066";
}
.glyphicon-check:before {
  content: "\e067";
}
.glyphicon-move:before {
  content: "\e068";
}
.glyphicon-step-backward:before {
  content: "\e069";
}
.glyphicon-fast-backward:before {
  content: "\e070";
}
.glyphicon-backward:before {
  content: "\e071";
}
.glyphicon-play:before {
  content: "\e072";
}
.glyphicon-pause:before {
  content: "\e073";
}
.glyphicon-stop:before {
  content: "\e074";
}
.glyphicon-forward:before {
  content: "\e075";
}
.glyphicon-fast-forward:before {
  content: "\e076";
}
.glyphicon-step-forward:before {
  content: "\e077";
}
.glyphicon-eject:before {
  content: "\e078";
}
.glyphicon-chevron-left:before {
  content: "\e079";
}
.glyphicon-chevron-right:before {
  content: "\e080";
}
.glyphicon-plus-sign:before {
  content: "\e081";
}
.glyphicon-minus-sign:before {
  content: "\e082";
}
.glyphicon-remove-sign:before {
  content: "\e083";
}
.glyphicon-ok-sign:before {
  content: "\e084";
}
.glyphicon-question-sign:before {
  content: "\e085";
}
.glyphicon-info-sign:before {
  content: "\e086";
}
.glyphicon-screenshot:before {
  content: "\e087";
}
.glyphicon-remove-circle:before {
  content: "\e088";
}
.glyphicon-ok-circle:before {
  content: "\e089";
}
.glyphicon-ban-circle:before {
  content: "\e090";
}
.glyphicon-arrow-left:before {
  content: "\e091";
}
.glyphicon-arrow-right:before {
  content: "\e092";
}
.glyphicon-arrow-up:before {
  content: "\e093";
}
.glyphicon-arrow-down:before {
  content: "\e094";
}
.glyphicon-share-alt:before {
  content: "\e095";
}
.glyphicon-resize-full:before {
  content: "\e096";
}
.glyphicon-resize-small:before {
  content: "\e097";
}
.glyphicon-exclamation-sign:before {
  content: "\e101";
}
.glyphicon-gift:before {
  content: "\e102";
}
.glyphicon-leaf:before {
  content: "\e103";
}
.glyphicon-fire:before {
  content: "\e104";
}
.glyphicon-eye-open:before {
  content: "\e105";
}
.glyphicon-eye-close:before {
  content: "\e106";
}
.glyphicon-warning-sign:before {
  content: "\e107";
}
.glyphicon-plane:before {
  content: "\e108";
}
.glyphicon-calendar:before {
  content: "\e109";
}
.glyphicon-random:before {
  content: "\e110";
}
.glyphicon-comment:before {
  content: "\e111";
}
.glyphicon-magnet:before {
  content: "\e112";
}
.glyphicon-chevron-up:before {
  content: "\e113";
}
.glyphicon-chevron-down:before {
  content: "\e114";
}
.glyphicon-retweet:before {
  content: "\e115";
}
.glyphicon-shopping-cart:before {
  content: "\e116";
}
.glyphicon-folder-close:before {
  content: "\e117";
}
.glyphicon-folder-open:before {
  content: "\e118";
}
.glyphicon-resize-vertical:before {
  content: "\e119";
}
.glyphicon-resize-horizontal:before {
  content: "\e120";
}
.glyphicon-hdd:before {
  content: "\e121";
}
.glyphicon-bullhorn:before {
  content: "\e122";
}
.glyphicon-bell:before {
  content: "\e123";
}
.glyphicon-certificate:before {
  content: "\e124";
}
.glyphicon-thumbs-up:before {
  content: "\e125";
}
.glyphicon-thumbs-down:before {
  content: "\e126";
}
.glyphicon-hand-right:before {
  content: "\e127";
}
.glyphicon-hand-left:before {
  content: "\e128";
}
.glyphicon-hand-up:before {
  content: "\e129";
}
.glyphicon-hand-down:before {
  content: "\e130";
}
.glyphicon-circle-arrow-right:before {
  content: "\e131";
}
.glyphicon-circle-arrow-left:before {
  content: "\e132";
}
.glyphicon-circle-arrow-up:before {
  content: "\e133";
}
.glyphicon-circle-arrow-down:before {
  content: "\e134";
}
.glyphicon-globe:before {
  content: "\e135";
}
.glyphicon-wrench:before {
  content: "\e136";
}
.glyphicon-tasks:before {
  content: "\e137";
}
.glyphicon-filter:before {
  content: "\e138";
}
.glyphicon-briefcase:before {
  content: "\e139";
}
.glyphicon-fullscreen:before {
  content: "\e140";
}
.glyphicon-dashboard:before {
  content: "\e141";
}
.glyphicon-paperclip:before {
  content: "\e142";
}
.glyphicon-heart-empty:before {
  content: "\e143";
}
.glyphicon-link:before {
  content: "\e144";
}
.glyphicon-phone:before {
  content: "\e145";
}
.glyphicon-pushpin:before {
  content: "\e146";
}
.glyphicon-usd:before {
  content: "\e148";
}
.glyphicon-gbp:before {
  content: "\e149";
}
.glyphicon-sort:before {
  content: "\e150";
}
.glyphicon-sort-by-alphabet:before {
  content: "\e151";
}
.glyphicon-sort-by-alphabet-alt:before {
  content: "\e152";
}
.glyphicon-sort-by-order:before {
  content: "\e153";
}
.glyphicon-sort-by-order-alt:before {
  content: "\e154";
}
.glyphicon-sort-by-attributes:before {
  content: "\e155";
}
.glyphicon-sort-by-attributes-alt:before {
  content: "\e156";
}
.glyphicon-unchecked:before {
  content: "\e157";
}
.glyphicon-expand:before {
  content: "\e158";
}
.glyphicon-collapse-down:before {
  content: "\e159";
}
.glyphicon-collapse-up:before {
  content: "\e160";
}
.glyphicon-log-in:before {
  content: "\e161";
}
.glyphicon-flash:before {
  content: "\e162";
}
.glyphicon-log-out:before {
  content: "\e163";
}
.glyphicon-new-window:before {
  content: "\e164";
}
.glyphicon-record:before {
  content: "\e165";
}
.glyphicon-save:before {
  content: "\e166";
}
.glyphicon-open:before {
  content: "\e167";
}
.glyphicon-saved:before {
  content: "\e168";
}
.glyphicon-import:before {
  content: "\e169";
}
.glyphicon-export:before {
  content: "\e170";
}
.glyphicon-send:before {
  content: "\e171";
}
.glyphicon-floppy-disk:before {
  content: "\e172";
}
.glyphicon-floppy-saved:before {
  content: "\e173";
}
.glyphicon-floppy-remove:before {
  content: "\e174";
}
.glyphicon-floppy-save:before {
  content: "\e175";
}
.glyphicon-floppy-open:before {
  content: "\e176";
}
.glyphicon-credit-card:before {
  content: "\e177";
}
.glyphicon-transfer:before {
  content: "\e178";
}
.glyphicon-cutlery:before {
  content: "\e179";
}
.glyphicon-header:before {
  content: "\e180";
}
.glyphicon-compressed:before {
  content: "\e181";
}
.glyphicon-earphone:before {
  content: "\e182";
}
.glyphicon-phone-alt:before {
  content: "\e183";
}
.glyphicon-tower:before {
  content: "\e184";
}
.glyphicon-stats:before {
  content: "\e185";
}
.glyphicon-sd-video:before {
  content: "\e186";
}
.glyphicon-hd-video:before {
  content: "\e187";
}
.glyphicon-subtitles:before {
  content: "\e188";
}
.glyphicon-sound-stereo:before {
  content: "\e189";
}
.glyphicon-sound-dolby:before {
  content: "\e190";
}
.glyphicon-sound-5-1:before {
  content: "\e191";
}
.glyphicon-sound-6-1:before {
  content: "\e192";
}
.glyphicon-sound-7-1:before {
  content: "\e193";
}
.glyphicon-copyright-mark:before {
  content: "\e194";
}
.glyphicon-registration-mark:before {
  content: "\e195";
}
.glyphicon-cloud-download:before {
  content: "\e197";
}
.glyphicon-cloud-upload:before {
  content: "\e198";
}
.glyphicon-tree-conifer:before {
  content: "\e199";
}
.glyphicon-tree-deciduous:before {
  content: "\e200";
}
.glyphicon-cd:before {
  content: "\e201";
}
.glyphicon-save-file:before {
  content: "\e202";
}
.glyphicon-open-file:before {
  content: "\e203";
}
.glyphicon-level-up:before {
  content: "\e204";
}
.glyphicon-copy:before {
  content: "\e205";
}
.glyphicon-paste:before {
  content: "\e206";
}
.glyphicon-alert:before {
  content: "\e209";
}
.glyphicon-equalizer:before {
  content: "\e210";
}
.glyphicon-king:before {
  content: "\e211";
}
.glyphicon-queen:before {
  content: "\e212";
}
.glyphicon-pawn:before {
  content: "\e213";
}
.glyphicon-bishop:before {
  content: "\e214";
}
.glyphicon-knight:before {
  content: "\e215";
}
.glyphicon-baby-formula:before {
  content: "\e216";
}
.glyphicon-tent:before {
  content: "\26fa";
}
.glyphicon-blackboard:before {
  content: "\e218";
}
.glyphicon-bed:before {
  content: "\e219";
}
.glyphicon-apple:before {
  content: "\f8ff";
}
.glyphicon-erase:before {
  content: "\e221";
}
.glyphicon-hourglass:before {
  content: "\231b";
}
.glyphicon-lamp:before {
  content: "\e223";
}
.glyphicon-duplicate:before {
  content: "\e224";
}
.glyphicon-piggy-bank:before {
  content: "\e225";
}
.glyphicon-scissors:before {
  content: "\e226";
}
.glyphicon-bitcoin:before {
  content: "\e227";
}
.glyphicon-btc:before {
  content: "\e227";
}
.glyphicon-xbt:before {
  content: "\e227";
}
.glyphicon-yen:before {
  content: "\00a5";
}
.glyphicon-jpy:before {
  content: "\00a5";
}
.glyphicon-ruble:before {
  content: "\20bd";
}
.glyphicon-rub:before {
  content: "\20bd";
}
.glyphicon-scale:before {
  content: "\e230";
}
.glyphicon-ice-lolly:before {
  content: "\e231";
}
.glyphicon-ice-lolly-tasted:before {
  content: "\e232";
}
.glyphicon-education:before {
  content: "\e233";
}
.glyphicon-option-horizontal:before {
  content: "\e234";
}
.glyphicon-option-vertical:before {
  content: "\e235";
}
.glyphicon-menu-hamburger:before {
  content: "\e236";
}
.glyphicon-modal-window:before {
  content: "\e237";
}
.glyphicon-oil:before {
  content: "\e238";
}
.glyphicon-grain:before {
  content: "\e239";
}
.glyphicon-sunglasses:before {
  content: "\e240";
}
.glyphicon-text-size:before {
  content: "\e241";
}
.glyphicon-text-color:before {
  content: "\e242";
}
.glyphicon-text-background:before {
  content: "\e243";
}
.glyphicon-object-align-top:before {
  content: "\e244";
}
.glyphicon-object-align-bottom:before {
  content: "\e245";
}
.glyphicon-object-align-horizontal:before {
  content: "\e246";
}
.glyphicon-object-align-left:before {
  content: "\e247";
}
.glyphicon-object-align-vertical:before {
  content: "\e248";
}
.glyphicon-object-align-right:before {
  content: "\e249";
}
.glyphicon-triangle-right:before {
  content: "\e250";
}
.glyphicon-triangle-left:before {
  content: "\e251";
}
.glyphicon-triangle-bottom:before {
  content: "\e252";
}
.glyphicon-triangle-top:before {
  content: "\e253";
}
.glyphicon-console:before {
  content: "\e254";
}
.glyphicon-superscript:before {
  content: "\e255";
}
.glyphicon-subscript:before {
  content: "\e256";
}
.glyphicon-menu-left:before {
  content: "\e257";
}
.glyphicon-menu-right:before {
  content: "\e258";
}
.glyphicon-menu-down:before {
  content: "\e259";
}
.glyphicon-menu-up:before {
  content: "\e260";
}
* {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}
*:before,
*:after {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}
html {
  font-size: 10px;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}
body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-size: 13px;
  line-height: 1.42857143;
  color: #000;
  background-color: #fff;
}
input,
button,
select,
textarea {
  font-family: inherit;
  font-size: inherit;
  line-height: inherit;
}
a {
  color: #337ab7;
  text-decoration: none;
}
a:hover,
a:focus {
  color: #23527c;
  text-decoration: underline;
}
a:focus {
  outline: 5px auto -webkit-focus-ring-color;
  outline-offset: -2px;
}
figure {
  margin: 0;
}
img {
  vertical-align: middle;
}
.img-responsive,
.thumbnail > img,
.thumbnail a > img,
.carousel-inner > .item > img,
.carousel-inner > .item > a > img {
  display: block;
  max-width: 100%;
  height: auto;
}
.img-rounded {
  border-radius: 3px;
}
.img-thumbnail {
  padding: 4px;
  line-height: 1.42857143;
  background-color: #fff;
  border: 1px solid #ddd;
  border-radius: 2px;
  -webkit-transition: all 0.2s ease-in-out;
  -o-transition: all 0.2s ease-in-out;
  transition: all 0.2s ease-in-out;
  display: inline-block;
  max-width: 100%;
  height: auto;
}
.img-circle {
  border-radius: 50%;
}
hr {
  margin-top: 18px;
  margin-bottom: 18px;
  border: 0;
  border-top: 1px solid #eeeeee;
}
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  margin: -1px;
  padding: 0;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  border: 0;
}
.sr-only-focusable:active,
.sr-only-focusable:focus {
  position: static;
  width: auto;
  height: auto;
  margin: 0;
  overflow: visible;
  clip: auto;
}
[role="button"] {
  cursor: pointer;
}
h1,
h2,
h3,
h4,
h5,
h6,
.h1,
.h2,
.h3,
.h4,
.h5,
.h6 {
  font-family: inherit;
  font-weight: 500;
  line-height: 1.1;
  color: inherit;
}
h1 small,
h2 small,
h3 small,
h4 small,
h5 small,
h6 small,
.h1 small,
.h2 small,
.h3 small,
.h4 small,
.h5 small,
.h6 small,
h1 .small,
h2 .small,
h3 .small,
h4 .small,
h5 .small,
h6 .small,
.h1 .small,
.h2 .small,
.h3 .small,
.h4 .small,
.h5 .small,
.h6 .small {
  font-weight: normal;
  line-height: 1;
  color: #777777;
}
h1,
.h1,
h2,
.h2,
h3,
.h3 {
  margin-top: 18px;
  margin-bottom: 9px;
}
h1 small,
.h1 small,
h2 small,
.h2 small,
h3 small,
.h3 small,
h1 .small,
.h1 .small,
h2 .small,
.h2 .small,
h3 .small,
.h3 .small {
  font-size: 65%;
}
h4,
.h4,
h5,
.h5,
h6,
.h6 {
  margin-top: 9px;
  margin-bottom: 9px;
}
h4 small,
.h4 small,
h5 small,
.h5 small,
h6 small,
.h6 small,
h4 .small,
.h4 .small,
h5 .small,
.h5 .small,
h6 .small,
.h6 .small {
  font-size: 75%;
}
h1,
.h1 {
  font-size: 33px;
}
h2,
.h2 {
  font-size: 27px;
}
h3,
.h3 {
  font-size: 23px;
}
h4,
.h4 {
  font-size: 17px;
}
h5,
.h5 {
  font-size: 13px;
}
h6,
.h6 {
  font-size: 12px;
}
p {
  margin: 0 0 9px;
}
.lead {
  margin-bottom: 18px;
  font-size: 14px;
  font-weight: 300;
  line-height: 1.4;
}
@media (min-width: 768px) {
  .lead {
    font-size: 19.5px;
  }
}
small,
.small {
  font-size: 92%;
}
mark,
.mark {
  background-color: #fcf8e3;
  padding: .2em;
}
.text-left {
  text-align: left;
}
.text-right {
  text-align: right;
}
.text-center {
  text-align: center;
}
.text-justify {
  text-align: justify;
}
.text-nowrap {
  white-space: nowrap;
}
.text-lowercase {
  text-transform: lowercase;
}
.text-uppercase {
  text-transform: uppercase;
}
.text-capitalize {
  text-transform: capitalize;
}
.text-muted {
  color: #777777;
}
.text-primary {
  color: #337ab7;
}
a.text-primary:hover,
a.text-primary:focus {
  color: #286090;
}
.text-success {
  color: #3c763d;
}
a.text-success:hover,
a.text-success:focus {
  color: #2b542c;
}
.text-info {
  color: #31708f;
}
a.text-info:hover,
a.text-info:focus {
  color: #245269;
}
.text-warning {
  color: #8a6d3b;
}
a.text-warning:hover,
a.text-warning:focus {
  color: #66512c;
}
.text-danger {
  color: #a94442;
}
a.text-danger:hover,
a.text-danger:focus {
  color: #843534;
}
.bg-primary {
  color: #fff;
  background-color: #337ab7;
}
a.bg-primary:hover,
a.bg-primary:focus {
  background-color: #286090;
}
.bg-success {
  background-color: #dff0d8;
}
a.bg-success:hover,
a.bg-success:focus {
  background-color: #c1e2b3;
}
.bg-info {
  background-color: #d9edf7;
}
a.bg-info:hover,
a.bg-info:focus {
  background-color: #afd9ee;
}
.bg-warning {
  background-color: #fcf8e3;
}
a.bg-warning:hover,
a.bg-warning:focus {
  background-color: #f7ecb5;
}
.bg-danger {
  background-color: #f2dede;
}
a.bg-danger:hover,
a.bg-danger:focus {
  background-color: #e4b9b9;
}
.page-header {
  padding-bottom: 8px;
  margin: 36px 0 18px;
  border-bottom: 1px solid #eeeeee;
}
ul,
ol {
  margin-top: 0;
  margin-bottom: 9px;
}
ul ul,
ol ul,
ul ol,
ol ol {
  margin-bottom: 0;
}
.list-unstyled {
  padding-left: 0;
  list-style: none;
}
.list-inline {
  padding-left: 0;
  list-style: none;
  margin-left: -5px;
}
.list-inline > li {
  display: inline-block;
  padding-left: 5px;
  padding-right: 5px;
}
dl {
  margin-top: 0;
  margin-bottom: 18px;
}
dt,
dd {
  line-height: 1.42857143;
}
dt {
  font-weight: bold;
}
dd {
  margin-left: 0;
}
@media (min-width: 541px) {
  .dl-horizontal dt {
    float: left;
    width: 160px;
    clear: left;
    text-align: right;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .dl-horizontal dd {
    margin-left: 180px;
  }
}
abbr[title],
abbr[data-original-title] {
  cursor: help;
  border-bottom: 1px dotted #777777;
}
.initialism {
  font-size: 90%;
  text-transform: uppercase;
}
blockquote {
  padding: 9px 18px;
  margin: 0 0 18px;
  font-size: inherit;
  border-left: 5px solid #eeeeee;
}
blockquote p:last-child,
blockquote ul:last-child,
blockquote ol:last-child {
  margin-bottom: 0;
}
blockquote footer,
blockquote small,
blockquote .small {
  display: block;
  font-size: 80%;
  line-height: 1.42857143;
  color: #777777;
}
blockquote footer:before,
blockquote small:before,
blockquote .small:before {
  content: '\2014 \00A0';
}
.blockquote-reverse,
blockquote.pull-right {
  padding-right: 15px;
  padding-left: 0;
  border-right: 5px solid #eeeeee;
  border-left: 0;
  text-align: right;
}
.blockquote-reverse footer:before,
blockquote.pull-right footer:before,
.blockquote-reverse small:before,
blockquote.pull-right small:before,
.blockquote-reverse .small:before,
blockquote.pull-right .small:before {
  content: '';
}
.blockquote-reverse footer:after,
blockquote.pull-right footer:after,
.blockquote-reverse small:after,
blockquote.pull-right small:after,
.blockquote-reverse .small:after,
blockquote.pull-right .small:after {
  content: '\00A0 \2014';
}
address {
  margin-bottom: 18px;
  font-style: normal;
  line-height: 1.42857143;
}
code,
kbd,
pre,
samp {
  font-family: monospace;
}
code {
  padding: 2px 4px;
  font-size: 90%;
  color: #c7254e;
  background-color: #f9f2f4;
  border-radius: 2px;
}
kbd {
  padding: 2px 4px;
  font-size: 90%;
  color: #888;
  background-color: transparent;
  border-radius: 1px;
  box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.25);
}
kbd kbd {
  padding: 0;
  font-size: 100%;
  font-weight: bold;
  box-shadow: none;
}
pre {
  display: block;
  padding: 8.5px;
  margin: 0 0 9px;
  font-size: 12px;
  line-height: 1.42857143;
  word-break: break-all;
  word-wrap: break-word;
  color: #333333;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 2px;
}
pre code {
  padding: 0;
  font-size: inherit;
  color: inherit;
  white-space: pre-wrap;
  background-color: transparent;
  border-radius: 0;
}
.pre-scrollable {
  max-height: 340px;
  overflow-y: scroll;
}
.container {
  margin-right: auto;
  margin-left: auto;
  padding-left: 0px;
  padding-right: 0px;
}
@media (min-width: 768px) {
  .container {
    width: 768px;
  }
}
@media (min-width: 992px) {
  .container {
    width: 940px;
  }
}
@media (min-width: 1200px) {
  .container {
    width: 1140px;
  }
}
.container-fluid {
  margin-right: auto;
  margin-left: auto;
  padding-left: 0px;
  padding-right: 0px;
}
.row {
  margin-left: 0px;
  margin-right: 0px;
}
.col-xs-1, .col-sm-1, .col-md-1, .col-lg-1, .col-xs-2, .col-sm-2, .col-md-2, .col-lg-2, .col-xs-3, .col-sm-3, .col-md-3, .col-lg-3, .col-xs-4, .col-sm-4, .col-md-4, .col-lg-4, .col-xs-5, .col-sm-5, .col-md-5, .col-lg-5, .col-xs-6, .col-sm-6, .col-md-6, .col-lg-6, .col-xs-7, .col-sm-7, .col-md-7, .col-lg-7, .col-xs-8, .col-sm-8, .col-md-8, .col-lg-8, .col-xs-9, .col-sm-9, .col-md-9, .col-lg-9, .col-xs-10, .col-sm-10, .col-md-10, .col-lg-10, .col-xs-11, .col-sm-11, .col-md-11, .col-lg-11, .col-xs-12, .col-sm-12, .col-md-12, .col-lg-12 {
  position: relative;
  min-height: 1px;
  padding-left: 0px;
  padding-right: 0px;
}
.col-xs-1, .col-xs-2, .col-xs-3, .col-xs-4, .col-xs-5, .col-xs-6, .col-xs-7, .col-xs-8, .col-xs-9, .col-xs-10, .col-xs-11, .col-xs-12 {
  float: left;
}
.col-xs-12 {
  width: 100%;
}
.col-xs-11 {
  width: 91.66666667%;
}
.col-xs-10 {
  width: 83.33333333%;
}
.col-xs-9 {
  width: 75%;
}
.col-xs-8 {
  width: 66.66666667%;
}
.col-xs-7 {
  width: 58.33333333%;
}
.col-xs-6 {
  width: 50%;
}
.col-xs-5 {
  width: 41.66666667%;
}
.col-xs-4 {
  width: 33.33333333%;
}
.col-xs-3 {
  width: 25%;
}
.col-xs-2 {
  width: 16.66666667%;
}
.col-xs-1 {
  width: 8.33333333%;
}
.col-xs-pull-12 {
  right: 100%;
}
.col-xs-pull-11 {
  right: 91.66666667%;
}
.col-xs-pull-10 {
  right: 83.33333333%;
}
.col-xs-pull-9 {
  right: 75%;
}
.col-xs-pull-8 {
  right: 66.66666667%;
}
.col-xs-pull-7 {
  right: 58.33333333%;
}
.col-xs-pull-6 {
  right: 50%;
}
.col-xs-pull-5 {
  right: 41.66666667%;
}
.col-xs-pull-4 {
  right: 33.33333333%;
}
.col-xs-pull-3 {
  right: 25%;
}
.col-xs-pull-2 {
  right: 16.66666667%;
}
.col-xs-pull-1 {
  right: 8.33333333%;
}
.col-xs-pull-0 {
  right: auto;
}
.col-xs-push-12 {
  left: 100%;
}
.col-xs-push-11 {
  left: 91.66666667%;
}
.col-xs-push-10 {
  left: 83.33333333%;
}
.col-xs-push-9 {
  left: 75%;
}
.col-xs-push-8 {
  left: 66.66666667%;
}
.col-xs-push-7 {
  left: 58.33333333%;
}
.col-xs-push-6 {
  left: 50%;
}
.col-xs-push-5 {
  left: 41.66666667%;
}
.col-xs-push-4 {
  left: 33.33333333%;
}
.col-xs-push-3 {
  left: 25%;
}
.col-xs-push-2 {
  left: 16.66666667%;
}
.col-xs-push-1 {
  left: 8.33333333%;
}
.col-xs-push-0 {
  left: auto;
}
.col-xs-offset-12 {
  margin-left: 100%;
}
.col-xs-offset-11 {
  margin-left: 91.66666667%;
}
.col-xs-offset-10 {
  margin-left: 83.33333333%;
}
.col-xs-offset-9 {
  margin-left: 75%;
}
.col-xs-offset-8 {
  margin-left: 66.66666667%;
}
.col-xs-offset-7 {
  margin-left: 58.33333333%;
}
.col-xs-offset-6 {
  margin-left: 50%;
}
.col-xs-offset-5 {
  margin-left: 41.66666667%;
}
.col-xs-offset-4 {
  margin-left: 33.33333333%;
}
.col-xs-offset-3 {
  margin-left: 25%;
}
.col-xs-offset-2 {
  margin-left: 16.66666667%;
}
.col-xs-offset-1 {
  margin-left: 8.33333333%;
}
.col-xs-offset-0 {
  margin-left: 0%;
}
@media (min-width: 768px) {
  .col-sm-1, .col-sm-2, .col-sm-3, .col-sm-4, .col-sm-5, .col-sm-6, .col-sm-7, .col-sm-8, .col-sm-9, .col-sm-10, .col-sm-11, .col-sm-12 {
    float: left;
  }
  .col-sm-12 {
    width: 100%;
  }
  .col-sm-11 {
    width: 91.66666667%;
  }
  .col-sm-10 {
    width: 83.33333333%;
  }
  .col-sm-9 {
    width: 75%;
  }
  .col-sm-8 {
    width: 66.66666667%;
  }
  .col-sm-7 {
    width: 58.33333333%;
  }
  .col-sm-6 {
    width: 50%;
  }
  .col-sm-5 {
    width: 41.66666667%;
  }
  .col-sm-4 {
    width: 33.33333333%;
  }
  .col-sm-3 {
    width: 25%;
  }
  .col-sm-2 {
    width: 16.66666667%;
  }
  .col-sm-1 {
    width: 8.33333333%;
  }
  .col-sm-pull-12 {
    right: 100%;
  }
  .col-sm-pull-11 {
    right: 91.66666667%;
  }
  .col-sm-pull-10 {
    right: 83.33333333%;
  }
  .col-sm-pull-9 {
    right: 75%;
  }
  .col-sm-pull-8 {
    right: 66.66666667%;
  }
  .col-sm-pull-7 {
    right: 58.33333333%;
  }
  .col-sm-pull-6 {
    right: 50%;
  }
  .col-sm-pull-5 {
    right: 41.66666667%;
  }
  .col-sm-pull-4 {
    right: 33.33333333%;
  }
  .col-sm-pull-3 {
    right: 25%;
  }
  .col-sm-pull-2 {
    right: 16.66666667%;
  }
  .col-sm-pull-1 {
    right: 8.33333333%;
  }
  .col-sm-pull-0 {
    right: auto;
  }
  .col-sm-push-12 {
    left: 100%;
  }
  .col-sm-push-11 {
    left: 91.66666667%;
  }
  .col-sm-push-10 {
    left: 83.33333333%;
  }
  .col-sm-push-9 {
    left: 75%;
  }
  .col-sm-push-8 {
    left: 66.66666667%;
  }
  .col-sm-push-7 {
    left: 58.33333333%;
  }
  .col-sm-push-6 {
    left: 50%;
  }
  .col-sm-push-5 {
    left: 41.66666667%;
  }
  .col-sm-push-4 {
    left: 33.33333333%;
  }
  .col-sm-push-3 {
    left: 25%;
  }
  .col-sm-push-2 {
    left: 16.66666667%;
  }
  .col-sm-push-1 {
    left: 8.33333333%;
  }
  .col-sm-push-0 {
    left: auto;
  }
  .col-sm-offset-12 {
    margin-left: 100%;
  }
  .col-sm-offset-11 {
    margin-left: 91.66666667%;
  }
  .col-sm-offset-10 {
    margin-left: 83.33333333%;
  }
  .col-sm-offset-9 {
    margin-left: 75%;
  }
  .col-sm-offset-8 {
    margin-left: 66.66666667%;
  }
  .col-sm-offset-7 {
    margin-left: 58.33333333%;
  }
  .col-sm-offset-6 {
    margin-left: 50%;
  }
  .col-sm-offset-5 {
    margin-left: 41.66666667%;
  }
  .col-sm-offset-4 {
    margin-left: 33.33333333%;
  }
  .col-sm-offset-3 {
    margin-left: 25%;
  }
  .col-sm-offset-2 {
    margin-left: 16.66666667%;
  }
  .col-sm-offset-1 {
    margin-left: 8.33333333%;
  }
  .col-sm-offset-0 {
    margin-left: 0%;
  }
}
@media (min-width: 992px) {
  .col-md-1, .col-md-2, .col-md-3, .col-md-4, .col-md-5, .col-md-6, .col-md-7, .col-md-8, .col-md-9, .col-md-10, .col-md-11, .col-md-12 {
    float: left;
  }
  .col-md-12 {
    width: 100%;
  }
  .col-md-11 {
    width: 91.66666667%;
  }
  .col-md-10 {
    width: 83.33333333%;
  }
  .col-md-9 {
    width: 75%;
  }
  .col-md-8 {
    width: 66.66666667%;
  }
  .col-md-7 {
    width: 58.33333333%;
  }
  .col-md-6 {
    width: 50%;
  }
  .col-md-5 {
    width: 41.66666667%;
  }
  .col-md-4 {
    width: 33.33333333%;
  }
  .col-md-3 {
    width: 25%;
  }
  .col-md-2 {
    width: 16.66666667%;
  }
  .col-md-1 {
    width: 8.33333333%;
  }
  .col-md-pull-12 {
    right: 100%;
  }
  .col-md-pull-11 {
    right: 91.66666667%;
  }
  .col-md-pull-10 {
    right: 83.33333333%;
  }
  .col-md-pull-9 {
    right: 75%;
  }
  .col-md-pull-8 {
    right: 66.66666667%;
  }
  .col-md-pull-7 {
    right: 58.33333333%;
  }
  .col-md-pull-6 {
    right: 50%;
  }
  .col-md-pull-5 {
    right: 41.66666667%;
  }
  .col-md-pull-4 {
    right: 33.33333333%;
  }
  .col-md-pull-3 {
    right: 25%;
  }
  .col-md-pull-2 {
    right: 16.66666667%;
  }
  .col-md-pull-1 {
    right: 8.33333333%;
  }
  .col-md-pull-0 {
    right: auto;
  }
  .col-md-push-12 {
    left: 100%;
  }
  .col-md-push-11 {
    left: 91.66666667%;
  }
  .col-md-push-10 {
    left: 83.33333333%;
  }
  .col-md-push-9 {
    left: 75%;
  }
  .col-md-push-8 {
    left: 66.66666667%;
  }
  .col-md-push-7 {
    left: 58.33333333%;
  }
  .col-md-push-6 {
    left: 50%;
  }
  .col-md-push-5 {
    left: 41.66666667%;
  }
  .col-md-push-4 {
    left: 33.33333333%;
  }
  .col-md-push-3 {
    left: 25%;
  }
  .col-md-push-2 {
    left: 16.66666667%;
  }
  .col-md-push-1 {
    left: 8.33333333%;
  }
  .col-md-push-0 {
    left: auto;
  }
  .col-md-offset-12 {
    margin-left: 100%;
  }
  .col-md-offset-11 {
    margin-left: 91.66666667%;
  }
  .col-md-offset-10 {
    margin-left: 83.33333333%;
  }
  .col-md-offset-9 {
    margin-left: 75%;
  }
  .col-md-offset-8 {
    margin-left: 66.66666667%;
  }
  .col-md-offset-7 {
    margin-left: 58.33333333%;
  }
  .col-md-offset-6 {
    margin-left: 50%;
  }
  .col-md-offset-5 {
    margin-left: 41.66666667%;
  }
  .col-md-offset-4 {
    margin-left: 33.33333333%;
  }
  .col-md-offset-3 {
    margin-left: 25%;
  }
  .col-md-offset-2 {
    margin-left: 16.66666667%;
  }
  .col-md-offset-1 {
    margin-left: 8.33333333%;
  }
  .col-md-offset-0 {
    margin-left: 0%;
  }
}
@media (min-width: 1200px) {
  .col-lg-1, .col-lg-2, .col-lg-3, .col-lg-4, .col-lg-5, .col-lg-6, .col-lg-7, .col-lg-8, .col-lg-9, .col-lg-10, .col-lg-11, .col-lg-12 {
    float: left;
  }
  .col-lg-12 {
    width: 100%;
  }
  .col-lg-11 {
    width: 91.66666667%;
  }
  .col-lg-10 {
    width: 83.33333333%;
  }
  .col-lg-9 {
    width: 75%;
  }
  .col-lg-8 {
    width: 66.66666667%;
  }
  .col-lg-7 {
    width: 58.33333333%;
  }
  .col-lg-6 {
    width: 50%;
  }
  .col-lg-5 {
    width: 41.66666667%;
  }
  .col-lg-4 {
    width: 33.33333333%;
  }
  .col-lg-3 {
    width: 25%;
  }
  .col-lg-2 {
    width: 16.66666667%;
  }
  .col-lg-1 {
    width: 8.33333333%;
  }
  .col-lg-pull-12 {
    right: 100%;
  }
  .col-lg-pull-11 {
    right: 91.66666667%;
  }
  .col-lg-pull-10 {
    right: 83.33333333%;
  }
  .col-lg-pull-9 {
    right: 75%;
  }
  .col-lg-pull-8 {
    right: 66.66666667%;
  }
  .col-lg-pull-7 {
    right: 58.33333333%;
  }
  .col-lg-pull-6 {
    right: 50%;
  }
  .col-lg-pull-5 {
    right: 41.66666667%;
  }
  .col-lg-pull-4 {
    right: 33.33333333%;
  }
  .col-lg-pull-3 {
    right: 25%;
  }
  .col-lg-pull-2 {
    right: 16.66666667%;
  }
  .col-lg-pull-1 {
    right: 8.33333333%;
  }
  .col-lg-pull-0 {
    right: auto;
  }
  .col-lg-push-12 {
    left: 100%;
  }
  .col-lg-push-11 {
    left: 91.66666667%;
  }
  .col-lg-push-10 {
    left: 83.33333333%;
  }
  .col-lg-push-9 {
    left: 75%;
  }
  .col-lg-push-8 {
    left: 66.66666667%;
  }
  .col-lg-push-7 {
    left: 58.33333333%;
  }
  .col-lg-push-6 {
    left: 50%;
  }
  .col-lg-push-5 {
    left: 41.66666667%;
  }
  .col-lg-push-4 {
    left: 33.33333333%;
  }
  .col-lg-push-3 {
    left: 25%;
  }
  .col-lg-push-2 {
    left: 16.66666667%;
  }
  .col-lg-push-1 {
    left: 8.33333333%;
  }
  .col-lg-push-0 {
    left: auto;
  }
  .col-lg-offset-12 {
    margin-left: 100%;
  }
  .col-lg-offset-11 {
    margin-left: 91.66666667%;
  }
  .col-lg-offset-10 {
    margin-left: 83.33333333%;
  }
  .col-lg-offset-9 {
    margin-left: 75%;
  }
  .col-lg-offset-8 {
    margin-left: 66.66666667%;
  }
  .col-lg-offset-7 {
    margin-left: 58.33333333%;
  }
  .col-lg-offset-6 {
    margin-left: 50%;
  }
  .col-lg-offset-5 {
    margin-left: 41.66666667%;
  }
  .col-lg-offset-4 {
    margin-left: 33.33333333%;
  }
  .col-lg-offset-3 {
    margin-left: 25%;
  }
  .col-lg-offset-2 {
    margin-left: 16.66666667%;
  }
  .col-lg-offset-1 {
    margin-left: 8.33333333%;
  }
  .col-lg-offset-0 {
    margin-left: 0%;
  }
}
table {
  background-color: transparent;
}
caption {
  padding-top: 8px;
  padding-bottom: 8px;
  color: #777777;
  text-align: left;
}
th {
  text-align: left;
}
.table {
  width: 100%;
  max-width: 100%;
  margin-bottom: 18px;
}
.table > thead > tr > th,
.table > tbody > tr > th,
.table > tfoot > tr > th,
.table > thead > tr > td,
.table > tbody > tr > td,
.table > tfoot > tr > td {
  padding: 8px;
  line-height: 1.42857143;
  vertical-align: top;
  border-top: 1px solid #ddd;
}
.table > thead > tr > th {
  vertical-align: bottom;
  border-bottom: 2px solid #ddd;
}
.table > caption + thead > tr:first-child > th,
.table > colgroup + thead > tr:first-child > th,
.table > thead:first-child > tr:first-child > th,
.table > caption + thead > tr:first-child > td,
.table > colgroup + thead > tr:first-child > td,
.table > thead:first-child > tr:first-child > td {
  border-top: 0;
}
.table > tbody + tbody {
  border-top: 2px solid #ddd;
}
.table .table {
  background-color: #fff;
}
.table-condensed > thead > tr > th,
.table-condensed > tbody > tr > th,
.table-condensed > tfoot > tr > th,
.table-condensed > thead > tr > td,
.table-condensed > tbody > tr > td,
.table-condensed > tfoot > tr > td {
  padding: 5px;
}
.table-bordered {
  border: 1px solid #ddd;
}
.table-bordered > thead > tr > th,
.table-bordered > tbody > tr > th,
.table-bordered > tfoot > tr > th,
.table-bordered > thead > tr > td,
.table-bordered > tbody > tr > td,
.table-bordered > tfoot > tr > td {
  border: 1px solid #ddd;
}
.table-bordered > thead > tr > th,
.table-bordered > thead > tr > td {
  border-bottom-width: 2px;
}
.table-striped > tbody > tr:nth-of-type(odd) {
  background-color: #f9f9f9;
}
.table-hover > tbody > tr:hover {
  background-color: #f5f5f5;
}
table col[class*="col-"] {
  position: static;
  float: none;
  display: table-column;
}
table td[class*="col-"],
table th[class*="col-"] {
  position: static;
  float: none;
  display: table-cell;
}
.table > thead > tr > td.active,
.table > tbody > tr > td.active,
.table > tfoot > tr > td.active,
.table > thead > tr > th.active,
.table > tbody > tr > th.active,
.table > tfoot > tr > th.active,
.table > thead > tr.active > td,
.table > tbody > tr.active > td,
.table > tfoot > tr.active > td,
.table > thead > tr.active > th,
.table > tbody > tr.active > th,
.table > tfoot > tr.active > th {
  background-color: #f5f5f5;
}
.table-hover > tbody > tr > td.active:hover,
.table-hover > tbody > tr > th.active:hover,
.table-hover > tbody > tr.active:hover > td,
.table-hover > tbody > tr:hover > .active,
.table-hover > tbody > tr.active:hover > th {
  background-color: #e8e8e8;
}
.table > thead > tr > td.success,
.table > tbody > tr > td.success,
.table > tfoot > tr > td.success,
.table > thead > tr > th.success,
.table > tbody > tr > th.success,
.table > tfoot > tr > th.success,
.table > thead > tr.success > td,
.table > tbody > tr.success > td,
.table > tfoot > tr.success > td,
.table > thead > tr.success > th,
.table > tbody > tr.success > th,
.table > tfoot > tr.success > th {
  background-color: #dff0d8;
}
.table-hover > tbody > tr > td.success:hover,
.table-hover > tbody > tr > th.success:hover,
.table-hover > tbody > tr.success:hover > td,
.table-hover > tbody > tr:hover > .success,
.table-hover > tbody > tr.success:hover > th {
  background-color: #d0e9c6;
}
.table > thead > tr > td.info,
.table > tbody > tr > td.info,
.table > tfoot > tr > td.info,
.table > thead > tr > th.info,
.table > tbody > tr > th.info,
.table > tfoot > tr > th.info,
.table > thead > tr.info > td,
.table > tbody > tr.info > td,
.table > tfoot > tr.info > td,
.table > thead > tr.info > th,
.table > tbody > tr.info > th,
.table > tfoot > tr.info > th {
  background-color: #d9edf7;
}
.table-hover > tbody > tr > td.info:hover,
.table-hover > tbody > tr > th.info:hover,
.table-hover > tbody > tr.info:hover > td,
.table-hover > tbody > tr:hover > .info,
.table-hover > tbody > tr.info:hover > th {
  background-color: #c4e3f3;
}
.table > thead > tr > td.warning,
.table > tbody > tr > td.warning,
.table > tfoot > tr > td.warning,
.table > thead > tr > th.warning,
.table > tbody > tr > th.warning,
.table > tfoot > tr > th.warning,
.table > thead > tr.warning > td,
.table > tbody > tr.warning > td,
.table > tfoot > tr.warning > td,
.table > thead > tr.warning > th,
.table > tbody > tr.warning > th,
.table > tfoot > tr.warning > th {
  background-color: #fcf8e3;
}
.table-hover > tbody > tr > td.warning:hover,
.table-hover > tbody > tr > th.warning:hover,
.table-hover > tbody > tr.warning:hover > td,
.table-hover > tbody > tr:hover > .warning,
.table-hover > tbody > tr.warning:hover > th {
  background-color: #faf2cc;
}
.table > thead > tr > td.danger,
.table > tbody > tr > td.danger,
.table > tfoot > tr > td.danger,
.table > thead > tr > th.danger,
.table > tbody > tr > th.danger,
.table > tfoot > tr > th.danger,
.table > thead > tr.danger > td,
.table > tbody > tr.danger > td,
.table > tfoot > tr.danger > td,
.table > thead > tr.danger > th,
.table > tbody > tr.danger > th,
.table > tfoot > tr.danger > th {
  background-color: #f2dede;
}
.table-hover > tbody > tr > td.danger:hover,
.table-hover > tbody > tr > th.danger:hover,
.table-hover > tbody > tr.danger:hover > td,
.table-hover > tbody > tr:hover > .danger,
.table-hover > tbody > tr.danger:hover > th {
  background-color: #ebcccc;
}
.table-responsive {
  overflow-x: auto;
  min-height: 0.01%;
}
@media screen and (max-width: 767px) {
  .table-responsive {
    width: 100%;
    margin-bottom: 13.5px;
    overflow-y: hidden;
    -ms-overflow-style: -ms-autohiding-scrollbar;
    border: 1px solid #ddd;
  }
  .table-responsive > .table {
    margin-bottom: 0;
  }
  .table-responsive > .table > thead > tr > th,
  .table-responsive > .table > tbody > tr > th,
  .table-responsive > .table > tfoot > tr > th,
  .table-responsive > .table > thead > tr > td,
  .table-responsive > .table > tbody > tr > td,
  .table-responsive > .table > tfoot > tr > td {
    white-space: nowrap;
  }
  .table-responsive > .table-bordered {
    border: 0;
  }
  .table-responsive > .table-bordered > thead > tr > th:first-child,
  .table-responsive > .table-bordered > tbody > tr > th:first-child,
  .table-responsive > .table-bordered > tfoot > tr > th:first-child,
  .table-responsive > .table-bordered > thead > tr > td:first-child,
  .table-responsive > .table-bordered > tbody > tr > td:first-child,
  .table-responsive > .table-bordered > tfoot > tr > td:first-child {
    border-left: 0;
  }
  .table-responsive > .table-bordered > thead > tr > th:last-child,
  .table-responsive > .table-bordered > tbody > tr > th:last-child,
  .table-responsive > .table-bordered > tfoot > tr > th:last-child,
  .table-responsive > .table-bordered > thead > tr > td:last-child,
  .table-responsive > .table-bordered > tbody > tr > td:last-child,
  .table-responsive > .table-bordered > tfoot > tr > td:last-child {
    border-right: 0;
  }
  .table-responsive > .table-bordered > tbody > tr:last-child > th,
  .table-responsive > .table-bordered > tfoot > tr:last-child > th,
  .table-responsive > .table-bordered > tbody > tr:last-child > td,
  .table-responsive > .table-bordered > tfoot > tr:last-child > td {
    border-bottom: 0;
  }
}
fieldset {
  padding: 0;
  margin: 0;
  border: 0;
  min-width: 0;
}
legend {
  display: block;
  width: 100%;
  padding: 0;
  margin-bottom: 18px;
  font-size: 19.5px;
  line-height: inherit;
  color: #333333;
  border: 0;
  border-bottom: 1px solid #e5e5e5;
}
label {
  display: inline-block;
  max-width: 100%;
  margin-bottom: 5px;
  font-weight: bold;
}
input[type="search"] {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}
input[type="radio"],
input[type="checkbox"] {
  margin: 4px 0 0;
  margin-top: 1px \9;
  line-height: normal;
}
input[type="file"] {
  display: block;
}
input[type="range"] {
  display: block;
  width: 100%;
}
select[multiple],
select[size] {
  height: auto;
}
input[type="file"]:focus,
input[type="radio"]:focus,
input[type="checkbox"]:focus {
  outline: 5px auto -webkit-focus-ring-color;
  outline-offset: -2px;
}
output {
  display: block;
  padding-top: 7px;
  font-size: 13px;
  line-height: 1.42857143;
  color: #555555;
}
.form-control {
  display: block;
  width: 100%;
  height: 32px;
  padding: 6px 12px;
  font-size: 13px;
  line-height: 1.42857143;
  color: #555555;
  background-color: #fff;
  background-image: none;
  border: 1px solid #ccc;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  -webkit-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
  -o-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
  transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
}
.form-control:focus {
  border-color: #66afe9;
  outline: 0;
  -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(102, 175, 233, 0.6);
  box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(102, 175, 233, 0.6);
}
.form-control::-moz-placeholder {
  color: #999;
  opacity: 1;
}
.form-control:-ms-input-placeholder {
  color: #999;
}
.form-control::-webkit-input-placeholder {
  color: #999;
}
.form-control::-ms-expand {
  border: 0;
  background-color: transparent;
}
.form-control[disabled],
.form-control[readonly],
fieldset[disabled] .form-control {
  background-color: #eeeeee;
  opacity: 1;
}
.form-control[disabled],
fieldset[disabled] .form-control {
  cursor: not-allowed;
}
textarea.form-control {
  height: auto;
}
input[type="search"] {
  -webkit-appearance: none;
}
@media screen and (-webkit-min-device-pixel-ratio: 0) {
  input[type="date"].form-control,
  input[type="time"].form-control,
  input[type="datetime-local"].form-control,
  input[type="month"].form-control {
    line-height: 32px;
  }
  input[type="date"].input-sm,
  input[type="time"].input-sm,
  input[type="datetime-local"].input-sm,
  input[type="month"].input-sm,
  .input-group-sm input[type="date"],
  .input-group-sm input[type="time"],
  .input-group-sm input[type="datetime-local"],
  .input-group-sm input[type="month"] {
    line-height: 30px;
  }
  input[type="date"].input-lg,
  input[type="time"].input-lg,
  input[type="datetime-local"].input-lg,
  input[type="month"].input-lg,
  .input-group-lg input[type="date"],
  .input-group-lg input[type="time"],
  .input-group-lg input[type="datetime-local"],
  .input-group-lg input[type="month"] {
    line-height: 45px;
  }
}
.form-group {
  margin-bottom: 15px;
}
.radio,
.checkbox {
  position: relative;
  display: block;
  margin-top: 10px;
  margin-bottom: 10px;
}
.radio label,
.checkbox label {
  min-height: 18px;
  padding-left: 20px;
  margin-bottom: 0;
  font-weight: normal;
  cursor: pointer;
}
.radio input[type="radio"],
.radio-inline input[type="radio"],
.checkbox input[type="checkbox"],
.checkbox-inline input[type="checkbox"] {
  position: absolute;
  margin-left: -20px;
  margin-top: 4px \9;
}
.radio + .radio,
.checkbox + .checkbox {
  margin-top: -5px;
}
.radio-inline,
.checkbox-inline {
  position: relative;
  display: inline-block;
  padding-left: 20px;
  margin-bottom: 0;
  vertical-align: middle;
  font-weight: normal;
  cursor: pointer;
}
.radio-inline + .radio-inline,
.checkbox-inline + .checkbox-inline {
  margin-top: 0;
  margin-left: 10px;
}
input[type="radio"][disabled],
input[type="checkbox"][disabled],
input[type="radio"].disabled,
input[type="checkbox"].disabled,
fieldset[disabled] input[type="radio"],
fieldset[disabled] input[type="checkbox"] {
  cursor: not-allowed;
}
.radio-inline.disabled,
.checkbox-inline.disabled,
fieldset[disabled] .radio-inline,
fieldset[disabled] .checkbox-inline {
  cursor: not-allowed;
}
.radio.disabled label,
.checkbox.disabled label,
fieldset[disabled] .radio label,
fieldset[disabled] .checkbox label {
  cursor: not-allowed;
}
.form-control-static {
  padding-top: 7px;
  padding-bottom: 7px;
  margin-bottom: 0;
  min-height: 31px;
}
.form-control-static.input-lg,
.form-control-static.input-sm {
  padding-left: 0;
  padding-right: 0;
}
.input-sm {
  height: 30px;
  padding: 5px 10px;
  font-size: 12px;
  line-height: 1.5;
  border-radius: 1px;
}
select.input-sm {
  height: 30px;
  line-height: 30px;
}
textarea.input-sm,
select[multiple].input-sm {
  height: auto;
}
.form-group-sm .form-control {
  height: 30px;
  padding: 5px 10px;
  font-size: 12px;
  line-height: 1.5;
  border-radius: 1px;
}
.form-group-sm select.form-control {
  height: 30px;
  line-height: 30px;
}
.form-group-sm textarea.form-control,
.form-group-sm select[multiple].form-control {
  height: auto;
}
.form-group-sm .form-control-static {
  height: 30px;
  min-height: 30px;
  padding: 6px 10px;
  font-size: 12px;
  line-height: 1.5;
}
.input-lg {
  height: 45px;
  padding: 10px 16px;
  font-size: 17px;
  line-height: 1.3333333;
  border-radius: 3px;
}
select.input-lg {
  height: 45px;
  line-height: 45px;
}
textarea.input-lg,
select[multiple].input-lg {
  height: auto;
}
.form-group-lg .form-control {
  height: 45px;
  padding: 10px 16px;
  font-size: 17px;
  line-height: 1.3333333;
  border-radius: 3px;
}
.form-group-lg select.form-control {
  height: 45px;
  line-height: 45px;
}
.form-group-lg textarea.form-control,
.form-group-lg select[multiple].form-control {
  height: auto;
}
.form-group-lg .form-control-static {
  height: 45px;
  min-height: 35px;
  padding: 11px 16px;
  font-size: 17px;
  line-height: 1.3333333;
}
.has-feedback {
  position: relative;
}
.has-feedback .form-control {
  padding-right: 40px;
}
.form-control-feedback {
  position: absolute;
  top: 0;
  right: 0;
  z-index: 2;
  display: block;
  width: 32px;
  height: 32px;
  line-height: 32px;
  text-align: center;
  pointer-events: none;
}
.input-lg + .form-control-feedback,
.input-group-lg + .form-control-feedback,
.form-group-lg .form-control + .form-control-feedback {
  width: 45px;
  height: 45px;
  line-height: 45px;
}
.input-sm + .form-control-feedback,
.input-group-sm + .form-control-feedback,
.form-group-sm .form-control + .form-control-feedback {
  width: 30px;
  height: 30px;
  line-height: 30px;
}
.has-success .help-block,
.has-success .control-label,
.has-success .radio,
.has-success .checkbox,
.has-success .radio-inline,
.has-success .checkbox-inline,
.has-success.radio label,
.has-success.checkbox label,
.has-success.radio-inline label,
.has-success.checkbox-inline label {
  color: #3c763d;
}
.has-success .form-control {
  border-color: #3c763d;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
}
.has-success .form-control:focus {
  border-color: #2b542c;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px #67b168;
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px #67b168;
}
.has-success .input-group-addon {
  color: #3c763d;
  border-color: #3c763d;
  background-color: #dff0d8;
}
.has-success .form-control-feedback {
  color: #3c763d;
}
.has-warning .help-block,
.has-warning .control-label,
.has-warning .radio,
.has-warning .checkbox,
.has-warning .radio-inline,
.has-warning .checkbox-inline,
.has-warning.radio label,
.has-warning.checkbox label,
.has-warning.radio-inline label,
.has-warning.checkbox-inline label {
  color: #8a6d3b;
}
.has-warning .form-control {
  border-color: #8a6d3b;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
}
.has-warning .form-control:focus {
  border-color: #66512c;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px #c0a16b;
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px #c0a16b;
}
.has-warning .input-group-addon {
  color: #8a6d3b;
  border-color: #8a6d3b;
  background-color: #fcf8e3;
}
.has-warning .form-control-feedback {
  color: #8a6d3b;
}
.has-error .help-block,
.has-error .control-label,
.has-error .radio,
.has-error .checkbox,
.has-error .radio-inline,
.has-error .checkbox-inline,
.has-error.radio label,
.has-error.checkbox label,
.has-error.radio-inline label,
.has-error.checkbox-inline label {
  color: #a94442;
}
.has-error .form-control {
  border-color: #a94442;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
}
.has-error .form-control:focus {
  border-color: #843534;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px #ce8483;
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px #ce8483;
}
.has-error .input-group-addon {
  color: #a94442;
  border-color: #a94442;
  background-color: #f2dede;
}
.has-error .form-control-feedback {
  color: #a94442;
}
.has-feedback label ~ .form-control-feedback {
  top: 23px;
}
.has-feedback label.sr-only ~ .form-control-feedback {
  top: 0;
}
.help-block {
  display: block;
  margin-top: 5px;
  margin-bottom: 10px;
  color: #404040;
}
@media (min-width: 768px) {
  .form-inline .form-group {
    display: inline-block;
    margin-bottom: 0;
    vertical-align: middle;
  }
  .form-inline .form-control {
    display: inline-block;
    width: auto;
    vertical-align: middle;
  }
  .form-inline .form-control-static {
    display: inline-block;
  }
  .form-inline .input-group {
    display: inline-table;
    vertical-align: middle;
  }
  .form-inline .input-group .input-group-addon,
  .form-inline .input-group .input-group-btn,
  .form-inline .input-group .form-control {
    width: auto;
  }
  .form-inline .input-group > .form-control {
    width: 100%;
  }
  .form-inline .control-label {
    margin-bottom: 0;
    vertical-align: middle;
  }
  .form-inline .radio,
  .form-inline .checkbox {
    display: inline-block;
    margin-top: 0;
    margin-bottom: 0;
    vertical-align: middle;
  }
  .form-inline .radio label,
  .form-inline .checkbox label {
    padding-left: 0;
  }
  .form-inline .radio input[type="radio"],
  .form-inline .checkbox input[type="checkbox"] {
    position: relative;
    margin-left: 0;
  }
  .form-inline .has-feedback .form-control-feedback {
    top: 0;
  }
}
.form-horizontal .radio,
.form-horizontal .checkbox,
.form-horizontal .radio-inline,
.form-horizontal .checkbox-inline {
  margin-top: 0;
  margin-bottom: 0;
  padding-top: 7px;
}
.form-horizontal .radio,
.form-horizontal .checkbox {
  min-height: 25px;
}
.form-horizontal .form-group {
  margin-left: 0px;
  margin-right: 0px;
}
@media (min-width: 768px) {
  .form-horizontal .control-label {
    text-align: right;
    margin-bottom: 0;
    padding-top: 7px;
  }
}
.form-horizontal .has-feedback .form-control-feedback {
  right: 0px;
}
@media (min-width: 768px) {
  .form-horizontal .form-group-lg .control-label {
    padding-top: 11px;
    font-size: 17px;
  }
}
@media (min-width: 768px) {
  .form-horizontal .form-group-sm .control-label {
    padding-top: 6px;
    font-size: 12px;
  }
}
.btn {
  display: inline-block;
  margin-bottom: 0;
  font-weight: normal;
  text-align: center;
  vertical-align: middle;
  touch-action: manipulation;
  cursor: pointer;
  background-image: none;
  border: 1px solid transparent;
  white-space: nowrap;
  padding: 6px 12px;
  font-size: 13px;
  line-height: 1.42857143;
  border-radius: 2px;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
.btn:focus,
.btn:active:focus,
.btn.active:focus,
.btn.focus,
.btn:active.focus,
.btn.active.focus {
  outline: 5px auto -webkit-focus-ring-color;
  outline-offset: -2px;
}
.btn:hover,
.btn:focus,
.btn.focus {
  color: #333;
  text-decoration: none;
}
.btn:active,
.btn.active {
  outline: 0;
  background-image: none;
  -webkit-box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
  box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
}
.btn.disabled,
.btn[disabled],
fieldset[disabled] .btn {
  cursor: not-allowed;
  opacity: 0.65;
  filter: alpha(opacity=65);
  -webkit-box-shadow: none;
  box-shadow: none;
}
a.btn.disabled,
fieldset[disabled] a.btn {
  pointer-events: none;
}
.btn-default {
  color: #333;
  background-color: #fff;
  border-color: #ccc;
}
.btn-default:focus,
.btn-default.focus {
  color: #333;
  background-color: #e6e6e6;
  border-color: #8c8c8c;
}
.btn-default:hover {
  color: #333;
  background-color: #e6e6e6;
  border-color: #adadad;
}
.btn-default:active,
.btn-default.active,
.open > .dropdown-toggle.btn-default {
  color: #333;
  background-color: #e6e6e6;
  border-color: #adadad;
}
.btn-default:active:hover,
.btn-default.active:hover,
.open > .dropdown-toggle.btn-default:hover,
.btn-default:active:focus,
.btn-default.active:focus,
.open > .dropdown-toggle.btn-default:focus,
.btn-default:active.focus,
.btn-default.active.focus,
.open > .dropdown-toggle.btn-default.focus {
  color: #333;
  background-color: #d4d4d4;
  border-color: #8c8c8c;
}
.btn-default:active,
.btn-default.active,
.open > .dropdown-toggle.btn-default {
  background-image: none;
}
.btn-default.disabled:hover,
.btn-default[disabled]:hover,
fieldset[disabled] .btn-default:hover,
.btn-default.disabled:focus,
.btn-default[disabled]:focus,
fieldset[disabled] .btn-default:focus,
.btn-default.disabled.focus,
.btn-default[disabled].focus,
fieldset[disabled] .btn-default.focus {
  background-color: #fff;
  border-color: #ccc;
}
.btn-default .badge {
  color: #fff;
  background-color: #333;
}
.btn-primary {
  color: #fff;
  background-color: #337ab7;
  border-color: #2e6da4;
}
.btn-primary:focus,
.btn-primary.focus {
  color: #fff;
  background-color: #286090;
  border-color: #122b40;
}
.btn-primary:hover {
  color: #fff;
  background-color: #286090;
  border-color: #204d74;
}
.btn-primary:active,
.btn-primary.active,
.open > .dropdown-toggle.btn-primary {
  color: #fff;
  background-color: #286090;
  border-color: #204d74;
}
.btn-primary:active:hover,
.btn-primary.active:hover,
.open > .dropdown-toggle.btn-primary:hover,
.btn-primary:active:focus,
.btn-primary.active:focus,
.open > .dropdown-toggle.btn-primary:focus,
.btn-primary:active.focus,
.btn-primary.active.focus,
.open > .dropdown-toggle.btn-primary.focus {
  color: #fff;
  background-color: #204d74;
  border-color: #122b40;
}
.btn-primary:active,
.btn-primary.active,
.open > .dropdown-toggle.btn-primary {
  background-image: none;
}
.btn-primary.disabled:hover,
.btn-primary[disabled]:hover,
fieldset[disabled] .btn-primary:hover,
.btn-primary.disabled:focus,
.btn-primary[disabled]:focus,
fieldset[disabled] .btn-primary:focus,
.btn-primary.disabled.focus,
.btn-primary[disabled].focus,
fieldset[disabled] .btn-primary.focus {
  background-color: #337ab7;
  border-color: #2e6da4;
}
.btn-primary .badge {
  color: #337ab7;
  background-color: #fff;
}
.btn-success {
  color: #fff;
  background-color: #5cb85c;
  border-color: #4cae4c;
}
.btn-success:focus,
.btn-success.focus {
  color: #fff;
  background-color: #449d44;
  border-color: #255625;
}
.btn-success:hover {
  color: #fff;
  background-color: #449d44;
  border-color: #398439;
}
.btn-success:active,
.btn-success.active,
.open > .dropdown-toggle.btn-success {
  color: #fff;
  background-color: #449d44;
  border-color: #398439;
}
.btn-success:active:hover,
.btn-success.active:hover,
.open > .dropdown-toggle.btn-success:hover,
.btn-success:active:focus,
.btn-success.active:focus,
.open > .dropdown-toggle.btn-success:focus,
.btn-success:active.focus,
.btn-success.active.focus,
.open > .dropdown-toggle.btn-success.focus {
  color: #fff;
  background-color: #398439;
  border-color: #255625;
}
.btn-success:active,
.btn-success.active,
.open > .dropdown-toggle.btn-success {
  background-image: none;
}
.btn-success.disabled:hover,
.btn-success[disabled]:hover,
fieldset[disabled] .btn-success:hover,
.btn-success.disabled:focus,
.btn-success[disabled]:focus,
fieldset[disabled] .btn-success:focus,
.btn-success.disabled.focus,
.btn-success[disabled].focus,
fieldset[disabled] .btn-success.focus {
  background-color: #5cb85c;
  border-color: #4cae4c;
}
.btn-success .badge {
  color: #5cb85c;
  background-color: #fff;
}
.btn-info {
  color: #fff;
  background-color: #5bc0de;
  border-color: #46b8da;
}
.btn-info:focus,
.btn-info.focus {
  color: #fff;
  background-color: #31b0d5;
  border-color: #1b6d85;
}
.btn-info:hover {
  color: #fff;
  background-color: #31b0d5;
  border-color: #269abc;
}
.btn-info:active,
.btn-info.active,
.open > .dropdown-toggle.btn-info {
  color: #fff;
  background-color: #31b0d5;
  border-color: #269abc;
}
.btn-info:active:hover,
.btn-info.active:hover,
.open > .dropdown-toggle.btn-info:hover,
.btn-info:active:focus,
.btn-info.active:focus,
.open > .dropdown-toggle.btn-info:focus,
.btn-info:active.focus,
.btn-info.active.focus,
.open > .dropdown-toggle.btn-info.focus {
  color: #fff;
  background-color: #269abc;
  border-color: #1b6d85;
}
.btn-info:active,
.btn-info.active,
.open > .dropdown-toggle.btn-info {
  background-image: none;
}
.btn-info.disabled:hover,
.btn-info[disabled]:hover,
fieldset[disabled] .btn-info:hover,
.btn-info.disabled:focus,
.btn-info[disabled]:focus,
fieldset[disabled] .btn-info:focus,
.btn-info.disabled.focus,
.btn-info[disabled].focus,
fieldset[disabled] .btn-info.focus {
  background-color: #5bc0de;
  border-color: #46b8da;
}
.btn-info .badge {
  color: #5bc0de;
  background-color: #fff;
}
.btn-warning {
  color: #fff;
  background-color: #f0ad4e;
  border-color: #eea236;
}
.btn-warning:focus,
.btn-warning.focus {
  color: #fff;
  background-color: #ec971f;
  border-color: #985f0d;
}
.btn-warning:hover {
  color: #fff;
  background-color: #ec971f;
  border-color: #d58512;
}
.btn-warning:active,
.btn-warning.active,
.open > .dropdown-toggle.btn-warning {
  color: #fff;
  background-color: #ec971f;
  border-color: #d58512;
}
.btn-warning:active:hover,
.btn-warning.active:hover,
.open > .dropdown-toggle.btn-warning:hover,
.btn-warning:active:focus,
.btn-warning.active:focus,
.open > .dropdown-toggle.btn-warning:focus,
.btn-warning:active.focus,
.btn-warning.active.focus,
.open > .dropdown-toggle.btn-warning.focus {
  color: #fff;
  background-color: #d58512;
  border-color: #985f0d;
}
.btn-warning:active,
.btn-warning.active,
.open > .dropdown-toggle.btn-warning {
  background-image: none;
}
.btn-warning.disabled:hover,
.btn-warning[disabled]:hover,
fieldset[disabled] .btn-warning:hover,
.btn-warning.disabled:focus,
.btn-warning[disabled]:focus,
fieldset[disabled] .btn-warning:focus,
.btn-warning.disabled.focus,
.btn-warning[disabled].focus,
fieldset[disabled] .btn-warning.focus {
  background-color: #f0ad4e;
  border-color: #eea236;
}
.btn-warning .badge {
  color: #f0ad4e;
  background-color: #fff;
}
.btn-danger {
  color: #fff;
  background-color: #d9534f;
  border-color: #d43f3a;
}
.btn-danger:focus,
.btn-danger.focus {
  color: #fff;
  background-color: #c9302c;
  border-color: #761c19;
}
.btn-danger:hover {
  color: #fff;
  background-color: #c9302c;
  border-color: #ac2925;
}
.btn-danger:active,
.btn-danger.active,
.open > .dropdown-toggle.btn-danger {
  color: #fff;
  background-color: #c9302c;
  border-color: #ac2925;
}
.btn-danger:active:hover,
.btn-danger.active:hover,
.open > .dropdown-toggle.btn-danger:hover,
.btn-danger:active:focus,
.btn-danger.active:focus,
.open > .dropdown-toggle.btn-danger:focus,
.btn-danger:active.focus,
.btn-danger.active.focus,
.open > .dropdown-toggle.btn-danger.focus {
  color: #fff;
  background-color: #ac2925;
  border-color: #761c19;
}
.btn-danger:active,
.btn-danger.active,
.open > .dropdown-toggle.btn-danger {
  background-image: none;
}
.btn-danger.disabled:hover,
.btn-danger[disabled]:hover,
fieldset[disabled] .btn-danger:hover,
.btn-danger.disabled:focus,
.btn-danger[disabled]:focus,
fieldset[disabled] .btn-danger:focus,
.btn-danger.disabled.focus,
.btn-danger[disabled].focus,
fieldset[disabled] .btn-danger.focus {
  background-color: #d9534f;
  border-color: #d43f3a;
}
.btn-danger .badge {
  color: #d9534f;
  background-color: #fff;
}
.btn-link {
  color: #337ab7;
  font-weight: normal;
  border-radius: 0;
}
.btn-link,
.btn-link:active,
.btn-link.active,
.btn-link[disabled],
fieldset[disabled] .btn-link {
  background-color: transparent;
  -webkit-box-shadow: none;
  box-shadow: none;
}
.btn-link,
.btn-link:hover,
.btn-link:focus,
.btn-link:active {
  border-color: transparent;
}
.btn-link:hover,
.btn-link:focus {
  color: #23527c;
  text-decoration: underline;
  background-color: transparent;
}
.btn-link[disabled]:hover,
fieldset[disabled] .btn-link:hover,
.btn-link[disabled]:focus,
fieldset[disabled] .btn-link:focus {
  color: #777777;
  text-decoration: none;
}
.btn-lg,
.btn-group-lg > .btn {
  padding: 10px 16px;
  font-size: 17px;
  line-height: 1.3333333;
  border-radius: 3px;
}
.btn-sm,
.btn-group-sm > .btn {
  padding: 5px 10px;
  font-size: 12px;
  line-height: 1.5;
  border-radius: 1px;
}
.btn-xs,
.btn-group-xs > .btn {
  padding: 1px 5px;
  font-size: 12px;
  line-height: 1.5;
  border-radius: 1px;
}
.btn-block {
  display: block;
  width: 100%;
}
.btn-block + .btn-block {
  margin-top: 5px;
}
input[type="submit"].btn-block,
input[type="reset"].btn-block,
input[type="button"].btn-block {
  width: 100%;
}
.fade {
  opacity: 0;
  -webkit-transition: opacity 0.15s linear;
  -o-transition: opacity 0.15s linear;
  transition: opacity 0.15s linear;
}
.fade.in {
  opacity: 1;
}
.collapse {
  display: none;
}
.collapse.in {
  display: block;
}
tr.collapse.in {
  display: table-row;
}
tbody.collapse.in {
  display: table-row-group;
}
.collapsing {
  position: relative;
  height: 0;
  overflow: hidden;
  -webkit-transition-property: height, visibility;
  transition-property: height, visibility;
  -webkit-transition-duration: 0.35s;
  transition-duration: 0.35s;
  -webkit-transition-timing-function: ease;
  transition-timing-function: ease;
}
.caret {
  display: inline-block;
  width: 0;
  height: 0;
  margin-left: 2px;
  vertical-align: middle;
  border-top: 4px dashed;
  border-top: 4px solid \9;
  border-right: 4px solid transparent;
  border-left: 4px solid transparent;
}
.dropup,
.dropdown {
  position: relative;
}
.dropdown-toggle:focus {
  outline: 0;
}
.dropdown-menu {
  position: absolute;
  top: 100%;
  left: 0;
  z-index: 1000;
  display: none;
  float: left;
  min-width: 160px;
  padding: 5px 0;
  margin: 2px 0 0;
  list-style: none;
  font-size: 13px;
  text-align: left;
  background-color: #fff;
  border: 1px solid #ccc;
  border: 1px solid rgba(0, 0, 0, 0.15);
  border-radius: 2px;
  -webkit-box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);
  background-clip: padding-box;
}
.dropdown-menu.pull-right {
  right: 0;
  left: auto;
}
.dropdown-menu .divider {
  height: 1px;
  margin: 8px 0;
  overflow: hidden;
  background-color: #e5e5e5;
}
.dropdown-menu > li > a {
  display: block;
  padding: 3px 20px;
  clear: both;
  font-weight: normal;
  line-height: 1.42857143;
  color: #333333;
  white-space: nowrap;
}
.dropdown-menu > li > a:hover,
.dropdown-menu > li > a:focus {
  text-decoration: none;
  color: #262626;
  background-color: #f5f5f5;
}
.dropdown-menu > .active > a,
.dropdown-menu > .active > a:hover,
.dropdown-menu > .active > a:focus {
  color: #fff;
  text-decoration: none;
  outline: 0;
  background-color: #337ab7;
}
.dropdown-menu > .disabled > a,
.dropdown-menu > .disabled > a:hover,
.dropdown-menu > .disabled > a:focus {
  color: #777777;
}
.dropdown-menu > .disabled > a:hover,
.dropdown-menu > .disabled > a:focus {
  text-decoration: none;
  background-color: transparent;
  background-image: none;
  filter: progid:DXImageTransform.Microsoft.gradient(enabled = false);
  cursor: not-allowed;
}
.open > .dropdown-menu {
  display: block;
}
.open > a {
  outline: 0;
}
.dropdown-menu-right {
  left: auto;
  right: 0;
}
.dropdown-menu-left {
  left: 0;
  right: auto;
}
.dropdown-header {
  display: block;
  padding: 3px 20px;
  font-size: 12px;
  line-height: 1.42857143;
  color: #777777;
  white-space: nowrap;
}
.dropdown-backdrop {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  top: 0;
  z-index: 990;
}
.pull-right > .dropdown-menu {
  right: 0;
  left: auto;
}
.dropup .caret,
.navbar-fixed-bottom .dropdown .caret {
  border-top: 0;
  border-bottom: 4px dashed;
  border-bottom: 4px solid \9;
  content: "";
}
.dropup .dropdown-menu,
.navbar-fixed-bottom .dropdown .dropdown-menu {
  top: auto;
  bottom: 100%;
  margin-bottom: 2px;
}
@media (min-width: 541px) {
  .navbar-right .dropdown-menu {
    left: auto;
    right: 0;
  }
  .navbar-right .dropdown-menu-left {
    left: 0;
    right: auto;
  }
}
.btn-group,
.btn-group-vertical {
  position: relative;
  display: inline-block;
  vertical-align: middle;
}
.btn-group > .btn,
.btn-group-vertical > .btn {
  position: relative;
  float: left;
}
.btn-group > .btn:hover,
.btn-group-vertical > .btn:hover,
.btn-group > .btn:focus,
.btn-group-vertical > .btn:focus,
.btn-group > .btn:active,
.btn-group-vertical > .btn:active,
.btn-group > .btn.active,
.btn-group-vertical > .btn.active {
  z-index: 2;
}
.btn-group .btn + .btn,
.btn-group .btn + .btn-group,
.btn-group .btn-group + .btn,
.btn-group .btn-group + .btn-group {
  margin-left: -1px;
}
.btn-toolbar {
  margin-left: -5px;
}
.btn-toolbar .btn,
.btn-toolbar .btn-group,
.btn-toolbar .input-group {
  float: left;
}
.btn-toolbar > .btn,
.btn-toolbar > .btn-group,
.btn-toolbar > .input-group {
  margin-left: 5px;
}
.btn-group > .btn:not(:first-child):not(:last-child):not(.dropdown-toggle) {
  border-radius: 0;
}
.btn-group > .btn:first-child {
  margin-left: 0;
}
.btn-group > .btn:first-child:not(:last-child):not(.dropdown-toggle) {
  border-bottom-right-radius: 0;
  border-top-right-radius: 0;
}
.btn-group > .btn:last-child:not(:first-child),
.btn-group > .dropdown-toggle:not(:first-child) {
  border-bottom-left-radius: 0;
  border-top-left-radius: 0;
}
.btn-group > .btn-group {
  float: left;
}
.btn-group > .btn-group:not(:first-child):not(:last-child) > .btn {
  border-radius: 0;
}
.btn-group > .btn-group:first-child:not(:last-child) > .btn:last-child,
.btn-group > .btn-group:first-child:not(:last-child) > .dropdown-toggle {
  border-bottom-right-radius: 0;
  border-top-right-radius: 0;
}
.btn-group > .btn-group:last-child:not(:first-child) > .btn:first-child {
  border-bottom-left-radius: 0;
  border-top-left-radius: 0;
}
.btn-group .dropdown-toggle:active,
.btn-group.open .dropdown-toggle {
  outline: 0;
}
.btn-group > .btn + .dropdown-toggle {
  padding-left: 8px;
  padding-right: 8px;
}
.btn-group > .btn-lg + .dropdown-toggle {
  padding-left: 12px;
  padding-right: 12px;
}
.btn-group.open .dropdown-toggle {
  -webkit-box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
  box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
}
.btn-group.open .dropdown-toggle.btn-link {
  -webkit-box-shadow: none;
  box-shadow: none;
}
.btn .caret {
  margin-left: 0;
}
.btn-lg .caret {
  border-width: 5px 5px 0;
  border-bottom-width: 0;
}
.dropup .btn-lg .caret {
  border-width: 0 5px 5px;
}
.btn-group-vertical > .btn,
.btn-group-vertical > .btn-group,
.btn-group-vertical > .btn-group > .btn {
  display: block;
  float: none;
  width: 100%;
  max-width: 100%;
}
.btn-group-vertical > .btn-group > .btn {
  float: none;
}
.btn-group-vertical > .btn + .btn,
.btn-group-vertical > .btn + .btn-group,
.btn-group-vertical > .btn-group + .btn,
.btn-group-vertical > .btn-group + .btn-group {
  margin-top: -1px;
  margin-left: 0;
}
.btn-group-vertical > .btn:not(:first-child):not(:last-child) {
  border-radius: 0;
}
.btn-group-vertical > .btn:first-child:not(:last-child) {
  border-top-right-radius: 2px;
  border-top-left-radius: 2px;
  border-bottom-right-radius: 0;
  border-bottom-left-radius: 0;
}
.btn-group-vertical > .btn:last-child:not(:first-child) {
  border-top-right-radius: 0;
  border-top-left-radius: 0;
  border-bottom-right-radius: 2px;
  border-bottom-left-radius: 2px;
}
.btn-group-vertical > .btn-group:not(:first-child):not(:last-child) > .btn {
  border-radius: 0;
}
.btn-group-vertical > .btn-group:first-child:not(:last-child) > .btn:last-child,
.btn-group-vertical > .btn-group:first-child:not(:last-child) > .dropdown-toggle {
  border-bottom-right-radius: 0;
  border-bottom-left-radius: 0;
}
.btn-group-vertical > .btn-group:last-child:not(:first-child) > .btn:first-child {
  border-top-right-radius: 0;
  border-top-left-radius: 0;
}
.btn-group-justified {
  display: table;
  width: 100%;
  table-layout: fixed;
  border-collapse: separate;
}
.btn-group-justified > .btn,
.btn-group-justified > .btn-group {
  float: none;
  display: table-cell;
  width: 1%;
}
.btn-group-justified > .btn-group .btn {
  width: 100%;
}
.btn-group-justified > .btn-group .dropdown-menu {
  left: auto;
}
[data-toggle="buttons"] > .btn input[type="radio"],
[data-toggle="buttons"] > .btn-group > .btn input[type="radio"],
[data-toggle="buttons"] > .btn input[type="checkbox"],
[data-toggle="buttons"] > .btn-group > .btn input[type="checkbox"] {
  position: absolute;
  clip: rect(0, 0, 0, 0);
  pointer-events: none;
}
.input-group {
  position: relative;
  display: table;
  border-collapse: separate;
}
.input-group[class*="col-"] {
  float: none;
  padding-left: 0;
  padding-right: 0;
}
.input-group .form-control {
  position: relative;
  z-index: 2;
  float: left;
  width: 100%;
  margin-bottom: 0;
}
.input-group .form-control:focus {
  z-index: 3;
}
.input-group-lg > .form-control,
.input-group-lg > .input-group-addon,
.input-group-lg > .input-group-btn > .btn {
  height: 45px;
  padding: 10px 16px;
  font-size: 17px;
  line-height: 1.3333333;
  border-radius: 3px;
}
select.input-group-lg > .form-control,
select.input-group-lg > .input-group-addon,
select.input-group-lg > .input-group-btn > .btn {
  height: 45px;
  line-height: 45px;
}
textarea.input-group-lg > .form-control,
textarea.input-group-lg > .input-group-addon,
textarea.input-group-lg > .input-group-btn > .btn,
select[multiple].input-group-lg > .form-control,
select[multiple].input-group-lg > .input-group-addon,
select[multiple].input-group-lg > .input-group-btn > .btn {
  height: auto;
}
.input-group-sm > .form-control,
.input-group-sm > .input-group-addon,
.input-group-sm > .input-group-btn > .btn {
  height: 30px;
  padding: 5px 10px;
  font-size: 12px;
  line-height: 1.5;
  border-radius: 1px;
}
select.input-group-sm > .form-control,
select.input-group-sm > .input-group-addon,
select.input-group-sm > .input-group-btn > .btn {
  height: 30px;
  line-height: 30px;
}
textarea.input-group-sm > .form-control,
textarea.input-group-sm > .input-group-addon,
textarea.input-group-sm > .input-group-btn > .btn,
select[multiple].input-group-sm > .form-control,
select[multiple].input-group-sm > .input-group-addon,
select[multiple].input-group-sm > .input-group-btn > .btn {
  height: auto;
}
.input-group-addon,
.input-group-btn,
.input-group .form-control {
  display: table-cell;
}
.input-group-addon:not(:first-child):not(:last-child),
.input-group-btn:not(:first-child):not(:last-child),
.input-group .form-control:not(:first-child):not(:last-child) {
  border-radius: 0;
}
.input-group-addon,
.input-group-btn {
  width: 1%;
  white-space: nowrap;
  vertical-align: middle;
}
.input-group-addon {
  padding: 6px 12px;
  font-size: 13px;
  font-weight: normal;
  line-height: 1;
  color: #555555;
  text-align: center;
  background-color: #eeeeee;
  border: 1px solid #ccc;
  border-radius: 2px;
}
.input-group-addon.input-sm {
  padding: 5px 10px;
  font-size: 12px;
  border-radius: 1px;
}
.input-group-addon.input-lg {
  padding: 10px 16px;
  font-size: 17px;
  border-radius: 3px;
}
.input-group-addon input[type="radio"],
.input-group-addon input[type="checkbox"] {
  margin-top: 0;
}
.input-group .form-control:first-child,
.input-group-addon:first-child,
.input-group-btn:first-child > .btn,
.input-group-btn:first-child > .btn-group > .btn,
.input-group-btn:first-child > .dropdown-toggle,
.input-group-btn:last-child > .btn:not(:last-child):not(.dropdown-toggle),
.input-group-btn:last-child > .btn-group:not(:last-child) > .btn {
  border-bottom-right-radius: 0;
  border-top-right-radius: 0;
}
.input-group-addon:first-child {
  border-right: 0;
}
.input-group .form-control:last-child,
.input-group-addon:last-child,
.input-group-btn:last-child > .btn,
.input-group-btn:last-child > .btn-group > .btn,
.input-group-btn:last-child > .dropdown-toggle,
.input-group-btn:first-child > .btn:not(:first-child),
.input-group-btn:first-child > .btn-group:not(:first-child) > .btn {
  border-bottom-left-radius: 0;
  border-top-left-radius: 0;
}
.input-group-addon:last-child {
  border-left: 0;
}
.input-group-btn {
  position: relative;
  font-size: 0;
  white-space: nowrap;
}
.input-group-btn > .btn {
  position: relative;
}
.input-group-btn > .btn + .btn {
  margin-left: -1px;
}
.input-group-btn > .btn:hover,
.input-group-btn > .btn:focus,
.input-group-btn > .btn:active {
  z-index: 2;
}
.input-group-btn:first-child > .btn,
.input-group-btn:first-child > .btn-group {
  margin-right: -1px;
}
.input-group-btn:last-child > .btn,
.input-group-btn:last-child > .btn-group {
  z-index: 2;
  margin-left: -1px;
}
.nav {
  margin-bottom: 0;
  padding-left: 0;
  list-style: none;
}
.nav > li {
  position: relative;
  display: block;
}
.nav > li > a {
  position: relative;
  display: block;
  padding: 10px 15px;
}
.nav > li > a:hover,
.nav > li > a:focus {
  text-decoration: none;
  background-color: #eeeeee;
}
.nav > li.disabled > a {
  color: #777777;
}
.nav > li.disabled > a:hover,
.nav > li.disabled > a:focus {
  color: #777777;
  text-decoration: none;
  background-color: transparent;
  cursor: not-allowed;
}
.nav .open > a,
.nav .open > a:hover,
.nav .open > a:focus {
  background-color: #eeeeee;
  border-color: #337ab7;
}
.nav .nav-divider {
  height: 1px;
  margin: 8px 0;
  overflow: hidden;
  background-color: #e5e5e5;
}
.nav > li > a > img {
  max-width: none;
}
.nav-tabs {
  border-bottom: 1px solid #ddd;
}
.nav-tabs > li {
  float: left;
  margin-bottom: -1px;
}
.nav-tabs > li > a {
  margin-right: 2px;
  line-height: 1.42857143;
  border: 1px solid transparent;
  border-radius: 2px 2px 0 0;
}
.nav-tabs > li > a:hover {
  border-color: #eeeeee #eeeeee #ddd;
}
.nav-tabs > li.active > a,
.nav-tabs > li.active > a:hover,
.nav-tabs > li.active > a:focus {
  color: #555555;
  background-color: #fff;
  border: 1px solid #ddd;
  border-bottom-color: transparent;
  cursor: default;
}
.nav-tabs.nav-justified {
  width: 100%;
  border-bottom: 0;
}
.nav-tabs.nav-justified > li {
  float: none;
}
.nav-tabs.nav-justified > li > a {
  text-align: center;
  margin-bottom: 5px;
}
.nav-tabs.nav-justified > .dropdown .dropdown-menu {
  top: auto;
  left: auto;
}
@media (min-width: 768px) {
  .nav-tabs.nav-justified > li {
    display: table-cell;
    width: 1%;
  }
  .nav-tabs.nav-justified > li > a {
    margin-bottom: 0;
  }
}
.nav-tabs.nav-justified > li > a {
  margin-right: 0;
  border-radius: 2px;
}
.nav-tabs.nav-justified > .active > a,
.nav-tabs.nav-justified > .active > a:hover,
.nav-tabs.nav-justified > .active > a:focus {
  border: 1px solid #ddd;
}
@media (min-width: 768px) {
  .nav-tabs.nav-justified > li > a {
    border-bottom: 1px solid #ddd;
    border-radius: 2px 2px 0 0;
  }
  .nav-tabs.nav-justified > .active > a,
  .nav-tabs.nav-justified > .active > a:hover,
  .nav-tabs.nav-justified > .active > a:focus {
    border-bottom-color: #fff;
  }
}
.nav-pills > li {
  float: left;
}
.nav-pills > li > a {
  border-radius: 2px;
}
.nav-pills > li + li {
  margin-left: 2px;
}
.nav-pills > li.active > a,
.nav-pills > li.active > a:hover,
.nav-pills > li.active > a:focus {
  color: #fff;
  background-color: #337ab7;
}
.nav-stacked > li {
  float: none;
}
.nav-stacked > li + li {
  margin-top: 2px;
  margin-left: 0;
}
.nav-justified {
  width: 100%;
}
.nav-justified > li {
  float: none;
}
.nav-justified > li > a {
  text-align: center;
  margin-bottom: 5px;
}
.nav-justified > .dropdown .dropdown-menu {
  top: auto;
  left: auto;
}
@media (min-width: 768px) {
  .nav-justified > li {
    display: table-cell;
    width: 1%;
  }
  .nav-justified > li > a {
    margin-bottom: 0;
  }
}
.nav-tabs-justified {
  border-bottom: 0;
}
.nav-tabs-justified > li > a {
  margin-right: 0;
  border-radius: 2px;
}
.nav-tabs-justified > .active > a,
.nav-tabs-justified > .active > a:hover,
.nav-tabs-justified > .active > a:focus {
  border: 1px solid #ddd;
}
@media (min-width: 768px) {
  .nav-tabs-justified > li > a {
    border-bottom: 1px solid #ddd;
    border-radius: 2px 2px 0 0;
  }
  .nav-tabs-justified > .active > a,
  .nav-tabs-justified > .active > a:hover,
  .nav-tabs-justified > .active > a:focus {
    border-bottom-color: #fff;
  }
}
.tab-content > .tab-pane {
  display: none;
}
.tab-content > .active {
  display: block;
}
.nav-tabs .dropdown-menu {
  margin-top: -1px;
  border-top-right-radius: 0;
  border-top-left-radius: 0;
}
.navbar {
  position: relative;
  min-height: 30px;
  margin-bottom: 18px;
  border: 1px solid transparent;
}
@media (min-width: 541px) {
  .navbar {
    border-radius: 2px;
  }
}
@media (min-width: 541px) {
  .navbar-header {
    float: left;
  }
}
.navbar-collapse {
  overflow-x: visible;
  padding-right: 0px;
  padding-left: 0px;
  border-top: 1px solid transparent;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1);
  -webkit-overflow-scrolling: touch;
}
.navbar-collapse.in {
  overflow-y: auto;
}
@media (min-width: 541px) {
  .navbar-collapse {
    width: auto;
    border-top: 0;
    box-shadow: none;
  }
  .navbar-collapse.collapse {
    display: block !important;
    height: auto !important;
    padding-bottom: 0;
    overflow: visible !important;
  }
  .navbar-collapse.in {
    overflow-y: visible;
  }
  .navbar-fixed-top .navbar-collapse,
  .navbar-static-top .navbar-collapse,
  .navbar-fixed-bottom .navbar-collapse {
    padding-left: 0;
    padding-right: 0;
  }
}
.navbar-fixed-top .navbar-collapse,
.navbar-fixed-bottom .navbar-collapse {
  max-height: 340px;
}
@media (max-device-width: 540px) and (orientation: landscape) {
  .navbar-fixed-top .navbar-collapse,
  .navbar-fixed-bottom .navbar-collapse {
    max-height: 200px;
  }
}
.container > .navbar-header,
.container-fluid > .navbar-header,
.container > .navbar-collapse,
.container-fluid > .navbar-collapse {
  margin-right: 0px;
  margin-left: 0px;
}
@media (min-width: 541px) {
  .container > .navbar-header,
  .container-fluid > .navbar-header,
  .container > .navbar-collapse,
  .container-fluid > .navbar-collapse {
    margin-right: 0;
    margin-left: 0;
  }
}
.navbar-static-top {
  z-index: 1000;
  border-width: 0 0 1px;
}
@media (min-width: 541px) {
  .navbar-static-top {
    border-radius: 0;
  }
}
.navbar-fixed-top,
.navbar-fixed-bottom {
  position: fixed;
  right: 0;
  left: 0;
  z-index: 1030;
}
@media (min-width: 541px) {
  .navbar-fixed-top,
  .navbar-fixed-bottom {
    border-radius: 0;
  }
}
.navbar-fixed-top {
  top: 0;
  border-width: 0 0 1px;
}
.navbar-fixed-bottom {
  bottom: 0;
  margin-bottom: 0;
  border-width: 1px 0 0;
}
.navbar-brand {
  float: left;
  padding: 6px 0px;
  font-size: 17px;
  line-height: 18px;
  height: 30px;
}
.navbar-brand:hover,
.navbar-brand:focus {
  text-decoration: none;
}
.navbar-brand > img {
  display: block;
}
@media (min-width: 541px) {
  .navbar > .container .navbar-brand,
  .navbar > .container-fluid .navbar-brand {
    margin-left: 0px;
  }
}
.navbar-toggle {
  position: relative;
  float: right;
  margin-right: 0px;
  padding: 9px 10px;
  margin-top: -2px;
  margin-bottom: -2px;
  background-color: transparent;
  background-image: none;
  border: 1px solid transparent;
  border-radius: 2px;
}
.navbar-toggle:focus {
  outline: 0;
}
.navbar-toggle .icon-bar {
  display: block;
  width: 22px;
  height: 2px;
  border-radius: 1px;
}
.navbar-toggle .icon-bar + .icon-bar {
  margin-top: 4px;
}
@media (min-width: 541px) {
  .navbar-toggle {
    display: none;
  }
}
.navbar-nav {
  margin: 3px 0px;
}
.navbar-nav > li > a {
  padding-top: 10px;
  padding-bottom: 10px;
  line-height: 18px;
}
@media (max-width: 540px) {
  .navbar-nav .open .dropdown-menu {
    position: static;
    float: none;
    width: auto;
    margin-top: 0;
    background-color: transparent;
    border: 0;
    box-shadow: none;
  }
  .navbar-nav .open .dropdown-menu > li > a,
  .navbar-nav .open .dropdown-menu .dropdown-header {
    padding: 5px 15px 5px 25px;
  }
  .navbar-nav .open .dropdown-menu > li > a {
    line-height: 18px;
  }
  .navbar-nav .open .dropdown-menu > li > a:hover,
  .navbar-nav .open .dropdown-menu > li > a:focus {
    background-image: none;
  }
}
@media (min-width: 541px) {
  .navbar-nav {
    float: left;
    margin: 0;
  }
  .navbar-nav > li {
    float: left;
  }
  .navbar-nav > li > a {
    padding-top: 6px;
    padding-bottom: 6px;
  }
}
.navbar-form {
  margin-left: 0px;
  margin-right: 0px;
  padding: 10px 0px;
  border-top: 1px solid transparent;
  border-bottom: 1px solid transparent;
  -webkit-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 0 rgba(255, 255, 255, 0.1);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 0 rgba(255, 255, 255, 0.1);
  margin-top: -1px;
  margin-bottom: -1px;
}
@media (min-width: 768px) {
  .navbar-form .form-group {
    display: inline-block;
    margin-bottom: 0;
    vertical-align: middle;
  }
  .navbar-form .form-control {
    display: inline-block;
    width: auto;
    vertical-align: middle;
  }
  .navbar-form .form-control-static {
    display: inline-block;
  }
  .navbar-form .input-group {
    display: inline-table;
    vertical-align: middle;
  }
  .navbar-form .input-group .input-group-addon,
  .navbar-form .input-group .input-group-btn,
  .navbar-form .input-group .form-control {
    width: auto;
  }
  .navbar-form .input-group > .form-control {
    width: 100%;
  }
  .navbar-form .control-label {
    margin-bottom: 0;
    vertical-align: middle;
  }
  .navbar-form .radio,
  .navbar-form .checkbox {
    display: inline-block;
    margin-top: 0;
    margin-bottom: 0;
    vertical-align: middle;
  }
  .navbar-form .radio label,
  .navbar-form .checkbox label {
    padding-left: 0;
  }
  .navbar-form .radio input[type="radio"],
  .navbar-form .checkbox input[type="checkbox"] {
    position: relative;
    margin-left: 0;
  }
  .navbar-form .has-feedback .form-control-feedback {
    top: 0;
  }
}
@media (max-width: 540px) {
  .navbar-form .form-group {
    margin-bottom: 5px;
  }
  .navbar-form .form-group:last-child {
    margin-bottom: 0;
  }
}
@media (min-width: 541px) {
  .navbar-form {
    width: auto;
    border: 0;
    margin-left: 0;
    margin-right: 0;
    padding-top: 0;
    padding-bottom: 0;
    -webkit-box-shadow: none;
    box-shadow: none;
  }
}
.navbar-nav > li > .dropdown-menu {
  margin-top: 0;
  border-top-right-radius: 0;
  border-top-left-radius: 0;
}
.navbar-fixed-bottom .navbar-nav > li > .dropdown-menu {
  margin-bottom: 0;
  border-top-right-radius: 2px;
  border-top-left-radius: 2px;
  border-bottom-right-radius: 0;
  border-bottom-left-radius: 0;
}
.navbar-btn {
  margin-top: -1px;
  margin-bottom: -1px;
}
.navbar-btn.btn-sm {
  margin-top: 0px;
  margin-bottom: 0px;
}
.navbar-btn.btn-xs {
  margin-top: 4px;
  margin-bottom: 4px;
}
.navbar-text {
  margin-top: 6px;
  margin-bottom: 6px;
}
@media (min-width: 541px) {
  .navbar-text {
    float: left;
    margin-left: 0px;
    margin-right: 0px;
  }
}
@media (min-width: 541px) {
  .navbar-left {
    float: left !important;
    float: left;
  }
  .navbar-right {
    float: right !important;
    float: right;
    margin-right: 0px;
  }
  .navbar-right ~ .navbar-right {
    margin-right: 0;
  }
}
.navbar-default {
  background-color: #f8f8f8;
  border-color: #e7e7e7;
}
.navbar-default .navbar-brand {
  color: #777;
}
.navbar-default .navbar-brand:hover,
.navbar-default .navbar-brand:focus {
  color: #5e5e5e;
  background-color: transparent;
}
.navbar-default .navbar-text {
  color: #777;
}
.navbar-default .navbar-nav > li > a {
  color: #777;
}
.navbar-default .navbar-nav > li > a:hover,
.navbar-default .navbar-nav > li > a:focus {
  color: #333;
  background-color: transparent;
}
.navbar-default .navbar-nav > .active > a,
.navbar-default .navbar-nav > .active > a:hover,
.navbar-default .navbar-nav > .active > a:focus {
  color: #555;
  background-color: #e7e7e7;
}
.navbar-default .navbar-nav > .disabled > a,
.navbar-default .navbar-nav > .disabled > a:hover,
.navbar-default .navbar-nav > .disabled > a:focus {
  color: #ccc;
  background-color: transparent;
}
.navbar-default .navbar-toggle {
  border-color: #ddd;
}
.navbar-default .navbar-toggle:hover,
.navbar-default .navbar-toggle:focus {
  background-color: #ddd;
}
.navbar-default .navbar-toggle .icon-bar {
  background-color: #888;
}
.navbar-default .navbar-collapse,
.navbar-default .navbar-form {
  border-color: #e7e7e7;
}
.navbar-default .navbar-nav > .open > a,
.navbar-default .navbar-nav > .open > a:hover,
.navbar-default .navbar-nav > .open > a:focus {
  background-color: #e7e7e7;
  color: #555;
}
@media (max-width: 540px) {
  .navbar-default .navbar-nav .open .dropdown-menu > li > a {
    color: #777;
  }
  .navbar-default .navbar-nav .open .dropdown-menu > li > a:hover,
  .navbar-default .navbar-nav .open .dropdown-menu > li > a:focus {
    color: #333;
    background-color: transparent;
  }
  .navbar-default .navbar-nav .open .dropdown-menu > .active > a,
  .navbar-default .navbar-nav .open .dropdown-menu > .active > a:hover,
  .navbar-default .navbar-nav .open .dropdown-menu > .active > a:focus {
    color: #555;
    background-color: #e7e7e7;
  }
  .navbar-default .navbar-nav .open .dropdown-menu > .disabled > a,
  .navbar-default .navbar-nav .open .dropdown-menu > .disabled > a:hover,
  .navbar-default .navbar-nav .open .dropdown-menu > .disabled > a:focus {
    color: #ccc;
    background-color: transparent;
  }
}
.navbar-default .navbar-link {
  color: #777;
}
.navbar-default .navbar-link:hover {
  color: #333;
}
.navbar-default .btn-link {
  color: #777;
}
.navbar-default .btn-link:hover,
.navbar-default .btn-link:focus {
  color: #333;
}
.navbar-default .btn-link[disabled]:hover,
fieldset[disabled] .navbar-default .btn-link:hover,
.navbar-default .btn-link[disabled]:focus,
fieldset[disabled] .navbar-default .btn-link:focus {
  color: #ccc;
}
.navbar-inverse {
  background-color: #222;
  border-color: #080808;
}
.navbar-inverse .navbar-brand {
  color: #9d9d9d;
}
.navbar-inverse .navbar-brand:hover,
.navbar-inverse .navbar-brand:focus {
  color: #fff;
  background-color: transparent;
}
.navbar-inverse .navbar-text {
  color: #9d9d9d;
}
.navbar-inverse .navbar-nav > li > a {
  color: #9d9d9d;
}
.navbar-inverse .navbar-nav > li > a:hover,
.navbar-inverse .navbar-nav > li > a:focus {
  color: #fff;
  background-color: transparent;
}
.navbar-inverse .navbar-nav > .active > a,
.navbar-inverse .navbar-nav > .active > a:hover,
.navbar-inverse .navbar-nav > .active > a:focus {
  color: #fff;
  background-color: #080808;
}
.navbar-inverse .navbar-nav > .disabled > a,
.navbar-inverse .navbar-nav > .disabled > a:hover,
.navbar-inverse .navbar-nav > .disabled > a:focus {
  color: #444;
  background-color: transparent;
}
.navbar-inverse .navbar-toggle {
  border-color: #333;
}
.navbar-inverse .navbar-toggle:hover,
.navbar-inverse .navbar-toggle:focus {
  background-color: #333;
}
.navbar-inverse .navbar-toggle .icon-bar {
  background-color: #fff;
}
.navbar-inverse .navbar-collapse,
.navbar-inverse .navbar-form {
  border-color: #101010;
}
.navbar-inverse .navbar-nav > .open > a,
.navbar-inverse .navbar-nav > .open > a:hover,
.navbar-inverse .navbar-nav > .open > a:focus {
  background-color: #080808;
  color: #fff;
}
@media (max-width: 540px) {
  .navbar-inverse .navbar-nav .open .dropdown-menu > .dropdown-header {
    border-color: #080808;
  }
  .navbar-inverse .navbar-nav .open .dropdown-menu .divider {
    background-color: #080808;
  }
  .navbar-inverse .navbar-nav .open .dropdown-menu > li > a {
    color: #9d9d9d;
  }
  .navbar-inverse .navbar-nav .open .dropdown-menu > li > a:hover,
  .navbar-inverse .navbar-nav .open .dropdown-menu > li > a:focus {
    color: #fff;
    background-color: transparent;
  }
  .navbar-inverse .navbar-nav .open .dropdown-menu > .active > a,
  .navbar-inverse .navbar-nav .open .dropdown-menu > .active > a:hover,
  .navbar-inverse .navbar-nav .open .dropdown-menu > .active > a:focus {
    color: #fff;
    background-color: #080808;
  }
  .navbar-inverse .navbar-nav .open .dropdown-menu > .disabled > a,
  .navbar-inverse .navbar-nav .open .dropdown-menu > .disabled > a:hover,
  .navbar-inverse .navbar-nav .open .dropdown-menu > .disabled > a:focus {
    color: #444;
    background-color: transparent;
  }
}
.navbar-inverse .navbar-link {
  color: #9d9d9d;
}
.navbar-inverse .navbar-link:hover {
  color: #fff;
}
.navbar-inverse .btn-link {
  color: #9d9d9d;
}
.navbar-inverse .btn-link:hover,
.navbar-inverse .btn-link:focus {
  color: #fff;
}
.navbar-inverse .btn-link[disabled]:hover,
fieldset[disabled] .navbar-inverse .btn-link:hover,
.navbar-inverse .btn-link[disabled]:focus,
fieldset[disabled] .navbar-inverse .btn-link:focus {
  color: #444;
}
.breadcrumb {
  padding: 8px 15px;
  margin-bottom: 18px;
  list-style: none;
  background-color: #f5f5f5;
  border-radius: 2px;
}
.breadcrumb > li {
  display: inline-block;
}
.breadcrumb > li + li:before {
  content: "/\00a0";
  padding: 0 5px;
  color: #5e5e5e;
}
.breadcrumb > .active {
  color: #777777;
}
.pagination {
  display: inline-block;
  padding-left: 0;
  margin: 18px 0;
  border-radius: 2px;
}
.pagination > li {
  display: inline;
}
.pagination > li > a,
.pagination > li > span {
  position: relative;
  float: left;
  padding: 6px 12px;
  line-height: 1.42857143;
  text-decoration: none;
  color: #337ab7;
  background-color: #fff;
  border: 1px solid #ddd;
  margin-left: -1px;
}
.pagination > li:first-child > a,
.pagination > li:first-child > span {
  margin-left: 0;
  border-bottom-left-radius: 2px;
  border-top-left-radius: 2px;
}
.pagination > li:last-child > a,
.pagination > li:last-child > span {
  border-bottom-right-radius: 2px;
  border-top-right-radius: 2px;
}
.pagination > li > a:hover,
.pagination > li > span:hover,
.pagination > li > a:focus,
.pagination > li > span:focus {
  z-index: 2;
  color: #23527c;
  background-color: #eeeeee;
  border-color: #ddd;
}
.pagination > .active > a,
.pagination > .active > span,
.pagination > .active > a:hover,
.pagination > .active > span:hover,
.pagination > .active > a:focus,
.pagination > .active > span:focus {
  z-index: 3;
  color: #fff;
  background-color: #337ab7;
  border-color: #337ab7;
  cursor: default;
}
.pagination > .disabled > span,
.pagination > .disabled > span:hover,
.pagination > .disabled > span:focus,
.pagination > .disabled > a,
.pagination > .disabled > a:hover,
.pagination > .disabled > a:focus {
  color: #777777;
  background-color: #fff;
  border-color: #ddd;
  cursor: not-allowed;
}
.pagination-lg > li > a,
.pagination-lg > li > span {
  padding: 10px 16px;
  font-size: 17px;
  line-height: 1.3333333;
}
.pagination-lg > li:first-child > a,
.pagination-lg > li:first-child > span {
  border-bottom-left-radius: 3px;
  border-top-left-radius: 3px;
}
.pagination-lg > li:last-child > a,
.pagination-lg > li:last-child > span {
  border-bottom-right-radius: 3px;
  border-top-right-radius: 3px;
}
.pagination-sm > li > a,
.pagination-sm > li > span {
  padding: 5px 10px;
  font-size: 12px;
  line-height: 1.5;
}
.pagination-sm > li:first-child > a,
.pagination-sm > li:first-child > span {
  border-bottom-left-radius: 1px;
  border-top-left-radius: 1px;
}
.pagination-sm > li:last-child > a,
.pagination-sm > li:last-child > span {
  border-bottom-right-radius: 1px;
  border-top-right-radius: 1px;
}
.pager {
  padding-left: 0;
  margin: 18px 0;
  list-style: none;
  text-align: center;
}
.pager li {
  display: inline;
}
.pager li > a,
.pager li > span {
  display: inline-block;
  padding: 5px 14px;
  background-color: #fff;
  border: 1px solid #ddd;
  border-radius: 15px;
}
.pager li > a:hover,
.pager li > a:focus {
  text-decoration: none;
  background-color: #eeeeee;
}
.pager .next > a,
.pager .next > span {
  float: right;
}
.pager .previous > a,
.pager .previous > span {
  float: left;
}
.pager .disabled > a,
.pager .disabled > a:hover,
.pager .disabled > a:focus,
.pager .disabled > span {
  color: #777777;
  background-color: #fff;
  cursor: not-allowed;
}
.label {
  display: inline;
  padding: .2em .6em .3em;
  font-size: 75%;
  font-weight: bold;
  line-height: 1;
  color: #fff;
  text-align: center;
  white-space: nowrap;
  vertical-align: baseline;
  border-radius: .25em;
}
a.label:hover,
a.label:focus {
  color: #fff;
  text-decoration: none;
  cursor: pointer;
}
.label:empty {
  display: none;
}
.btn .label {
  position: relative;
  top: -1px;
}
.label-default {
  background-color: #777777;
}
.label-default[href]:hover,
.label-default[href]:focus {
  background-color: #5e5e5e;
}
.label-primary {
  background-color: #337ab7;
}
.label-primary[href]:hover,
.label-primary[href]:focus {
  background-color: #286090;
}
.label-success {
  background-color: #5cb85c;
}
.label-success[href]:hover,
.label-success[href]:focus {
  background-color: #449d44;
}
.label-info {
  background-color: #5bc0de;
}
.label-info[href]:hover,
.label-info[href]:focus {
  background-color: #31b0d5;
}
.label-warning {
  background-color: #f0ad4e;
}
.label-warning[href]:hover,
.label-warning[href]:focus {
  background-color: #ec971f;
}
.label-danger {
  background-color: #d9534f;
}
.label-danger[href]:hover,
.label-danger[href]:focus {
  background-color: #c9302c;
}
.badge {
  display: inline-block;
  min-width: 10px;
  padding: 3px 7px;
  font-size: 12px;
  font-weight: bold;
  color: #fff;
  line-height: 1;
  vertical-align: middle;
  white-space: nowrap;
  text-align: center;
  background-color: #777777;
  border-radius: 10px;
}
.badge:empty {
  display: none;
}
.btn .badge {
  position: relative;
  top: -1px;
}
.btn-xs .badge,
.btn-group-xs > .btn .badge {
  top: 0;
  padding: 1px 5px;
}
a.badge:hover,
a.badge:focus {
  color: #fff;
  text-decoration: none;
  cursor: pointer;
}
.list-group-item.active > .badge,
.nav-pills > .active > a > .badge {
  color: #337ab7;
  background-color: #fff;
}
.list-group-item > .badge {
  float: right;
}
.list-group-item > .badge + .badge {
  margin-right: 5px;
}
.nav-pills > li > a > .badge {
  margin-left: 3px;
}
.jumbotron {
  padding-top: 30px;
  padding-bottom: 30px;
  margin-bottom: 30px;
  color: inherit;
  background-color: #eeeeee;
}
.jumbotron h1,
.jumbotron .h1 {
  color: inherit;
}
.jumbotron p {
  margin-bottom: 15px;
  font-size: 20px;
  font-weight: 200;
}
.jumbotron > hr {
  border-top-color: #d5d5d5;
}
.container .jumbotron,
.container-fluid .jumbotron {
  border-radius: 3px;
  padding-left: 0px;
  padding-right: 0px;
}
.jumbotron .container {
  max-width: 100%;
}
@media screen and (min-width: 768px) {
  .jumbotron {
    padding-top: 48px;
    padding-bottom: 48px;
  }
  .container .jumbotron,
  .container-fluid .jumbotron {
    padding-left: 60px;
    padding-right: 60px;
  }
  .jumbotron h1,
  .jumbotron .h1 {
    font-size: 59px;
  }
}
.thumbnail {
  display: block;
  padding: 4px;
  margin-bottom: 18px;
  line-height: 1.42857143;
  background-color: #fff;
  border: 1px solid #ddd;
  border-radius: 2px;
  -webkit-transition: border 0.2s ease-in-out;
  -o-transition: border 0.2s ease-in-out;
  transition: border 0.2s ease-in-out;
}
.thumbnail > img,
.thumbnail a > img {
  margin-left: auto;
  margin-right: auto;
}
a.thumbnail:hover,
a.thumbnail:focus,
a.thumbnail.active {
  border-color: #337ab7;
}
.thumbnail .caption {
  padding: 9px;
  color: #000;
}
.alert {
  padding: 15px;
  margin-bottom: 18px;
  border: 1px solid transparent;
  border-radius: 2px;
}
.alert h4 {
  margin-top: 0;
  color: inherit;
}
.alert .alert-link {
  font-weight: bold;
}
.alert > p,
.alert > ul {
  margin-bottom: 0;
}
.alert > p + p {
  margin-top: 5px;
}
.alert-dismissable,
.alert-dismissible {
  padding-right: 35px;
}
.alert-dismissable .close,
.alert-dismissible .close {
  position: relative;
  top: -2px;
  right: -21px;
  color: inherit;
}
.alert-success {
  background-color: #dff0d8;
  border-color: #d6e9c6;
  color: #3c763d;
}
.alert-success hr {
  border-top-color: #c9e2b3;
}
.alert-success .alert-link {
  color: #2b542c;
}
.alert-info {
  background-color: #d9edf7;
  border-color: #bce8f1;
  color: #31708f;
}
.alert-info hr {
  border-top-color: #a6e1ec;
}
.alert-info .alert-link {
  color: #245269;
}
.alert-warning {
  background-color: #fcf8e3;
  border-color: #faebcc;
  color: #8a6d3b;
}
.alert-warning hr {
  border-top-color: #f7e1b5;
}
.alert-warning .alert-link {
  color: #66512c;
}
.alert-danger {
  background-color: #f2dede;
  border-color: #ebccd1;
  color: #a94442;
}
.alert-danger hr {
  border-top-color: #e4b9c0;
}
.alert-danger .alert-link {
  color: #843534;
}
@-webkit-keyframes progress-bar-stripes {
  from {
    background-position: 40px 0;
  }
  to {
    background-position: 0 0;
  }
}
@keyframes progress-bar-stripes {
  from {
    background-position: 40px 0;
  }
  to {
    background-position: 0 0;
  }
}
.progress {
  overflow: hidden;
  height: 18px;
  margin-bottom: 18px;
  background-color: #f5f5f5;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
}
.progress-bar {
  float: left;
  width: 0%;
  height: 100%;
  font-size: 12px;
  line-height: 18px;
  color: #fff;
  text-align: center;
  background-color: #337ab7;
  -webkit-box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.15);
  box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.15);
  -webkit-transition: width 0.6s ease;
  -o-transition: width 0.6s ease;
  transition: width 0.6s ease;
}
.progress-striped .progress-bar,
.progress-bar-striped {
  background-image: -webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: -o-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-size: 40px 40px;
}
.progress.active .progress-bar,
.progress-bar.active {
  -webkit-animation: progress-bar-stripes 2s linear infinite;
  -o-animation: progress-bar-stripes 2s linear infinite;
  animation: progress-bar-stripes 2s linear infinite;
}
.progress-bar-success {
  background-color: #5cb85c;
}
.progress-striped .progress-bar-success {
  background-image: -webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: -o-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
}
.progress-bar-info {
  background-color: #5bc0de;
}
.progress-striped .progress-bar-info {
  background-image: -webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: -o-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
}
.progress-bar-warning {
  background-color: #f0ad4e;
}
.progress-striped .progress-bar-warning {
  background-image: -webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: -o-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
}
.progress-bar-danger {
  background-color: #d9534f;
}
.progress-striped .progress-bar-danger {
  background-image: -webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: -o-linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
  background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
}
.media {
  margin-top: 15px;
}
.media:first-child {
  margin-top: 0;
}
.media,
.media-body {
  zoom: 1;
  overflow: hidden;
}
.media-body {
  width: 10000px;
}
.media-object {
  display: block;
}
.media-object.img-thumbnail {
  max-width: none;
}
.media-right,
.media > .pull-right {
  padding-left: 10px;
}
.media-left,
.media > .pull-left {
  padding-right: 10px;
}
.media-left,
.media-right,
.media-body {
  display: table-cell;
  vertical-align: top;
}
.media-middle {
  vertical-align: middle;
}
.media-bottom {
  vertical-align: bottom;
}
.media-heading {
  margin-top: 0;
  margin-bottom: 5px;
}
.media-list {
  padding-left: 0;
  list-style: none;
}
.list-group {
  margin-bottom: 20px;
  padding-left: 0;
}
.list-group-item {
  position: relative;
  display: block;
  padding: 10px 15px;
  margin-bottom: -1px;
  background-color: #fff;
  border: 1px solid #ddd;
}
.list-group-item:first-child {
  border-top-right-radius: 2px;
  border-top-left-radius: 2px;
}
.list-group-item:last-child {
  margin-bottom: 0;
  border-bottom-right-radius: 2px;
  border-bottom-left-radius: 2px;
}
a.list-group-item,
button.list-group-item {
  color: #555;
}
a.list-group-item .list-group-item-heading,
button.list-group-item .list-group-item-heading {
  color: #333;
}
a.list-group-item:hover,
button.list-group-item:hover,
a.list-group-item:focus,
button.list-group-item:focus {
  text-decoration: none;
  color: #555;
  background-color: #f5f5f5;
}
button.list-group-item {
  width: 100%;
  text-align: left;
}
.list-group-item.disabled,
.list-group-item.disabled:hover,
.list-group-item.disabled:focus {
  background-color: #eeeeee;
  color: #777777;
  cursor: not-allowed;
}
.list-group-item.disabled .list-group-item-heading,
.list-group-item.disabled:hover .list-group-item-heading,
.list-group-item.disabled:focus .list-group-item-heading {
  color: inherit;
}
.list-group-item.disabled .list-group-item-text,
.list-group-item.disabled:hover .list-group-item-text,
.list-group-item.disabled:focus .list-group-item-text {
  color: #777777;
}
.list-group-item.active,
.list-group-item.active:hover,
.list-group-item.active:focus {
  z-index: 2;
  color: #fff;
  background-color: #337ab7;
  border-color: #337ab7;
}
.list-group-item.active .list-group-item-heading,
.list-group-item.active:hover .list-group-item-heading,
.list-group-item.active:focus .list-group-item-heading,
.list-group-item.active .list-group-item-heading > small,
.list-group-item.active:hover .list-group-item-heading > small,
.list-group-item.active:focus .list-group-item-heading > small,
.list-group-item.active .list-group-item-heading > .small,
.list-group-item.active:hover .list-group-item-heading > .small,
.list-group-item.active:focus .list-group-item-heading > .small {
  color: inherit;
}
.list-group-item.active .list-group-item-text,
.list-group-item.active:hover .list-group-item-text,
.list-group-item.active:focus .list-group-item-text {
  color: #c7ddef;
}
.list-group-item-success {
  color: #3c763d;
  background-color: #dff0d8;
}
a.list-group-item-success,
button.list-group-item-success {
  color: #3c763d;
}
a.list-group-item-success .list-group-item-heading,
button.list-group-item-success .list-group-item-heading {
  color: inherit;
}
a.list-group-item-success:hover,
button.list-group-item-success:hover,
a.list-group-item-success:focus,
button.list-group-item-success:focus {
  color: #3c763d;
  background-color: #d0e9c6;
}
a.list-group-item-success.active,
button.list-group-item-success.active,
a.list-group-item-success.active:hover,
button.list-group-item-success.active:hover,
a.list-group-item-success.active:focus,
button.list-group-item-success.active:focus {
  color: #fff;
  background-color: #3c763d;
  border-color: #3c763d;
}
.list-group-item-info {
  color: #31708f;
  background-color: #d9edf7;
}
a.list-group-item-info,
button.list-group-item-info {
  color: #31708f;
}
a.list-group-item-info .list-group-item-heading,
button.list-group-item-info .list-group-item-heading {
  color: inherit;
}
a.list-group-item-info:hover,
button.list-group-item-info:hover,
a.list-group-item-info:focus,
button.list-group-item-info:focus {
  color: #31708f;
  background-color: #c4e3f3;
}
a.list-group-item-info.active,
button.list-group-item-info.active,
a.list-group-item-info.active:hover,
button.list-group-item-info.active:hover,
a.list-group-item-info.active:focus,
button.list-group-item-info.active:focus {
  color: #fff;
  background-color: #31708f;
  border-color: #31708f;
}
.list-group-item-warning {
  color: #8a6d3b;
  background-color: #fcf8e3;
}
a.list-group-item-warning,
button.list-group-item-warning {
  color: #8a6d3b;
}
a.list-group-item-warning .list-group-item-heading,
button.list-group-item-warning .list-group-item-heading {
  color: inherit;
}
a.list-group-item-warning:hover,
button.list-group-item-warning:hover,
a.list-group-item-warning:focus,
button.list-group-item-warning:focus {
  color: #8a6d3b;
  background-color: #faf2cc;
}
a.list-group-item-warning.active,
button.list-group-item-warning.active,
a.list-group-item-warning.active:hover,
button.list-group-item-warning.active:hover,
a.list-group-item-warning.active:focus,
button.list-group-item-warning.active:focus {
  color: #fff;
  background-color: #8a6d3b;
  border-color: #8a6d3b;
}
.list-group-item-danger {
  color: #a94442;
  background-color: #f2dede;
}
a.list-group-item-danger,
button.list-group-item-danger {
  color: #a94442;
}
a.list-group-item-danger .list-group-item-heading,
button.list-group-item-danger .list-group-item-heading {
  color: inherit;
}
a.list-group-item-danger:hover,
button.list-group-item-danger:hover,
a.list-group-item-danger:focus,
button.list-group-item-danger:focus {
  color: #a94442;
  background-color: #ebcccc;
}
a.list-group-item-danger.active,
button.list-group-item-danger.active,
a.list-group-item-danger.active:hover,
button.list-group-item-danger.active:hover,
a.list-group-item-danger.active:focus,
button.list-group-item-danger.active:focus {
  color: #fff;
  background-color: #a94442;
  border-color: #a94442;
}
.list-group-item-heading {
  margin-top: 0;
  margin-bottom: 5px;
}
.list-group-item-text {
  margin-bottom: 0;
  line-height: 1.3;
}
.panel {
  margin-bottom: 18px;
  background-color: #fff;
  border: 1px solid transparent;
  border-radius: 2px;
  -webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
}
.panel-body {
  padding: 15px;
}
.panel-heading {
  padding: 10px 15px;
  border-bottom: 1px solid transparent;
  border-top-right-radius: 1px;
  border-top-left-radius: 1px;
}
.panel-heading > .dropdown .dropdown-toggle {
  color: inherit;
}
.panel-title {
  margin-top: 0;
  margin-bottom: 0;
  font-size: 15px;
  color: inherit;
}
.panel-title > a,
.panel-title > small,
.panel-title > .small,
.panel-title > small > a,
.panel-title > .small > a {
  color: inherit;
}
.panel-footer {
  padding: 10px 15px;
  background-color: #f5f5f5;
  border-top: 1px solid #ddd;
  border-bottom-right-radius: 1px;
  border-bottom-left-radius: 1px;
}
.panel > .list-group,
.panel > .panel-collapse > .list-group {
  margin-bottom: 0;
}
.panel > .list-group .list-group-item,
.panel > .panel-collapse > .list-group .list-group-item {
  border-width: 1px 0;
  border-radius: 0;
}
.panel > .list-group:first-child .list-group-item:first-child,
.panel > .panel-collapse > .list-group:first-child .list-group-item:first-child {
  border-top: 0;
  border-top-right-radius: 1px;
  border-top-left-radius: 1px;
}
.panel > .list-group:last-child .list-group-item:last-child,
.panel > .panel-collapse > .list-group:last-child .list-group-item:last-child {
  border-bottom: 0;
  border-bottom-right-radius: 1px;
  border-bottom-left-radius: 1px;
}
.panel > .panel-heading + .panel-collapse > .list-group .list-group-item:first-child {
  border-top-right-radius: 0;
  border-top-left-radius: 0;
}
.panel-heading + .list-group .list-group-item:first-child {
  border-top-width: 0;
}
.list-group + .panel-footer {
  border-top-width: 0;
}
.panel > .table,
.panel > .table-responsive > .table,
.panel > .panel-collapse > .table {
  margin-bottom: 0;
}
.panel > .table caption,
.panel > .table-responsive > .table caption,
.panel > .panel-collapse > .table caption {
  padding-left: 15px;
  padding-right: 15px;
}
.panel > .table:first-child,
.panel > .table-responsive:first-child > .table:first-child {
  border-top-right-radius: 1px;
  border-top-left-radius: 1px;
}
.panel > .table:first-child > thead:first-child > tr:first-child,
.panel > .table-responsive:first-child > .table:first-child > thead:first-child > tr:first-child,
.panel > .table:first-child > tbody:first-child > tr:first-child,
.panel > .table-responsive:first-child > .table:first-child > tbody:first-child > tr:first-child {
  border-top-left-radius: 1px;
  border-top-right-radius: 1px;
}
.panel > .table:first-child > thead:first-child > tr:first-child td:first-child,
.panel > .table-responsive:first-child > .table:first-child > thead:first-child > tr:first-child td:first-child,
.panel > .table:first-child > tbody:first-child > tr:first-child td:first-child,
.panel > .table-responsive:first-child > .table:first-child > tbody:first-child > tr:first-child td:first-child,
.panel > .table:first-child > thead:first-child > tr:first-child th:first-child,
.panel > .table-responsive:first-child > .table:first-child > thead:first-child > tr:first-child th:first-child,
.panel > .table:first-child > tbody:first-child > tr:first-child th:first-child,
.panel > .table-responsive:first-child > .table:first-child > tbody:first-child > tr:first-child th:first-child {
  border-top-left-radius: 1px;
}
.panel > .table:first-child > thead:first-child > tr:first-child td:last-child,
.panel > .table-responsive:first-child > .table:first-child > thead:first-child > tr:first-child td:last-child,
.panel > .table:first-child > tbody:first-child > tr:first-child td:last-child,
.panel > .table-responsive:first-child > .table:first-child > tbody:first-child > tr:first-child td:last-child,
.panel > .table:first-child > thead:first-child > tr:first-child th:last-child,
.panel > .table-responsive:first-child > .table:first-child > thead:first-child > tr:first-child th:last-child,
.panel > .table:first-child > tbody:first-child > tr:first-child th:last-child,
.panel > .table-responsive:first-child > .table:first-child > tbody:first-child > tr:first-child th:last-child {
  border-top-right-radius: 1px;
}
.panel > .table:last-child,
.panel > .table-responsive:last-child > .table:last-child {
  border-bottom-right-radius: 1px;
  border-bottom-left-radius: 1px;
}
.panel > .table:last-child > tbody:last-child > tr:last-child,
.panel > .table-responsive:last-child > .table:last-child > tbody:last-child > tr:last-child,
.panel > .table:last-child > tfoot:last-child > tr:last-child,
.panel > .table-responsive:last-child > .table:last-child > tfoot:last-child > tr:last-child {
  border-bottom-left-radius: 1px;
  border-bottom-right-radius: 1px;
}
.panel > .table:last-child > tbody:last-child > tr:last-child td:first-child,
.panel > .table-responsive:last-child > .table:last-child > tbody:last-child > tr:last-child td:first-child,
.panel > .table:last-child > tfoot:last-child > tr:last-child td:first-child,
.panel > .table-responsive:last-child > .table:last-child > tfoot:last-child > tr:last-child td:first-child,
.panel > .table:last-child > tbody:last-child > tr:last-child th:first-child,
.panel > .table-responsive:last-child > .table:last-child > tbody:last-child > tr:last-child th:first-child,
.panel > .table:last-child > tfoot:last-child > tr:last-child th:first-child,
.panel > .table-responsive:last-child > .table:last-child > tfoot:last-child > tr:last-child th:first-child {
  border-bottom-left-radius: 1px;
}
.panel > .table:last-child > tbody:last-child > tr:last-child td:last-child,
.panel > .table-responsive:last-child > .table:last-child > tbody:last-child > tr:last-child td:last-child,
.panel > .table:last-child > tfoot:last-child > tr:last-child td:last-child,
.panel > .table-responsive:last-child > .table:last-child > tfoot:last-child > tr:last-child td:last-child,
.panel > .table:last-child > tbody:last-child > tr:last-child th:last-child,
.panel > .table-responsive:last-child > .table:last-child > tbody:last-child > tr:last-child th:last-child,
.panel > .table:last-child > tfoot:last-child > tr:last-child th:last-child,
.panel > .table-responsive:last-child > .table:last-child > tfoot:last-child > tr:last-child th:last-child {
  border-bottom-right-radius: 1px;
}
.panel > .panel-body + .table,
.panel > .panel-body + .table-responsive,
.panel > .table + .panel-body,
.panel > .table-responsive + .panel-body {
  border-top: 1px solid #ddd;
}
.panel > .table > tbody:first-child > tr:first-child th,
.panel > .table > tbody:first-child > tr:first-child td {
  border-top: 0;
}
.panel > .table-bordered,
.panel > .table-responsive > .table-bordered {
  border: 0;
}
.panel > .table-bordered > thead > tr > th:first-child,
.panel > .table-responsive > .table-bordered > thead > tr > th:first-child,
.panel > .table-bordered > tbody > tr > th:first-child,
.panel > .table-responsive > .table-bordered > tbody > tr > th:first-child,
.panel > .table-bordered > tfoot > tr > th:first-child,
.panel > .table-responsive > .table-bordered > tfoot > tr > th:first-child,
.panel > .table-bordered > thead > tr > td:first-child,
.panel > .table-responsive > .table-bordered > thead > tr > td:first-child,
.panel > .table-bordered > tbody > tr > td:first-child,
.panel > .table-responsive > .table-bordered > tbody > tr > td:first-child,
.panel > .table-bordered > tfoot > tr > td:first-child,
.panel > .table-responsive > .table-bordered > tfoot > tr > td:first-child {
  border-left: 0;
}
.panel > .table-bordered > thead > tr > th:last-child,
.panel > .table-responsive > .table-bordered > thead > tr > th:last-child,
.panel > .table-bordered > tbody > tr > th:last-child,
.panel > .table-responsive > .table-bordered > tbody > tr > th:last-child,
.panel > .table-bordered > tfoot > tr > th:last-child,
.panel > .table-responsive > .table-bordered > tfoot > tr > th:last-child,
.panel > .table-bordered > thead > tr > td:last-child,
.panel > .table-responsive > .table-bordered > thead > tr > td:last-child,
.panel > .table-bordered > tbody > tr > td:last-child,
.panel > .table-responsive > .table-bordered > tbody > tr > td:last-child,
.panel > .table-bordered > tfoot > tr > td:last-child,
.panel > .table-responsive > .table-bordered > tfoot > tr > td:last-child {
  border-right: 0;
}
.panel > .table-bordered > thead > tr:first-child > td,
.panel > .table-responsive > .table-bordered > thead > tr:first-child > td,
.panel > .table-bordered > tbody > tr:first-child > td,
.panel > .table-responsive > .table-bordered > tbody > tr:first-child > td,
.panel > .table-bordered > thead > tr:first-child > th,
.panel > .table-responsive > .table-bordered > thead > tr:first-child > th,
.panel > .table-bordered > tbody > tr:first-child > th,
.panel > .table-responsive > .table-bordered > tbody > tr:first-child > th {
  border-bottom: 0;
}
.panel > .table-bordered > tbody > tr:last-child > td,
.panel > .table-responsive > .table-bordered > tbody > tr:last-child > td,
.panel > .table-bordered > tfoot > tr:last-child > td,
.panel > .table-responsive > .table-bordered > tfoot > tr:last-child > td,
.panel > .table-bordered > tbody > tr:last-child > th,
.panel > .table-responsive > .table-bordered > tbody > tr:last-child > th,
.panel > .table-bordered > tfoot > tr:last-child > th,
.panel > .table-responsive > .table-bordered > tfoot > tr:last-child > th {
  border-bottom: 0;
}
.panel > .table-responsive {
  border: 0;
  margin-bottom: 0;
}
.panel-group {
  margin-bottom: 18px;
}
.panel-group .panel {
  margin-bottom: 0;
  border-radius: 2px;
}
.panel-group .panel + .panel {
  margin-top: 5px;
}
.panel-group .panel-heading {
  border-bottom: 0;
}
.panel-group .panel-heading + .panel-collapse > .panel-body,
.panel-group .panel-heading + .panel-collapse > .list-group {
  border-top: 1px solid #ddd;
}
.panel-group .panel-footer {
  border-top: 0;
}
.panel-group .panel-footer + .panel-collapse .panel-body {
  border-bottom: 1px solid #ddd;
}
.panel-default {
  border-color: #ddd;
}
.panel-default > .panel-heading {
  color: #333333;
  background-color: #f5f5f5;
  border-color: #ddd;
}
.panel-default > .panel-heading + .panel-collapse > .panel-body {
  border-top-color: #ddd;
}
.panel-default > .panel-heading .badge {
  color: #f5f5f5;
  background-color: #333333;
}
.panel-default > .panel-footer + .panel-collapse > .panel-body {
  border-bottom-color: #ddd;
}
.panel-primary {
  border-color: #337ab7;
}
.panel-primary > .panel-heading {
  color: #fff;
  background-color: #337ab7;
  border-color: #337ab7;
}
.panel-primary > .panel-heading + .panel-collapse > .panel-body {
  border-top-color: #337ab7;
}
.panel-primary > .panel-heading .badge {
  color: #337ab7;
  background-color: #fff;
}
.panel-primary > .panel-footer + .panel-collapse > .panel-body {
  border-bottom-color: #337ab7;
}
.panel-success {
  border-color: #d6e9c6;
}
.panel-success > .panel-heading {
  color: #3c763d;
  background-color: #dff0d8;
  border-color: #d6e9c6;
}
.panel-success > .panel-heading + .panel-collapse > .panel-body {
  border-top-color: #d6e9c6;
}
.panel-success > .panel-heading .badge {
  color: #dff0d8;
  background-color: #3c763d;
}
.panel-success > .panel-footer + .panel-collapse > .panel-body {
  border-bottom-color: #d6e9c6;
}
.panel-info {
  border-color: #bce8f1;
}
.panel-info > .panel-heading {
  color: #31708f;
  background-color: #d9edf7;
  border-color: #bce8f1;
}
.panel-info > .panel-heading + .panel-collapse > .panel-body {
  border-top-color: #bce8f1;
}
.panel-info > .panel-heading .badge {
  color: #d9edf7;
  background-color: #31708f;
}
.panel-info > .panel-footer + .panel-collapse > .panel-body {
  border-bottom-color: #bce8f1;
}
.panel-warning {
  border-color: #faebcc;
}
.panel-warning > .panel-heading {
  color: #8a6d3b;
  background-color: #fcf8e3;
  border-color: #faebcc;
}
.panel-warning > .panel-heading + .panel-collapse > .panel-body {
  border-top-color: #faebcc;
}
.panel-warning > .panel-heading .badge {
  color: #fcf8e3;
  background-color: #8a6d3b;
}
.panel-warning > .panel-footer + .panel-collapse > .panel-body {
  border-bottom-color: #faebcc;
}
.panel-danger {
  border-color: #ebccd1;
}
.panel-danger > .panel-heading {
  color: #a94442;
  background-color: #f2dede;
  border-color: #ebccd1;
}
.panel-danger > .panel-heading + .panel-collapse > .panel-body {
  border-top-color: #ebccd1;
}
.panel-danger > .panel-heading .badge {
  color: #f2dede;
  background-color: #a94442;
}
.panel-danger > .panel-footer + .panel-collapse > .panel-body {
  border-bottom-color: #ebccd1;
}
.embed-responsive {
  position: relative;
  display: block;
  height: 0;
  padding: 0;
  overflow: hidden;
}
.embed-responsive .embed-responsive-item,
.embed-responsive iframe,
.embed-responsive embed,
.embed-responsive object,
.embed-responsive video {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  height: 100%;
  width: 100%;
  border: 0;
}
.embed-responsive-16by9 {
  padding-bottom: 56.25%;
}
.embed-responsive-4by3 {
  padding-bottom: 75%;
}
.well {
  min-height: 20px;
  padding: 19px;
  margin-bottom: 20px;
  background-color: #f5f5f5;
  border: 1px solid #e3e3e3;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.05);
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.05);
}
.well blockquote {
  border-color: #ddd;
  border-color: rgba(0, 0, 0, 0.15);
}
.well-lg {
  padding: 24px;
  border-radius: 3px;
}
.well-sm {
  padding: 9px;
  border-radius: 1px;
}
.close {
  float: right;
  font-size: 19.5px;
  font-weight: bold;
  line-height: 1;
  color: #000;
  text-shadow: 0 1px 0 #fff;
  opacity: 0.2;
  filter: alpha(opacity=20);
}
.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
  opacity: 0.5;
  filter: alpha(opacity=50);
}
button.close {
  padding: 0;
  cursor: pointer;
  background: transparent;
  border: 0;
  -webkit-appearance: none;
}
.modal-open {
  overflow: hidden;
}
.modal {
  display: none;
  overflow: hidden;
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  z-index: 1050;
  -webkit-overflow-scrolling: touch;
  outline: 0;
}
.modal.fade .modal-dialog {
  -webkit-transform: translate(0, -25%);
  -ms-transform: translate(0, -25%);
  -o-transform: translate(0, -25%);
  transform: translate(0, -25%);
  -webkit-transition: -webkit-transform 0.3s ease-out;
  -moz-transition: -moz-transform 0.3s ease-out;
  -o-transition: -o-transform 0.3s ease-out;
  transition: transform 0.3s ease-out;
}
.modal.in .modal-dialog {
  -webkit-transform: translate(0, 0);
  -ms-transform: translate(0, 0);
  -o-transform: translate(0, 0);
  transform: translate(0, 0);
}
.modal-open .modal {
  overflow-x: hidden;
  overflow-y: auto;
}
.modal-dialog {
  position: relative;
  width: auto;
  margin: 10px;
}
.modal-content {
  position: relative;
  background-color: #fff;
  border: 1px solid #999;
  border: 1px solid rgba(0, 0, 0, 0.2);
  border-radius: 3px;
  -webkit-box-shadow: 0 3px 9px rgba(0, 0, 0, 0.5);
  box-shadow: 0 3px 9px rgba(0, 0, 0, 0.5);
  background-clip: padding-box;
  outline: 0;
}
.modal-backdrop {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  z-index: 1040;
  background-color: #000;
}
.modal-backdrop.fade {
  opacity: 0;
  filter: alpha(opacity=0);
}
.modal-backdrop.in {
  opacity: 0.5;
  filter: alpha(opacity=50);
}
.modal-header {
  padding: 15px;
  border-bottom: 1px solid #e5e5e5;
}
.modal-header .close {
  margin-top: -2px;
}
.modal-title {
  margin: 0;
  line-height: 1.42857143;
}
.modal-body {
  position: relative;
  padding: 15px;
}
.modal-footer {
  padding: 15px;
  text-align: right;
  border-top: 1px solid #e5e5e5;
}
.modal-footer .btn + .btn {
  margin-left: 5px;
  margin-bottom: 0;
}
.modal-footer .btn-group .btn + .btn {
  margin-left: -1px;
}
.modal-footer .btn-block + .btn-block {
  margin-left: 0;
}
.modal-scrollbar-measure {
  position: absolute;
  top: -9999px;
  width: 50px;
  height: 50px;
  overflow: scroll;
}
@media (min-width: 768px) {
  .modal-dialog {
    width: 600px;
    margin: 30px auto;
  }
  .modal-content {
    -webkit-box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
  }
  .modal-sm {
    width: 300px;
  }
}
@media (min-width: 992px) {
  .modal-lg {
    width: 900px;
  }
}
.tooltip {
  position: absolute;
  z-index: 1070;
  display: block;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-style: normal;
  font-weight: normal;
  letter-spacing: normal;
  line-break: auto;
  line-height: 1.42857143;
  text-align: left;
  text-align: start;
  text-decoration: none;
  text-shadow: none;
  text-transform: none;
  white-space: normal;
  word-break: normal;
  word-spacing: normal;
  word-wrap: normal;
  font-size: 12px;
  opacity: 0;
  filter: alpha(opacity=0);
}
.tooltip.in {
  opacity: 0.9;
  filter: alpha(opacity=90);
}
.tooltip.top {
  margin-top: -3px;
  padding: 5px 0;
}
.tooltip.right {
  margin-left: 3px;
  padding: 0 5px;
}
.tooltip.bottom {
  margin-top: 3px;
  padding: 5px 0;
}
.tooltip.left {
  margin-left: -3px;
  padding: 0 5px;
}
.tooltip-inner {
  max-width: 200px;
  padding: 3px 8px;
  color: #fff;
  text-align: center;
  background-color: #000;
  border-radius: 2px;
}
.tooltip-arrow {
  position: absolute;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
}
.tooltip.top .tooltip-arrow {
  bottom: 0;
  left: 50%;
  margin-left: -5px;
  border-width: 5px 5px 0;
  border-top-color: #000;
}
.tooltip.top-left .tooltip-arrow {
  bottom: 0;
  right: 5px;
  margin-bottom: -5px;
  border-width: 5px 5px 0;
  border-top-color: #000;
}
.tooltip.top-right .tooltip-arrow {
  bottom: 0;
  left: 5px;
  margin-bottom: -5px;
  border-width: 5px 5px 0;
  border-top-color: #000;
}
.tooltip.right .tooltip-arrow {
  top: 50%;
  left: 0;
  margin-top: -5px;
  border-width: 5px 5px 5px 0;
  border-right-color: #000;
}
.tooltip.left .tooltip-arrow {
  top: 50%;
  right: 0;
  margin-top: -5px;
  border-width: 5px 0 5px 5px;
  border-left-color: #000;
}
.tooltip.bottom .tooltip-arrow {
  top: 0;
  left: 50%;
  margin-left: -5px;
  border-width: 0 5px 5px;
  border-bottom-color: #000;
}
.tooltip.bottom-left .tooltip-arrow {
  top: 0;
  right: 5px;
  margin-top: -5px;
  border-width: 0 5px 5px;
  border-bottom-color: #000;
}
.tooltip.bottom-right .tooltip-arrow {
  top: 0;
  left: 5px;
  margin-top: -5px;
  border-width: 0 5px 5px;
  border-bottom-color: #000;
}
.popover {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 1060;
  display: none;
  max-width: 276px;
  padding: 1px;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-style: normal;
  font-weight: normal;
  letter-spacing: normal;
  line-break: auto;
  line-height: 1.42857143;
  text-align: left;
  text-align: start;
  text-decoration: none;
  text-shadow: none;
  text-transform: none;
  white-space: normal;
  word-break: normal;
  word-spacing: normal;
  word-wrap: normal;
  font-size: 13px;
  background-color: #fff;
  background-clip: padding-box;
  border: 1px solid #ccc;
  border: 1px solid rgba(0, 0, 0, 0.2);
  border-radius: 3px;
  -webkit-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
}
.popover.top {
  margin-top: -10px;
}
.popover.right {
  margin-left: 10px;
}
.popover.bottom {
  margin-top: 10px;
}
.popover.left {
  margin-left: -10px;
}
.popover-title {
  margin: 0;
  padding: 8px 14px;
  font-size: 13px;
  background-color: #f7f7f7;
  border-bottom: 1px solid #ebebeb;
  border-radius: 2px 2px 0 0;
}
.popover-content {
  padding: 9px 14px;
}
.popover > .arrow,
.popover > .arrow:after {
  position: absolute;
  display: block;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
}
.popover > .arrow {
  border-width: 11px;
}
.popover > .arrow:after {
  border-width: 10px;
  content: "";
}
.popover.top > .arrow {
  left: 50%;
  margin-left: -11px;
  border-bottom-width: 0;
  border-top-color: #999999;
  border-top-color: rgba(0, 0, 0, 0.25);
  bottom: -11px;
}
.popover.top > .arrow:after {
  content: " ";
  bottom: 1px;
  margin-left: -10px;
  border-bottom-width: 0;
  border-top-color: #fff;
}
.popover.right > .arrow {
  top: 50%;
  left: -11px;
  margin-top: -11px;
  border-left-width: 0;
  border-right-color: #999999;
  border-right-color: rgba(0, 0, 0, 0.25);
}
.popover.right > .arrow:after {
  content: " ";
  left: 1px;
  bottom: -10px;
  border-left-width: 0;
  border-right-color: #fff;
}
.popover.bottom > .arrow {
  left: 50%;
  margin-left: -11px;
  border-top-width: 0;
  border-bottom-color: #999999;
  border-bottom-color: rgba(0, 0, 0, 0.25);
  top: -11px;
}
.popover.bottom > .arrow:after {
  content: " ";
  top: 1px;
  margin-left: -10px;
  border-top-width: 0;
  border-bottom-color: #fff;
}
.popover.left > .arrow {
  top: 50%;
  right: -11px;
  margin-top: -11px;
  border-right-width: 0;
  border-left-color: #999999;
  border-left-color: rgba(0, 0, 0, 0.25);
}
.popover.left > .arrow:after {
  content: " ";
  right: 1px;
  border-right-width: 0;
  border-left-color: #fff;
  bottom: -10px;
}
.carousel {
  position: relative;
}
.carousel-inner {
  position: relative;
  overflow: hidden;
  width: 100%;
}
.carousel-inner > .item {
  display: none;
  position: relative;
  -webkit-transition: 0.6s ease-in-out left;
  -o-transition: 0.6s ease-in-out left;
  transition: 0.6s ease-in-out left;
}
.carousel-inner > .item > img,
.carousel-inner > .item > a > img {
  line-height: 1;
}
@media all and (transform-3d), (-webkit-transform-3d) {
  .carousel-inner > .item {
    -webkit-transition: -webkit-transform 0.6s ease-in-out;
    -moz-transition: -moz-transform 0.6s ease-in-out;
    -o-transition: -o-transform 0.6s ease-in-out;
    transition: transform 0.6s ease-in-out;
    -webkit-backface-visibility: hidden;
    -moz-backface-visibility: hidden;
    backface-visibility: hidden;
    -webkit-perspective: 1000px;
    -moz-perspective: 1000px;
    perspective: 1000px;
  }
  .carousel-inner > .item.next,
  .carousel-inner > .item.active.right {
    -webkit-transform: translate3d(100%, 0, 0);
    transform: translate3d(100%, 0, 0);
    left: 0;
  }
  .carousel-inner > .item.prev,
  .carousel-inner > .item.active.left {
    -webkit-transform: translate3d(-100%, 0, 0);
    transform: translate3d(-100%, 0, 0);
    left: 0;
  }
  .carousel-inner > .item.next.left,
  .carousel-inner > .item.prev.right,
  .carousel-inner > .item.active {
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
    left: 0;
  }
}
.carousel-inner > .active,
.carousel-inner > .next,
.carousel-inner > .prev {
  display: block;
}
.carousel-inner > .active {
  left: 0;
}
.carousel-inner > .next,
.carousel-inner > .prev {
  position: absolute;
  top: 0;
  width: 100%;
}
.carousel-inner > .next {
  left: 100%;
}
.carousel-inner > .prev {
  left: -100%;
}
.carousel-inner > .next.left,
.carousel-inner > .prev.right {
  left: 0;
}
.carousel-inner > .active.left {
  left: -100%;
}
.carousel-inner > .active.right {
  left: 100%;
}
.carousel-control {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  width: 15%;
  opacity: 0.5;
  filter: alpha(opacity=50);
  font-size: 20px;
  color: #fff;
  text-align: center;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
  background-color: rgba(0, 0, 0, 0);
}
.carousel-control.left {
  background-image: -webkit-linear-gradient(left, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0.0001) 100%);
  background-image: -o-linear-gradient(left, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0.0001) 100%);
  background-image: linear-gradient(to right, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0.0001) 100%);
  background-repeat: repeat-x;
  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#80000000', endColorstr='#00000000', GradientType=1);
}
.carousel-control.right {
  left: auto;
  right: 0;
  background-image: -webkit-linear-gradient(left, rgba(0, 0, 0, 0.0001) 0%, rgba(0, 0, 0, 0.5) 100%);
  background-image: -o-linear-gradient(left, rgba(0, 0, 0, 0.0001) 0%, rgba(0, 0, 0, 0.5) 100%);
  background-image: linear-gradient(to right, rgba(0, 0, 0, 0.0001) 0%, rgba(0, 0, 0, 0.5) 100%);
  background-repeat: repeat-x;
  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#00000000', endColorstr='#80000000', GradientType=1);
}
.carousel-control:hover,
.carousel-control:focus {
  outline: 0;
  color: #fff;
  text-decoration: none;
  opacity: 0.9;
  filter: alpha(opacity=90);
}
.carousel-control .icon-prev,
.carousel-control .icon-next,
.carousel-control .glyphicon-chevron-left,
.carousel-control .glyphicon-chevron-right {
  position: absolute;
  top: 50%;
  margin-top: -10px;
  z-index: 5;
  display: inline-block;
}
.carousel-control .icon-prev,
.carousel-control .glyphicon-chevron-left {
  left: 50%;
  margin-left: -10px;
}
.carousel-control .icon-next,
.carousel-control .glyphicon-chevron-right {
  right: 50%;
  margin-right: -10px;
}
.carousel-control .icon-prev,
.carousel-control .icon-next {
  width: 20px;
  height: 20px;
  line-height: 1;
  font-family: serif;
}
.carousel-control .icon-prev:before {
  content: '\2039';
}
.carousel-control .icon-next:before {
  content: '\203a';
}
.carousel-indicators {
  position: absolute;
  bottom: 10px;
  left: 50%;
  z-index: 15;
  width: 60%;
  margin-left: -30%;
  padding-left: 0;
  list-style: none;
  text-align: center;
}
.carousel-indicators li {
  display: inline-block;
  width: 10px;
  height: 10px;
  margin: 1px;
  text-indent: -999px;
  border: 1px solid #fff;
  border-radius: 10px;
  cursor: pointer;
  background-color: #000 \9;
  background-color: rgba(0, 0, 0, 0);
}
.carousel-indicators .active {
  margin: 0;
  width: 12px;
  height: 12px;
  background-color: #fff;
}
.carousel-caption {
  position: absolute;
  left: 15%;
  right: 15%;
  bottom: 20px;
  z-index: 10;
  padding-top: 20px;
  padding-bottom: 20px;
  color: #fff;
  text-align: center;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
}
.carousel-caption .btn {
  text-shadow: none;
}
@media screen and (min-width: 768px) {
  .carousel-control .glyphicon-chevron-left,
  .carousel-control .glyphicon-chevron-right,
  .carousel-control .icon-prev,
  .carousel-control .icon-next {
    width: 30px;
    height: 30px;
    margin-top: -10px;
    font-size: 30px;
  }
  .carousel-control .glyphicon-chevron-left,
  .carousel-control .icon-prev {
    margin-left: -10px;
  }
  .carousel-control .glyphicon-chevron-right,
  .carousel-control .icon-next {
    margin-right: -10px;
  }
  .carousel-caption {
    left: 20%;
    right: 20%;
    padding-bottom: 30px;
  }
  .carousel-indicators {
    bottom: 20px;
  }
}
.clearfix:before,
.clearfix:after,
.dl-horizontal dd:before,
.dl-horizontal dd:after,
.container:before,
.container:after,
.container-fluid:before,
.container-fluid:after,
.row:before,
.row:after,
.form-horizontal .form-group:before,
.form-horizontal .form-group:after,
.btn-toolbar:before,
.btn-toolbar:after,
.btn-group-vertical > .btn-group:before,
.btn-group-vertical > .btn-group:after,
.nav:before,
.nav:after,
.navbar:before,
.navbar:after,
.navbar-header:before,
.navbar-header:after,
.navbar-collapse:before,
.navbar-collapse:after,
.pager:before,
.pager:after,
.panel-body:before,
.panel-body:after,
.modal-header:before,
.modal-header:after,
.modal-footer:before,
.modal-footer:after,
.item_buttons:before,
.item_buttons:after {
  content: " ";
  display: table;
}
.clearfix:after,
.dl-horizontal dd:after,
.container:after,
.container-fluid:after,
.row:after,
.form-horizontal .form-group:after,
.btn-toolbar:after,
.btn-group-vertical > .btn-group:after,
.nav:after,
.navbar:after,
.navbar-header:after,
.navbar-collapse:after,
.pager:after,
.panel-body:after,
.modal-header:after,
.modal-footer:after,
.item_buttons:after {
  clear: both;
}
.center-block {
  display: block;
  margin-left: auto;
  margin-right: auto;
}
.pull-right {
  float: right !important;
}
.pull-left {
  float: left !important;
}
.hide {
  display: none !important;
}
.show {
  display: block !important;
}
.invisible {
  visibility: hidden;
}
.text-hide {
  font: 0/0 a;
  color: transparent;
  text-shadow: none;
  background-color: transparent;
  border: 0;
}
.hidden {
  display: none !important;
}
.affix {
  position: fixed;
}
@-ms-viewport {
  width: device-width;
}
.visible-xs,
.visible-sm,
.visible-md,
.visible-lg {
  display: none !important;
}
.visible-xs-block,
.visible-xs-inline,
.visible-xs-inline-block,
.visible-sm-block,
.visible-sm-inline,
.visible-sm-inline-block,
.visible-md-block,
.visible-md-inline,
.visible-md-inline-block,
.visible-lg-block,
.visible-lg-inline,
.visible-lg-inline-block {
  display: none !important;
}
@media (max-width: 767px) {
  .visible-xs {
    display: block !important;
  }
  table.visible-xs {
    display: table !important;
  }
  tr.visible-xs {
    display: table-row !important;
  }
  th.visible-xs,
  td.visible-xs {
    display: table-cell !important;
  }
}
@media (max-width: 767px) {
  .visible-xs-block {
    display: block !important;
  }
}
@media (max-width: 767px) {
  .visible-xs-inline {
    display: inline !important;
  }
}
@media (max-width: 767px) {
  .visible-xs-inline-block {
    display: inline-block !important;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .visible-sm {
    display: block !important;
  }
  table.visible-sm {
    display: table !important;
  }
  tr.visible-sm {
    display: table-row !important;
  }
  th.visible-sm,
  td.visible-sm {
    display: table-cell !important;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .visible-sm-block {
    display: block !important;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .visible-sm-inline {
    display: inline !important;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .visible-sm-inline-block {
    display: inline-block !important;
  }
}
@media (min-width: 992px) and (max-width: 1199px) {
  .visible-md {
    display: block !important;
  }
  table.visible-md {
    display: table !important;
  }
  tr.visible-md {
    display: table-row !important;
  }
  th.visible-md,
  td.visible-md {
    display: table-cell !important;
  }
}
@media (min-width: 992px) and (max-width: 1199px) {
  .visible-md-block {
    display: block !important;
  }
}
@media (min-width: 992px) and (max-width: 1199px) {
  .visible-md-inline {
    display: inline !important;
  }
}
@media (min-width: 992px) and (max-width: 1199px) {
  .visible-md-inline-block {
    display: inline-block !important;
  }
}
@media (min-width: 1200px) {
  .visible-lg {
    display: block !important;
  }
  table.visible-lg {
    display: table !important;
  }
  tr.visible-lg {
    display: table-row !important;
  }
  th.visible-lg,
  td.visible-lg {
    display: table-cell !important;
  }
}
@media (min-width: 1200px) {
  .visible-lg-block {
    display: block !important;
  }
}
@media (min-width: 1200px) {
  .visible-lg-inline {
    display: inline !important;
  }
}
@media (min-width: 1200px) {
  .visible-lg-inline-block {
    display: inline-block !important;
  }
}
@media (max-width: 767px) {
  .hidden-xs {
    display: none !important;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .hidden-sm {
    display: none !important;
  }
}
@media (min-width: 992px) and (max-width: 1199px) {
  .hidden-md {
    display: none !important;
  }
}
@media (min-width: 1200px) {
  .hidden-lg {
    display: none !important;
  }
}
.visible-print {
  display: none !important;
}
@media print {
  .visible-print {
    display: block !important;
  }
  table.visible-print {
    display: table !important;
  }
  tr.visible-print {
    display: table-row !important;
  }
  th.visible-print,
  td.visible-print {
    display: table-cell !important;
  }
}
.visible-print-block {
  display: none !important;
}
@media print {
  .visible-print-block {
    display: block !important;
  }
}
.visible-print-inline {
  display: none !important;
}
@media print {
  .visible-print-inline {
    display: inline !important;
  }
}
.visible-print-inline-block {
  display: none !important;
}
@media print {
  .visible-print-inline-block {
    display: inline-block !important;
  }
}
@media print {
  .hidden-print {
    display: none !important;
  }
}
/*!
*
* Font Awesome
*
*/
/*!
 *  Font Awesome 4.2.0 by @davegandy - http://fontawesome.io - @fontawesome
 *  License - http://fontawesome.io/license (Font: SIL OFL 1.1, CSS: MIT License)
 */
/* FONT PATH
 * -------------------------- */
@font-face {
  font-family: 'FontAwesome';
  src: url('../components/font-awesome/fonts/fontawesome-webfont.eot?v=4.2.0');
  src: url('../components/font-awesome/fonts/fontawesome-webfont.eot?#iefix&v=4.2.0') format('embedded-opentype'), url('../components/font-awesome/fonts/fontawesome-webfont.woff?v=4.2.0') format('woff'), url('../components/font-awesome/fonts/fontawesome-webfont.ttf?v=4.2.0') format('truetype'), url('../components/font-awesome/fonts/fontawesome-webfont.svg?v=4.2.0#fontawesomeregular') format('svg');
  font-weight: normal;
  font-style: normal;
}
.fa {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
/* makes the font 33% larger relative to the icon container */
.fa-lg {
  font-size: 1.33333333em;
  line-height: 0.75em;
  vertical-align: -15%;
}
.fa-2x {
  font-size: 2em;
}
.fa-3x {
  font-size: 3em;
}
.fa-4x {
  font-size: 4em;
}
.fa-5x {
  font-size: 5em;
}
.fa-fw {
  width: 1.28571429em;
  text-align: center;
}
.fa-ul {
  padding-left: 0;
  margin-left: 2.14285714em;
  list-style-type: none;
}
.fa-ul > li {
  position: relative;
}
.fa-li {
  position: absolute;
  left: -2.14285714em;
  width: 2.14285714em;
  top: 0.14285714em;
  text-align: center;
}
.fa-li.fa-lg {
  left: -1.85714286em;
}
.fa-border {
  padding: .2em .25em .15em;
  border: solid 0.08em #eee;
  border-radius: .1em;
}
.pull-right {
  float: right;
}
.pull-left {
  float: left;
}
.fa.pull-left {
  margin-right: .3em;
}
.fa.pull-right {
  margin-left: .3em;
}
.fa-spin {
  -webkit-animation: fa-spin 2s infinite linear;
  animation: fa-spin 2s infinite linear;
}
@-webkit-keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(359deg);
    transform: rotate(359deg);
  }
}
@keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(359deg);
    transform: rotate(359deg);
  }
}
.fa-rotate-90 {
  filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=1);
  -webkit-transform: rotate(90deg);
  -ms-transform: rotate(90deg);
  transform: rotate(90deg);
}
.fa-rotate-180 {
  filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=2);
  -webkit-transform: rotate(180deg);
  -ms-transform: rotate(180deg);
  transform: rotate(180deg);
}
.fa-rotate-270 {
  filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);
  -webkit-transform: rotate(270deg);
  -ms-transform: rotate(270deg);
  transform: rotate(270deg);
}
.fa-flip-horizontal {
  filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1);
  -webkit-transform: scale(-1, 1);
  -ms-transform: scale(-1, 1);
  transform: scale(-1, 1);
}
.fa-flip-vertical {
  filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1);
  -webkit-transform: scale(1, -1);
  -ms-transform: scale(1, -1);
  transform: scale(1, -1);
}
:root .fa-rotate-90,
:root .fa-rotate-180,
:root .fa-rotate-270,
:root .fa-flip-horizontal,
:root .fa-flip-vertical {
  filter: none;
}
.fa-stack {
  position: relative;
  display: inline-block;
  width: 2em;
  height: 2em;
  line-height: 2em;
  vertical-align: middle;
}
.fa-stack-1x,
.fa-stack-2x {
  position: absolute;
  left: 0;
  width: 100%;
  text-align: center;
}
.fa-stack-1x {
  line-height: inherit;
}
.fa-stack-2x {
  font-size: 2em;
}
.fa-inverse {
  color: #fff;
}
/* Font Awesome uses the Unicode Private Use Area (PUA) to ensure screen
   readers do not read off random characters that represent icons */
.fa-glass:before {
  content: "\f000";
}
.fa-music:before {
  content: "\f001";
}
.fa-search:before {
  content: "\f002";
}
.fa-envelope-o:before {
  content: "\f003";
}
.fa-heart:before {
  content: "\f004";
}
.fa-star:before {
  content: "\f005";
}
.fa-star-o:before {
  content: "\f006";
}
.fa-user:before {
  content: "\f007";
}
.fa-film:before {
  content: "\f008";
}
.fa-th-large:before {
  content: "\f009";
}
.fa-th:before {
  content: "\f00a";
}
.fa-th-list:before {
  content: "\f00b";
}
.fa-check:before {
  content: "\f00c";
}
.fa-remove:before,
.fa-close:before,
.fa-times:before {
  content: "\f00d";
}
.fa-search-plus:before {
  content: "\f00e";
}
.fa-search-minus:before {
  content: "\f010";
}
.fa-power-off:before {
  content: "\f011";
}
.fa-signal:before {
  content: "\f012";
}
.fa-gear:before,
.fa-cog:before {
  content: "\f013";
}
.fa-trash-o:before {
  content: "\f014";
}
.fa-home:before {
  content: "\f015";
}
.fa-file-o:before {
  content: "\f016";
}
.fa-clock-o:before {
  content: "\f017";
}
.fa-road:before {
  content: "\f018";
}
.fa-download:before {
  content: "\f019";
}
.fa-arrow-circle-o-down:before {
  content: "\f01a";
}
.fa-arrow-circle-o-up:before {
  content: "\f01b";
}
.fa-inbox:before {
  content: "\f01c";
}
.fa-play-circle-o:before {
  content: "\f01d";
}
.fa-rotate-right:before,
.fa-repeat:before {
  content: "\f01e";
}
.fa-refresh:before {
  content: "\f021";
}
.fa-list-alt:before {
  content: "\f022";
}
.fa-lock:before {
  content: "\f023";
}
.fa-flag:before {
  content: "\f024";
}
.fa-headphones:before {
  content: "\f025";
}
.fa-volume-off:before {
  content: "\f026";
}
.fa-volume-down:before {
  content: "\f027";
}
.fa-volume-up:before {
  content: "\f028";
}
.fa-qrcode:before {
  content: "\f029";
}
.fa-barcode:before {
  content: "\f02a";
}
.fa-tag:before {
  content: "\f02b";
}
.fa-tags:before {
  content: "\f02c";
}
.fa-book:before {
  content: "\f02d";
}
.fa-bookmark:before {
  content: "\f02e";
}
.fa-print:before {
  content: "\f02f";
}
.fa-camera:before {
  content: "\f030";
}
.fa-font:before {
  content: "\f031";
}
.fa-bold:before {
  content: "\f032";
}
.fa-italic:before {
  content: "\f033";
}
.fa-text-height:before {
  content: "\f034";
}
.fa-text-width:before {
  content: "\f035";
}
.fa-align-left:before {
  content: "\f036";
}
.fa-align-center:before {
  content: "\f037";
}
.fa-align-right:before {
  content: "\f038";
}
.fa-align-justify:before {
  content: "\f039";
}
.fa-list:before {
  content: "\f03a";
}
.fa-dedent:before,
.fa-outdent:before {
  content: "\f03b";
}
.fa-indent:before {
  content: "\f03c";
}
.fa-video-camera:before {
  content: "\f03d";
}
.fa-photo:before,
.fa-image:before,
.fa-picture-o:before {
  content: "\f03e";
}
.fa-pencil:before {
  content: "\f040";
}
.fa-map-marker:before {
  content: "\f041";
}
.fa-adjust:before {
  content: "\f042";
}
.fa-tint:before {
  content: "\f043";
}
.fa-edit:before,
.fa-pencil-square-o:before {
  content: "\f044";
}
.fa-share-square-o:before {
  content: "\f045";
}
.fa-check-square-o:before {
  content: "\f046";
}
.fa-arrows:before {
  content: "\f047";
}
.fa-step-backward:before {
  content: "\f048";
}
.fa-fast-backward:before {
  content: "\f049";
}
.fa-backward:before {
  content: "\f04a";
}
.fa-play:before {
  content: "\f04b";
}
.fa-pause:before {
  content: "\f04c";
}
.fa-stop:before {
  content: "\f04d";
}
.fa-forward:before {
  content: "\f04e";
}
.fa-fast-forward:before {
  content: "\f050";
}
.fa-step-forward:before {
  content: "\f051";
}
.fa-eject:before {
  content: "\f052";
}
.fa-chevron-left:before {
  content: "\f053";
}
.fa-chevron-right:before {
  content: "\f054";
}
.fa-plus-circle:before {
  content: "\f055";
}
.fa-minus-circle:before {
  content: "\f056";
}
.fa-times-circle:before {
  content: "\f057";
}
.fa-check-circle:before {
  content: "\f058";
}
.fa-question-circle:before {
  content: "\f059";
}
.fa-info-circle:before {
  content: "\f05a";
}
.fa-crosshairs:before {
  content: "\f05b";
}
.fa-times-circle-o:before {
  content: "\f05c";
}
.fa-check-circle-o:before {
  content: "\f05d";
}
.fa-ban:before {
  content: "\f05e";
}
.fa-arrow-left:before {
  content: "\f060";
}
.fa-arrow-right:before {
  content: "\f061";
}
.fa-arrow-up:before {
  content: "\f062";
}
.fa-arrow-down:before {
  content: "\f063";
}
.fa-mail-forward:before,
.fa-share:before {
  content: "\f064";
}
.fa-expand:before {
  content: "\f065";
}
.fa-compress:before {
  content: "\f066";
}
.fa-plus:before {
  content: "\f067";
}
.fa-minus:before {
  content: "\f068";
}
.fa-asterisk:before {
  content: "\f069";
}
.fa-exclamation-circle:before {
  content: "\f06a";
}
.fa-gift:before {
  content: "\f06b";
}
.fa-leaf:before {
  content: "\f06c";
}
.fa-fire:before {
  content: "\f06d";
}
.fa-eye:before {
  content: "\f06e";
}
.fa-eye-slash:before {
  content: "\f070";
}
.fa-warning:before,
.fa-exclamation-triangle:before {
  content: "\f071";
}
.fa-plane:before {
  content: "\f072";
}
.fa-calendar:before {
  content: "\f073";
}
.fa-random:before {
  content: "\f074";
}
.fa-comment:before {
  content: "\f075";
}
.fa-magnet:before {
  content: "\f076";
}
.fa-chevron-up:before {
  content: "\f077";
}
.fa-chevron-down:before {
  content: "\f078";
}
.fa-retweet:before {
  content: "\f079";
}
.fa-shopping-cart:before {
  content: "\f07a";
}
.fa-folder:before {
  content: "\f07b";
}
.fa-folder-open:before {
  content: "\f07c";
}
.fa-arrows-v:before {
  content: "\f07d";
}
.fa-arrows-h:before {
  content: "\f07e";
}
.fa-bar-chart-o:before,
.fa-bar-chart:before {
  content: "\f080";
}
.fa-twitter-square:before {
  content: "\f081";
}
.fa-facebook-square:before {
  content: "\f082";
}
.fa-camera-retro:before {
  content: "\f083";
}
.fa-key:before {
  content: "\f084";
}
.fa-gears:before,
.fa-cogs:before {
  content: "\f085";
}
.fa-comments:before {
  content: "\f086";
}
.fa-thumbs-o-up:before {
  content: "\f087";
}
.fa-thumbs-o-down:before {
  content: "\f088";
}
.fa-star-half:before {
  content: "\f089";
}
.fa-heart-o:before {
  content: "\f08a";
}
.fa-sign-out:before {
  content: "\f08b";
}
.fa-linkedin-square:before {
  content: "\f08c";
}
.fa-thumb-tack:before {
  content: "\f08d";
}
.fa-external-link:before {
  content: "\f08e";
}
.fa-sign-in:before {
  content: "\f090";
}
.fa-trophy:before {
  content: "\f091";
}
.fa-github-square:before {
  content: "\f092";
}
.fa-upload:before {
  content: "\f093";
}
.fa-lemon-o:before {
  content: "\f094";
}
.fa-phone:before {
  content: "\f095";
}
.fa-square-o:before {
  content: "\f096";
}
.fa-bookmark-o:before {
  content: "\f097";
}
.fa-phone-square:before {
  content: "\f098";
}
.fa-twitter:before {
  content: "\f099";
}
.fa-facebook:before {
  content: "\f09a";
}
.fa-github:before {
  content: "\f09b";
}
.fa-unlock:before {
  content: "\f09c";
}
.fa-credit-card:before {
  content: "\f09d";
}
.fa-rss:before {
  content: "\f09e";
}
.fa-hdd-o:before {
  content: "\f0a0";
}
.fa-bullhorn:before {
  content: "\f0a1";
}
.fa-bell:before {
  content: "\f0f3";
}
.fa-certificate:before {
  content: "\f0a3";
}
.fa-hand-o-right:before {
  content: "\f0a4";
}
.fa-hand-o-left:before {
  content: "\f0a5";
}
.fa-hand-o-up:before {
  content: "\f0a6";
}
.fa-hand-o-down:before {
  content: "\f0a7";
}
.fa-arrow-circle-left:before {
  content: "\f0a8";
}
.fa-arrow-circle-right:before {
  content: "\f0a9";
}
.fa-arrow-circle-up:before {
  content: "\f0aa";
}
.fa-arrow-circle-down:before {
  content: "\f0ab";
}
.fa-globe:before {
  content: "\f0ac";
}
.fa-wrench:before {
  content: "\f0ad";
}
.fa-tasks:before {
  content: "\f0ae";
}
.fa-filter:before {
  content: "\f0b0";
}
.fa-briefcase:before {
  content: "\f0b1";
}
.fa-arrows-alt:before {
  content: "\f0b2";
}
.fa-group:before,
.fa-users:before {
  content: "\f0c0";
}
.fa-chain:before,
.fa-link:before {
  content: "\f0c1";
}
.fa-cloud:before {
  content: "\f0c2";
}
.fa-flask:before {
  content: "\f0c3";
}
.fa-cut:before,
.fa-scissors:before {
  content: "\f0c4";
}
.fa-copy:before,
.fa-files-o:before {
  content: "\f0c5";
}
.fa-paperclip:before {
  content: "\f0c6";
}
.fa-save:before,
.fa-floppy-o:before {
  content: "\f0c7";
}
.fa-square:before {
  content: "\f0c8";
}
.fa-navicon:before,
.fa-reorder:before,
.fa-bars:before {
  content: "\f0c9";
}
.fa-list-ul:before {
  content: "\f0ca";
}
.fa-list-ol:before {
  content: "\f0cb";
}
.fa-strikethrough:before {
  content: "\f0cc";
}
.fa-underline:before {
  content: "\f0cd";
}
.fa-table:before {
  content: "\f0ce";
}
.fa-magic:before {
  content: "\f0d0";
}
.fa-truck:before {
  content: "\f0d1";
}
.fa-pinterest:before {
  content: "\f0d2";
}
.fa-pinterest-square:before {
  content: "\f0d3";
}
.fa-google-plus-square:before {
  content: "\f0d4";
}
.fa-google-plus:before {
  content: "\f0d5";
}
.fa-money:before {
  content: "\f0d6";
}
.fa-caret-down:before {
  content: "\f0d7";
}
.fa-caret-up:before {
  content: "\f0d8";
}
.fa-caret-left:before {
  content: "\f0d9";
}
.fa-caret-right:before {
  content: "\f0da";
}
.fa-columns:before {
  content: "\f0db";
}
.fa-unsorted:before,
.fa-sort:before {
  content: "\f0dc";
}
.fa-sort-down:before,
.fa-sort-desc:before {
  content: "\f0dd";
}
.fa-sort-up:before,
.fa-sort-asc:before {
  content: "\f0de";
}
.fa-envelope:before {
  content: "\f0e0";
}
.fa-linkedin:before {
  content: "\f0e1";
}
.fa-rotate-left:before,
.fa-undo:before {
  content: "\f0e2";
}
.fa-legal:before,
.fa-gavel:before {
  content: "\f0e3";
}
.fa-dashboard:before,
.fa-tachometer:before {
  content: "\f0e4";
}
.fa-comment-o:before {
  content: "\f0e5";
}
.fa-comments-o:before {
  content: "\f0e6";
}
.fa-flash:before,
.fa-bolt:before {
  content: "\f0e7";
}
.fa-sitemap:before {
  content: "\f0e8";
}
.fa-umbrella:before {
  content: "\f0e9";
}
.fa-paste:before,
.fa-clipboard:before {
  content: "\f0ea";
}
.fa-lightbulb-o:before {
  content: "\f0eb";
}
.fa-exchange:before {
  content: "\f0ec";
}
.fa-cloud-download:before {
  content: "\f0ed";
}
.fa-cloud-upload:before {
  content: "\f0ee";
}
.fa-user-md:before {
  content: "\f0f0";
}
.fa-stethoscope:before {
  content: "\f0f1";
}
.fa-suitcase:before {
  content: "\f0f2";
}
.fa-bell-o:before {
  content: "\f0a2";
}
.fa-coffee:before {
  content: "\f0f4";
}
.fa-cutlery:before {
  content: "\f0f5";
}
.fa-file-text-o:before {
  content: "\f0f6";
}
.fa-building-o:before {
  content: "\f0f7";
}
.fa-hospital-o:before {
  content: "\f0f8";
}
.fa-ambulance:before {
  content: "\f0f9";
}
.fa-medkit:before {
  content: "\f0fa";
}
.fa-fighter-jet:before {
  content: "\f0fb";
}
.fa-beer:before {
  content: "\f0fc";
}
.fa-h-square:before {
  content: "\f0fd";
}
.fa-plus-square:before {
  content: "\f0fe";
}
.fa-angle-double-left:before {
  content: "\f100";
}
.fa-angle-double-right:before {
  content: "\f101";
}
.fa-angle-double-up:before {
  content: "\f102";
}
.fa-angle-double-down:before {
  content: "\f103";
}
.fa-angle-left:before {
  content: "\f104";
}
.fa-angle-right:before {
  content: "\f105";
}
.fa-angle-up:before {
  content: "\f106";
}
.fa-angle-down:before {
  content: "\f107";
}
.fa-desktop:before {
  content: "\f108";
}
.fa-laptop:before {
  content: "\f109";
}
.fa-tablet:before {
  content: "\f10a";
}
.fa-mobile-phone:before,
.fa-mobile:before {
  content: "\f10b";
}
.fa-circle-o:before {
  content: "\f10c";
}
.fa-quote-left:before {
  content: "\f10d";
}
.fa-quote-right:before {
  content: "\f10e";
}
.fa-spinner:before {
  content: "\f110";
}
.fa-circle:before {
  content: "\f111";
}
.fa-mail-reply:before,
.fa-reply:before {
  content: "\f112";
}
.fa-github-alt:before {
  content: "\f113";
}
.fa-folder-o:before {
  content: "\f114";
}
.fa-folder-open-o:before {
  content: "\f115";
}
.fa-smile-o:before {
  content: "\f118";
}
.fa-frown-o:before {
  content: "\f119";
}
.fa-meh-o:before {
  content: "\f11a";
}
.fa-gamepad:before {
  content: "\f11b";
}
.fa-keyboard-o:before {
  content: "\f11c";
}
.fa-flag-o:before {
  content: "\f11d";
}
.fa-flag-checkered:before {
  content: "\f11e";
}
.fa-terminal:before {
  content: "\f120";
}
.fa-code:before {
  content: "\f121";
}
.fa-mail-reply-all:before,
.fa-reply-all:before {
  content: "\f122";
}
.fa-star-half-empty:before,
.fa-star-half-full:before,
.fa-star-half-o:before {
  content: "\f123";
}
.fa-location-arrow:before {
  content: "\f124";
}
.fa-crop:before {
  content: "\f125";
}
.fa-code-fork:before {
  content: "\f126";
}
.fa-unlink:before,
.fa-chain-broken:before {
  content: "\f127";
}
.fa-question:before {
  content: "\f128";
}
.fa-info:before {
  content: "\f129";
}
.fa-exclamation:before {
  content: "\f12a";
}
.fa-superscript:before {
  content: "\f12b";
}
.fa-subscript:before {
  content: "\f12c";
}
.fa-eraser:before {
  content: "\f12d";
}
.fa-puzzle-piece:before {
  content: "\f12e";
}
.fa-microphone:before {
  content: "\f130";
}
.fa-microphone-slash:before {
  content: "\f131";
}
.fa-shield:before {
  content: "\f132";
}
.fa-calendar-o:before {
  content: "\f133";
}
.fa-fire-extinguisher:before {
  content: "\f134";
}
.fa-rocket:before {
  content: "\f135";
}
.fa-maxcdn:before {
  content: "\f136";
}
.fa-chevron-circle-left:before {
  content: "\f137";
}
.fa-chevron-circle-right:before {
  content: "\f138";
}
.fa-chevron-circle-up:before {
  content: "\f139";
}
.fa-chevron-circle-down:before {
  content: "\f13a";
}
.fa-html5:before {
  content: "\f13b";
}
.fa-css3:before {
  content: "\f13c";
}
.fa-anchor:before {
  content: "\f13d";
}
.fa-unlock-alt:before {
  content: "\f13e";
}
.fa-bullseye:before {
  content: "\f140";
}
.fa-ellipsis-h:before {
  content: "\f141";
}
.fa-ellipsis-v:before {
  content: "\f142";
}
.fa-rss-square:before {
  content: "\f143";
}
.fa-play-circle:before {
  content: "\f144";
}
.fa-ticket:before {
  content: "\f145";
}
.fa-minus-square:before {
  content: "\f146";
}
.fa-minus-square-o:before {
  content: "\f147";
}
.fa-level-up:before {
  content: "\f148";
}
.fa-level-down:before {
  content: "\f149";
}
.fa-check-square:before {
  content: "\f14a";
}
.fa-pencil-square:before {
  content: "\f14b";
}
.fa-external-link-square:before {
  content: "\f14c";
}
.fa-share-square:before {
  content: "\f14d";
}
.fa-compass:before {
  content: "\f14e";
}
.fa-toggle-down:before,
.fa-caret-square-o-down:before {
  content: "\f150";
}
.fa-toggle-up:before,
.fa-caret-square-o-up:before {
  content: "\f151";
}
.fa-toggle-right:before,
.fa-caret-square-o-right:before {
  content: "\f152";
}
.fa-euro:before,
.fa-eur:before {
  content: "\f153";
}
.fa-gbp:before {
  content: "\f154";
}
.fa-dollar:before,
.fa-usd:before {
  content: "\f155";
}
.fa-rupee:before,
.fa-inr:before {
  content: "\f156";
}
.fa-cny:before,
.fa-rmb:before,
.fa-yen:before,
.fa-jpy:before {
  content: "\f157";
}
.fa-ruble:before,
.fa-rouble:before,
.fa-rub:before {
  content: "\f158";
}
.fa-won:before,
.fa-krw:before {
  content: "\f159";
}
.fa-bitcoin:before,
.fa-btc:before {
  content: "\f15a";
}
.fa-file:before {
  content: "\f15b";
}
.fa-file-text:before {
  content: "\f15c";
}
.fa-sort-alpha-asc:before {
  content: "\f15d";
}
.fa-sort-alpha-desc:before {
  content: "\f15e";
}
.fa-sort-amount-asc:before {
  content: "\f160";
}
.fa-sort-amount-desc:before {
  content: "\f161";
}
.fa-sort-numeric-asc:before {
  content: "\f162";
}
.fa-sort-numeric-desc:before {
  content: "\f163";
}
.fa-thumbs-up:before {
  content: "\f164";
}
.fa-thumbs-down:before {
  content: "\f165";
}
.fa-youtube-square:before {
  content: "\f166";
}
.fa-youtube:before {
  content: "\f167";
}
.fa-xing:before {
  content: "\f168";
}
.fa-xing-square:before {
  content: "\f169";
}
.fa-youtube-play:before {
  content: "\f16a";
}
.fa-dropbox:before {
  content: "\f16b";
}
.fa-stack-overflow:before {
  content: "\f16c";
}
.fa-instagram:before {
  content: "\f16d";
}
.fa-flickr:before {
  content: "\f16e";
}
.fa-adn:before {
  content: "\f170";
}
.fa-bitbucket:before {
  content: "\f171";
}
.fa-bitbucket-square:before {
  content: "\f172";
}
.fa-tumblr:before {
  content: "\f173";
}
.fa-tumblr-square:before {
  content: "\f174";
}
.fa-long-arrow-down:before {
  content: "\f175";
}
.fa-long-arrow-up:before {
  content: "\f176";
}
.fa-long-arrow-left:before {
  content: "\f177";
}
.fa-long-arrow-right:before {
  content: "\f178";
}
.fa-apple:before {
  content: "\f179";
}
.fa-windows:before {
  content: "\f17a";
}
.fa-android:before {
  content: "\f17b";
}
.fa-linux:before {
  content: "\f17c";
}
.fa-dribbble:before {
  content: "\f17d";
}
.fa-skype:before {
  content: "\f17e";
}
.fa-foursquare:before {
  content: "\f180";
}
.fa-trello:before {
  content: "\f181";
}
.fa-female:before {
  content: "\f182";
}
.fa-male:before {
  content: "\f183";
}
.fa-gittip:before {
  content: "\f184";
}
.fa-sun-o:before {
  content: "\f185";
}
.fa-moon-o:before {
  content: "\f186";
}
.fa-archive:before {
  content: "\f187";
}
.fa-bug:before {
  content: "\f188";
}
.fa-vk:before {
  content: "\f189";
}
.fa-weibo:before {
  content: "\f18a";
}
.fa-renren:before {
  content: "\f18b";
}
.fa-pagelines:before {
  content: "\f18c";
}
.fa-stack-exchange:before {
  content: "\f18d";
}
.fa-arrow-circle-o-right:before {
  content: "\f18e";
}
.fa-arrow-circle-o-left:before {
  content: "\f190";
}
.fa-toggle-left:before,
.fa-caret-square-o-left:before {
  content: "\f191";
}
.fa-dot-circle-o:before {
  content: "\f192";
}
.fa-wheelchair:before {
  content: "\f193";
}
.fa-vimeo-square:before {
  content: "\f194";
}
.fa-turkish-lira:before,
.fa-try:before {
  content: "\f195";
}
.fa-plus-square-o:before {
  content: "\f196";
}
.fa-space-shuttle:before {
  content: "\f197";
}
.fa-slack:before {
  content: "\f198";
}
.fa-envelope-square:before {
  content: "\f199";
}
.fa-wordpress:before {
  content: "\f19a";
}
.fa-openid:before {
  content: "\f19b";
}
.fa-institution:before,
.fa-bank:before,
.fa-university:before {
  content: "\f19c";
}
.fa-mortar-board:before,
.fa-graduation-cap:before {
  content: "\f19d";
}
.fa-yahoo:before {
  content: "\f19e";
}
.fa-google:before {
  content: "\f1a0";
}
.fa-reddit:before {
  content: "\f1a1";
}
.fa-reddit-square:before {
  content: "\f1a2";
}
.fa-stumbleupon-circle:before {
  content: "\f1a3";
}
.fa-stumbleupon:before {
  content: "\f1a4";
}
.fa-delicious:before {
  content: "\f1a5";
}
.fa-digg:before {
  content: "\f1a6";
}
.fa-pied-piper:before {
  content: "\f1a7";
}
.fa-pied-piper-alt:before {
  content: "\f1a8";
}
.fa-drupal:before {
  content: "\f1a9";
}
.fa-joomla:before {
  content: "\f1aa";
}
.fa-language:before {
  content: "\f1ab";
}
.fa-fax:before {
  content: "\f1ac";
}
.fa-building:before {
  content: "\f1ad";
}
.fa-child:before {
  content: "\f1ae";
}
.fa-paw:before {
  content: "\f1b0";
}
.fa-spoon:before {
  content: "\f1b1";
}
.fa-cube:before {
  content: "\f1b2";
}
.fa-cubes:before {
  content: "\f1b3";
}
.fa-behance:before {
  content: "\f1b4";
}
.fa-behance-square:before {
  content: "\f1b5";
}
.fa-steam:before {
  content: "\f1b6";
}
.fa-steam-square:before {
  content: "\f1b7";
}
.fa-recycle:before {
  content: "\f1b8";
}
.fa-automobile:before,
.fa-car:before {
  content: "\f1b9";
}
.fa-cab:before,
.fa-taxi:before {
  content: "\f1ba";
}
.fa-tree:before {
  content: "\f1bb";
}
.fa-spotify:before {
  content: "\f1bc";
}
.fa-deviantart:before {
  content: "\f1bd";
}
.fa-soundcloud:before {
  content: "\f1be";
}
.fa-database:before {
  content: "\f1c0";
}
.fa-file-pdf-o:before {
  content: "\f1c1";
}
.fa-file-word-o:before {
  content: "\f1c2";
}
.fa-file-excel-o:before {
  content: "\f1c3";
}
.fa-file-powerpoint-o:before {
  content: "\f1c4";
}
.fa-file-photo-o:before,
.fa-file-picture-o:before,
.fa-file-image-o:before {
  content: "\f1c5";
}
.fa-file-zip-o:before,
.fa-file-archive-o:before {
  content: "\f1c6";
}
.fa-file-sound-o:before,
.fa-file-audio-o:before {
  content: "\f1c7";
}
.fa-file-movie-o:before,
.fa-file-video-o:before {
  content: "\f1c8";
}
.fa-file-code-o:before {
  content: "\f1c9";
}
.fa-vine:before {
  content: "\f1ca";
}
.fa-codepen:before {
  content: "\f1cb";
}
.fa-jsfiddle:before {
  content: "\f1cc";
}
.fa-life-bouy:before,
.fa-life-buoy:before,
.fa-life-saver:before,
.fa-support:before,
.fa-life-ring:before {
  content: "\f1cd";
}
.fa-circle-o-notch:before {
  content: "\f1ce";
}
.fa-ra:before,
.fa-rebel:before {
  content: "\f1d0";
}
.fa-ge:before,
.fa-empire:before {
  content: "\f1d1";
}
.fa-git-square:before {
  content: "\f1d2";
}
.fa-git:before {
  content: "\f1d3";
}
.fa-hacker-news:before {
  content: "\f1d4";
}
.fa-tencent-weibo:before {
  content: "\f1d5";
}
.fa-qq:before {
  content: "\f1d6";
}
.fa-wechat:before,
.fa-weixin:before {
  content: "\f1d7";
}
.fa-send:before,
.fa-paper-plane:before {
  content: "\f1d8";
}
.fa-send-o:before,
.fa-paper-plane-o:before {
  content: "\f1d9";
}
.fa-history:before {
  content: "\f1da";
}
.fa-circle-thin:before {
  content: "\f1db";
}
.fa-header:before {
  content: "\f1dc";
}
.fa-paragraph:before {
  content: "\f1dd";
}
.fa-sliders:before {
  content: "\f1de";
}
.fa-share-alt:before {
  content: "\f1e0";
}
.fa-share-alt-square:before {
  content: "\f1e1";
}
.fa-bomb:before {
  content: "\f1e2";
}
.fa-soccer-ball-o:before,
.fa-futbol-o:before {
  content: "\f1e3";
}
.fa-tty:before {
  content: "\f1e4";
}
.fa-binoculars:before {
  content: "\f1e5";
}
.fa-plug:before {
  content: "\f1e6";
}
.fa-slideshare:before {
  content: "\f1e7";
}
.fa-twitch:before {
  content: "\f1e8";
}
.fa-yelp:before {
  content: "\f1e9";
}
.fa-newspaper-o:before {
  content: "\f1ea";
}
.fa-wifi:before {
  content: "\f1eb";
}
.fa-calculator:before {
  content: "\f1ec";
}
.fa-paypal:before {
  content: "\f1ed";
}
.fa-google-wallet:before {
  content: "\f1ee";
}
.fa-cc-visa:before {
  content: "\f1f0";
}
.fa-cc-mastercard:before {
  content: "\f1f1";
}
.fa-cc-discover:before {
  content: "\f1f2";
}
.fa-cc-amex:before {
  content: "\f1f3";
}
.fa-cc-paypal:before {
  content: "\f1f4";
}
.fa-cc-stripe:before {
  content: "\f1f5";
}
.fa-bell-slash:before {
  content: "\f1f6";
}
.fa-bell-slash-o:before {
  content: "\f1f7";
}
.fa-trash:before {
  content: "\f1f8";
}
.fa-copyright:before {
  content: "\f1f9";
}
.fa-at:before {
  content: "\f1fa";
}
.fa-eyedropper:before {
  content: "\f1fb";
}
.fa-paint-brush:before {
  content: "\f1fc";
}
.fa-birthday-cake:before {
  content: "\f1fd";
}
.fa-area-chart:before {
  content: "\f1fe";
}
.fa-pie-chart:before {
  content: "\f200";
}
.fa-line-chart:before {
  content: "\f201";
}
.fa-lastfm:before {
  content: "\f202";
}
.fa-lastfm-square:before {
  content: "\f203";
}
.fa-toggle-off:before {
  content: "\f204";
}
.fa-toggle-on:before {
  content: "\f205";
}
.fa-bicycle:before {
  content: "\f206";
}
.fa-bus:before {
  content: "\f207";
}
.fa-ioxhost:before {
  content: "\f208";
}
.fa-angellist:before {
  content: "\f209";
}
.fa-cc:before {
  content: "\f20a";
}
.fa-shekel:before,
.fa-sheqel:before,
.fa-ils:before {
  content: "\f20b";
}
.fa-meanpath:before {
  content: "\f20c";
}
/*!
*
* IPython base
*
*/
.modal.fade .modal-dialog {
  -webkit-transform: translate(0, 0);
  -ms-transform: translate(0, 0);
  -o-transform: translate(0, 0);
  transform: translate(0, 0);
}
code {
  color: #000;
}
pre {
  font-size: inherit;
  line-height: inherit;
}
label {
  font-weight: normal;
}
/* Make the page background atleast 100% the height of the view port */
/* Make the page itself atleast 70% the height of the view port */
.border-box-sizing {
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}
.corner-all {
  border-radius: 2px;
}
.no-padding {
  padding: 0px;
}
/* Flexible box model classes */
/* Taken from Alex Russell http://infrequently.org/2009/08/css-3-progress/ */
/* This file is a compatability layer.  It allows the usage of flexible box 
model layouts accross multiple browsers, including older browsers.  The newest,
universal implementation of the flexible box model is used when available (see
`Modern browsers` comments below).  Browsers that are known to implement this 
new spec completely include:

    Firefox 28.0+
    Chrome 29.0+
    Internet Explorer 11+ 
    Opera 17.0+

Browsers not listed, including Safari, are supported via the styling under the
`Old browsers` comments below.
*/
.hbox {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
.hbox > * {
  /* Old browsers */
  -webkit-box-flex: 0;
  -moz-box-flex: 0;
  box-flex: 0;
  /* Modern browsers */
  flex: none;
}
.vbox {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
.vbox > * {
  /* Old browsers */
  -webkit-box-flex: 0;
  -moz-box-flex: 0;
  box-flex: 0;
  /* Modern browsers */
  flex: none;
}
.hbox.reverse,
.vbox.reverse,
.reverse {
  /* Old browsers */
  -webkit-box-direction: reverse;
  -moz-box-direction: reverse;
  box-direction: reverse;
  /* Modern browsers */
  flex-direction: row-reverse;
}
.hbox.box-flex0,
.vbox.box-flex0,
.box-flex0 {
  /* Old browsers */
  -webkit-box-flex: 0;
  -moz-box-flex: 0;
  box-flex: 0;
  /* Modern browsers */
  flex: none;
  width: auto;
}
.hbox.box-flex1,
.vbox.box-flex1,
.box-flex1 {
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
}
.hbox.box-flex,
.vbox.box-flex,
.box-flex {
  /* Old browsers */
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
}
.hbox.box-flex2,
.vbox.box-flex2,
.box-flex2 {
  /* Old browsers */
  -webkit-box-flex: 2;
  -moz-box-flex: 2;
  box-flex: 2;
  /* Modern browsers */
  flex: 2;
}
.box-group1 {
  /*  Deprecated */
  -webkit-box-flex-group: 1;
  -moz-box-flex-group: 1;
  box-flex-group: 1;
}
.box-group2 {
  /* Deprecated */
  -webkit-box-flex-group: 2;
  -moz-box-flex-group: 2;
  box-flex-group: 2;
}
.hbox.start,
.vbox.start,
.start {
  /* Old browsers */
  -webkit-box-pack: start;
  -moz-box-pack: start;
  box-pack: start;
  /* Modern browsers */
  justify-content: flex-start;
}
.hbox.end,
.vbox.end,
.end {
  /* Old browsers */
  -webkit-box-pack: end;
  -moz-box-pack: end;
  box-pack: end;
  /* Modern browsers */
  justify-content: flex-end;
}
.hbox.center,
.vbox.center,
.center {
  /* Old browsers */
  -webkit-box-pack: center;
  -moz-box-pack: center;
  box-pack: center;
  /* Modern browsers */
  justify-content: center;
}
.hbox.baseline,
.vbox.baseline,
.baseline {
  /* Old browsers */
  -webkit-box-pack: baseline;
  -moz-box-pack: baseline;
  box-pack: baseline;
  /* Modern browsers */
  justify-content: baseline;
}
.hbox.stretch,
.vbox.stretch,
.stretch {
  /* Old browsers */
  -webkit-box-pack: stretch;
  -moz-box-pack: stretch;
  box-pack: stretch;
  /* Modern browsers */
  justify-content: stretch;
}
.hbox.align-start,
.vbox.align-start,
.align-start {
  /* Old browsers */
  -webkit-box-align: start;
  -moz-box-align: start;
  box-align: start;
  /* Modern browsers */
  align-items: flex-start;
}
.hbox.align-end,
.vbox.align-end,
.align-end {
  /* Old browsers */
  -webkit-box-align: end;
  -moz-box-align: end;
  box-align: end;
  /* Modern browsers */
  align-items: flex-end;
}
.hbox.align-center,
.vbox.align-center,
.align-center {
  /* Old browsers */
  -webkit-box-align: center;
  -moz-box-align: center;
  box-align: center;
  /* Modern browsers */
  align-items: center;
}
.hbox.align-baseline,
.vbox.align-baseline,
.align-baseline {
  /* Old browsers */
  -webkit-box-align: baseline;
  -moz-box-align: baseline;
  box-align: baseline;
  /* Modern browsers */
  align-items: baseline;
}
.hbox.align-stretch,
.vbox.align-stretch,
.align-stretch {
  /* Old browsers */
  -webkit-box-align: stretch;
  -moz-box-align: stretch;
  box-align: stretch;
  /* Modern browsers */
  align-items: stretch;
}
div.error {
  margin: 2em;
  text-align: center;
}
div.error > h1 {
  font-size: 500%;
  line-height: normal;
}
div.error > p {
  font-size: 200%;
  line-height: normal;
}
div.traceback-wrapper {
  text-align: left;
  max-width: 800px;
  margin: auto;
}
/**
 * Primary styles
 *
 * Author: Jupyter Development Team
 */
body {
  background-color: #fff;
  /* This makes sure that the body covers the entire window and needs to
       be in a different element than the display: box in wrapper below */
  position: absolute;
  left: 0px;
  right: 0px;
  top: 0px;
  bottom: 0px;
  overflow: visible;
}
body > #header {
  /* Initially hidden to prevent FLOUC */
  display: none;
  background-color: #fff;
  /* Display over codemirror */
  position: relative;
  z-index: 100;
}
body > #header #header-container {
  padding-bottom: 5px;
  padding-top: 5px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}
body > #header .header-bar {
  width: 100%;
  height: 1px;
  background: #e7e7e7;
  margin-bottom: -1px;
}
@media print {
  body > #header {
    display: none !important;
  }
}
#header-spacer {
  width: 100%;
  visibility: hidden;
}
@media print {
  #header-spacer {
    display: none;
  }
}
#ipython_notebook {
  padding-left: 0px;
  padding-top: 1px;
  padding-bottom: 1px;
}
@media (max-width: 991px) {
  #ipython_notebook {
    margin-left: 10px;
  }
}
[dir="rtl"] #ipython_notebook {
  float: right !important;
}
#noscript {
  width: auto;
  padding-top: 16px;
  padding-bottom: 16px;
  text-align: center;
  font-size: 22px;
  color: red;
  font-weight: bold;
}
#ipython_notebook img {
  height: 28px;
}
#site {
  width: 100%;
  display: none;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  overflow: auto;
}
@media print {
  #site {
    height: auto !important;
  }
}
/* Smaller buttons */
.ui-button .ui-button-text {
  padding: 0.2em 0.8em;
  font-size: 77%;
}
input.ui-button {
  padding: 0.3em 0.9em;
}
span#login_widget {
  float: right;
}
span#login_widget > .button,
#logout {
  color: #333;
  background-color: #fff;
  border-color: #ccc;
}
span#login_widget > .button:focus,
#logout:focus,
span#login_widget > .button.focus,
#logout.focus {
  color: #333;
  background-color: #e6e6e6;
  border-color: #8c8c8c;
}
span#login_widget > .button:hover,
#logout:hover {
  color: #333;
  background-color: #e6e6e6;
  border-color: #adadad;
}
span#login_widget > .button:active,
#logout:active,
span#login_widget > .button.active,
#logout.active,
.open > .dropdown-togglespan#login_widget > .button,
.open > .dropdown-toggle#logout {
  color: #333;
  background-color: #e6e6e6;
  border-color: #adadad;
}
span#login_widget > .button:active:hover,
#logout:active:hover,
span#login_widget > .button.active:hover,
#logout.active:hover,
.open > .dropdown-togglespan#login_widget > .button:hover,
.open > .dropdown-toggle#logout:hover,
span#login_widget > .button:active:focus,
#logout:active:focus,
span#login_widget > .button.active:focus,
#logout.active:focus,
.open > .dropdown-togglespan#login_widget > .button:focus,
.open > .dropdown-toggle#logout:focus,
span#login_widget > .button:active.focus,
#logout:active.focus,
span#login_widget > .button.active.focus,
#logout.active.focus,
.open > .dropdown-togglespan#login_widget > .button.focus,
.open > .dropdown-toggle#logout.focus {
  color: #333;
  background-color: #d4d4d4;
  border-color: #8c8c8c;
}
span#login_widget > .button:active,
#logout:active,
span#login_widget > .button.active,
#logout.active,
.open > .dropdown-togglespan#login_widget > .button,
.open > .dropdown-toggle#logout {
  background-image: none;
}
span#login_widget > .button.disabled:hover,
#logout.disabled:hover,
span#login_widget > .button[disabled]:hover,
#logout[disabled]:hover,
fieldset[disabled] span#login_widget > .button:hover,
fieldset[disabled] #logout:hover,
span#login_widget > .button.disabled:focus,
#logout.disabled:focus,
span#login_widget > .button[disabled]:focus,
#logout[disabled]:focus,
fieldset[disabled] span#login_widget > .button:focus,
fieldset[disabled] #logout:focus,
span#login_widget > .button.disabled.focus,
#logout.disabled.focus,
span#login_widget > .button[disabled].focus,
#logout[disabled].focus,
fieldset[disabled] span#login_widget > .button.focus,
fieldset[disabled] #logout.focus {
  background-color: #fff;
  border-color: #ccc;
}
span#login_widget > .button .badge,
#logout .badge {
  color: #fff;
  background-color: #333;
}
.nav-header {
  text-transform: none;
}
#header > span {
  margin-top: 10px;
}
.modal_stretch .modal-dialog {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  min-height: 80vh;
}
.modal_stretch .modal-dialog .modal-body {
  max-height: calc(100vh - 200px);
  overflow: auto;
  flex: 1;
}
@media (min-width: 768px) {
  .modal .modal-dialog {
    width: 700px;
  }
}
@media (min-width: 768px) {
  select.form-control {
    margin-left: 12px;
    margin-right: 12px;
  }
}
/*!
*
* IPython auth
*
*/
.center-nav {
  display: inline-block;
  margin-bottom: -4px;
}
/*!
*
* IPython tree view
*
*/
/* We need an invisible input field on top of the sentense*/
/* "Drag file onto the list ..." */
.alternate_upload {
  background-color: none;
  display: inline;
}
.alternate_upload.form {
  padding: 0;
  margin: 0;
}
.alternate_upload input.fileinput {
  text-align: center;
  vertical-align: middle;
  display: inline;
  opacity: 0;
  z-index: 2;
  width: 12ex;
  margin-right: -12ex;
}
.alternate_upload .btn-upload {
  height: 22px;
}
/**
 * Primary styles
 *
 * Author: Jupyter Development Team
 */
[dir="rtl"] #tabs li {
  float: right;
}
ul#tabs {
  margin-bottom: 4px;
}
[dir="rtl"] ul#tabs {
  margin-right: 0px;
}
ul#tabs a {
  padding-top: 6px;
  padding-bottom: 4px;
}
ul.breadcrumb a:focus,
ul.breadcrumb a:hover {
  text-decoration: none;
}
ul.breadcrumb i.icon-home {
  font-size: 16px;
  margin-right: 4px;
}
ul.breadcrumb span {
  color: #5e5e5e;
}
.list_toolbar {
  padding: 4px 0 4px 0;
  vertical-align: middle;
}
.list_toolbar .tree-buttons {
  padding-top: 1px;
}
[dir="rtl"] .list_toolbar .tree-buttons {
  float: left !important;
}
[dir="rtl"] .list_toolbar .pull-right {
  padding-top: 1px;
  float: left !important;
}
[dir="rtl"] .list_toolbar .pull-left {
  float: right !important;
}
.dynamic-buttons {
  padding-top: 3px;
  display: inline-block;
}
.list_toolbar [class*="span"] {
  min-height: 24px;
}
.list_header {
  font-weight: bold;
  background-color: #EEE;
}
.list_placeholder {
  font-weight: bold;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 7px;
  padding-right: 7px;
}
.list_container {
  margin-top: 4px;
  margin-bottom: 20px;
  border: 1px solid #ddd;
  border-radius: 2px;
}
.list_container > div {
  border-bottom: 1px solid #ddd;
}
.list_container > div:hover .list-item {
  background-color: red;
}
.list_container > div:last-child {
  border: none;
}
.list_item:hover .list_item {
  background-color: #ddd;
}
.list_item a {
  text-decoration: none;
}
.list_item:hover {
  background-color: #fafafa;
}
.list_header > div,
.list_item > div {
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 7px;
  padding-right: 7px;
  line-height: 22px;
}
.list_header > div input,
.list_item > div input {
  margin-right: 7px;
  margin-left: 14px;
  vertical-align: baseline;
  line-height: 22px;
  position: relative;
  top: -1px;
}
.list_header > div .item_link,
.list_item > div .item_link {
  margin-left: -1px;
  vertical-align: baseline;
  line-height: 22px;
}
.new-file input[type=checkbox] {
  visibility: hidden;
}
.item_name {
  line-height: 22px;
  height: 24px;
}
.item_icon {
  font-size: 14px;
  color: #5e5e5e;
  margin-right: 7px;
  margin-left: 7px;
  line-height: 22px;
  vertical-align: baseline;
}
.item_buttons {
  line-height: 1em;
  margin-left: -5px;
}
.item_buttons .btn,
.item_buttons .btn-group,
.item_buttons .input-group {
  float: left;
}
.item_buttons > .btn,
.item_buttons > .btn-group,
.item_buttons > .input-group {
  margin-left: 5px;
}
.item_buttons .btn {
  min-width: 13ex;
}
.item_buttons .running-indicator {
  padding-top: 4px;
  color: #5cb85c;
}
.item_buttons .kernel-name {
  padding-top: 4px;
  color: #5bc0de;
  margin-right: 7px;
  float: left;
}
.toolbar_info {
  height: 24px;
  line-height: 24px;
}
.list_item input:not([type=checkbox]) {
  padding-top: 3px;
  padding-bottom: 3px;
  height: 22px;
  line-height: 14px;
  margin: 0px;
}
.highlight_text {
  color: blue;
}
#project_name {
  display: inline-block;
  padding-left: 7px;
  margin-left: -2px;
}
#project_name > .breadcrumb {
  padding: 0px;
  margin-bottom: 0px;
  background-color: transparent;
  font-weight: bold;
}
#tree-selector {
  padding-right: 0px;
}
[dir="rtl"] #tree-selector a {
  float: right;
}
#button-select-all {
  min-width: 50px;
}
#select-all {
  margin-left: 7px;
  margin-right: 2px;
}
.menu_icon {
  margin-right: 2px;
}
.tab-content .row {
  margin-left: 0px;
  margin-right: 0px;
}
.folder_icon:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f114";
}
.folder_icon:before.pull-left {
  margin-right: .3em;
}
.folder_icon:before.pull-right {
  margin-left: .3em;
}
.notebook_icon:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f02d";
  position: relative;
  top: -1px;
}
.notebook_icon:before.pull-left {
  margin-right: .3em;
}
.notebook_icon:before.pull-right {
  margin-left: .3em;
}
.running_notebook_icon:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f02d";
  position: relative;
  top: -1px;
  color: #5cb85c;
}
.running_notebook_icon:before.pull-left {
  margin-right: .3em;
}
.running_notebook_icon:before.pull-right {
  margin-left: .3em;
}
.file_icon:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f016";
  position: relative;
  top: -2px;
}
.file_icon:before.pull-left {
  margin-right: .3em;
}
.file_icon:before.pull-right {
  margin-left: .3em;
}
#notebook_toolbar .pull-right {
  padding-top: 0px;
  margin-right: -1px;
}
ul#new-menu {
  left: auto;
  right: 0;
}
[dir="rtl"] #new-menu {
  text-align: right;
}
.kernel-menu-icon {
  padding-right: 12px;
  width: 24px;
  content: "\f096";
}
.kernel-menu-icon:before {
  content: "\f096";
}
.kernel-menu-icon-current:before {
  content: "\f00c";
}
#tab_content {
  padding-top: 20px;
}
#running .panel-group .panel {
  margin-top: 3px;
  margin-bottom: 1em;
}
#running .panel-group .panel .panel-heading {
  background-color: #EEE;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 7px;
  padding-right: 7px;
  line-height: 22px;
}
#running .panel-group .panel .panel-heading a:focus,
#running .panel-group .panel .panel-heading a:hover {
  text-decoration: none;
}
#running .panel-group .panel .panel-body {
  padding: 0px;
}
#running .panel-group .panel .panel-body .list_container {
  margin-top: 0px;
  margin-bottom: 0px;
  border: 0px;
  border-radius: 0px;
}
#running .panel-group .panel .panel-body .list_container .list_item {
  border-bottom: 1px solid #ddd;
}
#running .panel-group .panel .panel-body .list_container .list_item:last-child {
  border-bottom: 0px;
}
[dir="rtl"] #running .col-sm-8 {
  float: right !important;
}
.delete-button {
  display: none;
}
.duplicate-button {
  display: none;
}
.rename-button {
  display: none;
}
.shutdown-button {
  display: none;
}
.dynamic-instructions {
  display: inline-block;
  padding-top: 4px;
}
/*!
*
* IPython text editor webapp
*
*/
.selected-keymap i.fa {
  padding: 0px 5px;
}
.selected-keymap i.fa:before {
  content: "\f00c";
}
#mode-menu {
  overflow: auto;
  max-height: 20em;
}
.edit_app #header {
  -webkit-box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
  box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
}
.edit_app #menubar .navbar {
  /* Use a negative 1 bottom margin, so the border overlaps the border of the
    header */
  margin-bottom: -1px;
}
.dirty-indicator {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  width: 20px;
}
.dirty-indicator.pull-left {
  margin-right: .3em;
}
.dirty-indicator.pull-right {
  margin-left: .3em;
}
.dirty-indicator-dirty {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  width: 20px;
}
.dirty-indicator-dirty.pull-left {
  margin-right: .3em;
}
.dirty-indicator-dirty.pull-right {
  margin-left: .3em;
}
.dirty-indicator-clean {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  width: 20px;
}
.dirty-indicator-clean.pull-left {
  margin-right: .3em;
}
.dirty-indicator-clean.pull-right {
  margin-left: .3em;
}
.dirty-indicator-clean:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f00c";
}
.dirty-indicator-clean:before.pull-left {
  margin-right: .3em;
}
.dirty-indicator-clean:before.pull-right {
  margin-left: .3em;
}
#filename {
  font-size: 16pt;
  display: table;
  padding: 0px 5px;
}
#current-mode {
  padding-left: 5px;
  padding-right: 5px;
}
#texteditor-backdrop {
  padding-top: 20px;
  padding-bottom: 20px;
}
@media not print {
  #texteditor-backdrop {
    background-color: #EEE;
  }
}
@media print {
  #texteditor-backdrop #texteditor-container .CodeMirror-gutter,
  #texteditor-backdrop #texteditor-container .CodeMirror-gutters {
    background-color: #fff;
  }
}
@media not print {
  #texteditor-backdrop #texteditor-container .CodeMirror-gutter,
  #texteditor-backdrop #texteditor-container .CodeMirror-gutters {
    background-color: #fff;
  }
}
@media not print {
  #texteditor-backdrop #texteditor-container {
    padding: 0px;
    background-color: #fff;
    -webkit-box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
    box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
  }
}
/*!
*
* IPython notebook
*
*/
/* CSS font colors for translated ANSI colors. */
.ansibold {
  font-weight: bold;
}
/* use dark versions for foreground, to improve visibility */
.ansiblack {
  color: black;
}
.ansired {
  color: darkred;
}
.ansigreen {
  color: darkgreen;
}
.ansiyellow {
  color: #c4a000;
}
.ansiblue {
  color: darkblue;
}
.ansipurple {
  color: darkviolet;
}
.ansicyan {
  color: steelblue;
}
.ansigray {
  color: gray;
}
/* and light for background, for the same reason */
.ansibgblack {
  background-color: black;
}
.ansibgred {
  background-color: red;
}
.ansibggreen {
  background-color: green;
}
.ansibgyellow {
  background-color: yellow;
}
.ansibgblue {
  background-color: blue;
}
.ansibgpurple {
  background-color: magenta;
}
.ansibgcyan {
  background-color: cyan;
}
.ansibggray {
  background-color: gray;
}
div.cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  border-radius: 2px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  border-width: 1px;
  border-style: solid;
  border-color: transparent;
  width: 100%;
  padding: 5px;
  /* This acts as a spacer between cells, that is outside the border */
  margin: 0px;
  outline: none;
  border-left-width: 1px;
  padding-left: 5px;
  background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%);
}
div.cell.jupyter-soft-selected {
  border-left-color: #90CAF9;
  border-left-color: #E3F2FD;
  border-left-width: 1px;
  padding-left: 5px;
  border-right-color: #E3F2FD;
  border-right-width: 1px;
  background: #E3F2FD;
}
@media print {
  div.cell.jupyter-soft-selected {
    border-color: transparent;
  }
}
div.cell.selected {
  border-color: #ababab;
  border-left-width: 0px;
  padding-left: 6px;
  background: linear-gradient(to right, #42A5F5 -40px, #42A5F5 5px, transparent 5px, transparent 100%);
}
@media print {
  div.cell.selected {
    border-color: transparent;
  }
}
div.cell.selected.jupyter-soft-selected {
  border-left-width: 0;
  padding-left: 6px;
  background: linear-gradient(to right, #42A5F5 -40px, #42A5F5 7px, #E3F2FD 7px, #E3F2FD 100%);
}
.edit_mode div.cell.selected {
  border-color: #66BB6A;
  border-left-width: 0px;
  padding-left: 6px;
  background: linear-gradient(to right, #66BB6A -40px, #66BB6A 5px, transparent 5px, transparent 100%);
}
@media print {
  .edit_mode div.cell.selected {
    border-color: transparent;
  }
}
.prompt {
  /* This needs to be wide enough for 3 digit prompt numbers: In[100]: */
  min-width: 14ex;
  /* This padding is tuned to match the padding on the CodeMirror editor. */
  padding: 0.4em;
  margin: 0px;
  font-family: monospace;
  text-align: right;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
  /* Don't highlight prompt number selection */
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  /* Use default cursor */
  cursor: default;
}
@media (max-width: 540px) {
  .prompt {
    text-align: left;
  }
}
div.inner_cell {
  min-width: 0;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_area {
  border: 1px solid #cfcfcf;
  border-radius: 2px;
  background: #f7f7f7;
  line-height: 1.21429em;
}
/* This is needed so that empty prompt areas can collapse to zero height when there
   is no content in the output_subarea and the prompt. The main purpose of this is
   to make sure that empty JavaScript output_subareas have no height. */
div.prompt:empty {
  padding-top: 0;
  padding-bottom: 0;
}
div.unrecognized_cell {
  padding: 5px 5px 5px 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.unrecognized_cell .inner_cell {
  border-radius: 2px;
  padding: 5px;
  font-weight: bold;
  color: red;
  border: 1px solid #cfcfcf;
  background: #eaeaea;
}
div.unrecognized_cell .inner_cell a {
  color: inherit;
  text-decoration: none;
}
div.unrecognized_cell .inner_cell a:hover {
  color: inherit;
  text-decoration: none;
}
@media (max-width: 540px) {
  div.unrecognized_cell > div.prompt {
    display: none;
  }
}
div.code_cell {
  /* avoid page breaking on code cells when printing */
}
@media print {
  div.code_cell {
    page-break-inside: avoid;
  }
}
/* any special styling for code cells that are currently running goes here */
div.input {
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.input {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_prompt {
  color: #303F9F;
  border-top: 1px solid transparent;
}
div.input_area > div.highlight {
  margin: 0.4em;
  border: none;
  padding: 0px;
  background-color: transparent;
}
div.input_area > div.highlight > pre {
  margin: 0px;
  border: none;
  padding: 0px;
  background-color: transparent;
}
/* The following gets added to the <head> if it is detected that the user has a
 * monospace font with inconsistent normal/bold/italic height.  See
 * notebookmain.js.  Such fonts will have keywords vertically offset with
 * respect to the rest of the text.  The user should select a better font.
 * See: https://github.com/ipython/ipython/issues/1503
 *
 * .CodeMirror span {
 *      vertical-align: bottom;
 * }
 */
.CodeMirror {
  line-height: 1.21429em;
  /* Changed from 1em to our global default */
  font-size: 14px;
  height: auto;
  /* Changed to auto to autogrow */
  background: none;
  /* Changed from white to allow our bg to show through */
}
.CodeMirror-scroll {
  /*  The CodeMirror docs are a bit fuzzy on if overflow-y should be hidden or visible.*/
  /*  We have found that if it is visible, vertical scrollbars appear with font size changes.*/
  overflow-y: hidden;
  overflow-x: auto;
}
.CodeMirror-lines {
  /* In CM2, this used to be 0.4em, but in CM3 it went to 4px. We need the em value because */
  /* we have set a different line-height and want this to scale with that. */
  padding: 0.4em;
}
.CodeMirror-linenumber {
  padding: 0 8px 0 4px;
}
.CodeMirror-gutters {
  border-bottom-left-radius: 2px;
  border-top-left-radius: 2px;
}
.CodeMirror pre {
  /* In CM3 this went to 4px from 0 in CM2. We need the 0 value because of how we size */
  /* .CodeMirror-lines */
  padding: 0;
  border: 0;
  border-radius: 0;
}
/*

Original style from softwaremaniacs.org (c) Ivan Sagalaev <Maniac@SoftwareManiacs.Org>
Adapted from GitHub theme

*/
.highlight-base {
  color: #000;
}
.highlight-variable {
  color: #000;
}
.highlight-variable-2 {
  color: #1a1a1a;
}
.highlight-variable-3 {
  color: #333333;
}
.highlight-string {
  color: #BA2121;
}
.highlight-comment {
  color: #408080;
  font-style: italic;
}
.highlight-number {
  color: #080;
}
.highlight-atom {
  color: #88F;
}
.highlight-keyword {
  color: #008000;
  font-weight: bold;
}
.highlight-builtin {
  color: #008000;
}
.highlight-error {
  color: #f00;
}
.highlight-operator {
  color: #AA22FF;
  font-weight: bold;
}
.highlight-meta {
  color: #AA22FF;
}
/* previously not defined, copying from default codemirror */
.highlight-def {
  color: #00f;
}
.highlight-string-2 {
  color: #f50;
}
.highlight-qualifier {
  color: #555;
}
.highlight-bracket {
  color: #997;
}
.highlight-tag {
  color: #170;
}
.highlight-attribute {
  color: #00c;
}
.highlight-header {
  color: blue;
}
.highlight-quote {
  color: #090;
}
.highlight-link {
  color: #00c;
}
/* apply the same style to codemirror */
.cm-s-ipython span.cm-keyword {
  color: #008000;
  font-weight: bold;
}
.cm-s-ipython span.cm-atom {
  color: #88F;
}
.cm-s-ipython span.cm-number {
  color: #080;
}
.cm-s-ipython span.cm-def {
  color: #00f;
}
.cm-s-ipython span.cm-variable {
  color: #000;
}
.cm-s-ipython span.cm-operator {
  color: #AA22FF;
  font-weight: bold;
}
.cm-s-ipython span.cm-variable-2 {
  color: #1a1a1a;
}
.cm-s-ipython span.cm-variable-3 {
  color: #333333;
}
.cm-s-ipython span.cm-comment {
  color: #408080;
  font-style: italic;
}
.cm-s-ipython span.cm-string {
  color: #BA2121;
}
.cm-s-ipython span.cm-string-2 {
  color: #f50;
}
.cm-s-ipython span.cm-meta {
  color: #AA22FF;
}
.cm-s-ipython span.cm-qualifier {
  color: #555;
}
.cm-s-ipython span.cm-builtin {
  color: #008000;
}
.cm-s-ipython span.cm-bracket {
  color: #997;
}
.cm-s-ipython span.cm-tag {
  color: #170;
}
.cm-s-ipython span.cm-attribute {
  color: #00c;
}
.cm-s-ipython span.cm-header {
  color: blue;
}
.cm-s-ipython span.cm-quote {
  color: #090;
}
.cm-s-ipython span.cm-link {
  color: #00c;
}
.cm-s-ipython span.cm-error {
  color: #f00;
}
.cm-s-ipython span.cm-tab {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAAXNSR0IArs4c6QAAAGFJREFUSMft1LsRQFAQheHPowAKoACx3IgEKtaEHujDjORSgWTH/ZOdnZOcM/sgk/kFFWY0qV8foQwS4MKBCS3qR6ixBJvElOobYAtivseIE120FaowJPN75GMu8j/LfMwNjh4HUpwg4LUAAAAASUVORK5CYII=);
  background-position: right;
  background-repeat: no-repeat;
}
div.output_wrapper {
  /* this position must be relative to enable descendents to be absolute within it */
  position: relative;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  z-index: 1;
}
/* class for the output area when it should be height-limited */
div.output_scroll {
  /* ideally, this would be max-height, but FF barfs all over that */
  height: 24em;
  /* FF needs this *and the wrapper* to specify full width, or it will shrinkwrap */
  width: 100%;
  overflow: auto;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  display: block;
}
/* output div while it is collapsed */
div.output_collapsed {
  margin: 0px;
  padding: 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
div.out_prompt_overlay {
  height: 100%;
  padding: 0px 0.4em;
  position: absolute;
  border-radius: 2px;
}
div.out_prompt_overlay:hover {
  /* use inner shadow to get border that is computed the same on WebKit/FF */
  -webkit-box-shadow: inset 0 0 1px #000;
  box-shadow: inset 0 0 1px #000;
  background: rgba(240, 240, 240, 0.5);
}
div.output_prompt {
  color: #D84315;
}
/* This class is the outer container of all output sections. */
div.output_area {
  padding: 0px;
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.output_area .MathJax_Display {
  text-align: left !important;
}
div.output_area .rendered_html table {
  margin-left: 0;
  margin-right: 0;
}
div.output_area .rendered_html img {
  margin-left: 0;
  margin-right: 0;
}
div.output_area img,
div.output_area svg {
  max-width: 100%;
  height: auto;
}
div.output_area img.unconfined,
div.output_area svg.unconfined {
  max-width: none;
}
/* This is needed to protect the pre formating from global settings such
   as that of bootstrap */
.output {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.output_area {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
div.output_area pre {
  margin: 0;
  padding: 0;
  border: 0;
  vertical-align: baseline;
  color: black;
  background-color: transparent;
  border-radius: 0;
}
/* This class is for the output subarea inside the output_area and after
   the prompt div. */
div.output_subarea {
  overflow-x: auto;
  padding: 0.4em;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
  max-width: calc(100% - 14ex);
}
div.output_scroll div.output_subarea {
  overflow-x: visible;
}
/* The rest of the output_* classes are for special styling of the different
   output types */
/* all text output has this class: */
div.output_text {
  text-align: left;
  color: #000;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
}
/* stdout/stderr are 'text' as well as 'stream', but execute_result/error are *not* streams */
div.output_stderr {
  background: #fdd;
  /* very light red background for stderr */
}
div.output_latex {
  text-align: left;
}
/* Empty output_javascript divs should have no height */
div.output_javascript:empty {
  padding: 0;
}
.js-error {
  color: darkred;
}
/* raw_input styles */
div.raw_input_container {
  line-height: 1.21429em;
  padding-top: 5px;
}
pre.raw_input_prompt {
  /* nothing needed here. */
}
input.raw_input {
  font-family: monospace;
  font-size: inherit;
  color: inherit;
  width: auto;
  /* make sure input baseline aligns with prompt */
  vertical-align: baseline;
  /* padding + margin = 0.5em between prompt and cursor */
  padding: 0em 0.25em;
  margin: 0em 0.25em;
}
input.raw_input:focus {
  box-shadow: none;
}
p.p-space {
  margin-bottom: 10px;
}
div.output_unrecognized {
  padding: 5px;
  font-weight: bold;
  color: red;
}
div.output_unrecognized a {
  color: inherit;
  text-decoration: none;
}
div.output_unrecognized a:hover {
  color: inherit;
  text-decoration: none;
}
.rendered_html {
  color: #000;
  /* any extras will just be numbers: */
}
.rendered_html em {
  font-style: italic;
}
.rendered_html strong {
  font-weight: bold;
}
.rendered_html u {
  text-decoration: underline;
}
.rendered_html :link {
  text-decoration: underline;
}
.rendered_html :visited {
  text-decoration: underline;
}
.rendered_html h1 {
  font-size: 185.7%;
  margin: 1.08em 0 0 0;
  font-weight: bold;
  line-height: 1.0;
}
.rendered_html h2 {
  font-size: 157.1%;
  margin: 1.27em 0 0 0;
  font-weight: bold;
  line-height: 1.0;
}
.rendered_html h3 {
  font-size: 128.6%;
  margin: 1.55em 0 0 0;
  font-weight: bold;
  line-height: 1.0;
}
.rendered_html h4 {
  font-size: 100%;
  margin: 2em 0 0 0;
  font-weight: bold;
  line-height: 1.0;
}
.rendered_html h5 {
  font-size: 100%;
  margin: 2em 0 0 0;
  font-weight: bold;
  line-height: 1.0;
  font-style: italic;
}
.rendered_html h6 {
  font-size: 100%;
  margin: 2em 0 0 0;
  font-weight: bold;
  line-height: 1.0;
  font-style: italic;
}
.rendered_html h1:first-child {
  margin-top: 0.538em;
}
.rendered_html h2:first-child {
  margin-top: 0.636em;
}
.rendered_html h3:first-child {
  margin-top: 0.777em;
}
.rendered_html h4:first-child {
  margin-top: 1em;
}
.rendered_html h5:first-child {
  margin-top: 1em;
}
.rendered_html h6:first-child {
  margin-top: 1em;
}
.rendered_html ul {
  list-style: disc;
  margin: 0em 2em;
  padding-left: 0px;
}
.rendered_html ul ul {
  list-style: square;
  margin: 0em 2em;
}
.rendered_html ul ul ul {
  list-style: circle;
  margin: 0em 2em;
}
.rendered_html ol {
  list-style: decimal;
  margin: 0em 2em;
  padding-left: 0px;
}
.rendered_html ol ol {
  list-style: upper-alpha;
  margin: 0em 2em;
}
.rendered_html ol ol ol {
  list-style: lower-alpha;
  margin: 0em 2em;
}
.rendered_html ol ol ol ol {
  list-style: lower-roman;
  margin: 0em 2em;
}
.rendered_html ol ol ol ol ol {
  list-style: decimal;
  margin: 0em 2em;
}
.rendered_html * + ul {
  margin-top: 1em;
}
.rendered_html * + ol {
  margin-top: 1em;
}
.rendered_html hr {
  color: black;
  background-color: black;
}
.rendered_html pre {
  margin: 1em 2em;
}
.rendered_html pre,
.rendered_html code {
  border: 0;
  background-color: #fff;
  color: #000;
  font-size: 100%;
  padding: 0px;
}
.rendered_html blockquote {
  margin: 1em 2em;
}
.rendered_html table {
  margin-left: auto;
  margin-right: auto;
  border: 1px solid black;
  border-collapse: collapse;
}
.rendered_html tr,
.rendered_html th,
.rendered_html td {
  border: 1px solid black;
  border-collapse: collapse;
  margin: 1em 2em;
}
.rendered_html td,
.rendered_html th {
  text-align: left;
  vertical-align: middle;
  padding: 4px;
}
.rendered_html th {
  font-weight: bold;
}
.rendered_html * + table {
  margin-top: 1em;
}
.rendered_html p {
  text-align: left;
}
.rendered_html * + p {
  margin-top: 1em;
}
.rendered_html img {
  display: block;
  margin-left: auto;
  margin-right: auto;
}
.rendered_html * + img {
  margin-top: 1em;
}
.rendered_html img,
.rendered_html svg {
  max-width: 100%;
  height: auto;
}
.rendered_html img.unconfined,
.rendered_html svg.unconfined {
  max-width: none;
}
div.text_cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.text_cell > div.prompt {
    display: none;
  }
}
div.text_cell_render {
  /*font-family: "Helvetica Neue", Arial, Helvetica, Geneva, sans-serif;*/
  outline: none;
  resize: none;
  width: inherit;
  border-style: none;
  padding: 0.5em 0.5em 0.5em 0.4em;
  color: #000;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}
a.anchor-link:link {
  text-decoration: none;
  padding: 0px 20px;
  visibility: hidden;
}
h1:hover .anchor-link,
h2:hover .anchor-link,
h3:hover .anchor-link,
h4:hover .anchor-link,
h5:hover .anchor-link,
h6:hover .anchor-link {
  visibility: visible;
}
.text_cell.rendered .input_area {
  display: none;
}
.text_cell.rendered .rendered_html {
  overflow-x: auto;
  overflow-y: hidden;
}
.text_cell.unrendered .text_cell_render {
  display: none;
}
.cm-header-1,
.cm-header-2,
.cm-header-3,
.cm-header-4,
.cm-header-5,
.cm-header-6 {
  font-weight: bold;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}
.cm-header-1 {
  font-size: 185.7%;
}
.cm-header-2 {
  font-size: 157.1%;
}
.cm-header-3 {
  font-size: 128.6%;
}
.cm-header-4 {
  font-size: 110%;
}
.cm-header-5 {
  font-size: 100%;
  font-style: italic;
}
.cm-header-6 {
  font-size: 100%;
  font-style: italic;
}
/*!
*
* IPython notebook webapp
*
*/
@media (max-width: 767px) {
  .notebook_app {
    padding-left: 0px;
    padding-right: 0px;
  }
}
#ipython-main-app {
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  height: 100%;
}
div#notebook_panel {
  margin: 0px;
  padding: 0px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  height: 100%;
}
div#notebook {
  font-size: 14px;
  line-height: 20px;
  overflow-y: hidden;
  overflow-x: auto;
  width: 100%;
  /* This spaces the page away from the edge of the notebook area */
  padding-top: 20px;
  margin: 0px;
  outline: none;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  min-height: 100%;
}
@media not print {
  #notebook-container {
    padding: 15px;
    background-color: #fff;
    min-height: 0;
    -webkit-box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
    box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
  }
}
@media print {
  #notebook-container {
    width: 100%;
  }
}
div.ui-widget-content {
  border: 1px solid #ababab;
  outline: none;
}
pre.dialog {
  background-color: #f7f7f7;
  border: 1px solid #ddd;
  border-radius: 2px;
  padding: 0.4em;
  padding-left: 2em;
}
p.dialog {
  padding: 0.2em;
}
/* Word-wrap output correctly.  This is the CSS3 spelling, though Firefox seems
   to not honor it correctly.  Webkit browsers (Chrome, rekonq, Safari) do.
 */
pre,
code,
kbd,
samp {
  white-space: pre-wrap;
}
#fonttest {
  font-family: monospace;
}
p {
  margin-bottom: 0;
}
.end_space {
  min-height: 100px;
  transition: height .2s ease;
}
.notebook_app > #header {
  -webkit-box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
  box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
}
@media not print {
  .notebook_app {
    background-color: #EEE;
  }
}
kbd {
  border-style: solid;
  border-width: 1px;
  box-shadow: none;
  margin: 2px;
  padding-left: 2px;
  padding-right: 2px;
  padding-top: 1px;
  padding-bottom: 1px;
}
/* CSS for the cell toolbar */
.celltoolbar {
  border: thin solid #CFCFCF;
  border-bottom: none;
  background: #EEE;
  border-radius: 2px 2px 0px 0px;
  width: 100%;
  height: 29px;
  padding-right: 4px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
  /* Old browsers */
  -webkit-box-pack: end;
  -moz-box-pack: end;
  box-pack: end;
  /* Modern browsers */
  justify-content: flex-end;
  display: -webkit-flex;
}
@media print {
  .celltoolbar {
    display: none;
  }
}
.ctb_hideshow {
  display: none;
  vertical-align: bottom;
}
/* ctb_show is added to the ctb_hideshow div to show the cell toolbar.
   Cell toolbars are only shown when the ctb_global_show class is also set.
*/
.ctb_global_show .ctb_show.ctb_hideshow {
  display: block;
}
.ctb_global_show .ctb_show + .input_area,
.ctb_global_show .ctb_show + div.text_cell_input,
.ctb_global_show .ctb_show ~ div.text_cell_render {
  border-top-right-radius: 0px;
  border-top-left-radius: 0px;
}
.ctb_global_show .ctb_show ~ div.text_cell_render {
  border: 1px solid #cfcfcf;
}
.celltoolbar {
  font-size: 87%;
  padding-top: 3px;
}
.celltoolbar select {
  display: block;
  width: 100%;
  height: 32px;
  padding: 6px 12px;
  font-size: 13px;
  line-height: 1.42857143;
  color: #555555;
  background-color: #fff;
  background-image: none;
  border: 1px solid #ccc;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
  -webkit-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
  -o-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
  transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
  height: 30px;
  padding: 5px 10px;
  font-size: 12px;
  line-height: 1.5;
  border-radius: 1px;
  width: inherit;
  font-size: inherit;
  height: 22px;
  padding: 0px;
  display: inline-block;
}
.celltoolbar select:focus {
  border-color: #66afe9;
  outline: 0;
  -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(102, 175, 233, 0.6);
  box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(102, 175, 233, 0.6);
}
.celltoolbar select::-moz-placeholder {
  color: #999;
  opacity: 1;
}
.celltoolbar select:-ms-input-placeholder {
  color: #999;
}
.celltoolbar select::-webkit-input-placeholder {
  color: #999;
}
.celltoolbar select::-ms-expand {
  border: 0;
  background-color: transparent;
}
.celltoolbar select[disabled],
.celltoolbar select[readonly],
fieldset[disabled] .celltoolbar select {
  background-color: #eeeeee;
  opacity: 1;
}
.celltoolbar select[disabled],
fieldset[disabled] .celltoolbar select {
  cursor: not-allowed;
}
textarea.celltoolbar select {
  height: auto;
}
select.celltoolbar select {
  height: 30px;
  line-height: 30px;
}
textarea.celltoolbar select,
select[multiple].celltoolbar select {
  height: auto;
}
.celltoolbar label {
  margin-left: 5px;
  margin-right: 5px;
}
.completions {
  position: absolute;
  z-index: 110;
  overflow: hidden;
  border: 1px solid #ababab;
  border-radius: 2px;
  -webkit-box-shadow: 0px 6px 10px -1px #adadad;
  box-shadow: 0px 6px 10px -1px #adadad;
  line-height: 1;
}
.completions select {
  background: white;
  outline: none;
  border: none;
  padding: 0px;
  margin: 0px;
  overflow: auto;
  font-family: monospace;
  font-size: 110%;
  color: #000;
  width: auto;
}
.completions select option.context {
  color: #286090;
}
#kernel_logo_widget {
  float: right !important;
  float: right;
}
#kernel_logo_widget .current_kernel_logo {
  display: none;
  margin-top: -1px;
  margin-bottom: -1px;
  width: 32px;
  height: 32px;
}
#menubar {
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  margin-top: 1px;
}
#menubar .navbar {
  border-top: 1px;
  border-radius: 0px 0px 2px 2px;
  margin-bottom: 0px;
}
#menubar .navbar-toggle {
  float: left;
  padding-top: 7px;
  padding-bottom: 7px;
  border: none;
}
#menubar .navbar-collapse {
  clear: left;
}
.nav-wrapper {
  border-bottom: 1px solid #e7e7e7;
}
i.menu-icon {
  padding-top: 4px;
}
ul#help_menu li a {
  overflow: hidden;
  padding-right: 2.2em;
}
ul#help_menu li a i {
  margin-right: -1.2em;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu > .dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
}
.dropdown-submenu:hover > .dropdown-menu {
  display: block;
}
.dropdown-submenu > a:after {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  display: block;
  content: "\f0da";
  float: right;
  color: #333333;
  margin-top: 2px;
  margin-right: -10px;
}
.dropdown-submenu > a:after.pull-left {
  margin-right: .3em;
}
.dropdown-submenu > a:after.pull-right {
  margin-left: .3em;
}
.dropdown-submenu:hover > a:after {
  color: #262626;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left > .dropdown-menu {
  left: -100%;
  margin-left: 10px;
}
#notification_area {
  float: right !important;
  float: right;
  z-index: 10;
}
.indicator_area {
  float: right !important;
  float: right;
  color: #777;
  margin-left: 5px;
  margin-right: 5px;
  width: 11px;
  z-index: 10;
  text-align: center;
  width: auto;
}
#kernel_indicator {
  float: right !important;
  float: right;
  color: #777;
  margin-left: 5px;
  margin-right: 5px;
  width: 11px;
  z-index: 10;
  text-align: center;
  width: auto;
  border-left: 1px solid;
}
#kernel_indicator .kernel_indicator_name {
  padding-left: 5px;
  padding-right: 5px;
}
#modal_indicator {
  float: right !important;
  float: right;
  color: #777;
  margin-left: 5px;
  margin-right: 5px;
  width: 11px;
  z-index: 10;
  text-align: center;
  width: auto;
}
#readonly-indicator {
  float: right !important;
  float: right;
  color: #777;
  margin-left: 5px;
  margin-right: 5px;
  width: 11px;
  z-index: 10;
  text-align: center;
  width: auto;
  margin-top: 2px;
  margin-bottom: 0px;
  margin-left: 0px;
  margin-right: 0px;
  display: none;
}
.modal_indicator:before {
  width: 1.28571429em;
  text-align: center;
}
.edit_mode .modal_indicator:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f040";
}
.edit_mode .modal_indicator:before.pull-left {
  margin-right: .3em;
}
.edit_mode .modal_indicator:before.pull-right {
  margin-left: .3em;
}
.command_mode .modal_indicator:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: ' ';
}
.command_mode .modal_indicator:before.pull-left {
  margin-right: .3em;
}
.command_mode .modal_indicator:before.pull-right {
  margin-left: .3em;
}
.kernel_idle_icon:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f10c";
}
.kernel_idle_icon:before.pull-left {
  margin-right: .3em;
}
.kernel_idle_icon:before.pull-right {
  margin-left: .3em;
}
.kernel_busy_icon:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f111";
}
.kernel_busy_icon:before.pull-left {
  margin-right: .3em;
}
.kernel_busy_icon:before.pull-right {
  margin-left: .3em;
}
.kernel_dead_icon:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f1e2";
}
.kernel_dead_icon:before.pull-left {
  margin-right: .3em;
}
.kernel_dead_icon:before.pull-right {
  margin-left: .3em;
}
.kernel_disconnected_icon:before {
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  content: "\f127";
}
.kernel_disconnected_icon:before.pull-left {
  margin-right: .3em;
}
.kernel_disconnected_icon:before.pull-right {
  margin-left: .3em;
}
.notification_widget {
  color: #777;
  z-index: 10;
  background: rgba(240, 240, 240, 0.5);
  margin-right: 4px;
  color: #333;
  background-color: #fff;
  border-color: #ccc;
}
.notification_widget:focus,
.notification_widget.focus {
  color: #333;
  background-color: #e6e6e6;
  border-color: #8c8c8c;
}
.notification_widget:hover {
  color: #333;
  background-color: #e6e6e6;
  border-color: #adadad;
}
.notification_widget:active,
.notification_widget.active,
.open > .dropdown-toggle.notification_widget {
  color: #333;
  background-color: #e6e6e6;
  border-color: #adadad;
}
.notification_widget:active:hover,
.notification_widget.active:hover,
.open > .dropdown-toggle.notification_widget:hover,
.notification_widget:active:focus,
.notification_widget.active:focus,
.open > .dropdown-toggle.notification_widget:focus,
.notification_widget:active.focus,
.notification_widget.active.focus,
.open > .dropdown-toggle.notification_widget.focus {
  color: #333;
  background-color: #d4d4d4;
  border-color: #8c8c8c;
}
.notification_widget:active,
.notification_widget.active,
.open > .dropdown-toggle.notification_widget {
  background-image: none;
}
.notification_widget.disabled:hover,
.notification_widget[disabled]:hover,
fieldset[disabled] .notification_widget:hover,
.notification_widget.disabled:focus,
.notification_widget[disabled]:focus,
fieldset[disabled] .notification_widget:focus,
.notification_widget.disabled.focus,
.notification_widget[disabled].focus,
fieldset[disabled] .notification_widget.focus {
  background-color: #fff;
  border-color: #ccc;
}
.notification_widget .badge {
  color: #fff;
  background-color: #333;
}
.notification_widget.warning {
  color: #fff;
  background-color: #f0ad4e;
  border-color: #eea236;
}
.notification_widget.warning:focus,
.notification_widget.warning.focus {
  color: #fff;
  background-color: #ec971f;
  border-color: #985f0d;
}
.notification_widget.warning:hover {
  color: #fff;
  background-color: #ec971f;
  border-color: #d58512;
}
.notification_widget.warning:active,
.notification_widget.warning.active,
.open > .dropdown-toggle.notification_widget.warning {
  color: #fff;
  background-color: #ec971f;
  border-color: #d58512;
}
.notification_widget.warning:active:hover,
.notification_widget.warning.active:hover,
.open > .dropdown-toggle.notification_widget.warning:hover,
.notification_widget.warning:active:focus,
.notification_widget.warning.active:focus,
.open > .dropdown-toggle.notification_widget.warning:focus,
.notification_widget.warning:active.focus,
.notification_widget.warning.active.focus,
.open > .dropdown-toggle.notification_widget.warning.focus {
  color: #fff;
  background-color: #d58512;
  border-color: #985f0d;
}
.notification_widget.warning:active,
.notification_widget.warning.active,
.open > .dropdown-toggle.notification_widget.warning {
  background-image: none;
}
.notification_widget.warning.disabled:hover,
.notification_widget.warning[disabled]:hover,
fieldset[disabled] .notification_widget.warning:hover,
.notification_widget.warning.disabled:focus,
.notification_widget.warning[disabled]:focus,
fieldset[disabled] .notification_widget.warning:focus,
.notification_widget.warning.disabled.focus,
.notification_widget.warning[disabled].focus,
fieldset[disabled] .notification_widget.warning.focus {
  background-color: #f0ad4e;
  border-color: #eea236;
}
.notification_widget.warning .badge {
  color: #f0ad4e;
  background-color: #fff;
}
.notification_widget.success {
  color: #fff;
  background-color: #5cb85c;
  border-color: #4cae4c;
}
.notification_widget.success:focus,
.notification_widget.success.focus {
  color: #fff;
  background-color: #449d44;
  border-color: #255625;
}
.notification_widget.success:hover {
  color: #fff;
  background-color: #449d44;
  border-color: #398439;
}
.notification_widget.success:active,
.notification_widget.success.active,
.open > .dropdown-toggle.notification_widget.success {
  color: #fff;
  background-color: #449d44;
  border-color: #398439;
}
.notification_widget.success:active:hover,
.notification_widget.success.active:hover,
.open > .dropdown-toggle.notification_widget.success:hover,
.notification_widget.success:active:focus,
.notification_widget.success.active:focus,
.open > .dropdown-toggle.notification_widget.success:focus,
.notification_widget.success:active.focus,
.notification_widget.success.active.focus,
.open > .dropdown-toggle.notification_widget.success.focus {
  color: #fff;
  background-color: #398439;
  border-color: #255625;
}
.notification_widget.success:active,
.notification_widget.success.active,
.open > .dropdown-toggle.notification_widget.success {
  background-image: none;
}
.notification_widget.success.disabled:hover,
.notification_widget.success[disabled]:hover,
fieldset[disabled] .notification_widget.success:hover,
.notification_widget.success.disabled:focus,
.notification_widget.success[disabled]:focus,
fieldset[disabled] .notification_widget.success:focus,
.notification_widget.success.disabled.focus,
.notification_widget.success[disabled].focus,
fieldset[disabled] .notification_widget.success.focus {
  background-color: #5cb85c;
  border-color: #4cae4c;
}
.notification_widget.success .badge {
  color: #5cb85c;
  background-color: #fff;
}
.notification_widget.info {
  color: #fff;
  background-color: #5bc0de;
  border-color: #46b8da;
}
.notification_widget.info:focus,
.notification_widget.info.focus {
  color: #fff;
  background-color: #31b0d5;
  border-color: #1b6d85;
}
.notification_widget.info:hover {
  color: #fff;
  background-color: #31b0d5;
  border-color: #269abc;
}
.notification_widget.info:active,
.notification_widget.info.active,
.open > .dropdown-toggle.notification_widget.info {
  color: #fff;
  background-color: #31b0d5;
  border-color: #269abc;
}
.notification_widget.info:active:hover,
.notification_widget.info.active:hover,
.open > .dropdown-toggle.notification_widget.info:hover,
.notification_widget.info:active:focus,
.notification_widget.info.active:focus,
.open > .dropdown-toggle.notification_widget.info:focus,
.notification_widget.info:active.focus,
.notification_widget.info.active.focus,
.open > .dropdown-toggle.notification_widget.info.focus {
  color: #fff;
  background-color: #269abc;
  border-color: #1b6d85;
}
.notification_widget.info:active,
.notification_widget.info.active,
.open > .dropdown-toggle.notification_widget.info {
  background-image: none;
}
.notification_widget.info.disabled:hover,
.notification_widget.info[disabled]:hover,
fieldset[disabled] .notification_widget.info:hover,
.notification_widget.info.disabled:focus,
.notification_widget.info[disabled]:focus,
fieldset[disabled] .notification_widget.info:focus,
.notification_widget.info.disabled.focus,
.notification_widget.info[disabled].focus,
fieldset[disabled] .notification_widget.info.focus {
  background-color: #5bc0de;
  border-color: #46b8da;
}
.notification_widget.info .badge {
  color: #5bc0de;
  background-color: #fff;
}
.notification_widget.danger {
  color: #fff;
  background-color: #d9534f;
  border-color: #d43f3a;
}
.notification_widget.danger:focus,
.notification_widget.danger.focus {
  color: #fff;
  background-color: #c9302c;
  border-color: #761c19;
}
.notification_widget.danger:hover {
  color: #fff;
  background-color: #c9302c;
  border-color: #ac2925;
}
.notification_widget.danger:active,
.notification_widget.danger.active,
.open > .dropdown-toggle.notification_widget.danger {
  color: #fff;
  background-color: #c9302c;
  border-color: #ac2925;
}
.notification_widget.danger:active:hover,
.notification_widget.danger.active:hover,
.open > .dropdown-toggle.notification_widget.danger:hover,
.notification_widget.danger:active:focus,
.notification_widget.danger.active:focus,
.open > .dropdown-toggle.notification_widget.danger:focus,
.notification_widget.danger:active.focus,
.notification_widget.danger.active.focus,
.open > .dropdown-toggle.notification_widget.danger.focus {
  color: #fff;
  background-color: #ac2925;
  border-color: #761c19;
}
.notification_widget.danger:active,
.notification_widget.danger.active,
.open > .dropdown-toggle.notification_widget.danger {
  background-image: none;
}
.notification_widget.danger.disabled:hover,
.notification_widget.danger[disabled]:hover,
fieldset[disabled] .notification_widget.danger:hover,
.notification_widget.danger.disabled:focus,
.notification_widget.danger[disabled]:focus,
fieldset[disabled] .notification_widget.danger:focus,
.notification_widget.danger.disabled.focus,
.notification_widget.danger[disabled].focus,
fieldset[disabled] .notification_widget.danger.focus {
  background-color: #d9534f;
  border-color: #d43f3a;
}
.notification_widget.danger .badge {
  color: #d9534f;
  background-color: #fff;
}
div#pager {
  background-color: #fff;
  font-size: 14px;
  line-height: 20px;
  overflow: hidden;
  display: none;
  position: fixed;
  bottom: 0px;
  width: 100%;
  max-height: 50%;
  padding-top: 8px;
  -webkit-box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
  box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
  /* Display over codemirror */
  z-index: 100;
  /* Hack which prevents jquery ui resizable from changing top. */
  top: auto !important;
}
div#pager pre {
  line-height: 1.21429em;
  color: #000;
  background-color: #f7f7f7;
  padding: 0.4em;
}
div#pager #pager-button-area {
  position: absolute;
  top: 8px;
  right: 20px;
}
div#pager #pager-contents {
  position: relative;
  overflow: auto;
  width: 100%;
  height: 100%;
}
div#pager #pager-contents #pager-container {
  position: relative;
  padding: 15px 0px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}
div#pager .ui-resizable-handle {
  top: 0px;
  height: 8px;
  background: #f7f7f7;
  border-top: 1px solid #cfcfcf;
  border-bottom: 1px solid #cfcfcf;
  /* This injects handle bars (a short, wide = symbol) for 
        the resize handle. */
}
div#pager .ui-resizable-handle::after {
  content: '';
  top: 2px;
  left: 50%;
  height: 3px;
  width: 30px;
  margin-left: -15px;
  position: absolute;
  border-top: 1px solid #cfcfcf;
}
.quickhelp {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
  line-height: 1.8em;
}
.shortcut_key {
  display: inline-block;
  width: 21ex;
  text-align: right;
  font-family: monospace;
}
.shortcut_descr {
  display: inline-block;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
}
span.save_widget {
  margin-top: 6px;
}
span.save_widget span.filename {
  height: 1em;
  line-height: 1em;
  padding: 3px;
  margin-left: 16px;
  border: none;
  font-size: 146.5%;
  border-radius: 2px;
}
span.save_widget span.filename:hover {
  background-color: #e6e6e6;
}
span.checkpoint_status,
span.autosave_status {
  font-size: small;
}
@media (max-width: 767px) {
  span.save_widget {
    font-size: small;
  }
  span.checkpoint_status,
  span.autosave_status {
    display: none;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  span.checkpoint_status {
    display: none;
  }
  span.autosave_status {
    font-size: x-small;
  }
}
.toolbar {
  padding: 0px;
  margin-left: -5px;
  margin-top: 2px;
  margin-bottom: 5px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}
.toolbar select,
.toolbar label {
  width: auto;
  vertical-align: middle;
  margin-right: 2px;
  margin-bottom: 0px;
  display: inline;
  font-size: 92%;
  margin-left: 0.3em;
  margin-right: 0.3em;
  padding: 0px;
  padding-top: 3px;
}
.toolbar .btn {
  padding: 2px 8px;
}
.toolbar .btn-group {
  margin-top: 0px;
  margin-left: 5px;
}
#maintoolbar {
  margin-bottom: -3px;
  margin-top: -8px;
  border: 0px;
  min-height: 27px;
  margin-left: 0px;
  padding-top: 11px;
  padding-bottom: 3px;
}
#maintoolbar .navbar-text {
  float: none;
  vertical-align: middle;
  text-align: right;
  margin-left: 5px;
  margin-right: 0px;
  margin-top: 0px;
}
.select-xs {
  height: 24px;
}
.pulse,
.dropdown-menu > li > a.pulse,
li.pulse > a.dropdown-toggle,
li.pulse.open > a.dropdown-toggle {
  background-color: #F37626;
  color: white;
}
/**
 * Primary styles
 *
 * Author: Jupyter Development Team
 */
/** WARNING IF YOU ARE EDITTING THIS FILE, if this is a .css file, It has a lot
 * of chance of beeing generated from the ../less/[samename].less file, you can
 * try to get back the less file by reverting somme commit in history
 **/
/*
 * We'll try to get something pretty, so we
 * have some strange css to have the scroll bar on
 * the left with fix button on the top right of the tooltip
 */
@-moz-keyframes fadeOut {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}
@-webkit-keyframes fadeOut {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}
@-moz-keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
@-webkit-keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
/*properties of tooltip after "expand"*/
.bigtooltip {
  overflow: auto;
  height: 200px;
  -webkit-transition-property: height;
  -webkit-transition-duration: 500ms;
  -moz-transition-property: height;
  -moz-transition-duration: 500ms;
  transition-property: height;
  transition-duration: 500ms;
}
/*properties of tooltip before "expand"*/
.smalltooltip {
  -webkit-transition-property: height;
  -webkit-transition-duration: 500ms;
  -moz-transition-property: height;
  -moz-transition-duration: 500ms;
  transition-property: height;
  transition-duration: 500ms;
  text-overflow: ellipsis;
  overflow: hidden;
  height: 80px;
}
.tooltipbuttons {
  position: absolute;
  padding-right: 15px;
  top: 0px;
  right: 0px;
}
.tooltiptext {
  /*avoid the button to overlap on some docstring*/
  padding-right: 30px;
}
.ipython_tooltip {
  max-width: 700px;
  /*fade-in animation when inserted*/
  -webkit-animation: fadeOut 400ms;
  -moz-animation: fadeOut 400ms;
  animation: fadeOut 400ms;
  -webkit-animation: fadeIn 400ms;
  -moz-animation: fadeIn 400ms;
  animation: fadeIn 400ms;
  vertical-align: middle;
  background-color: #f7f7f7;
  overflow: visible;
  border: #ababab 1px solid;
  outline: none;
  padding: 3px;
  margin: 0px;
  padding-left: 7px;
  font-family: monospace;
  min-height: 50px;
  -moz-box-shadow: 0px 6px 10px -1px #adadad;
  -webkit-box-shadow: 0px 6px 10px -1px #adadad;
  box-shadow: 0px 6px 10px -1px #adadad;
  border-radius: 2px;
  position: absolute;
  z-index: 1000;
}
.ipython_tooltip a {
  float: right;
}
.ipython_tooltip .tooltiptext pre {
  border: 0;
  border-radius: 0;
  font-size: 100%;
  background-color: #f7f7f7;
}
.pretooltiparrow {
  left: 0px;
  margin: 0px;
  top: -16px;
  width: 40px;
  height: 16px;
  overflow: hidden;
  position: absolute;
}
.pretooltiparrow:before {
  background-color: #f7f7f7;
  border: 1px #ababab solid;
  z-index: 11;
  content: "";
  position: absolute;
  left: 15px;
  top: 10px;
  width: 25px;
  height: 25px;
  -webkit-transform: rotate(45deg);
  -moz-transform: rotate(45deg);
  -ms-transform: rotate(45deg);
  -o-transform: rotate(45deg);
}
ul.typeahead-list i {
  margin-left: -10px;
  width: 18px;
}
ul.typeahead-list {
  max-height: 80vh;
  overflow: auto;
}
ul.typeahead-list > li > a {
  /** Firefox bug **/
  /* see https://github.com/jupyter/notebook/issues/559 */
  white-space: normal;
}
.cmd-palette .modal-body {
  padding: 7px;
}
.cmd-palette form {
  background: white;
}
.cmd-palette input {
  outline: none;
}
.no-shortcut {
  display: none;
}
.command-shortcut:before {
  content: "(command)";
  padding-right: 3px;
  color: #777777;
}
.edit-shortcut:before {
  content: "(edit)";
  padding-right: 3px;
  color: #777777;
}
#find-and-replace #replace-preview .match,
#find-and-replace #replace-preview .insert {
  background-color: #BBDEFB;
  border-color: #90CAF9;
  border-style: solid;
  border-width: 1px;
  border-radius: 0px;
}
#find-and-replace #replace-preview .replace .match {
  background-color: #FFCDD2;
  border-color: #EF9A9A;
  border-radius: 0px;
}
#find-and-replace #replace-preview .replace .insert {
  background-color: #C8E6C9;
  border-color: #A5D6A7;
  border-radius: 0px;
}
#find-and-replace #replace-preview {
  max-height: 60vh;
  overflow: auto;
}
#find-and-replace #replace-preview pre {
  padding: 5px 10px;
}
.terminal-app {
  background: #EEE;
}
.terminal-app #header {
  background: #fff;
  -webkit-box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
  box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.2);
}
.terminal-app .terminal {
  width: 100%;
  float: left;
  font-family: monospace;
  color: white;
  background: black;
  padding: 0.4em;
  border-radius: 2px;
  -webkit-box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.4);
  box-shadow: 0px 0px 12px 1px rgba(87, 87, 87, 0.4);
}
.terminal-app .terminal,
.terminal-app .terminal dummy-screen {
  line-height: 1em;
  font-size: 14px;
}
.terminal-app .terminal .xterm-rows {
  padding: 10px;
}
.terminal-app .terminal-cursor {
  color: black;
  background: white;
}
.terminal-app #terminado-container {
  margin-top: 20px;
}
/*# sourceMappingURL=style.min.css.map */
    </style>
<style type="text/css">
    .highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sa { color: #BA2121 } /* Literal.String.Affix */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0000FF } /* Name.Function.Magic */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .vm { color: #19177C } /* Name.Variable.Magic */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
<style type="text/css">

/* Temporary definitions which will become obsolete with Notebook release 5.0 */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }

    </style>

<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
body {
  overflow: visible;
  padding: 8px;
}

div#notebook {
  overflow: visible;
  border-top: none;
}@media print {
  div.cell {
    display: block;
    page-break-inside: avoid;
  }
  div.output_wrapper {
    display: block;
    page-break-inside: avoid;
  }
  div.output {
    display: block;
    page-break-inside: avoid;
  }
}
</style>

<!-- Custom stylesheet, it must be in the same directory as the html file -->
<link rel="stylesheet" href="custom.css">

<!-- Load mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"></script>
<!-- MathJax configuration -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,
        processEnvironments: true
    },
    // Center justify equations in code and markdown cells. Elsewhere
    // we use CSS to left justify single line equations in code cells.
    displayAlign: 'center',
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}},
        linebreaks: { automatic: true }
    }
});
</script>
<!-- End of mathjax configuration --><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<!--[if IE lte 8]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

<style type="text/css">
.ipyfigure { display: -ms-flex; display: -webkit-flex; display: flex;}
.ipyfigure>div { flex:1; }
.ipytable { display: -ms-flex; display: -webkit-flex; display: flex;}
.ipytable>div { flex:1; }

</style>

<link href='https://fonts.googleapis.com/css?family=Patua+One|Source+Code+Pro|Open+Sans' rel='stylesheet' type='text/css'>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

<meta property="og:url" content="https://www.fuzzingbook.org/html/book.html" />
<meta property="og:type" content="article" />
<meta property="og:title" content="About this Book - Generating Software Tests" />
<meta property="og:description" content="Welcome to &quot;Generating Software Tests&quot;! Software has bugs, and catching bugs can involve lots of effort.  This book addresses this problem by automating software testing, specifically by generating tests automatically.  Recent years have seen the development of novel techniques that lead to dramatic improvements in test generation and software testing.  They now are mature enough to be assembled in a book – even with executable code. " />
<meta property="og:image" content="https://www.fuzzingbook.org/html/PICS/wordcloud.png" />

<link rel="shortcut icon" href="favicon/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" sizes="152x152" href="favicon/apple-touch-icon.png">

<meta name="msapplication-TileColor" content="#B03A2E">
<meta name="msapplication-config" content="favicon/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
<link rel="manifest" href="favicon/site.webmanifest">

<meta name="viewport" content="width=device-width, initial-scale=1"></head>
 <body>

    <script>
    var close_menus = function() {
        /* doesn't work yet - AZ
        console.log("Closing menus")
        var cssmenu = document.getElementById("cssmenu")
        var all_items = cssmenu.getElementsByTagName("li");
        var i;
        for (i = 0; i < all_items.length; i++) {
            item = all_items[i];
            // console.log("<li>: ")
            // console.log(item.innerHTML);
            var j;
            var all_ul = item.getElementsByTagName("ul");
            for (j = 0; j < all_ul.length; j++) {
                console.log("<ul>: ")
                console.log(all_ul[j].innerHTML);
                all_ul[j].style.display = "none";
            }
            var all_ol = item.getElementsByTagName("ol");
            for (j = 0; j < all_ol.length; j++) {
                console.log("<ol>: ")
                console.log(all_ol[j].innerHTML);
                all_ol[j].style.display = "none";
            }
        }
        */
    };

    $( document ).ready( close_menus );

    // Let navbar fade away when scrolling down
    var prevScrollpos = window.pageYOffset;
    window.onscroll = function() {
        var currentScrollPos = window.pageYOffset;
        if (currentScrollPos > 10 && currentScrollPos > prevScrollpos) {
            // Hide navbar
            var cssmenu = document.getElementById("cssmenu")
            cssmenu.style.opacity = 0;

            // When scrolling, also close all sub-menus
            close_menus();
        }
        else {
            // Make navbar visible
            document.getElementById("cssmenu").style.opacity = 1;
        }
        prevScrollpos = currentScrollPos;
    };
    </script>
    
<nav>
<div id="cssmenu">
  <ul>
     <li class="has-sub"><a href="#"><span title="Generating Software Tests"><i class="fa fa-fw fa-bars"></i> </span><span class="menu_1">Generating Software Tests</span></a>
        <ol>
           <li><a href="https://www.fuzzingbook.org/"><i class="fa fa-fw fa-home"></i> About this book</a></li>
<li><a href="Intro_Testing.html">Introduction to Software Testing</a></li>
<li><a href="Fuzzer.html">Fuzzing: Breaking Things with Random Inputs</a></li>

           <li><a href="https://www.fuzzingbook.org/#News" class="more_coming">More Chapters Coming!</a></li>
        </ol>
     </li>
     <li class="has-sub"><a href="#"><span title="About this Book"><i class="fa fa-fw fa-list-ul"></i></span> <span class="menu_2">About this Book</span></a>
        <ul>
           <li><a href="#About-this-Book">About this Book</a></li>
<li><a href="#Introduction-to-Software-Testing">Introduction to Software Testing</a></li>
<li><a href="#Fuzzing:-Breaking-Things-with Random Inputs">Fuzzing: Breaking Things with Random Inputs</a></li>
<li><a href="#Getting-Coverage">Getting Coverage</a></li>
<li><a href="#more_pairs">more_pairs</a></li>
<li><a href="#Mutation-Based-Fuzzing">Mutation-Based Fuzzing</a></li>
<li><a href="#Fuzzing-with-Grammars">Fuzzing with Grammars</a></li>
<li><a href="#Efficient-Grammar-Fuzzing">Efficient Grammar Fuzzing</a></li>
<li><a href="#Grammar-Coverage">Grammar Coverage</a></li>
<li><a href="#Testing-Configurations">Testing Configurations</a></li>
<li><a href="#Parsing-and-Recombining-Inputs">Parsing and Recombining Inputs</a></li>
<li><a href="#Probabilistic-Grammar-Fuzzing">Probabilistic Grammar Fuzzing</a></li>
<li><a href="#Reducing-Failure-Inducing-Inputs">Reducing Failure-Inducing Inputs</a></li>
<li><a href="#Carving-Unit-Tests">Carving Unit Tests</a></li>
<li><a href="#Fuzzing-APIs">Fuzzing APIs</a></li>
<li><a href="#Error-Handling">Error Handling</a></li>
<li><a href="#Timer">Timer</a></li>
<li><a href="#Guide-for-Authors">Guide for Authors</a></li>
<li><a href="#Title">Title</a></li>
<li><a href="#Oh-no!--We-are-not-ready-yet!">Oh no!  We are not ready yet!</a></li>

        </ul>
     </li>
     
     <li class="has-sub"><a href="#"><span title="Resources"><i class="fa fa-fw fa-cube"></i> </span><span class="menu_3">Resources</span></a>
     <ul>
     <li><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb" target="_blank" class="edit_as_notebook"><i class="fa fa-fw fa-edit"></i> Edit as Notebook (beta)</a></li>
     <li><a href="https://www.fuzzingbook.org/slides/book.slides.html" target="_blank"><i class="fa fa-fw fa-video-camera"></i> View Slides</a></li>
     <li><a href="https://www.fuzzingbook.org/code/book.py"><i class="fa fa-fw fa-download"></i> Download Code (.py)</a></li>
     <li><a href="https://www.fuzzingbook.org/notebooks/book.ipynb"><i class="fa fa-fw fa-download"></i> Download Notebook (.ipynb)</a></li>
     <li><a href="https://www.fuzzingbook.org/dist/fuzzingbook-code.zip"><i class="fa fa-fw fa-cube"></i> All Code (.zip)</a></li>
     <li><a href="https://www.fuzzingbook.org/dist/fuzzingbook-notebooks.zip"><i class="fa fa-fw fa-cube"></i> All Notebooks (.zip)</a></li>
     <li><a href="https://github.com/uds-se/fuzzingbook/" target="_blank"><i class="fa fa-fw fa-github"></i> Project Page</a></li>
     </ul>
     </li>
     
     <li class="has-sub"><a href="#"><span title="Share"><i class="fa fa-fw fa-comments"></i> </span> <span class="menu_4">Share</span></a>
        <ul>
            <li><a href="https://twitter.com/intent/tweet?text=I%20just%20read%20%22About%20this%20Book%22%20(part%20of%20@FuzzingBook)%20at%20https%3a%2f%2fwww.fuzzingbook.org%2fhtml%2fbook.html" target="popup" 
onclick="window.open('https://twitter.com/intent/tweet?text=I%20just%20read%20%22About%20this%20Book%22%20(part%20of%20@FuzzingBook)%20at%20https%3a%2f%2fwww.fuzzingbook.org%2fhtml%2fbook.html','popup','width=600,height=600'); return false;"
><i class="fa fa-fw fa-twitter"></i> Share on Twitter</a>
            <li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.fuzzingbook.org%2fhtml%2fbook.html" target="popup" 
onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.fuzzingbook.org%2fhtml%2fbook.html','popup','width=600,height=600'); return false;"
><i class="fa fa-fw fa-facebook"></i> Share on Facebook</a>
            <li><a href="mailto:?subject=About%20this%20Book&body=I%20just%20read%20%22About%20this%20Book%22%20(part%20of%20@FuzzingBook)%20at%20https%3a%2f%2fwww.fuzzingbook.org%2fhtml%2fbook.html"><i class="fa fa-fw fa-envelope"></i> Share by Email</a>
            <li><a href="#citation" id="cite" onclick="revealCitation()"><i class="fa fa-fw fa-mortar-board"></i> Cite</a>
        </ul>
     </li>
     <li class="has-sub"><a href="#"><span title="Help"><i class="fa fa-fw fa-question-circle"></i></span> <span class="menu_5">Help</span></a>
        <ul>
          <li><a href="https://www.fuzzingbook.org/#Troubleshooting"><i class="fa fa-fw fa-wrench"></i> Troubleshooting</a></li>
          <li><a href="https://docs.python.org/3/tutorial/" target=_blank><i class="fa fa-fw fa-question-circle"></i> Python Tutorial</a>
          <li><a href="https://www.dataquest.io/blog/jupyter-notebook-tutorial/" target=_blank><i class="fa fa-fw fa-question-circle"></i> Jupyter Notebook Tutorial</a>
          <li><a href="https://github.com/uds-se/fuzzingbook/issues/" target="_blank"><i class="fa fa-fw fa-commenting"></i> Report an Issue</a></li>
        </ul>
     </li>
  </ul>
</div>
</nav>

    <article>
   <div tabindex="-1" id="notebook" class="border-box-sizing">
     <div class="container" id="notebook-container"><section><h1>Generating Software Tests</h1><h3>Breaking Software for Fun and Profit</h3><b>by Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler</b></section>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="About-this-Book">About this Book<a class="anchor-link" href="#About-this-Book">&#182;</a></h1><p><strong>Welcome to "Generating Software Tests"!</strong> 
Software has bugs, and catching bugs can involve lots of effort.  This book addresses this problem by <em>automating</em> software testing, specifically by <em>generating tests automatically</em>.  Recent years have seen the development of novel techniques that lead to dramatic improvements in test generation and software testing.  They now are mature enough to be assembled in a book – even with executable code.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fuzzingbook_utils</span> <span class="k">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s2">&quot;w4u5gCgPlmg&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="640"
            height="360"
            src="https://www.youtube.com/embed/w4u5gCgPlmg"
            frameborder="0"
            allowfullscreen
        ></iframe>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="A-Textbook-for-Paper,-Screen,-and-Keyboard">A Textbook for Paper, Screen, and Keyboard<a class="anchor-link" href="#A-Textbook-for-Paper,-Screen,-and-Keyboard">&#182;</a></h2><p>You can use this book in three ways:</p>
<ul>
<li><p>You can <strong>read chapters in your browser</strong>.  Check out the list of chapters in the menu above, or start right away with the <a href="Intro_Testing.html">introduction to testing</a> or the <a href="Fuzzer.html">introduction to fuzzing</a>.  All code is available for download.</p>
</li>
<li><p>You can <strong>interact with chapters as Jupyter Notebooks</strong> (beta).  This allows you to edit and extend the code, experimenting <em>live in your browser.</em>  Simply select "Resources $\rightarrow$ Edit as Notebook" at the top of each chapter. <a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/Fuzzer.ipynb" target=_blank>Try interacting with the introduction to fuzzing.</a></p>
</li>
<li><p>You can <strong>present chapters as slides</strong>.  This allows for presenting the material in lectures.  Just select "Resources $\rightarrow$ View slides" at the top of each chapter. <a href="https://www.fuzzingbook.org/slides/Fuzzer.slides.html" target=_blank>Try viewing the slides for the introduction to fuzzing.</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Who-this-Book-is-for">Who this Book is for<a class="anchor-link" href="#Who-this-Book-is-for">&#182;</a></h2><p>This work is designed as a <em>textbook</em> for a course in software testing; as <em>supplementary material</em> in a software testing or software engineering course; and as a <em>resource for software developers</em>. We cover random fuzzing, mutation-based fuzzing, grammar-based test generation, symbolic testing, and much more, illustrating all techniques with code examples that you can try out yourself.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="News">News<a class="anchor-link" href="#News">&#182;</a></h2><p>This book is <em>work in progress,</em> with new chapters coming out every week.  To get notified when a new chapter comes out, <a href="https://twitter.com/FuzzingBook?ref_src=twsrc%5Etfw" data-show-count="false">follow us on Twitter</a>.</p>
<p><a class="twitter-timeline" data-width="500" data-chrome="noheader nofooter noborders transparent" data-link-color="#A93226" data-align="center" href="https://twitter.com/FuzzingBook?ref_src=twsrc%5Etfw">News from @FuzzingBook</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="About-the-Authors">About the Authors<a class="anchor-link" href="#About-the-Authors">&#182;</a></h2><p>This book is written by <em>Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler</em>.  All of us are long-standing experts in software testing and test generation; and we have written or contributed to some of the most important test generators and fuzzers on the planet.  As an example, if you are reading this in a Firefox, Chrome, or Edge Web browser, you can do so safely partly because of us, as <em>the very techniques listed in this book have found more than 2,600 bugs in their JavaScript interpreters so far.</em>  We are happy to share our expertise and making it accessible to the public.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Frequently-Asked-Questions">Frequently Asked Questions<a class="anchor-link" href="#Frequently-Asked-Questions">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Troubleshooting">Troubleshooting<a class="anchor-link" href="#Troubleshooting">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Why-does-it-take-so-long-to-start-an-interactive-notebook?">Why does it take so long to start an interactive notebook?<a class="anchor-link" href="#Why-does-it-take-so-long-to-start-an-interactive-notebook?">&#182;</a></h4><p>The interactive notebook uses the <a href="https://mybinder.org">mybinder.org</a> service, which runs notebooks on their own servers.  Starting Jupyter through mybinder.org normally takes about 30 seconds, depending on your Internet connection. If, however, you are the first to invoke binder after a book update, binder recreates its environment, which will take a few minutes.  Reload the page occasionally.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="The-interactive-notebook-does-not-work!">The interactive notebook does not work!<a class="anchor-link" href="#The-interactive-notebook-does-not-work!">&#182;</a></h4><p>mybinder.org imposes a <a href="https://mybinder.readthedocs.io/en/latest/user-guidelines.html">limit of 100 concurrent users for a repository</a>.  Also, as listed on the <a href="https://mybinder.readthedocs.io/en/latest/reliability.html">mybinder.org status and reliability page</a>,</p>
<blockquote><p>As mybinder.org is a research pilot project, the main goal for the project is to understand usage patterns and workloads for future project evolution. While we strive for site reliability and availability, we want our users to understand the intent of this service is research and we offer no guarantees of its performance in mission critical uses.</p>
</blockquote>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>There are alternatives to mybinder.org; see below.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Do-I-have-alternatives-to-the-interactive-notebook?">Do I have alternatives to the interactive notebook?<a class="anchor-link" href="#Do-I-have-alternatives-to-the-interactive-notebook?">&#182;</a></h4><p>If mybinder.org does not work or match your needs, you have a number of alternatives:</p>
<ol>
<li><p><strong>Download the Python code</strong> (using the menu at the top) and edit and run it in your favorite environment.  This is easy to do and does not require lots of resources.</p>
</li>
<li><p><strong>Download the Jupyter Notebooks</strong> (using the menu at the top) and open them in Jupyter.  Here's <a href="https://www.dataquest.io/blog/jupyter-notebook-tutorial/">how to install jupyter notebook on your machine</a>.</p>
</li>
<li><p>If you want to use the book in a classroom, and depend on your users having access to the interactive notebooks, consider using or deploying a <a href="http://jupyter.org/hub">JupyterHub</a> or <a href="https://github.com/jupyterhub/binderhub">BinderHub</a> instance.</p>
</li>
</ol>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Can-I-run-the-code-on-my-Windows-machine?">Can I run the code on my Windows machine?<a class="anchor-link" href="#Can-I-run-the-code-on-my-Windows-machine?">&#182;</a></h4></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We try to keep the code as general as possible, but occasionally, when we interact with the operating system, we assume a Unix-like environment (because that is what Binder provides).  To run these examples on your own Windows machine, you can install a Linux VM or a Docker environment.  Instructions on how to do this are welcome.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Can't-you-run-your-own-dedicated-cloud-service?">Can't you run your own dedicated cloud service?<a class="anchor-link" href="#Can't-you-run-your-own-dedicated-cloud-service?">&#182;</a></h4><p>Technically, yes; but this would cost money and effort, which we'd rather spend on the book at this point.  If you'd like to host a <a href="http://jupyter.org/hub">JupyterHub</a> or <a href="https://github.com/jupyterhub/binderhub">BinderHub</a> instance for the public, please <em>do so</em> and let us know.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Content">Content<a class="anchor-link" href="#Content">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Which-content-will-be-coming-up?">Which content will be coming up?<a class="anchor-link" href="#Which-content-will-be-coming-up?">&#182;</a></h4><p>The contents of this book will include topics such as:</p>
<ol>
<li>Introduction to Testing</li>
<li>Basic Fuzzing</li>
<li>Coverage</li>
<li>Mutation-Based Fuzzing</li>
<li>Fuzzing with Grammars</li>
<li>Efficient Grammar Fuzzing</li>
<li>Grammar Coverage</li>
<li>Configuration Fuzzing</li>
<li>Parsing and Mutating Inputs</li>
<li>Probabilistic Testing</li>
<li>Reducing Failure-Inducing Inputs</li>
<li>Fuzzing Function Calls</li>
<li>Fuzzing User Interfaces</li>
<li>Search-Based Testing</li>
<li>Symbolic Testing</li>
<li>Mining Grammars</li>
<li>Fuzzing and Invariants</li>
<li>Protection and Repair</li>
</ol>
<p>See the table of contents in the menu above for those chapters that are already done.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="How-do-I-cite-your-work?">How do I cite your work?<a class="anchor-link" href="#How-do-I-cite-your-work?">&#182;</a></h4><p>Thanks for referring to our work!  Once the book is complete, you will be able to cite it in the traditional way.  In the meantime, just click on the "cite" button at the bottom of the Web page for each chapter to get a citation entry.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Can-you-cite-my-paper?--And-possibly-write-a-chapter-about-it?">Can you cite my paper?  And possibly write a chapter about it?<a class="anchor-link" href="#Can-you-cite-my-paper?--And-possibly-write-a-chapter-about-it?">&#182;</a></h4><p>We're always happy to get suggestions!  If we missed an important reference, we will of course add it.  If you'd like specific material to be covered, the best way is to <em>write a notebook</em> yourself; see our <a href="Guide_for_Authors.html">Guide for Authors</a> for instructions on coding and writing.  We can then refer to it or even host it.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Teaching-and-Coursework">Teaching and Coursework<a class="anchor-link" href="#Teaching-and-Coursework">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Can-I-use-your-material-in-my-course?">Can I use your material in my course?<a class="anchor-link" href="#Can-I-use-your-material-in-my-course?">&#182;</a></h4><p>Of course!  Just respect the <a href="https://github.com/uds-se/fuzzingbook/blob/master/LICENSE.md">license</a> (including attribution and share alike).  If you want to use the material for commercial purposes, contact us.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Can-I-extend-or-adapt-your-material?">Can I extend or adapt your material?<a class="anchor-link" href="#Can-I-extend-or-adapt-your-material?">&#182;</a></h4><p>Yes!  Again, please see the <a href="https://github.com/uds-se/fuzzingbook/blob/master/LICENSE.md">license</a> for details.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="How-can-I-run-a-course-based-on-the-book?">How can I run a course based on the book?<a class="anchor-link" href="#How-can-I-run-a-course-based-on-the-book?">&#182;</a></h4><p>We have successfully used the material in various courses.</p>
<ul>
<li><p>Initially, we used the slides and code and did <em>live coding</em> in lectures to illustrate how a technique works.</p>
</li>
<li><p>Now, the goal of the book is to be completely self-contained; that is, it should work without additional support.  Hence, we now give out completed chapters to students in a <em>flipped classroom</em> setting, with the students working on the notebooks at their leisure.  We would meet in the classroom to discuss experiences with past notebooks and discuss future notebooks.</p>
</li>
</ul>
<p>When running a course, <a href="#Troubleshooting">do not rely on mybinder.org</a> – it will not provide sufficient resources for a larger group of students.  Instead, <a href="#Do-I-have-alternatives-to-the-interactive-notebook?">install and run your own hub.</a></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="How-can-I-extend-or-adapt-your-slides?">How can I extend or adapt your slides?<a class="anchor-link" href="#How-can-I-extend-or-adapt-your-slides?">&#182;</a></h4><p>Download the Jupyter Notebooks (using the menu at the top) and adapt the notebooks at your leisure (see above), including "Slide Type" settings.  Then,</p>
<ol>
<li>Download slides from Jupyter Notebook; or</li>
<li>Use the RISE extension (<a href="http://www.blog.pythonlibrary.org/2018/09/25/creating-presentations-with-jupyter-notebook/">instructions</a>) to present your slides right out of Jupyter notebook.</li>
</ol>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Do-you-provide-PDFs-of-your-material?">Do you provide PDFs of your material?<a class="anchor-link" href="#Do-you-provide-PDFs-of-your-material?">&#182;</a></h4><p>At this point, we do not provide support for PDF versions.  We will be producing PDF and print versions once the book is complete.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Other-Issues">Other Issues<a class="anchor-link" href="#Other-Issues">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="I-have-a-question,-comment,-or-a-suggestion.--What-do-I-do?">I have a question, comment, or a suggestion.  What do I do?<a class="anchor-link" href="#I-have-a-question,-comment,-or-a-suggestion.--What-do-I-do?">&#182;</a></h4><p>You can <a href="https://twitter.com/fuzzingbook">tweet to @fuzzingbook on Twitter</a>, allowing the community of readers to chime in.  For bugs you'd like to get fixed, report an issue on the <a href="https://github.com/uds-se/fuzzingbook/issues">development page</a>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="I-have-reported-an-issue-two-weeks-ago.--When-will-it-be-addressed?">I have reported an issue two weeks ago.  When will it be addressed?<a class="anchor-link" href="#I-have-reported-an-issue-two-weeks-ago.--When-will-it-be-addressed?">&#182;</a></h4><p>We prioritize issues as follows:</p>
<ol>
<li>Bugs in code published on fuzzingbook.org</li>
<li>Bugs in text published on fuzzingbook.org</li>
<li>Writing missing chapters</li>
<li>Issues in yet unpublished code or text</li>
<li>Issues related to development or construction</li>
<li>Things marked as "beta"</li>
<li>Everything else</li>
</ol>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="How-can-I-solve-problems-myself?">How can I solve problems myself?<a class="anchor-link" href="#How-can-I-solve-problems-myself?">&#182;</a></h4><p>We're glad you ask that.  The <a href="https://github.com/uds-se/fuzzingbook/">development page</a> has all sources and some supplementary material.  Pull requests that fix issues are very welcome.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="How-can-I-contribute?">How can I contribute?<a class="anchor-link" href="#How-can-I-contribute?">&#182;</a></h4><p>Again, we're glad you're here!  We are happy to accept</p>
<ul>
<li><strong>Code fixes and improvements.</strong>  Please place any code under the MIT license such that we can easily include it.</li>
<li><strong>Additional text, chapters, and notebooks</strong> on specialized topics.  We plan to set up a special folder for third-party contributions.</li>
</ul>
<p>See our <a href="Guide_for_Authors.html">Guide for Authors</a> for instructions on coding and writing.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Introduction-to-Software-Testing">Introduction to Software Testing<a class="anchor-link" href="#Introduction-to-Software-Testing">&#182;</a></h1><p>Before we get to the central parts of the book, let us introduce essential concepts of software testing.  Why is it necessary to test software at all?  How does one test software?  How can one tell whether a test has been successful?  How does one know if one has tested enough?  In this chapter, let us recall the most important concepts, and at the same time get acquainted with Python and interactive notebooks.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Simple-Testing">Simple Testing<a class="anchor-link" href="#Simple-Testing">&#182;</a></h2><p>Let's start with a simple example.  Your co-worker has been asked to implement a square root function $\sqrt{x}$.  (Let's assume for a moment that the environment does  not already have one.)  After studying the <a href="https://en.wikipedia.org/wiki/Newton%27s_method">Newton–Raphson method</a>, she comes up with the following Python code, claiming that, in fact, this <code>my_sqrt()</code> function computes square roots.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">my_sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes the square root of x, using the Newton–Raphson method&quot;&quot;&quot;</span>
    <span class="n">approx</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">guess</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="n">approx</span> <span class="o">!=</span> <span class="n">guess</span><span class="p">:</span>
        <span class="n">approx</span> <span class="o">=</span> <span class="n">guess</span>
        <span class="n">guess</span> <span class="o">=</span> <span class="p">(</span><span class="n">approx</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="n">approx</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">approx</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Your job is now to find out whether this function actually does what it claims to do.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Understanding-Python-Programs">Understanding Python Programs<a class="anchor-link" href="#Understanding-Python-Programs">&#182;</a></h3><p>If you're new to Python, you might first have to understand what the above code does.  We very much recommend the <a href="https://docs.python.org/3/tutorial/">Python tutorial</a> to get an idea on how Python works.  The most important things for you to understand the above code are these three:</p>
<ol>
<li>Python structures programs through <em>indentation</em>, so the function and <code>while</code> bodies are defined by being indented;</li>
<li>Python is <em>dynamically typed</em>, meaning that the type of variables like <code>x</code>, <code>approx</code>, or <code>guess</code> is determined at run-time.</li>
<li>Most of Python's syntactic features are inspired by other common languages, such as control structures (<code>while</code>, <code>if</code>), assignments (<code>=</code>), or comparisons (<code>==</code>, <code>!=</code>, <code>&lt;</code>).</li>
</ol>
<p>With that, you can already understand what the above code does: Starting with a <code>guess</code> of <code>x / 2</code>, it computes better and better approximations in <code>approx</code> until the value of <code>approx</code> no longer changes.  This is the value that finally is returned.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Running-a-Function">Running a Function<a class="anchor-link" href="#Running-a-Function">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To find out whether <code>my_sqrt()</code> works correctly, we can <em>test</em> it with a few values.  For <code>x = 4</code>, for instance, it produces the correct value:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">my_sqrt</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>2.0
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The upper part above <code>my_sqrt(4)</code> (a so-called <em>cell</em>) is an input to the Python interpreter, which by default <em>evaluates</em> it.  The lower part (<code>2.0</code>) is its output.  We can see that <code>my_sqrt(4)</code> produces the correct value.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The same holds for <code>x = 2.0</code>, apparently, too:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">my_sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>1.414213562373095
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Interacting-with-Notebooks">Interacting with Notebooks<a class="anchor-link" href="#Interacting-with-Notebooks">&#182;</a></h3><p>If you are reading this in the interactive notebook, you can try out <code>my_sqrt()</code> with other values as well.  Click on one of the above cells with invocations of <code>my_sqrt()</code> and change the value – say, to <code>my_sqrt(1)</code>.  Press <code>Shift+Enter</code> (or click on the play symbol) to execute it and see the result.  If you get an error message, go to the above cell with the definition of <code>my_sqrt()</code> and execute this first.  You can also run <em>all</em> cells at once; see the Notebook menu for details.  (You can actually also change the text by clicking on it, and corect mistaks such as in this sentence.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Executing a single cell does not execute other cells, so if your cell builds on a definition in another cell that you have not executed yet, you will get an error.  You can select <code>Run all cells above</code> from the menu to ensure all definitions are set.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Also keep in mind that, unless overwritten, all definitions are kept across executions.  Occasionally, it thus helps to <em>restart the kernel</em> (i.e. start the Python interpreter from scratch) to get rid of older, superfluous definitions.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Debugging-a-Function">Debugging a Function<a class="anchor-link" href="#Debugging-a-Function">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To see how <code>my_sqrt()</code> operates, a simple strategy is to insert <code>print()</code> statements in critical places.  You can, for instance, log the value of <code>approx</code>, to see how each loop iteration gets closer to the actual value:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">my_sqrt_with_log</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes the square root of x, using the Newton–Raphson method&quot;&quot;&quot;</span>
    <span class="n">approx</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">guess</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="n">approx</span> <span class="o">!=</span> <span class="n">guess</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;approx =&quot;</span><span class="p">,</span> <span class="n">approx</span><span class="p">)</span>  <span class="c1"># &lt;-- New</span>
        <span class="n">approx</span> <span class="o">=</span> <span class="n">guess</span>
        <span class="n">guess</span> <span class="o">=</span> <span class="p">(</span><span class="n">approx</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="n">approx</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">approx</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">my_sqrt_with_log</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>approx = None
approx = 4.5
approx = 3.25
approx = 3.0096153846153846
approx = 3.000015360039322
approx = 3.0000000000393214
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>3.0
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Interactive notebooks also allow to launch an <em>interactive debugger</em> – insert a "magic line" <code>%%debug</code> at the top of a cell and see what happens.  Unfortunately, interactive debuggers interfere with our dynamic analysis techniques, so we mostly use logging and assertions for debugging.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Checking-a-Function">Checking a Function<a class="anchor-link" href="#Checking-a-Function">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let's get back to testing.  We can read and run the code, but are the above values of <code>my_sqrt(2)</code> actually correct?  We can easily verify by exploiting that $\sqrt{x}$ squared again has to be $x$, or in other words $\sqrt{x} \times \sqrt{x} = x$.  Let's take a look:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">my_sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">my_sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>1.9999999999999996
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Okay, we do have some rounding error, but otherwise, this seems just fine.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What we have done now is that we have <em>tested</em> the above program: We have <em>executed</em> it on a given input and <em>checked</em> its result whether it is correct or not.  Such a test is the bare minimum of quality assurance before a program goes into production.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Automating-Test-Execution">Automating Test Execution<a class="anchor-link" href="#Automating-Test-Execution">&#182;</a></h2><p>So far, we have tested the above program <em>manually</em>, that is, running it by hand and checking its results by hand.  This is a very flexible way of testing, but in the long run, it is rather inefficient:</p>
<ol>
<li>Manually, you can only check a very limited number of executions and their results</li>
<li>After any change to the program, you have to repeat the testing process</li>
</ol>
<p>This is why it is very useful to <em>automate</em> tests.  One simple way of doing so is to let the computer first do the computation, and then have it check the results.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For instance, this piece of code automatically tests whether $\sqrt{4} = 2$ holds:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">my_sqrt</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">expected_result</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">expected_result</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test passed&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test failed&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test passed
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The nice thing about this test is that we can run it again and again, thus ensuring that at least the square root of 4 is computed correctly.  But there are still a number of issues, though:</p>
<ol>
<li>We need <em>five lines of code</em> for a single test</li>
<li>We do not care for rounding errors</li>
<li>We only check a single input (and a single result)</li>
</ol>
<p>Let us address these issues one by one.  First, let's make the test a bit more compact.  Almost all programming languages do have a means to automatically check whether a condition holds, and stop execution if it does not.  This is called an <em>assertion</em>, and it is immensely useful for testing.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In Python, the <code>assert</code> statement takes a condition, and if the condition is true, nothing happens.  (If everything works as it should, you should not be bothered.)  If the condition evaluates to false, though, <code>assert</code> raises an exception, indicating that a test just failed.</p>
<p>In our example, we can use <code>assert</code> to easily check whether <code>my_sqrt()</code> yields the expected result as above:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">my_sqrt</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As you execute this line of code, nothing happens: We just have shown (or asserted) that our implementation indeed produces $\sqrt{4} = 2$.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Remember, though, that floating-point computations may induce rounding errors.  So we cannot simply compare two floating-point values with equality; rather, we would ensure that the absolute difference between them stays below a certain threshold value, typically denoted as $\epsilon$ or <code>epsilon</code>.  This is how we can do it:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">1e-8</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">my_sqrt</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">EPSILON</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can also introduce a special function for this purpose, and now do more tests for concrete values:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">assertEquals</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">epsilon</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assertEquals</span><span class="p">(</span><span class="n">my_sqrt</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">assertEquals</span><span class="p">(</span><span class="n">my_sqrt</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">assertEquals</span><span class="p">(</span><span class="n">my_sqrt</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Seems to work, right?  If we know the expected results of a computation, we can use such assertions again and again to ensure our program works correctly.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Generating-Tests">Generating Tests<a class="anchor-link" href="#Generating-Tests">&#182;</a></h2><p>Remember that the property $\sqrt{x} \times \sqrt{x} = x$ universally holds?  We can also explicitly test this with a few values:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assertEquals</span><span class="p">(</span><span class="n">my_sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">my_sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">assertEquals</span><span class="p">(</span><span class="n">my_sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">my_sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">assertEquals</span><span class="p">(</span><span class="n">my_sqrt</span><span class="p">(</span><span class="mf">42.11</span><span class="p">)</span> <span class="o">*</span> <span class="n">my_sqrt</span><span class="p">(</span><span class="mf">42.11</span><span class="p">),</span> <span class="mf">42.11</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Still seems to work, right?  Most importantly, though, $\sqrt{x} \times \sqrt{x} = x$ is something we can very easily test for thousands of values:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">):</span>
    <span class="n">assertEquals</span><span class="p">(</span><span class="n">my_sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">my_sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">n</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>How much time does it take to test <code>my_sqrt()</code> with 100 values?  Let's see.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We use our own <a href="Timer.html"><code>Timer</code> module</a> to measure elapsed time.  To be able to use <code>Timer</code>, we first import our own utility module, which allows us to import other notebooks.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Timer.html" class="import" target="_blank">Timer</a></span> <span class="k">import</span> <span class="n">Timer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">):</span>
        <span class="n">assertEquals</span><span class="p">(</span><span class="n">my_sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">my_sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">n</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0.030833983997581527
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>10,000 values take about a hundredth of a second, so a single execution of <code>my_sqrt()</code> takes 1/1000000 second, or about 1 microseconds.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let's repeat this with 10,000 values picked at random.  The Python <code>random.random()</code> function returns a random value between 0.0 and 1.0:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/random.html" class="import" target="_blank">random</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000000</span>
        <span class="n">assertEquals</span><span class="p">(</span><span class="n">my_sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">my_sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0.035782645994913764
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Within a second, we have now tested 10,000 random values, and each time, the square root was actually computed correctly.  We can repeat this test with every single change to <code>my_sqrt()</code>, each time reinforcing our confidence that <code>my_sqrt()</code> works as it should.  Note, though, that while a random function is <em>unbiased</em> in producing random values, it is unlikely to generate special values that drastically alter program behavior.  We will discuss this later below.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Run-Time-Verification">Run-Time Verification<a class="anchor-link" href="#Run-Time-Verification">&#182;</a></h2><p>Instead of writing and running tests for <code>my_sqrt()</code>, we can also go and <em>integrate the check right into the implementation.</em>  This way, <em>each and every</em> invocation of <code>my_sqrt()</code> will be automatically checked.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Such an <em>automatic run-time check</em> is very easy to implement:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">my_sqrt_checked</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">my_sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">assertEquals</span><span class="p">(</span><span class="n">root</span> <span class="o">*</span> <span class="n">root</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">root</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Now, whenever we compute a root with <code>my_sqrt_checked()</code>$\dots$</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">my_sqrt_checked</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>1.414213562373095
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>we already know that the result is correct, and will so for every new successful computation.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Automatic run-time checks, as above, assume two things, though:</p>
<ul>
<li><p>One has to be able to <em>formulate</em> such run-time checks.  Having concrete values to check against should always be possible, but formulating desired properties in an abstract fashion can be very complex.  In practice, you need to decide which properties are most crucial, and design appropriate checks for them.  Plus, run-time checks may depend not only on local properties, but on several properties of the program state, which all have to be identified.</p>
</li>
<li><p>One has to be able to <em>afford</em> such run-time checks.  In the case of <code>my_sqrt()</code>, the check is not very expensive; but if we have to check, say, a large data structure even after a simple operation, the cost of the check may soon be prohibitive.  In practice, run-time checks will typically be disabled during production, trading reliability for efficiency.  On the other hand, a comprehensive suite of run-time checks is a great way to find errors and quickly debug them; you need to decide how many such capabilities you would still want during production.</p>
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="System-Input-vs-Function-Input">System Input vs Function Input<a class="anchor-link" href="#System-Input-vs-Function-Input">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>At this point, we may make <code>my_sqrt()</code> available to other programmers, who may then embed it in their code.  At some point, it will have to process input that comes from <em>third parties</em>, i.e. is not under control by the programmer.  Let us simulate this <em>system input</em> by assuming a function <code>exposed_sqrt()</code> whose input is a string under third-party control:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">exposed_sqrt</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The root of&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="n">my_sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can easily invoke <code>exposed_sqrt()</code> with some system input:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exposed_sqrt</span><span class="p">(</span><span class="s2">&quot;4&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The root of 4 is 2.0
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What's the problem?  Well, the problem is that we do not check external inputs for validity.  Try invoking <code>exposed_sqrt(-1)</code>, for instance.  What happens?</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Indeed, if you invoke <code>my_sqrt()</code> with a negative number, it enters an infinite loop.  For technical reasons, we cannot have infinite loops in this chapter (unless we'd want the code to run forever); so we use a special <code>with ExpectTimeOut(1)</code> construct to interrupt execution after one second.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="ExpectError.html" class="import" target="_blank">ExpectError</a></span> <span class="k">import</span> <span class="n">ExpectTimeout</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectTimeout</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The root of&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="n">my_sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-25-51d1d547b921&gt;&#34;, line 3, in &lt;module&gt;
    print(&#39;The root of&#39;, x, &#39;is&#39;, my_sqrt(x))
  File &#34;&lt;ipython-input-1-f91e5d79a1e7&gt;&#34;, line 7, in my_sqrt
    guess = (approx + x / approx) / 2
  File &#34;&lt;ipython-input-1-f91e5d79a1e7&gt;&#34;, line 7, in my_sqrt
    guess = (approx + x / approx) / 2
  File &#34;&lt;string&gt;&#34;, line 16, in check_time
TimeoutError (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The above message is an <em>error message</em>, indicating that something went wrong.  It lists the <em>call stack</em> of functions and lines that were active at the time of the error.  The line at the very bottom is the line last executed; the lines above represent function invocations – in our case, up to <code>my_sqrt(x)</code>.</p>
<p>We don't want our code terminating with an exception.  Consequently, when accepting external input, we must ensure that it is properly validated.  We may write, for instance:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">exposed_sqrt</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Illegal Input&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The root of&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="n">my_sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>and then we can be sure that <code>my_sqrt()</code> is only invoked according to its specification.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exposed_sqrt</span><span class="p">(</span><span class="s2">&quot;-1&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Illegal Input
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>But wait!  What happens if <code>exposed_sqrt()</code> is not invoked with a number?  Then we would try to convert a non-number string, which would also result in a runtime error:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="ExpectError.html" class="import" target="_blank">ExpectError</a></span> <span class="k">import</span> <span class="n">ExpectError</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">exposed_sqrt</span><span class="p">(</span><span class="s2">&quot;xyzzy&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-29-15370172e011&gt;&#34;, line 2, in &lt;module&gt;
    exposed_sqrt(&#34;xyzzy&#34;)
  File &#34;&lt;ipython-input-26-259e53fd8dc6&gt;&#34;, line 2, in exposed_sqrt
    x = int(s)
ValueError: invalid literal for int() with base 10: &#39;xyzzy&#39; (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's a version which also checks for bad inputs:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">exposed_sqrt</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Illegal Input&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Illegal Number&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The root of&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="n">my_sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exposed_sqrt</span><span class="p">(</span><span class="s2">&quot;4&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The root of 4.0 is 2.0
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exposed_sqrt</span><span class="p">(</span><span class="s2">&quot;-1&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Illegal Number
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exposed_sqrt</span><span class="p">(</span><span class="s2">&quot;xyzzy&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Illegal Input
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We have now seen that at the system level, the program must be able to handle any kind of input gracefully without ever entering an uncontrolled state.  This, of course, is a burden for programmers, who must struggle to make their programs robust for all circumstances.  This burden, however, becomes a <em>benefit</em> when generating software tests: If a program can handle any kind of input (possibly with well-defined error messages), we can also <em>send it any kind of input</em>.  When calling a function with generated values, though, we have to <em>know</em> its precise preconditions.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="The-Limits-of-Testing">The Limits of Testing<a class="anchor-link" href="#The-Limits-of-Testing">&#182;</a></h2><p>Despite best efforts in testing, keep in mind that you are always checking functionality for a <em>finite</em> set of inputs.  Thus, there may always be <em>untested</em> inputs for which the function may still fail.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the case of <code>my_sqrt()</code>, for instance, computing $\sqrt{0}$ results in a division by zero:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">my_sqrt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-34-24ede1f53910&gt;&#34;, line 2, in &lt;module&gt;
    root = my_sqrt(0)
  File &#34;&lt;ipython-input-1-f91e5d79a1e7&gt;&#34;, line 7, in my_sqrt
    guess = (approx + x / approx) / 2
ZeroDivisionError: float division by zero (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In our tests so far, we have not checked this condition, meaning that a program which builds on $\sqrt{0} = 0$ will surprisingly fail.  But even if we had set up our random generator to produce inputs in the range of 0–1000000 rather than 1–1000000, the chances of it producing a zero value by chance would still have been one in a million.  If the behavior of a function is radically different for few individual values, plain random testing has few chances to produce these.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can, of course, fix the function accordingly, documenting the accepted values for <code>x</code> and handling the special case <code>x = 0</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">my_sqrt_fixed</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">x</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">my_sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With this, we can now correctly compute $\sqrt{0} = 0$:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">my_sqrt_fixed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Illegal values now result in an exception:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">my_sqrt_fixed</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-37-55b1caf1586a&gt;&#34;, line 2, in &lt;module&gt;
    root = my_sqrt_fixed(-1)
  File &#34;&lt;ipython-input-35-f3e21e80ddfb&gt;&#34;, line 2, in my_sqrt_fixed
    assert 0 &lt;= x
AssertionError (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Still, we have to remember that while extensive testing may give us a high confidence into the correctness of a program, it does not provide a guarantee that all future executions will be correct.  Even run-time verification, which checks every result, can only guarantee that <em>if</em> it produces a result, the result will be correct; but there is no guarantee that future executions may not lead to a failing check.  As I am writing this, I <em>believe</em> that <code>my_sqrt_fixed(x)</code> is a correct implementation of $\sqrt{x}$, but I cannot be 100% certain.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With the Newton-Raphson method, we may still have a good chance of actually <em>proving</em> that the implementation is correct: The implementation is simple, the math is well-understood.  Alas, this is only the case for few domains.  If we do not want to go into full-fledged correctness proofs, our best chance with testing is to</p>
<ol>
<li>Test the program on several, well-chosen inputs; and</li>
<li>Check results extensively and automatically.</li>
</ol>
<p>This is what we do in the remainder of this course: Devise techniques that help us to thoroughly test a program, as well as techniques that help us checking its state for correctness.  Enjoy!</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned<a class="anchor-link" href="#Lessons-Learned">&#182;</a></h2><ul>
<li>The aim of testing is to execute a program such that we find bugs.</li>
<li>Test execution, test generation, and checking test results can be automated.</li>
<li>Testing is <em>incomplete</em>; it provides no 100% guarantee that the code is free of errors.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps<a class="anchor-link" href="#Next-Steps">&#182;</a></h2><p>From here, you can move on how to</p>
<ul>
<li><a href="Fuzzer.html">use <em>fuzzing</em> to test programs with random inputs</a></li>
</ul>
<p>Enjoy the read!</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Background">Background<a class="anchor-link" href="#Background">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>There is a large number of works on software testing and analysis.  For this book, we are happy to recommend "Software Testing and Analysis" [<a href="http://ix.cs.uoregon.edu/~michal/book/">Pezzè <em>et al</em>, 2008.</a>] as an introduction to the field; its strong technical focus very well fits our methodology.  Other important must-reads with a comprehensive approach to software testing, including psychology and organization, include "The Art of Software Testing" [<a href="https://dl.acm.org/citation.cfm?id=983238">Myers <em>et al</em>, 2004.</a>] as well as "Software Testing Techniques" [<a href="https://dl.acm.org/citation.cfm?id=79060">Beizer <em>et al</em>, 1990.</a>].</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises<a class="anchor-link" href="#Exercises">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1:-Testing-Shellsort">Exercise 1: Testing Shellsort<a class="anchor-link" href="#Exercise-1:-Testing-Shellsort">&#182;</a></h3><p>Consider the following implementation of a <a href="https://en.wikipedia.org/wiki/Shellsort">Shellsort</a> function, taking a list of elements and (presumably) sorting it.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">shellsort</span><span class="p">(</span><span class="n">elems</span><span class="p">):</span>
    <span class="n">sorted_elems</span> <span class="o">=</span> <span class="n">elems</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">gaps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">701</span><span class="p">,</span> <span class="mi">301</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">gap</span> <span class="ow">in</span> <span class="n">gaps</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gap</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_elems</span><span class="p">)):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">sorted_elems</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">while</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">sorted_elems</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="n">gap</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">temp</span><span class="p">:</span>
                <span class="n">sorted_elems</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorted_elems</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="n">gap</span><span class="p">]</span>
                <span class="n">j</span> <span class="o">-=</span> <span class="n">gap</span>
            <span class="n">sorted_elems</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>

    <span class="k">return</span> <span class="n">sorted_elems</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>A first test indicates that <code>shellsort()</code> might actually work:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">shellsort</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[1, 2, 3]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The implementation uses a <em>list</em> as argument <code>elems</code> (which it copies into <code>sorted_elems</code>) as well as for the fixed list <code>gaps</code>.  Lists work like <em>arrays</em> in other languages:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First element:&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;length:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>First element: 5 length: 4
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>range()</code> function returns an iterable list of elements.  It is often used in conjunction with <code>for</code> loops, as in the above implementation.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>1
2
3
4
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-1:-Manual-Test-Cases">Part 1: Manual Test Cases<a class="anchor-link" href="#Part-1:-Manual-Test-Cases">&#182;</a></h4></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Your job is now to thoroughly test <code>shellsort()</code> with a variety of inputs.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>First, set up <code>assert</code> statements with a number of manually written test cases.  Select your test cases such that extreme cases are covered.  Use <code>==</code> to compare two lists.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-2:-Random-Inputs">Part 2: Random Inputs<a class="anchor-link" href="#Part-2:-Random-Inputs">&#182;</a></h4></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Second, create random lists as arguments to <code>shellsort()</code>.   Make use of the following helper predicates to check whether the result is (a) sorted, and (b) a permutation of the original.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">is_sorted</span><span class="p">(</span><span class="n">elems</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">elems</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">elems</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elems</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">is_sorted</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>True
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">is_permutation</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">a</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">is_permutation</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>True
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Start with a random list generator, using <code>[]</code> as the empty list and <code>elems.append(x)</code> to append an element <code>x</code> to the list <code>elems</code>.  Use the above helper functions to assess the results.  Generate and test 1,000 lists.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2:-Quadratic-Solver">Exercise 2: Quadratic Solver<a class="anchor-link" href="#Exercise-2:-Quadratic-Solver">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Given an equation $ax^2 + bx + c = 0$, we want to find solutions for $x$ given the values of $a$, $b$, and $c$.  The following code is supposed to do this, using the equation $$x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}$$</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">quadratic_solver</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span>
    <span class="n">solution_1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">+</span> <span class="n">my_sqrt_fixed</span><span class="p">(</span><span class="n">q</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">solution_2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">-</span> <span class="n">my_sqrt_fixed</span><span class="p">(</span><span class="n">q</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">solution_1</span><span class="p">,</span> <span class="n">solution_2</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">quadratic_solver</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>(-0.3333333333333333, -1.0)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The above implementation is incomplete, though.  You can trigger</p>
<ol>
<li>a division by zero; and</li>
<li>violate the precondition of <code>my_sqrt_fixed()</code>.</li>
</ol>
<p>How does one do that, and how can one prevent this?</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-1:-Find-bug-triggering-inputs">Part 1: Find bug-triggering inputs<a class="anchor-link" href="#Part-1:-Find-bug-triggering-inputs">&#182;</a></h4><p>For each of the two cases above, identify values for <code>a</code>, <code>b</code>, <code>c</code> that trigger the bug.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-2:-Fix-the-problem">Part 2: Fix the problem<a class="anchor-link" href="#Part-2:-Fix-the-problem">&#182;</a></h4><p>Extend the code appropriately such that the cases are handled.  Return <code>None</code> for nonexistent values.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-3:-Odds-and-Ends">Part 3: Odds and Ends<a class="anchor-link" href="#Part-3:-Odds-and-Ends">&#182;</a></h4><p>What are the chances of discovering these conditions with random inputs?  Assuming one can do a billion tests per second, how long would one have to wait on average until a bug gets triggered?</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Fuzzing:-Breaking-Things-with&#160;Random&#160;Inputs">Fuzzing: Breaking Things with&#160;Random&#160;Inputs<a class="anchor-link" href="#Fuzzing:-Breaking-Things-with&#160;Random&#160;Inputs">&#182;</a></h1><p>In this chapter, we'll start with one of the simplest test generation techniques.  The key idea of random text generation, also known as "fuzzing", is to feed a <em>string of random characters</em> into a program in the hope to uncover failures.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>You should know fundamentals of software testing; for instance, from the chapter <a href="Intro_Testing.html">"Introduction to Software Testing"</a>.</li>
<li>You should have a decent understanding of Python; for instance, from the <a href="https://docs.python.org/3/tutorial/">Python tutorial</a>.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="A-Testing-Assignment">A Testing Assignment<a class="anchor-link" href="#A-Testing-Assignment">&#182;</a></h2><p>Fuzzing was born in a "dark and stormy night in the Fall of 1988" [<a href="http://us.artechhouse.com/Fuzzing-for-Software-Security-Testing-and-Quality-Assurance-Second-Edition-P1930.aspx">Takanen <em>et al</em>, 2008.</a>].  Sitting in his apartment in Wisconsin, Madison, professor Barton Miller was connected to his university computer via a 1200 baud telephone line.  The thunderstorm caused noise on the line, and this noise in turn caused the UNIX commands on either end to get bad inputs – and crash.  The frequent crashes surprised him – surely, programs should be more robust than that?  As a scientist, he wanted to investigate the extent of the problem and its causes.  So he crafted a <em>programming exercise</em> for his students at the University of Wisconsin-Madison – an exercise that would have his students create the first fuzzers.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is how the <a href="http://pages.cs.wisc.edu/~bart/fuzz/CS736-Projects-f1988.pdf">assignment</a> read:</p>
<blockquote><p>The goal of this project is to evaluate the robustness of various UNIX utility programs, given an unpredictable input stream. [...] First, you will build a <em>fuzz generator</em>. This is a program that will output a random character stream. Second, you will take the fuzz generator and use it to attack as many UNIX utilities as possible, with the goal of trying to break them.</p>
</blockquote>
<p>This assignment captures the essence of fuzzing: <em>Create random inputs, and see if they break things.</em>  Just let it run long enough and you'll see.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="A-Simple-Fuzzer">A Simple Fuzzer<a class="anchor-link" href="#A-Simple-Fuzzer">&#182;</a></h2><p>Let us try to fulfill this assignment and build a fuzz generator.  The idea is to produce random characters, adding them to a buffer string variable (<code>out</code>), and finally returning the string.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This implementation uses the following Python features and functions:</p>
<ul>
<li><code>random.randrange(start, end)</code> – return a random number $[$ <code>start</code>, <code>end</code> $)$</li>
<li><code>range(start, end)</code> – create a list with integers from <code>start</code> to <code>end</code>.  Typically used in iterations.</li>
<li><code>for elem in list: body</code> – execute <code>body</code> in a loop with <code>elem</code> taking each value from <code>list</code>.</li>
<li><code>for i in range(start, end): body</code> – execute <code>body</code> in a loop with <code>i</code> from <code>start</code> to <code>end</code> $-$ 1.</li>
<li><code>chr(n)</code> – return a character with ASCII code <code>n</code></li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>First, we'll import a standard package required for working in notebooks.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Next, we'll need random numbers.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/random.html" class="import" target="_blank">random</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here comes the actual <code>fuzzer()</code> function.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">fuzzer</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">char_start</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">char_range</span><span class="o">=</span><span class="mi">32</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A string of up to `max_length` characters</span>
<span class="sd">       in the range [`char_start`, `char_start` + `char_range`]&quot;&quot;&quot;</span>
    <span class="n">string_length</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">string_length</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">char_start</span><span class="p">,</span> <span class="n">char_start</span> <span class="o">+</span> <span class="n">char_range</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">out</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With its default arguments, the <code>fuzzer()</code> function returns a string of random characters.  Bart Miller coined the term "fuzz" as the name for such random, unstructured data.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fuzzer</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;!7#%&#34;*#0=)$;%6*;&gt;638:*&gt;80&#34;=&lt;/&gt;(/*:-(2&lt;4 !:5*6856&amp;?&#34;&#34;11&lt;7+%&lt;%7,4.8,*+&amp;,,$,.&#34;&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Now imagine that this "fuzz" string was the input to a program expecting a specific input format – say, a comma-separated list of values, or an e-mail address.  Would the program be able to process such an input without any problems?</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If the above fuzzing input already is intriguing, consider that fuzzing can easily be set up to produce other kinds of input.  For instance, we can also have <code>fuzzer()</code> produce a series of lowercase letters.  We use <code>ord(c)</code> to return the ASCII code of the character <code>c</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fuzzer</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="mi">26</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;zskscocrxllosagkvaszlngpysurezehvcqcghygphnhonehczraznkibltfmocxddoxcmrvatcleysksodzlwmzdndoxrjfqigjhqjxkblyrtoaydlwwisrvxtxsejhfbnforvlfisojqaktcxpmjqsfsycisoexjctydzxzzutukdztxvdpqbjuqmsectwjvylvbixzfmqiabdnihqagsvlyxwxxconminadcaqjdzcnzfjlwccyudmdfceiepwvyggepjxoeqaqbjzvmjdlebxqvehkmlevoofjlilegieeihmetjappbisqgrjhglzgffqrdqcwfmmwqecxlqfpvgtvcddvmwkplmwadgiyckrfjddxnegvmxravaunzwhpfpyzuyyavwwtgykwfszasvlbwojetvcygectelwkputfczgsfsbclnkzzcjfywitooygjwqujseflqyvqgyzpvknddzemkegrjjrshbouqxcmixnqhgsgdwgzwzmgzfajymbcfezqxndbmzwnxjeevgtpjtcwgbzptozflrwvuopohbvpmpaifnyyfvbzzdsdlznusarkmmtazptbjbqdkrsnrpgdffemnpehoapiiudokczwrvpsonybfpaeyorrgjdmgvkvupdtkrequicexqkoikygepawmwsdcrhivoegynnhodfhryeqbebtbqnwhogdfrsrksntqjbocvislhgrgchkhpaiugpbdygwkhrtyniufabdnqhtnwreiascfvmuhettfpbowbjadfxnbtzhobnxsnf&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Assume a program expects an identifier as its input.  Would it expect such a long identifier?</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Fuzzing-External-Programs">Fuzzing External Programs<a class="anchor-link" href="#Fuzzing-External-Programs">&#182;</a></h2><p>Let us see what happens if we actually invoke an external program with fuzzed inputs.  To this end, let us proceed in two steps.  First, we create an <em>input file</em> with fuzzed test data; then we feed this input file into a program of choice.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Creating-Input-Files">Creating Input Files<a class="anchor-link" href="#Creating-Input-Files">&#182;</a></h3><p>Let us obtain a temporary file name such that we do not clutter the file system.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/os.html" class="import" target="_blank">os</a></span>
<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/tempfile.html" class="import" target="_blank">tempfile</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">basename</span> <span class="o">=</span> <span class="s2">&quot;input.txt&quot;</span>
<span class="n">tempdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
<span class="n">FILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">basename</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">FILE</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/tmp_5wgm_yp/input.txt
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now open this file for writing.  The Python <code>open()</code> function opens a file into which we can then write arbitrary contents.  It is commonly used in conjunction with the <code>with</code> statement, which ensures that the file is closed as soon as it is no longer needed.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">fuzzer</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">FILE</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can verify that the file was actually created by reading its contents:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">contents</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">FILE</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
<span class="k">assert</span><span class="p">(</span><span class="n">contents</span> <span class="o">==</span> <span class="n">data</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>!6&#34;*-2,$994,%*:&#34;$25!2=!+!2#&#39;&#39;6/3&#39;4!6%7056&#39;??2#7;75&gt;27&#39;15#-4.?*&lt;?6&amp;&#34; !3&#39;7-5&gt;18%
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Invoking-External-Programs">Invoking External Programs<a class="anchor-link" href="#Invoking-External-Programs">&#182;</a></h3><p>Now that we have an input file, we can invoke a program on it.  For the fun of it, let us test the <code>bc</code> calculator program, which takes an arithmetic expression and evaluates it.</p>
<p>To invoke <code>bc</code>, let us use the Python <code>subprocess</code> module.  This is how this works:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/os.html" class="import" target="_blank">os</a></span>
<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/subprocess.html" class="import" target="_blank">subprocess</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">program</span> <span class="o">=</span> <span class="s2">&quot;bc&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">FILE</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;2 + 2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">program</span><span class="p">,</span> <span class="n">FILE</span><span class="p">],</span>
                        <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span>
                        <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                        <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                        <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>From the <code>result</code>, we can check the program output.  In the case of <code>bc</code>, this is the result of evaluating the arithmetic expression:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;4\n&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can also check the status. A value of 0 indicates that the program terminated correctly.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">returncode</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>0
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Any error messages would be available in <code>results.stderr</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Instead of <code>bc</code>, you can actually put in any program you like.  Be aware, though, that if your program is able to change or even damage your system, there is quite a risk that the fuzzed input contains data or commands that do precisely this.</p>
<p>Just for the fun of it, imagine you would test a file removal program.  What is the chance of the fuzzer producing a valid file name?  (Note that <code>.</code> and <code>/</code> may be  valid directory names already.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Long-Running-Fuzzing">Long-Running Fuzzing<a class="anchor-link" href="#Long-Running-Fuzzing">&#182;</a></h3><p>Let us now feed a large number of inputs into our tested program, to see whether it might crash on some.  We store all results in the <code>runs</code> variable as pairs of input data and the actual result. (Note: running this may take a while.)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trials</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">program</span> <span class="o">=</span> <span class="s2">&quot;bc&quot;</span>

<span class="n">runs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">fuzzer</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">FILE</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">program</span><span class="p">,</span> <span class="n">FILE</span><span class="p">],</span>
                            <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span>
                            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                            <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">runs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now query <code>runs</code> for some statistics.  For instance, we can query how many runs actually passed -- that is, there were no error messages.  We use a <em>list comprehension</em> here: The form <em>expression</em> <code>for</code> <em>element</em> <code>in</code> <em>list</em> <code>if</code> <em>condition</em> returns a list of evaluated <em>expressions</em> in which each <em>element</em> comes from <em>list</em> if the <em>condition</em> was true.  (Actually, a list comprehension returns a <em>list generator</em>, but for our purposes, the generator behaves like a list.)  Here, we have the <em>expression</em> be 1 for all elements where <em>condition</em> holds, and we use <code>sum()</code> to sum over all elements in the list.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="ow">in</span> <span class="n">runs</span> <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">stderr</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>4
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Most inputs apparently are invalid – not a big surprise, as it is unlikely that a random input contains a valid arithmetic expression.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us take a look at the first error message:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">errors</span> <span class="o">=</span> <span class="p">[(</span><span class="n">data</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="ow">in</span> <span class="n">runs</span> <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">stderr</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
<span class="p">(</span><span class="n">first_data</span><span class="p">,</span> <span class="n">first_result</span><span class="p">)</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">first_data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first_result</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&#39;5*,55&amp;8&gt;&#34;86,?&#34;/7!1%5-**&amp;-$&amp;)$91;&#34;21(\&#39;8&#34;(%$&#39;
/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/tmp_5wgm_yp/input.txt 1: parse error
/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/tmp_5wgm_yp/input.txt 1: illegal character: &amp;
/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/tmp_5wgm_yp/input.txt 1: parse error
/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/tmp_5wgm_yp/input.txt 1: illegal character: &amp;
/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/tmp_5wgm_yp/input.txt 1: illegal character: $
/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/tmp_5wgm_yp/input.txt 1: illegal character: &amp;
/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/tmp_5wgm_yp/input.txt 1: illegal character: $
/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/tmp_5wgm_yp/input.txt 1: parse error
/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/tmp_5wgm_yp/input.txt 1: illegal character: $
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Are there any runs with messages other than <code>illegal character</code>, <code>parse error</code>, or <code>syntax error</code>?  (Say, something like <code>crash</code> or <code>you found a fatal bug</code>?)  Not very many:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span> <span class="k">for</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="ow">in</span> <span class="n">runs</span> <span class="k">if</span>
 <span class="n">result</span><span class="o">.</span><span class="n">stderr</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>
 <span class="ow">and</span> <span class="s2">&quot;illegal character&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stderr</span>
 <span class="ow">and</span> <span class="s2">&quot;parse error&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stderr</span>
 <span class="ow">and</span> <span class="s2">&quot;syntax error&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Maybe a crash would be indicated by <code>bc</code> just crashing.  Unfortunately, the return code is never nonzero:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="ow">in</span> <span class="n">runs</span> <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>0
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>How about we let the above <code>bc</code> test run for some more?  While it is running, let us take a look on how the state of the art was in 1989.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Bugs-Fuzzers-Find">Bugs Fuzzers Find<a class="anchor-link" href="#Bugs-Fuzzers-Find">&#182;</a></h2><p>When Miller and his students ran their first fuzzers in 1989, they found an alarming result: About <strong>a third of the UNIX utilities</strong> they fuzzed had issues – they crashed, hung, or otherwise failed when confronted with fuzzing input [<a href="https://doi.org/10.1145/96267.96279">Miller <em>et al</em>, 1990.</a>].  This also included the <code>bc</code> program, above.  (Apparently, the bugs have now been fixed!)</p>
<p>Considering that many of these UNIX utilities were used in scripts that would also process network input, this was an alarming result.  Programmers quickly built and ran their own fuzzers, rushed to fix the reported errors, and learned not to trust external inputs anymore.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What kind of problems did Miller's fuzzing experiment find?  It turns out that the mistakes programmers made in 1990 are still the same mistakes being made today.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Buffer-Overflows">Buffer Overflows<a class="anchor-link" href="#Buffer-Overflows">&#182;</a></h3><p>Many programs have built-in maximum lengths for inputs and input elements.  In languages like C, it is easy to excess these lengths without the program (or the programmer) even noticing, triggering so-called <strong>buffer overflows</strong>.  The following code, for instance, happily copies the <code>input</code> string into a <code>weekday</code> string even if <code>input</code> has more than eight characters:</p>
<div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">weekday</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span> <span class="c1">// 8 characters + trailing &#39;\0&#39; terminator</span>
<span class="n">strcpy</span> <span class="p">(</span><span class="n">weekday</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span>
</pre></div>
<p>Ironically, this already fails if <code>input</code> is <code>"Wednesday"</code> (9 characters); any excess characters (here, <code>'y'</code> and the following <code>'\0'</code> string terminator) are simply copied to whatever resides in memory after <code>weekday</code>, triggering arbitrary behavior; maybe some boolean character variable which would be set from <code>'n'</code> to <code>'y'</code>.  With fuzzing, it is very easy to produce arbitrary long inputs and input elements.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can easily simulate this buffer overflow behavior in a Python function:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">crash_if_too_long</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;Thursday&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">buffer</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>And yes, it quickly crashes.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="ExpectError.html" class="import" target="_blank">ExpectError</a></span> <span class="k">import</span> <span class="n">ExpectError</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trials</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">fuzzer</span><span class="p">()</span>
        <span class="n">crash_if_too_long</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-22-f83db3d59a06&gt;&#34;, line 5, in &lt;module&gt;
    crash_if_too_long(s)
  File &#34;&lt;ipython-input-20-928c2d2de976&gt;&#34;, line 4, in crash_if_too_long
    raise ValueError
ValueError (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>with ExpectError()</code> line in the above code ensures that the error message is printed, yet execution continues; this is to differentiate this "expected" error from "unexpected" errors in other code examples.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Missing-Error-Checks">Missing Error Checks<a class="anchor-link" href="#Missing-Error-Checks">&#182;</a></h3><p>Many programming languages do not have exceptions, but instead have functions return special <strong>error codes</strong> in exceptional circumstances.  The C function <code>getchar()</code>, for instance, normally returns a character from the standard input; if no input is available anymore, it returns the special value <code>EOF</code> (end of file).  Now assume a programmer is scanning the input for the next character, skipping space characters:</p>
<div class="highlight"><pre><span></span><span class="kt">char</span> <span class="nf">read_next_nonspace</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">lastc</span><span class="p">;</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="n">lastc</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">lastc</span> <span class="o">!=</span> <span class="sc">&#39; &#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">lastc</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>What happens if the input ends prematurely, as would perfectly be feasible with fuzzing?  Well, <code>getchar()</code> returns <code>EOF</code>, and keeps on returning <code>EOF</code> when called again; so the code above simply enters an infinite loop.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Again, we can simulate such missing error checks.  Here's a function that will effectively hang if no space is present in the input:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">hang_if_no_space</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Using the timeout mechanism from our <a href="Intro_Testing.html">Introduction to Testing</a>, we can interrupt this function after some time.  And yes, it does hang after a few fuzzing inputs.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="ExpectError.html" class="import" target="_blank">ExpectError</a></span> <span class="k">import</span> <span class="n">ExpectTimeout</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trials</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">with</span> <span class="n">ExpectTimeout</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">fuzzer</span><span class="p">()</span>
        <span class="n">hang_if_no_space</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-25-8e40f7d62a1b&gt;&#34;, line 5, in &lt;module&gt;
    hang_if_no_space(s)
  File &#34;&lt;ipython-input-23-5f437edacff4&gt;&#34;, line 7, in hang_if_no_space
    i += 1
  File &#34;&lt;ipython-input-23-5f437edacff4&gt;&#34;, line 7, in hang_if_no_space
    i += 1
  File &#34;&lt;string&gt;&#34;, line 16, in check_time
TimeoutError (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>with ExpectTimeout()</code> line in the above code ensures that execution of the enclosed code is interrupted after two seconds, printing the error message.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Rogue-Numbers">Rogue Numbers<a class="anchor-link" href="#Rogue-Numbers">&#182;</a></h3><p>With fuzzing, it is easy to generate <strong>uncommon values</strong> in the input, causing all kinds of interesting behavior.  Consider the following code, again in the C language, which first reads a buffer size from the input, and then allocates a buffer of the given size:</p>
<div class="highlight"><pre><span></span><span class="kt">char</span> <span class="o">*</span><span class="nf">read_input</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">size_t</span> <span class="n">size</span> <span class="o">=</span> <span class="n">read_buffer_size</span><span class="p">();</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
    <span class="c1">// fill buffer</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>What happens if <code>size</code> is very large, exceeding program memory?  What happens if <code>size</code> is less than the number of characters following?  What happens if <code>size</code> is negative?  By providing a random number here, fuzzing can create all kinds of damages.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Again, we can easily simulate such rogue numbers in Python.  The function <code>collapse_if_too_large()</code> fails if the passed value (a string) is too large after having been converted to an integer.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">collapse_if_too_large</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can have <code>fuzzer()</code> create a string of digits:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">long_number</span> <span class="o">=</span> <span class="n">fuzzer</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">long_number</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>7056414967099541967374507745748918952640135045
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If we feed such numbers into <code>collapse_if_too_large()</code>, it will very soon fail.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">collapse_if_too_large</span><span class="p">(</span><span class="n">long_number</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-28-7a1817f3dbfc&gt;&#34;, line 2, in &lt;module&gt;
    collapse_if_too_large(long_number)
  File &#34;&lt;ipython-input-26-2c22a83a4dca&gt;&#34;, line 3, in collapse_if_too_large
    raise ValueError
ValueError (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If we really wanted to allocate that much memory on a system, having it quickly fail as above actually would be the better option.  In reality, running out of memory may dramatically slow systems down, up to the point that they become totally unresponsive – and restarting is the only option.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>One might argue that these are all problems of bad programming, or of bad programming languages.  But then, there are thousands of people starting to program every day, and all of them make the same mistakes again and again, even today.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Catching-Errors">Catching Errors<a class="anchor-link" href="#Catching-Errors">&#182;</a></h2><p>When Miller and his students built their first fuzzer, they could identify errors simply because the program would crash or hang – two conditions that are easy to identify.  If the failures are more subtle, though, we need to come up with additional checks.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Generic-Checkers">Generic Checkers<a class="anchor-link" href="#Generic-Checkers">&#182;</a></h3><p>Buffer overflows, as <a href="#Buffer-Overflows">discussed above</a>, are a particular instance of a more general problem: In languages like C, a program can access arbitrary parts of its memory – even those parts that are uninitialized and possibly not even meant to be accessed.  This is necessary if you want to write an operating system, and great if you want a maximum of performance or control, but pretty bad if you want to avoid mistakes.  Fortunately, there are tools that help catching such issues at runtime, and they are great when combined with fuzzing.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To catch problematic memory accesses during testing, one can run C programs in special <em>memory-checking</em> environments; at runtime, these check for each and every memory read whether it accesses valid and initialized memory.  A popular example of such a tool is the <a href="https://clang.llvm.org/docs/MemorySanitizer.html">LLVM Memory Sanitizer</a>.  Compiling a C program with</p>
<div class="highlight"><pre><span></span>$ clang -fsanitize<span class="o">=</span>memory -o program program.c
</pre></div>
<p>can then reveal errors during execution:</p>
<div class="highlight"><pre><span></span>$ ./program
WARNING: MemorySanitizer: use-of-uninitialized-value
    <span class="c1">#0 0x7f45944b418a in main umr.cc:6</span>
    <span class="c1">#1 0x7f45938b676c in __libc_start_main libc-start.c:226</span>
</pre></div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If you want to find errors in a C program, turning on memory checking during fuzzing is a no-brainer.  It will slow down execution by a certain factor (typical values are 3–5$\times$) and also consume more memory, but CPU cycles are dead cheap compared to the human effort it takes to find these bugs – not to speak of the potential <em>damage</em> they cause.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us illustrate this "damage" by only one example.  The <a href="https://en.wikipedia.org/wiki/Heartbleed">HeartBleed bug</a> was a security bug in the OpenSSL library, implementing cryptographic protocols that provide communications security over a computer network.  (If you read this text in a browser, it is likely encrypted using these protocols.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The HeartBleed bug was exploited by sending a specially crafted command to the SSL <em>heartbeat</em> service.  A heartbeat service is used to check if the server on the other end is still alive.  A client would send the service a string like</p>

<pre><code>BIRD (4 letters)</code></pre>
<p>to which the server would reply with <code>BIRD</code>, and the client would know the server is alive.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Unfortunately, this service could be exploited by asking the server to reply with <em>more</em> than the requested set of letters.  This is very well explained in this <a href="https://xkcd.com/1354/">XKCD comic</a>:</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><img src="PICS/xkcd_heartbleed_1.png" alt="XKCD Comic"></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><img src="PICS/xkcd_heartbleed_2.png" alt="XKCD Comic"></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><img src="PICS/xkcd_heartbleed_3.png" alt="XKCD Comic"></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can actually simulate the bug in a Python program.  To start with, let us create some program memory filled with actual data and random data:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&lt;space for reply&gt;&quot;</span> <span class="o">+</span> <span class="n">fuzzer</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
     <span class="o">+</span> <span class="s2">&quot;&lt;secret-certificate&gt;&quot;</span> <span class="o">+</span> <span class="n">fuzzer</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
     <span class="o">+</span> <span class="s2">&quot;&lt;secret-key&gt;&quot;</span> <span class="o">+</span> <span class="n">fuzzer</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;other-secrets&gt;&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We add more "memory" characters to <code>s</code>, filled with <code>"deadbeef"</code> as marker for uninitialized memory:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">uninitialized_memory_marker</span> <span class="o">=</span> <span class="s2">&quot;deadbeef&quot;</span>
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2048</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">uninitialized_memory_marker</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We now convert this string into a modifiable list of characters.  (In C, both would be the same.)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">memory</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
    <span class="n">memory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The heartbeat service would now take a reply to be sent back, as well as a length.  It would store the reply to be sent in memory, and then send it back with the given length.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">heartbeat</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">memory</span>

    <span class="c1"># Store reply in memory</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reply</span><span class="p">)):</span>
        <span class="n">memory</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">reply</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">memory</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

    <span class="c1"># Send back heartbeat</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">memory</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">s</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This perfectly works for standard strings:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">heartbeat</span><span class="p">(</span><span class="s2">&quot;potato&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;potato&#39;
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">heartbeat</span><span class="p">(</span><span class="s2">&quot;bird&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;bird&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>However, if the length is greater than the length of the reply string, additional contents of memory spill out:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">heartbeat</span><span class="p">(</span><span class="s2">&quot;hat&quot;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;hat\n\no\nfor reply&gt;#,,!3?30&gt;#61)$4--8=&lt;7)4 )03/%,5+! &#34;4)0?.9+?3();&lt;42?=?0&lt;secret-certificate&gt;7(+/+((1)#/0\&#39;4!&gt;/&lt;#=78%6$!!$&lt;-&#34;3&#34;\&#39;-?1?85!05629%/); *)1\&#39;/=9%&lt;secret-key&gt;.(#.4%&lt;other-secrets&gt;deadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadb&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the OpenSSL implementation, these memory contents could involve cryptographic certificates, private keys, and more – and worse, no one would notice that this memory just had been accessed.  When the HeartBleed bug was discovered, it had been around for many years, and none would know whether and which secrets had already leaked.  The quickly set up <a href="http://heartbleed.com/">HeartBleed announcement page</a> said it all:</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><img src="PICS/Heartbleed-announce.png" alt="Heartbleed Announcement"></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>But how was HeartBleed discovered?  Very simple.  Researchers both at the Codenomicon company as well as with Google compiled the OpenSSL library with a memory sanitizer, and then happily flooded it with fuzzed commands.  The memory sanitizer would then notice whether uninitialized memory had been accessed – and actually, it would very quickly discover this.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can again simulate this in our Python example.  Let us simply assume that if some string contains the uninitialized memory marker, we have been accessing memory out of bounds:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="ExpectError.html" class="import" target="_blank">ExpectError</a></span> <span class="k">import</span> <span class="n">ExpectError</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">heartbeat</span><span class="p">(</span><span class="n">fuzzer</span><span class="p">(),</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">uninitialized_memory_marker</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-37-acbbca5ca20f&gt;&#34;, line 4, in &lt;module&gt;
    assert not s.find(uninitialized_memory_marker)
AssertionError (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In combination with a memory checker, this indeed would find the bug within seconds.  If only OpenSSL had been fuzzed right before release...</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As a rule of thumb, you should always <em>enable as many automatic checkers as possible</em> during fuzzing.  CPU cycles are cheap, and errors are expensive.  If you only execute the program without an option to actually detect errors, you will be missing several opportunities.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Program-Specific-Checkers">Program-Specific Checkers<a class="anchor-link" href="#Program-Specific-Checkers">&#182;</a></h3><p>Besides generic checkers that apply to <em>all</em> programs on a given platform or in a given language, you can also devise <em>specific</em> checkers that apply to your program, or a subsystem.  In the <a href="Intro_Testing.html">chapter on testing</a>, we already have hinted at techniques of <a href="Intro_Testing.ipynb#Runtime-Verification">runtime verification</a> that check function results at runtime for correctness.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>One key concept for detecting errors early is <em>assertions</em> that check the input (precondition) and the result (postcondition) of important functions.  The more assertions you have in your program, the higher your chances to detect errors during execution that would go undetected by generic checkers – notably during fuzzing.  If you worry about the impact of assertions on performance, keep in mind that assertions can be turned off in production code (although it can be helpful to leave the most critical checks active).</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>One of the most important uses of assertions for finding errors is <em>checking the integrity of complex data structures.</em>  Let us illustrate the concept using a simple example.  Suppose we have a mapping of airport codes to airports, as in</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">airport_codes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;YVR&quot;</span><span class="p">:</span> <span class="s2">&quot;Vancouver&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JFK&quot;</span><span class="p">:</span> <span class="s2">&quot;New York-JFK&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CDG&quot;</span><span class="p">:</span> <span class="s2">&quot;Paris-Charles de Gaulle&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CAI&quot;</span><span class="p">:</span> <span class="s2">&quot;Cairo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LED&quot;</span><span class="p">:</span> <span class="s2">&quot;St. Petersburg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PEK&quot;</span><span class="p">:</span> <span class="s2">&quot;Beijing&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HND&quot;</span><span class="p">:</span> <span class="s2">&quot;Tokyo-Haneda&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AKL&quot;</span><span class="p">:</span> <span class="s2">&quot;Auckland&quot;</span>
<span class="p">}</span>  <span class="c1"># plus many more</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">airport_codes</span><span class="p">[</span><span class="s2">&quot;YVR&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;Vancouver&#39;
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s2">&quot;AKL&quot;</span> <span class="ow">in</span> <span class="n">airport_codes</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>True
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This list of airport codes may be pretty critical: if we have a spelling mistake in any of the airport codes, this may impact whatever application we have.  We therefore introduce a function that checks the list for consistency.  The consistency condition is called a <em>representation invariant</em>, and functions (or methods) that check it are therefore typically named <code>repOK()</code> for "the representation is ok".</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>First, let's have a checker for individual airport codes.  The checker fails if the code is inconsistent.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">code_repOK</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Airport code must have three characters: &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">code</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">isalpha</span><span class="p">(),</span> <span class="s2">&quot;Non-letter in airport code: &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">isupper</span><span class="p">(),</span> <span class="s2">&quot;Lowercase letter in airport code: &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">code_repOK</span><span class="p">(</span><span class="s2">&quot;SEA&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now use <code>code_repOK()</code> to check all elements in the list:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">airport_codes_repOK</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">airport_codes</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">code_repOK</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">airport_codes_repOK</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If we add an invalid element to the list, our check would fail:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">airport_codes</span><span class="p">[</span><span class="s2">&quot;YMML&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Melbourne&quot;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">airport_codes_repOK</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-46-21eb3b08ef3e&gt;&#34;, line 2, in &lt;module&gt;
    assert airport_codes_repOK()
  File &#34;&lt;ipython-input-43-f8128f7dc918&gt;&#34;, line 3, in airport_codes_repOK
    assert code_repOK(code)
  File &#34;&lt;ipython-input-41-345123a45730&gt;&#34;, line 2, in code_repOK
    assert len(code) == 3, &#34;Airport code must have three characters: &#34; + repr(code)
AssertionError: Airport code must have three characters: &#39;YMML&#39; (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Of course, rather than manipulating the list directly, we'd have a special function for adding elements; this could then also check whether the code is valid:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">add_new_airport</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">city</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">code_repOK</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="n">airport_codes</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">city</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>  <span class="c1"># For BER, ExpectTimeout would be more appropriate</span>
    <span class="n">add_new_airport</span><span class="p">(</span><span class="s2">&quot;BER&quot;</span><span class="p">,</span> <span class="s2">&quot;Berlin&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This check also allows us to find out errors in argument lists:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">add_new_airport</span><span class="p">(</span><span class="s2">&quot;London-Heathrow&quot;</span><span class="p">,</span> <span class="s2">&quot;LHR&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-49-6aeb45bf2b91&gt;&#34;, line 2, in &lt;module&gt;
    add_new_airport(&#34;London-Heathrow&#34;, &#34;LHR&#34;)
  File &#34;&lt;ipython-input-47-f4d30ab4bf9e&gt;&#34;, line 2, in add_new_airport
    assert code_repOK(code)
  File &#34;&lt;ipython-input-41-345123a45730&gt;&#34;, line 2, in code_repOK
    assert len(code) == 3, &#34;Airport code must have three characters: &#34; + repr(code)
AssertionError: Airport code must have three characters: &#39;London-Heathrow&#39; (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For maximum checking, though, the <code>add_new_airport()</code> function would also ensure the correct representation of the list of airport codes – <em>before</em> and <em>after</em> changing it.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">add_new_airport</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">city</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">code_repOK</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">airport_codes_repOK</span><span class="p">()</span>
    <span class="n">airport_codes</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">city</span>
    <span class="k">assert</span> <span class="n">airport_codes_repOK</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This catches the inconsistency introduced earlier:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">add_new_airport</span><span class="p">(</span><span class="s2">&quot;IST&quot;</span><span class="p">,</span> <span class="s2">&quot;Istanbul Yeni Havalimanı&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-51-a80a619d120e&gt;&#34;, line 2, in &lt;module&gt;
    add_new_airport(&#34;IST&#34;, &#34;Istanbul Yeni Havalimanı&#34;)
  File &#34;&lt;ipython-input-50-93da9120109e&gt;&#34;, line 3, in add_new_airport
    assert airport_codes_repOK()
  File &#34;&lt;ipython-input-43-f8128f7dc918&gt;&#34;, line 3, in airport_codes_repOK
    assert code_repOK(code)
  File &#34;&lt;ipython-input-41-345123a45730&gt;&#34;, line 2, in code_repOK
    assert len(code) == 3, &#34;Airport code must have three characters: &#34; + repr(code)
AssertionError: Airport code must have three characters: &#39;YMML&#39; (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The more <code>repOK()</code> assertions exist in your code, the more errors you will catch – even those specific to only your domain and problem.  On top, such assertions document the <em>assumptions you made</em> during programming and thus help other programmers to understand your code and prevent errors.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As a final example, let us consider a rather complex data structure – a <a href="https://en.wikipedia.org/wiki/Red-black_tree">red-black tree</a>, a self-balancing binary search tree.  Implementing a red-black tree is not too hard, but getting it correct can be a task of several hours even for experienced programmers.  A <code>repOK()</code> method, however, documents all the assumptions and checks them as well:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">RedBlackTree</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">repOK</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">rootHasNoParent</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">rootIsBlack</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">rootNodesHaveOnlyBlackChildren</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">treeIsAcyclic</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">parentsAreConsistent</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">rootIsBlack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="n">BLACK</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">add_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">repOK</span><span class="p">()</span>
        <span class="c1"># Add the element</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">repOK</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">delete_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">repOK</span><span class="p">()</span>
        <span class="c1"># Delete the element</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">repOK</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here, <code>repOK()</code> is a method that runs on an object of the <code>RedBlackTree</code> class.  It runs five different checks, all of which have their own assertions.  Whenever an element is added or deleted, all these consistency checks are run automatically.  If you have an error in any of these, the checkers will find them – if you run the tree through sufficiently many fuzzed inputs, of course.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Static-Code-Checkers">Static Code Checkers<a class="anchor-link" href="#Static-Code-Checkers">&#182;</a></h3><p>Many of the benefits from <code>repOK()</code> assertions can also be obtained by using <em>static type checkers</em> on your code.  In Python, for instance, the <a href="http://mypy-lang.org">MyPy</a> static checker can find type errors as soon as types of arguments are properly declared:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/typing.html" class="import" target="_blank">typing</a></span> <span class="k">import</span> <span class="n">Dict</span>

<span class="n">airport_codes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;YVR&quot;</span><span class="p">:</span> <span class="s2">&quot;Vancouver&quot;</span><span class="p">,</span>  <span class="c1"># etc</span>
<span class="p">}</span>  <span class="c1"># type: Dict[str, str]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If we now add a key with a non-string type, as in</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">airport_codes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;First&quot;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>this would be caught by MyPy immediately:</p>
<div class="highlight"><pre><span></span>$ mypy airports.py
airports.py: error: Invalid index <span class="nb">type</span> <span class="s2">&quot;int&quot;</span> <span class="k">for</span> <span class="s2">&quot;Dict[str, str]&quot;</span><span class="p">;</span> expected <span class="nb">type</span> <span class="s2">&quot;str&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Statically checking more advanced properties such as the airport code consisting of exactly three uppercase characters or a tree being acyclic, however, quickly reach the limits of static checking.  Your <code>repOK()</code> assertions will still be needed – best in conjunction with a good test generator.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="A-Fuzzing-Architecture">A Fuzzing Architecture<a class="anchor-link" href="#A-Fuzzing-Architecture">&#182;</a></h2><p>Since we'd like to reuse some parts of this chapter in the following ones, let us define things in a way that are easier to reuse, and in particular easier to <em>extend</em>.  To this end, we introduce a number of <em>classes</em> that encapsulate the functionality above in a reusable way.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Runner-Classes">Runner Classes<a class="anchor-link" href="#Runner-Classes">&#182;</a></h3><p>The first thing we introduce is the notion of a <code>Runner</code> – that is, an object whose job it is to execute some object with a given input.  A runner typically is some program or function under test, but we can also have simpler runners.</p>
<p>Let us start with a base class for runners.  A runner essentially provides a method <code>run(input)</code> that is used to pass <code>input</code> (a string) to the runner.  <code>run()</code> returns a pair (<code>result</code>, <code>outcome</code>).  Here, <code>result</code> is a runner-specific value that gives details on the run; <code>outcome</code> is a value that classifies the result in three categories:</p>
<ul>
<li><code>Runner.PASS</code> – the test <em>passed</em>.  The run produced correct results.</li>
<li><code>Runner.FAIL</code> – the test <em>failed</em>.  The run produced incorrect results.</li>
<li><code>Runner.UNRESOLVED</code> – the test neither passed nor failed.  This happens if the run could not take place – for instance, because the input was invalid.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Runner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1"># Test outcomes</span>
    <span class="n">PASS</span> <span class="o">=</span> <span class="s2">&quot;PASS&quot;</span>
    <span class="n">FAIL</span> <span class="o">=</span> <span class="s2">&quot;FAIL&quot;</span>
    <span class="n">UNRESOLVED</span> <span class="o">=</span> <span class="s2">&quot;UNRESOLVED&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the runner with the given input&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">Runner</span><span class="o">.</span><span class="n">UNRESOLVED</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>A more interesting class is <code>PrintRunner</code>, which simply prints out everything that is given to it.  This is the default runner in many situations.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">PrintRunner</span><span class="p">(</span><span class="n">Runner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print the given input&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">Runner</span><span class="o">.</span><span class="n">UNRESOLVED</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">PrintRunner</span><span class="p">()</span>
<span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;Some input&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Some input
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The result is just the string we passed as input:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;Some input&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Still, at this point, we have no way to classify program behavior:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">outcome</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;UNRESOLVED&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>ProgramRunner</code> class sends the input to the standard input of a program instead.  The program is specified when creating a <code>ProgramRunner</code> object.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ProgramRunner</span><span class="p">(</span><span class="n">Runner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize.  `program` is a program spec as passed to `subprocess.run()`&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">program</span> <span class="o">=</span> <span class="n">program</span>

    <span class="k">def</span> <span class="nf">run_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the program with `inp` as input.  Return result of `subprocess.run()`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program</span><span class="p">,</span>
                              <span class="nb">input</span><span class="o">=</span><span class="n">inp</span><span class="p">,</span>
                              <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                              <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                              <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the program with `inp` as input.  Return test outcome based on result of `subprocess.run()`.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_process</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PASS</span>
        <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FAIL</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNRESOLVED</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's a variant for binary (i.e., non-textual) input and output.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">BinaryProgramRunner</span><span class="p">(</span><span class="n">ProgramRunner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the program with `inp` as input.  Return result of `subprocess.run()`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program</span><span class="p">,</span>
                              <span class="nb">input</span><span class="o">=</span><span class="n">inp</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
                              <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                              <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us demonstrate a <code>ProgramRunner</code> using the <code>cat</code> program – a program that copies its input to its output.  We see that a standard invocation of <code>cat</code> simply does the job, with the output of <code>cat</code> being the same as its input:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cat</span> <span class="o">=</span> <span class="n">ProgramRunner</span><span class="p">(</span><span class="n">program</span><span class="o">=</span><span class="s2">&quot;cat&quot;</span><span class="p">)</span>
<span class="n">cat</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>(CompletedProcess(args=&#39;cat&#39;, returncode=0, stdout=&#39;hello&#39;, stderr=&#39;&#39;), &#39;PASS&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Fuzzer-Classes">Fuzzer Classes<a class="anchor-link" href="#Fuzzer-Classes">&#182;</a></h3><p>Let us now define <em>fuzzers</em> that actually feed data into a consumer.  The base class for fuzzers provides one central method <code>fuzz()</code> that creates some input.  The <code>run()</code> function then sends the fuzz() input to a runner, returning the outcome; <code>runs()</code> does this for a given number (<code>trials</code>) of times.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Fuzzer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">fuzz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return fuzz input&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="o">=</span><span class="n">Runner</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;Run `runner` with fuzz input&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">runs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="o">=</span><span class="n">PrintRunner</span><span class="p">(),</span> <span class="n">trials</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run `runner` with fuzz input, `trials` times&quot;&quot;&quot;</span>
        <span class="c1"># Note: the list comprehension below does not invoke self.run() for subclasses</span>
        <span class="c1"># return [self.run(runner) for i in range(trials)]</span>
        <span class="n">outcomes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
            <span class="n">outcomes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">runner</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">outcomes</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>By default, <code>Fuzzer</code> objects do not do much, as their <code>fuzz()</code> function is merely an abstract placeholder.  The subclass <code>RandomFuzzer</code>, however, implements the functionality of the <code>fuzzer()</code> function, above, adding an additional parameter <code>min_length</code> to specify a minimum length.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">RandomFuzzer</span><span class="p">(</span><span class="n">Fuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                 <span class="n">char_start</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">char_range</span><span class="o">=</span><span class="mi">32</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_length</span> <span class="o">=</span> <span class="n">min_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_length</span> <span class="o">=</span> <span class="n">max_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">char_start</span> <span class="o">=</span> <span class="n">char_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">char_range</span> <span class="o">=</span> <span class="n">char_range</span>

    <span class="k">def</span> <span class="nf">fuzz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A string of `min_length` to `max_length` characters</span>
<span class="sd">           in the range [`char_start`, `char_start` + `char_range`]&quot;&quot;&quot;</span>
        <span class="n">string_length</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">string_length</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">char_start</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">char_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">char_range</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">out</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With <code>RandomFuzzer</code>, we can now create a fuzzer whose configuration needs to be specified only once when creating the fuzzer.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">random_fuzzer</span> <span class="o">=</span> <span class="n">RandomFuzzer</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">random_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&#39;&gt;23&gt;33)(&amp;&#34;09.377.*3
*+:5 ? (?1$4&lt;&gt;!?3&gt;.&#39;
4+3/(3 (0%!&gt;!(+9%,#$
/51$2964&gt;;)2417&lt;9&#34;2&amp;
907.. !7:&amp;--&#34;=$7&#39;,7*
(5=5&#39;.!*+&amp;&gt;&#34;)6%9)=,/
?:&amp;5) &#34;;.0!=6&gt;3+&gt;)=,
6&amp;,?:!#2))- ?:)=63&#39;-
,)9#839%)?&amp;(0&lt;6(&#34;*;)
4?!(49+8=-&#39;&amp;499%?&lt; &#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now send such generated inputs to our previously defined <code>cat</code> runner, verifying that <code>cat</code> actually does copy its (fuzzed) input to its output.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">inp</span> <span class="o">=</span> <span class="n">random_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
    <span class="n">result</span><span class="p">,</span> <span class="n">outcome</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span> <span class="o">==</span> <span class="n">inp</span>
    <span class="k">assert</span> <span class="n">outcome</span> <span class="o">==</span> <span class="n">Runner</span><span class="o">.</span><span class="n">PASS</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Combining a <code>Fuzzer</code> with a <code>Runner</code>, however, is so common that we can use the <code>run()</code> method supplied by the <code>Fuzzer</code> class for this purpose:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">random_fuzzer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>(CompletedProcess(args=&#39;cat&#39;, returncode=0, stdout=&#39;?:+= % &lt;1&lt;6$:(&gt;=:9)5&#39;, stderr=&#39;&#39;),
 &#39;PASS&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With <code>runs()</code>, we can repeat a fuzzing run a number of times, obtaining a list of results.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">random_fuzzer</span><span class="o">.</span><span class="n">runs</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[(CompletedProcess(args=&#39;cat&#39;, returncode=0, stdout=&#39;3976%%&amp;+%6=(1)3&amp;3:&lt;9&#39;, stderr=&#39;&#39;),
  &#39;PASS&#39;),
 (CompletedProcess(args=&#39;cat&#39;, returncode=0, stdout=&#39;33$#42$ 11=*%$20=&lt;.-&#39;, stderr=&#39;&#39;),
  &#39;PASS&#39;),
 (CompletedProcess(args=&#39;cat&#39;, returncode=0, stdout=&#39;&#34;?&lt;\&#39;#8 &lt;/:*%9.--\&#39;97!&#39;, stderr=&#39;&#39;),
  &#39;PASS&#39;),
 (CompletedProcess(args=&#39;cat&#39;, returncode=0, stdout=&#34;/0-#(03/!#60&#39;+6&gt;&amp;&amp;72&#34;, stderr=&#39;&#39;),
  &#39;PASS&#39;),
 (CompletedProcess(args=&#39;cat&#39;, returncode=0, stdout=&#34;=,+:,6&#39;5:950+&gt;&lt;3(*()&#34;, stderr=&#39;&#39;),
  &#39;PASS&#39;),
 (CompletedProcess(args=&#39;cat&#39;, returncode=0, stdout=&#34; 379+0?&#39;%3137=2:4605&#34;, stderr=&#39;&#39;),
  &#39;PASS&#39;),
 (CompletedProcess(args=&#39;cat&#39;, returncode=0, stdout=&#34;02&gt;!$&lt;/&#39;*81.#&lt;/22&gt;+:&#34;, stderr=&#39;&#39;),
  &#39;PASS&#39;),
 (CompletedProcess(args=&#39;cat&#39;, returncode=0, stdout=&#34;=-&lt;&#39;3-#88*%&amp;*9&lt; +1&amp;&amp;&#34;, stderr=&#39;&#39;),
  &#39;PASS&#39;),
 (CompletedProcess(args=&#39;cat&#39;, returncode=0, stdout=&#39;2;;0=3&amp;6=8&amp;30&amp;&lt;-;?*;&#39;, stderr=&#39;&#39;),
  &#39;PASS&#39;),
 (CompletedProcess(args=&#39;cat&#39;, returncode=0, stdout=&#39;/#05=*3($&gt;::#7!0=12+&#39;, stderr=&#39;&#39;),
  &#39;PASS&#39;)]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With this, we have all in place to create fuzzers – starting with the simple random fuzzers introduced in this chapter, but even far more advanced ones.  Stay tuned!</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned<a class="anchor-link" href="#Lessons-Learned">&#182;</a></h2><ul>
<li>Randomly generating inputs ("fuzzing") is a simple, cost-effective way to quickly test arbitrary programs for their robustness.</li>
<li>Bugs fuzzers find are mainly due to errors and deficiencies in <em>input processing</em>.</li>
<li>To catch errors, have as many <em>consistency checkers</em> as possible.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We're done, so don't forget to clean up:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">FILE</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">removedirs</span><span class="p">(</span><span class="n">tempdir</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps<a class="anchor-link" href="#Next-Steps">&#182;</a></h2><p>From here, you can explore how to</p>
<ul>
<li><a href="MutationFuzzer.html">use <em>mutations</em> on existing inputs to get more valid inputs</a></li>
<li><a href="Grammars.html">use <em>grammars</em> to specify the input format and thus get many more valid inputs</a></li>
<li><a href="Reducer.html">reduce <em>failing inputs</em> for efficient debugging</a></li>
</ul>
<p>Enjoy the read!</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Background">Background<a class="anchor-link" href="#Background">&#182;</a></h2><p>Books on generating software tests in general are scarce (which is why we wrote this book).  There are a few notable books on <em>fuzzing,</em> though, also based on the basic fuzzing techniques introduced in this chapter:</p>
<ul>
<li><p>The book "Fuzzing – Brute Force Vulnerability Discovery"  covers a wide range of fuzzing domains, including files, Web pages, environment variables, and network protocols.  The authors bring in lots of experience from fuzzing at Microsoft, and include a number of ready-made tools for Windows and UNIX programs.  The tools have aged somewhat, but the principles remain.</p>
</li>
<li><p>The book "Fuzzing for Software Security Testing and Quality Assurance" [<a href="http://us.artechhouse.com/Fuzzing-for-Software-Security-Testing-and-Quality-Assurance-Second-Edition-P1930.aspx">Takanen <em>et al</em>, 2008.</a>], now in its second edition 2018, covers a wide range of fuzzing tools and detection techniques; its authors bring in plenty of experience from security testing and vulnerability discovery.  This is arguably one of the most comprehensive and up-to-date books on the field.</p>
</li>
</ul>
<p>Specifically for this chapter, the seminal work on fuzzing, introducing both the term and the approach, is "An Empirical Study of the Reliability of UNIX Utilities" [<a href="https://doi.org/10.1145/96267.96279">Miller <em>et al</em>, 1990.</a>].  As the foundation for the field, this is a must-read for anyone interested in fuzzing and robustness testing, with observations as valid today as they were 30 years ago.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises<a class="anchor-link" href="#Exercises">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>One of the errors found by Miller et al. [<a href="https://doi.org/10.1145/96267.96279">Miller <em>et al</em>, 1990.</a>] involves the <em>troff</em> typesetting system.  <em>Troff</em> takes as input a text consisting of lines; a line beginning with a dot (<code>.</code>) includes typesetting commands, as in</p>

<pre><code>.NH
Some Heading
.LP
Some paragraph</code></pre>
<p>which would produce (using <code>nroff -ms</code>) the text</p>

<pre><code>1.  Some Heading

Some paragraph</code></pre>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>At the time of Miller et al., <em>troff</em> would fail if its input included</p>
<ol>
<li>The input sequence <code>\D</code> (backslash + D) followed by a non-printable character</li>
<li>A single character of 8-bit input, followed by a newline character</li>
<li>A single dot (<code>.</code>), followed by a newline character.</li>
</ol>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1:-Simulate-Troff">Exercise 1: Simulate Troff<a class="anchor-link" href="#Exercise-1:-Simulate-Troff">&#182;</a></h3><p>For each of the above, write a Python function <code>f(s)</code> that fails if <code>s</code> fulfills the failure criterion.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2:-Run-Simulated-Troff">Exercise 2: Run Simulated Troff<a class="anchor-link" href="#Exercise-2:-Run-Simulated-Troff">&#182;</a></h3><p>Create a class <code>TroffRunner</code> as subclass of <code>Runner</code> that checks for the above predicates.  Run it with <code>Fuzzer</code>.  Be sure to have the <code>Fuzzer</code> object produce the entire range of characters.  Count how frequently the individual predicates fail.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-3:-Run-Real-Troff">Exercise 3: Run Real Troff<a class="anchor-link" href="#Exercise-3:-Run-Real-Troff">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Using <code>BinaryProgramRunner</code>, apply the fuzzer you configured on the real <code>troff</code> program.  Check if you can produce any run whose output code is non-zero, indicating a failure or a crash.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Getting-Coverage">Getting Coverage<a class="anchor-link" href="#Getting-Coverage">&#182;</a></h1><p>In the <a href="Fuzzer.html">previous chapter</a>, we introduced <em>basic fuzzing</em> – that is, generating random inputs to test programs.  How do we measure the effectiveness of these tests?  One way would be to check the number (and seriousness) of bugs found; but if bugs are scarce, we need a <em>proxy for the likelihood of a test to uncover a bug.</em>  In this chapter, we introduce the concept of <em>code coverage</em>, measuring which parts of a program are actually executed during a test run.  Measuring such coverage is also crucial for test generators that attempt to cover as much code as possible.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>You need some understanding of how a program is executed.</li>
<li>You should have learned about basic fuzzing in the <a href="Fuzzer.html">previous chapter</a>.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="A-CGI-Decoder">A CGI Decoder<a class="anchor-link" href="#A-CGI-Decoder">&#182;</a></h2><p>We start by introducing a simple Python function that decodes a CGI-encoded string.  CGI encoding is used in URLs (i.e., Web addresses) to encode characters that would be invalid in a URL, such as blanks and certain punctuation:</p>
<ul>
<li>Blanks are replaced by <code>'+'</code></li>
<li>Other invalid characters are replaced by '<code>%xx</code>', where <code>xx</code> is the two-digit hexadecimal equivalent.</li>
</ul>
<p>In CGI encoding, the string <code>"Hello, world!"</code> would thus become <code>"Hello%2c+world%21"</code> where <code>2c</code> and <code>21</code> are the hexadecimal numbers of <code>','</code> and <code>'!'</code>, respectively.</p>
<p>The function <code>cgi_decode()</code> takes such an encoded string and decodes it back to its original form.  Our implementation replicates the code from [<a href="http://ix.cs.uoregon.edu/~michal/book/">Pezzè <em>et al</em>, 2008.</a>].  (It even includes its bugs – but we won't reveal them at this point.)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">cgi_decode</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decode the CGI-encoded string `s`:</span>
<span class="sd">       * replace &quot;+&quot; by &quot; &quot;</span>
<span class="sd">       * replace &quot;%xx&quot; by the character with hex number xx.</span>
<span class="sd">       Return the decoded string.  Raise `ValueError` for invalid inputs.&quot;&quot;&quot;</span>

    <span class="c1"># Mapping of hex digits to their integer values</span>
    <span class="n">hex_values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;0&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s1">&#39;5&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;7&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;8&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
        <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
        <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">t</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;%&#39;</span><span class="p">:</span>
            <span class="n">digit_high</span><span class="p">,</span> <span class="n">digit_low</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">digit_high</span> <span class="ow">in</span> <span class="n">hex_values</span> <span class="ow">and</span> <span class="n">digit_low</span> <span class="ow">in</span> <span class="n">hex_values</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">hex_values</span><span class="p">[</span><span class="n">digit_high</span><span class="p">]</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">hex_values</span><span class="p">[</span><span class="n">digit_low</span><span class="p">]</span>
                <span class="n">t</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid encoding&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="n">c</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">t</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here is an example of how <code>cgi_decode()</code> works:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cgi_decode</span><span class="p">(</span><span class="s2">&quot;Hello+world&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;Hello world&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If we want to systematically test <code>cgi_decode()</code>, how would we proceed?</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The testing literature distinguishes two ways of deriving tests: <em>Black-box testing</em> and <em>White-box testing.</em></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Black-Box-Testing">Black-Box Testing<a class="anchor-link" href="#Black-Box-Testing">&#182;</a></h2><p>The idea of <em>black-box testing</em> is to derive tests from the <em>specification</em>.  In the above case, we thus would have to test <code>cgi_decode()</code> by the features specified and documented, including</p>
<ul>
<li>testing for correct replacement of <code>'+'</code>;</li>
<li>testing for correct replacement of <code>"%xx"</code>;</li>
<li>testing for non-replacement of other characters; and</li>
<li>testing for recognition of illegal inputs.</li>
</ul>
<p>Here are four assertions (tests) that cover these four features.  We can see that they all pass:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">cgi_decode</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span>
<span class="k">assert</span> <span class="n">cgi_decode</span><span class="p">(</span><span class="s1">&#39;%20&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span>
<span class="k">assert</span> <span class="n">cgi_decode</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;abc&#39;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">cgi_decode</span><span class="p">(</span><span class="s1">&#39;%?a&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="kc">False</span>
<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The advantage of black-box testing is that it finds errors in the <em>specified</em> behavior.  It is independent from a given implementation, and thus allows to create test even before implementation.  The downside is that <em>implemented</em> behavior typically covers more ground than <em>specified</em> behavior, and thus tests based on specification alone typically do not cover all implementation details.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="White-Box-Testing">White-Box Testing<a class="anchor-link" href="#White-Box-Testing">&#182;</a></h2><p>In contrast to black-box testing, white-box testing derives tests from the <em>implementation</em>, notably the internal structure.  White-Box testing is closely tied to the concept of <em>covering</em> structural features of the code.  If a statement in the code is not executed during testing, for instance, this means that an error in this statement cannot be triggered either.  White-Box testing thus introduces a number of <em>coverage criteria</em> that have to be fulfilled before the test can be said to be sufficient.  The most frequently used coverage criteria are</p>
<ul>
<li><strong>Statement testing</strong> – each statement in the code must be executed at least once.</li>
<li><strong>Branch testing</strong> – each branch in the code must be taken at least once.  (This translates to each <code>if</code> and <code>while</code> decision once being true, and once being false.)</li>
</ul>
<p>Besides these, there are far more coverage criteria, including sequences of branches taken, loop iterations taken (zero, one, many), data flows between variable definitions and usages, and many more; [<a href="http://ix.cs.uoregon.edu/~michal/book/">Pezzè <em>et al</em>, 2008.</a>] has a great overview.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us consider <code>cgi_decode()</code>, above, and reason what we have to do such that each statement of the code is executed at least once.  We'd have to cover</p>
<ul>
<li>The block following <code>if c == '+'</code></li>
<li>The two blocks following <code>if c == '%'</code> (one for valid input, one for invalid)</li>
<li>The final <code>else</code> case for all other characters.</li>
</ul>
<p>This results in the same conditions as with black-box testing, above; again, the assertions above indeed would cover every statement in the code.  Such a correspondence is actually pretty common, since programmers tend to implement different behaviors in different code locations; and thus, covering these locations will lead to test cases that cover the different (specified) behaviors.</p>
<p>The advantage of white-box testing is that it finds errors in <em>implemented</em> behavior.  It can be conducted even in cases where the specification does not provide sufficient details; actually, it helps in identifying (and thus specifying) corner cases in the specification.  The downside is that it may miss <em>non-implemented</em> behavior: If some specified functionality is missing, white-box testing will not find it.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Tracing-Executions">Tracing Executions<a class="anchor-link" href="#Tracing-Executions">&#182;</a></h2><p>One nice feature of white-box testing is that one can actually automatically assess whether some program feature was covered.  To this end, one <em>instruments</em> the execution of the program such that during execution, a special functionality keeps track of which code was executed.  After testing, this information can be passed to the programmer, who can then focus on writing tests that cover the yet uncovered code.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In most programming languages, it is rather difficult to set up programs such that one can trace their execution.  Not so in Python.  The function <code>sys.settrace(f)</code> allows to define a function <code>f()</code> that is called for each and every line executed.  Even better, it gets access to the current function and its name, current variable contents, and more.  It is thus an ideal tool for <em>dynamic analysis</em> – that is, the analysis of what actually happens during an execution.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To illustrate how this works, let us again look into a specific execution of <code>cgi_decode()</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cgi_decode</span><span class="p">(</span><span class="s2">&quot;a+b&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;a b&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To track how the execution proceeds through <code>cgi_decode()</code>, we make use of <code>sys.settrace()</code>.  First, we define the <em>tracing function</em> that will be called for each line.  It has three parameters:</p>
<ul>
<li>The <code>frame</code> parameter gets you the current <em>frame</em>, allowing access to the current location and variables:<ul>
<li><code>frame.f_code</code> gets you the currently executed code with <code>frame.f_code.co_name</code> being the function name;</li>
<li><code>frame.f_lineno</code> gets you the current line number; and</li>
<li><code>frame.f_locals</code> gets you the current local variables and arguments.</li>
</ul>
</li>
<li>The <code>event</code> parameter is a string with values including <code>"line"</code> (a new line has been reached) or <code>"call"</code> (a function is being called).</li>
<li>The <code>arg</code> parameter is an additional <em>argument</em> for some events; for <code>"return"</code> events, for instance, <code>arg</code> holds the value being returned.</li>
</ul>
<p>We use the tracing function for simply reporting the current line executed, which we access through the <code>frame</code> argument.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">coverage</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">traceit</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s2">&quot;line&quot;</span><span class="p">:</span>
        <span class="k">global</span> <span class="n">coverage</span>
        <span class="n">function_name</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_lineno</span>
        <span class="n">coverage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lineno</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">traceit</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can switch tracing on and off with <code>sys.settrace()</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/sys.html" class="import" target="_blank">sys</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">cgi_decode_traced</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">coverage</span>
    <span class="n">coverage</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="n">traceit</span><span class="p">)</span>
    <span class="n">cgi_decode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>When we compute <code>cgi_decode("a+b")</code>, we can now see how the execution progresses through <code>cgi_decode()</code>.  After the initialization of <code>hex_values</code>, <code>t</code>, and <code>i</code>, we see that the <code>while</code> loop is taken three times – one for every character in the input.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cgi_decode_traced</span><span class="p">(</span><span class="s2">&quot;a+b&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">coverage</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[9, 10, 11, 12, 15, 16, 17, 18, 19, 21, 30, 31, 17, 18, 19, 20, 31, 17, 18, 19, 21, 30, 31, 17, 32]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Which lines are these, actually?  To this end, we encode the source code into an array <code>cgi_decode_lines</code>.  (An actual coverage tool could also access the source code file directly.)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cgi_decode_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">def cgi_decode(s):</span>
<span class="s2">    </span><span class="se">\&quot;\&quot;\&quot;</span><span class="s2">Decode the CGI-encoded string `s`:</span>
<span class="s2">       * replace &quot;+&quot; by &quot; &quot;</span>
<span class="s2">       * replace &quot;</span><span class="si">%x</span><span class="s2">x&quot; by the character with hex number xx.</span>
<span class="s2">       Return the decoded string.  Raise `ValueError` for invalid inputs.</span><span class="se">\&quot;\&quot;\&quot;</span><span class="s2"></span>

<span class="s2">    # Mapping of hex digits to their integer values</span>
<span class="s2">    hex_values = {</span>
<span class="s2">        &#39;0&#39;: 0, &#39;1&#39;: 1, &#39;2&#39;: 2, &#39;3&#39;: 3, &#39;4&#39;: 4,</span>
<span class="s2">        &#39;5&#39;: 5, &#39;6&#39;: 6, &#39;7&#39;: 7, &#39;8&#39;: 8, &#39;9&#39;: 9,</span>
<span class="s2">        &#39;a&#39;: 10, &#39;b&#39;: 11, &#39;c&#39;: 12, &#39;d&#39;: 13, &#39;e&#39;: 14, &#39;f&#39;: 15,</span>
<span class="s2">        &#39;A&#39;: 10, &#39;B&#39;: 11, &#39;C&#39;: 12, &#39;D&#39;: 13, &#39;E&#39;: 14, &#39;F&#39;: 15,</span>
<span class="s2">    }</span>

<span class="s2">    t = &quot;&quot;</span>
<span class="s2">    i = 0</span>
<span class="s2">    while i &lt; len(s):</span>
<span class="s2">        c = s[i]</span>
<span class="s2">        if c == &#39;+&#39;:</span>
<span class="s2">            t += &#39; &#39;</span>
<span class="s2">        elif c == &#39;%&#39;:</span>
<span class="s2">            digit_high, digit_low = s[i + 1], s[i + 2]</span>
<span class="s2">            i += 2</span>
<span class="s2">            if digit_high in hex_values and digit_low in hex_values:</span>
<span class="s2">                v = hex_values[digit_high] * 16 + hex_values[digit_low]</span>
<span class="s2">                t += chr(v)</span>
<span class="s2">            else:</span>
<span class="s2">                raise ValueError(&quot;Invalid encoding&quot;)</span>
<span class="s2">        else:</span>
<span class="s2">            t += c</span>
<span class="s2">        i += 1</span>
<span class="s2">    return t</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">cgi_decode_lines</span> <span class="o">=</span> <span class="n">cgi_decode_code</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that the first line (9) executed is actually the initialization of <code>hex_values</code>...</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cgi_decode_lines</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#34;        &#39;0&#39;: 0, &#39;1&#39;: 1, &#39;2&#39;: 2, &#39;3&#39;: 3, &#39;4&#39;: 4,&#34;,
 &#34;        &#39;5&#39;: 5, &#39;6&#39;: 6, &#39;7&#39;: 7, &#39;8&#39;: 8, &#39;9&#39;: 9,&#34;,
 &#34;        &#39;a&#39;: 10, &#39;b&#39;: 11, &#39;c&#39;: 12, &#39;d&#39;: 13, &#39;e&#39;: 14, &#39;f&#39;: 15,&#34;,
 &#34;        &#39;A&#39;: 10, &#39;B&#39;: 11, &#39;C&#39;: 12, &#39;D&#39;: 13, &#39;E&#39;: 14, &#39;F&#39;: 15,&#34;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>... followed by the initialization of <code>t</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cgi_decode_lines</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;    t = &#34;&#34;&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To see which lines actually have been covered at least once, we can convert <code>coverage</code> into a set:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">covered_lines</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">coverage</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">covered_lines</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{32, 9, 10, 11, 12, 15, 16, 17, 18, 19, 20, 21, 30, 31}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us print out the code, annotating lines not covered with '#':</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">lineno</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cgi_decode_lines</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">lineno</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">covered_lines</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%2d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">cgi_decode_lines</span><span class="p">[</span><span class="n">lineno</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>#  1 def cgi_decode(s):
#  2     &#34;&#34;&#34;Decode the CGI-encoded string `s`:
#  3        * replace &#34;+&#34; by &#34; &#34;
#  4        * replace &#34;%xx&#34; by the character with hex number xx.
#  5        Return the decoded string.  Raise `ValueError` for invalid inputs.&#34;&#34;&#34;
#  6 
#  7     # Mapping of hex digits to their integer values
#  8     hex_values = {
   9         &#39;0&#39;: 0, &#39;1&#39;: 1, &#39;2&#39;: 2, &#39;3&#39;: 3, &#39;4&#39;: 4,
  10         &#39;5&#39;: 5, &#39;6&#39;: 6, &#39;7&#39;: 7, &#39;8&#39;: 8, &#39;9&#39;: 9,
  11         &#39;a&#39;: 10, &#39;b&#39;: 11, &#39;c&#39;: 12, &#39;d&#39;: 13, &#39;e&#39;: 14, &#39;f&#39;: 15,
  12         &#39;A&#39;: 10, &#39;B&#39;: 11, &#39;C&#39;: 12, &#39;D&#39;: 13, &#39;E&#39;: 14, &#39;F&#39;: 15,
# 13     }
# 14 
  15     t = &#34;&#34;
  16     i = 0
  17     while i &lt; len(s):
  18         c = s[i]
  19         if c == &#39;+&#39;:
  20             t += &#39; &#39;
  21         elif c == &#39;%&#39;:
# 22             digit_high, digit_low = s[i + 1], s[i + 2]
# 23             i += 2
# 24             if digit_high in hex_values and digit_low in hex_values:
# 25                 v = hex_values[digit_high] * 16 + hex_values[digit_low]
# 26                 t += chr(v)
# 27             else:
# 28                 raise ValueError(&#34;Invalid encoding&#34;)
# 29         else:
  30             t += c
  31         i += 1
  32     return t
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that a number of lines (notably comments) have not been executed, simply because they are not executable.  However, we also see that the lines under <code>if c == '%'</code> have <em>not</em> been executed yet.  If <code>"a+b"</code> were our only test case so far, this missing coverage would now encourage us to create another test case that actually covers these lines.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="A-Coverage-Class">A Coverage Class<a class="anchor-link" href="#A-Coverage-Class">&#182;</a></h2><p>In this book, we will make use of coverage again and again – to <em>measure</em> the effectiveness of different test generation techniques, but also to <em>guide</em> test generation towards code coverage.  Our previous implementation with a global <code>coverage</code> variable is a bit cumbersome for that.  We therefore implement some functionality that will help us measuring coverage easily.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The key idea of getting coverage is to make use of the Python <code>with</code> statement.  The general form</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">OBJECT</span> <span class="p">[</span><span class="k">as</span> <span class="n">VARIABLE</span><span class="p">]:</span>
    <span class="n">BODY</span>
</pre></div>
<p>executes <code>BODY</code> with <code>OBJECT</code> being defined (and stored in <code>VARIABLE</code>).  The interesting thing is that at the beginning and end of <code>BODY</code>, the special methods <code>OBJECT.__enter__()</code> and <code>OBJECT.__exit__()</code> are automatically invoked; even if <code>BODY</code> raises an exception.  This allows us to define a <code>Coverage</code> object where <code>Coverage.__enter__()</code> automatically turns on tracing and <code>Coverage.__exit__()</code> automatically turns off tracing again.  After tracing, we can make use of special methods to access the coverage.  This is what this looks like during usage:</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Coverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
    <span class="n">function_to_be_traced</span><span class="p">()</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">coverage</span><span class="p">()</span>
</pre></div>
<p>Here, tracing is automatically turned on during <code>function_to_be_traced()</code> and turned off again after the <code>with</code> block; afterwards, we can access the set of lines executed.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's the full implementation with all its bells and whistles.  You don't have to get everything; it suffices that you know how to use it:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Coverage</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1"># Trace function</span>
    <span class="k">def</span> <span class="nf">traceit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_trace_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">original_trace_function</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s2">&quot;line&quot;</span><span class="p">:</span>
            <span class="n">function_name</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_lineno</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">function_name</span><span class="p">,</span> <span class="n">lineno</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">traceit</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Start of `with` block</span>
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_trace_function</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">gettrace</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">traceit</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># End of `with` block</span>
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_trace_function</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The list of executed lines, as (function_name, line_number) pairs&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span>

    <span class="k">def</span> <span class="nf">coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The set of executed lines, as (function_name, line_number) pairs&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us put this to use:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">Coverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
    <span class="n">cgi_decode</span><span class="p">(</span><span class="s2">&quot;a+b&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">cov</span><span class="o">.</span><span class="n">coverage</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{(&#39;cgi_decode&#39;, 20), (&#39;cgi_decode&#39;, 21), (&#39;cgi_decode&#39;, 32), (&#39;cgi_decode&#39;, 15), (&#39;cgi_decode&#39;, 12), (&#39;__exit__&#39;, 25), (&#39;cgi_decode&#39;, 18), (&#39;cgi_decode&#39;, 19), (&#39;cgi_decode&#39;, 30), (&#39;cgi_decode&#39;, 16), (&#39;cgi_decode&#39;, 31), (&#39;cgi_decode&#39;, 10), (&#39;cgi_decode&#39;, 17), (&#39;cgi_decode&#39;, 11), (&#39;cgi_decode&#39;, 9)}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As you can see, the <code>Coverage()</code> class not only keeps track of lines executed, but also of function names.  This is useful if you have a program that spans multiple files.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Comparing-Coverage">Comparing Coverage<a class="anchor-link" href="#Comparing-Coverage">&#182;</a></h2><p>Since we represent coverage as a set of executed lines, we can also apply <em>set operations</em> on these.  For instance, we can find out which lines are covered by individual test cases, but not others:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">Coverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov_plus</span><span class="p">:</span>
    <span class="n">cgi_decode</span><span class="p">(</span><span class="s2">&quot;a+b&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">Coverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov_standard</span><span class="p">:</span>
    <span class="n">cgi_decode</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">)</span>

<span class="n">cov_plus</span><span class="o">.</span><span class="n">coverage</span><span class="p">()</span> <span class="o">-</span> <span class="n">cov_standard</span><span class="o">.</span><span class="n">coverage</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{(&#39;cgi_decode&#39;, 20)}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is the single line in the code that is executed only in the <code>'a+b'</code> input.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can also compare sets to find out which lines still need to be covered.  Let us define <code>cov_max</code> as the maximum coverage we can achieve. (Here, we do this by executing the "good" test cases we already have.  In practice, one would statically analyze code structure, which we introduce in <a href="SymbolicFuzzer.html">the chapter on symbolic testing</a>.)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">Coverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov_max</span><span class="p">:</span>
    <span class="n">cgi_decode</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
    <span class="n">cgi_decode</span><span class="p">(</span><span class="s1">&#39;%20&#39;</span><span class="p">)</span>
    <span class="n">cgi_decode</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cgi_decode</span><span class="p">(</span><span class="s1">&#39;%?a&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Then, we can easily see which lines are <em>not</em> yet covered by a test case:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cov_max</span><span class="o">.</span><span class="n">coverage</span><span class="p">()</span> <span class="o">-</span> <span class="n">cov_plus</span><span class="o">.</span><span class="n">coverage</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{(&#39;cgi_decode&#39;, 22),
 (&#39;cgi_decode&#39;, 23),
 (&#39;cgi_decode&#39;, 24),
 (&#39;cgi_decode&#39;, 25),
 (&#39;cgi_decode&#39;, 26),
 (&#39;cgi_decode&#39;, 28)}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Again, these would be the lines handling <code>"%xx"</code>, which we have not yet had in the input.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Coverage-of-Basic-Fuzzing">Coverage of Basic Fuzzing<a class="anchor-link" href="#Coverage-of-Basic-Fuzzing">&#182;</a></h2><p>We can now use our coverage tracing to assess the <em>effectiveness</em> of testing methods – in particular, of course, test <em>generation</em> methods.  Our challenge is to achieve maximum coverage in <code>cgi_decode()</code> just with random inputs.  In principle, we should <em>eventually</em> get there, as eventually, we will have produced every possible string in the universe – but exactly how long is this?  To this end, let us run just one fuzzing iteration on <code>cgi_decode()</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Fuzzer.html" class="import" target="_blank">Fuzzer</a></span> <span class="k">import</span> <span class="n">fuzzer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sample</span> <span class="o">=</span> <span class="n">fuzzer</span><span class="p">()</span>
<span class="n">sample</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;!7#%&#34;*#0=)$;%6*;&gt;638:*&gt;80&#34;=&lt;/&gt;(/*:-(2&lt;4 !:5*6856&amp;?&#34;&#34;11&lt;7+%&lt;%7,4.8,*+&amp;,,$,.&#34;&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's the invocation and the coverage we achieve.  We wrap <code>cgi_decode()</code> in a <code>try...except</code> block such that we can ignore <code>ValueError</code> exceptions raised by illegal <code>%xx</code> formats.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">Coverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov_fuzz</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cgi_decode</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
<span class="n">cov_fuzz</span><span class="o">.</span><span class="n">coverage</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{(&#39;__exit__&#39;, 25),
 (&#39;cgi_decode&#39;, 9),
 (&#39;cgi_decode&#39;, 10),
 (&#39;cgi_decode&#39;, 11),
 (&#39;cgi_decode&#39;, 12),
 (&#39;cgi_decode&#39;, 15),
 (&#39;cgi_decode&#39;, 16),
 (&#39;cgi_decode&#39;, 17),
 (&#39;cgi_decode&#39;, 18),
 (&#39;cgi_decode&#39;, 19),
 (&#39;cgi_decode&#39;, 21),
 (&#39;cgi_decode&#39;, 22),
 (&#39;cgi_decode&#39;, 23),
 (&#39;cgi_decode&#39;, 24),
 (&#39;cgi_decode&#39;, 28),
 (&#39;cgi_decode&#39;, 30),
 (&#39;cgi_decode&#39;, 31)}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Is this already the maximum coverage?  Apparently, there are still lines missing:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cov_max</span><span class="o">.</span><span class="n">coverage</span><span class="p">()</span> <span class="o">-</span> <span class="n">cov_fuzz</span><span class="o">.</span><span class="n">coverage</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{(&#39;cgi_decode&#39;, 20),
 (&#39;cgi_decode&#39;, 25),
 (&#39;cgi_decode&#39;, 26),
 (&#39;cgi_decode&#39;, 32)}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us try again, increasing coverage over 100 random inputs.  We use an array <code>cumulative_coverage</code> to store the coverage achieved over time; <code>cumulative_coverage[0]</code> is the total number of lines covered after input 1, 
<code>cumulative_coverage[1]</code> is the number of lines covered after inputs 1–2, and so on.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trials</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">population_coverage</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
    <span class="n">cumulative_coverage</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_coverage</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">population</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">Coverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">function</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="n">all_coverage</span> <span class="o">|=</span> <span class="n">cov</span><span class="o">.</span><span class="n">coverage</span><span class="p">()</span>
        <span class="n">cumulative_coverage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_coverage</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">all_coverage</span><span class="p">,</span> <span class="n">cumulative_coverage</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's how the coverage increases with each input:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">hundred_inputs</span><span class="p">():</span>
    <span class="n">population</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
        <span class="n">population</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fuzzer</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">population</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_coverage</span><span class="p">,</span> <span class="n">cumulative_coverage</span> <span class="o">=</span> <span class="n">population_coverage</span><span class="p">(</span>
    <span class="n">hundred_inputs</span><span class="p">(),</span> <span class="n">cgi_decode</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/matplotlib.pyplot.html" class="import" target="_blank">matplotlib.pyplot</a></span> <span class="k">as</span> <span class="nn"><a href="https://docs.python.org/3/library/plt.html" class="import" target="_blank">plt</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cumulative_coverage</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Coverage of cgi_decode() with random inputs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;# of inputs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;lines covered&#39;</span><span class="p">);</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_png output_subarea ">
<img src="data:image/png;base64,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
"
>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is just <em>one</em> run, of course; so let's repeat this a number of times and plot the averages.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">runs</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># Create an array with TRIALS elements, all zero</span>
<span class="n">sum_coverage</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">trials</span>

<span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
    <span class="n">all_coverage</span><span class="p">,</span> <span class="n">coverage</span> <span class="o">=</span> <span class="n">population_coverage</span><span class="p">(</span><span class="n">hundred_inputs</span><span class="p">(),</span> <span class="n">cgi_decode</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">coverage</span><span class="p">)</span> <span class="o">==</span> <span class="n">trials</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
        <span class="n">sum_coverage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">coverage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="n">average_coverage</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
    <span class="n">average_coverage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_coverage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">runs</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">average_coverage</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Average coverage of cgi_decode() with random inputs&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;# of inputs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;lines covered&#39;</span><span class="p">);</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYIAAAEWCAYAAABrDZDcAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADl0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uIDIuMi4zLCBodHRwOi8vbWF0cGxvdGxpYi5vcmcvIxREBQAAIABJREFUeJzt3XmcXFWZ//HPN/u+kZAQkhCWQBKQNSyRRRFEFhUcBWVkAGUZHR3FcZxBx3H7qYjiNuMooKwKCC4oOm5hFwaQJAQIJKxZCEk6+9addKe7n98f9xQpmq7u6qSrq7vq+369+tV1l7r3OXVv3afOOXdRRGBmZtWrV7kDMDOz8nIiMDOrck4EZmZVzonAzKzKORGYmVU5JwIzsyrnRGDdlqQDJD0habOkT3Ticq+W9J878b6QtF9nxVHE+t4qaVkH5p8uaXbe8N8kHdgJcXxO0k/amH6hpId2dT2dRdKXJP2sC9ZzvKTnSr2ertCn3AHsKkn3A4cA4yKivszhWOf6N+D+iDisMxcaER/pzOV1I/8PuCpv+CrgK8B7d2WhEfH13GtJk4FFQN+IaNyV5fZ0EfFX4ICuWJekAKZExIulWH6PrhGknfJ4IIB3l2gdPT5ZdkQ3K+9ewDPlDqInkLQHcCLwm7zRdwEnpmndUjfb36pWj04EwPnAo8CNwAW5kZKOkbRSUu+8ce+R9FR63UvS5ZJekrRW0h2SRqVpk1MTwEWSlgL3pvG/SMvcKOnB/Cq3pN0k/U7SJkmPS/pqflVZ0lRJsyStk/ScpHMKFUjSKEk3SFouab2k3+RNu0TSi2k5d0kan8ZfLemqFsv5raR/Sa/HS/qVpNWSFuU3s6Rq9C8l/UzSJuBCSUdJekTSBkkrJP1AUr+895ySyrFR0g8lPSDp4rzpH5a0IMX/Z0l7tVHed0t6Jq3rfknT0vh7yQ5sP5C0RdL+Hfys/i3FvlzSxfnNOpJulPTVQjHlLeMzecv4cItp/SVdJWmppJq0DQbmTT9T0ry0T7wk6dS8bXFX2oYvSrok7z0DU2zrJT0LHNlinQW3I/B2YG5EbMuNSK/nAKcUKN8SSUek1+elz2h6Gr4493nq9U0tD6b/G9J2mZm3vKtS7IskndbG57pY0r8r+z7WSuqjHd/HzZKelfSevPkvlPRQoeVL2jvtg5slzQJGt1hfq/tYXiyfkfSUpFpJ10kaK+mPaXl3SxpZoByva7pLy/rXtKyNkm6XNCB/XmXNbGvSvB/Me+/9Lb5DrzW3Scp95k+mz/z9kkZL+n0q0zpJf5W088fziOixf8CLwD8BRwDbgbF5014C3p43/Avg8vT6MrIEMgHoD1wD3JamTSarYdwMDAYGpvEfBoam+b8HzMtb9s/T3yBgOvAK8FCaNjgNf4isKe5wYA1wYIEy/S9wOzAS6Au8JY1/W3rf4SmG/wYeTNNOSOtQGh4JbAXGkyX7OcAXgH7APsDLwDvSvF9Kn91Zad6B6fM8JsU7GVgAXJbmHw1sAv4uTf9kev/FafpZabtMS9M/D/xfgbLuD9SSHcT6kjUFvQj0S9Pvzy23g5/VqcBK4MC0TX6atul+afqNwFfb2bdOBWqAg9I2vLXFMr5H9ot7VNovfgdckaYdBWxM5eoF7AlMTdMeAH4IDAAOBVYDJ6Vp3wD+mpY5EZgPLEvT2tuO3wL+p5Vy/BfwnQJlvBn4dHp9Ldl35qN50z6Vt4/8rMX3o0/eci5M+8AlQG/go8By0v7YynoXA/NSGXPfr7PZsb++P+0XexSzfOAR4Dtk34sTgM158ba3jy0mOxaMTdtpFTAXOCwt717giwXK8dbc9slb1t9SOUaRfW8+kjdvY16cb0lxHdDavp7K/FDe8Gv7Xhq+Arg6lakvWctIq593UcfSUh6oS/kHHJd2jtFpeGFux03DXwWuT6+Hpg99rzS8gPTlS8N7pGXlDnwB7NPGukekeYanHXN7boPmrTuXCN4P/LXF+69pbedKcTQDI1uZdh3wzbzhIWm9kwEBS4ET0rRLgHvT66OBpS2W9Vnghrwv+YPtfNaXAXem1+cDj+RNE1kSyiWCPwIX5U3vBdTlPvsWy/1P4I4W874KvLW1L0cHPqvrSQflNLwfHU8E1wPfyBveP7eMVOZaYN+86TOBRXnb97utLHMi0AQMzRt3BXBjev0ycGretEvZkQja244/zo83b56vkb4HrUy7CLgr7ztxMfDzNLwEODxvH2kvEbyYNzwozTOuwHoXAx9u5/OfB5zZ3vKBSWQH2MF502/Ni7e9fWwx8MG86b8CfpQ3/M/AbwrE+FbemAjOyxv+JnB13rwt47wD+M/W9nXaTwRfAX6bP25X/npy09AFwF8iYk0avpW85qE0/HeS+pP9ep0bEUvStL2AO1O1agPZl6CJ7FdBziu5F5J6S/pGqrpuItvgkP06HkOWQF5p7b1pXUfn1pXW90GynbilicC6iFjfyrTxZF9OACJiC7AW2DOyPePnwLlp8t8Dt+Stf3yL9X+uUFlTefdP1c6VqbxfZ0d1e3z+/Gnd+We27AV8P29d68gOnHsWUabmtOzW5m2pvc+q0PYoVstlLMl7PYbsYDQnr5x/SuNzsb1UYJnrImJzi+XumTe90Drb247ryX7wtDQU2NB6EXkAOF7SOLIfNLcDxyrrextOdjAu1srci4ioSy+HtDF/y33u/NSUlivbQby+iafQ8scD6yOiNm/e/M+tmH2sJu/11laG2ypHSyvzXte1eG9rcY7vwLLzfYusZvMXSS9LunwnlwP00D4CZW2x5wBvSQerlcCngEMkHQIQEc+SfdCnkR0Yb81bxCvAaRExIu9vQES8mjdP5L3+e+BM4GSyL8jkXChkVftGsmamnIkt1vVAi3UNiYiPtlK0V4BRkka0Mm052cEg9xkMBnYj+3UDcBvwPmXt8UeT/bLJLXNRi/UPjYjTC5QV4EdkNawpETGM7ICjNG1FflklqUXZXwH+scX6BkbE/xVRJpF9dq+2Mm9LbX1Wr4uR12+PYq1o8b5Jea/XkB0gDswr4/CIyH3pXwH2bWWZy1PM+QfsSewob1vrbG87PkVWa2lpGvBkawWM7AyUOuATZLXCzWQHskvJfo02t/a21pa1E15bTtpnfwx8HNgtIkaQNYupwHvzrQBGpu9DTv7ntiv7WGdrLc7l6XUt2Y+LnNZ+KL4mIjZHxKcjYh/gXcC/SDppZwPrkYmArB26iaw9/tD0N42sffX8vPluJdvJTyDrI8i5Gvha2gGRNEbSmW2sbyhQT/YLfBDZL2QAIqIJ+DXwJUmDJE1tEcPvgf0l/YOkvunvyPwOq7xlrSBrWvmhpJFp3hPyyvIhSYemWs7XgcciYnF67xNkSeknwJ8jIvcr8G/AJmWdcwNT7eYgSa/riGylvJuALak8+Unrf4E3STpL2RkfH+P1O+3VwGeVOtMlDZd0doH13AGcIekkSX2BT5N9zq0ljddp57O6g+yzmiZpEFm7ekfdQdZxPj0t44t5624mO3B9V9LuqZx7SnpHmuW6tP6TlJ2YsKekqRHxSirbFZIGSDqYrHnmlrx1fjaVZwJZs0ROe9txFnB4rnMyxdSfrL9nVhvlfIDsAPxAGr6/xXBLq8ma5PZpY5kdNZgsMawGkPQhshpBu1ItfzbwZUn9JB1HdmDM2el9rERycR4PvJMdx6V5ZC0Yg5Sd1HBRi/fVkPeZS3qnpP1SYttEdjxs2tmgemoiuICsbXRpRKzM/QE/AD6oHaek3UbWNndvXhMSwPfJOvr+ImkzWWfR0W2s72ay2sWrwLNp/nwfJ6sprCTrmLyNbGcj/co6BfgAWfZfCVxJ1mHUmn8ga/tfSNZxdVlazj1k7Z2/IvsVtG9aZr7byGotr9V+UqJ6F1myXET2a/YnKd5C/pWsFrSZ7IB3e97y1pB17H2TLDFOJ/si5sp7Zyrfz1Oz0nyyWtkbRMRzwHlkHd9rUpzvioiGNmLLV+iz+iNZJ+l9ZNXnR9L8RV9nkpbxPbLOwhfT/3z/nsY/msp5N+mc8oj4G9nJAd8l6zR+gB2/Ss8lq1EuB+4k6yvKHai/TLafLQL+QrYv5eJpcztGRE2KMf8HzbvJrsNYTmEPkCX+BwsMt/xc6sj6HR5OzTjHtLHsoqTa+7fJtlMN8Cbg4Q4s4u/Jvr/ryBL2zXnL3tV9rDOtJGvCW06W/D8SEQvTtO8CDWTlv4kdPw5yvgTclD7zc4ApZPvcFrLP7YcRcf/OBpbrdbdOJOlKso6yC9qduYdTdsraMrIOt/vKHU9rUu1rPtA/KvgiKGWnft4EHBURIekxso77+WUOrepJeitZB/aE9uYth55aI+hWlF0ncLAyR5FV6+4sd1ylIukdkkakpodc/0HLWlJZKbtupJ+yc8CvBH5XyUkAsl/WEXFk5E4ziTjaScCK4UTQOYaS9RPUkrVJfpvs1K5KNZPsrJhcVfusiNha3pDe4B/J2pxfIms7fUPnvLKLe7a08vfHrg7WrJzcNGRmVuVcIzAzq3I94oZPo0ePjsmTJ5c7DDOzHmXOnDlrImJMe/P1iEQwefJkZs+e3f6MZmb2GklL2p/LTUNmZlXPicDMrMo5EZiZVTknAjOzKudEYGZW5UqWCCRNlHSfskcWPiPpk2n82Wm4WdKMUq3fzMyKU8rTRxvJHoM3N91/fY6y54nOJ3tQzDUlXLeZmRWpZIkg3S9+RXq9WdICsqdpzQLIbqNtZmYAjU3NPL54PY8vXkdj045nAr3n8AnsPXpwG+/cdV1yQZmyR98dBjzWgfdcSvakJCZNmtTO3GbWUkSwYMVm7ntuFWu2FP0oBiuDtVsaeOD51Wzcuh2A/N/Jh+81sucnAklDyB6mcllEbCr2fRFxLXAtwIwZM3xnPKtKG7du5/7nVvHYotf/SmxPY1Pwt8XrWLZ+KxIM6d8jbiJQtQb27c1J03bnlOljOX7KGAZ38fYq6drSo+F+BdwSEb8u5brMuoum5mDu0vXc/WwNr6yva/8NBayrbWD24vU0NgfDBvTp8MFh+h7D+PiJ+3HStLGMGVrogXhmJUwE6Vma1wELIuI7pVqPWXdQ19DIX19Yw6xna7h34SrW1TbQt7fYa7fBRT2BvTUD+vbmkhP24eRpYzls4gh69XK/mpVGKWsEx5I9U/ZpSfPSuM+RPav3v4ExwP9KmhcR7yiwDLOSiQjmv7qJWQtqePTltWzvQNNLvubmYOHKzdQ3NjN0QB/eNnV33j59LCfsP4ZhA/p2ctRmna+UZw09BAV/DFXsYxytYyKC52u2cPeCGu5buOq1zrKusGHrdlZvrqeX4E0TRjBswM5/Hc49ahJvnz6Wo/YeRd/evk7Tehb3IFmXaGhs5rFFa5n1bA0PvbCGrdubXhu/trYBgEMmDGfK2CFdFlP/Pr2Zue9unDR1d3Yb4jZ0q15OBNbpGhqb+fFfX+aGhxdRvz1rbqlvbKahqZkBfXtx3H6jGTW4HwBCHDxxOCdPG8vYYQPKGbZZ1XIisF22taGJ5vTs6yeXbeALv32GF1dt4cQDxrD36OwXfp/e4qjJozhuymgG9O1dznDNrAUnAuuw5ubgyWUbmPVsDbOereGFVVteN33iqIHccOGRnDh19zJFaGYd4URgr7N523ZqNrV+FerSdbXMeraGuxesYvXmenr3EkfvPYp3HzKe/n2zDtKhA/py1qF7MrCff/Wb9RROBMbyDVu5e0H26z47jbLwhdxD+vfhLfuP4e3Tx3LiAbszfJBPjzTr6ZwIqsiy9XUsXpNd6doUwRNL13P3ghrmv5rd+WOf0YP58LF7M338sFZvCjhqUD+O3Hsk/fv4175ZJXEiqBKL1tRy2vcfZNv2HRdNSXD4pJFcftpUTp42lv1277pTN82s+3AiqALNzcHlv3qKvr178ePzZ7x21s7k3Qb7HjRm5kRQDW57fCmPLVrHle99E8dPGVPucMysm/G18BVu+YatXPGHhRy7326cM2NiucMxs27IiaCCNTUHn7vzaZqagyvec7CfCmdmrXIiqFD1jU38821zuf+51Xz29KlM2m1QuUMys27KfQQVqLa+kY/8bA5/fWENnz9jGufPnFzukMysG3MiqADraxv42h8WsD7dxXPR2lqWrK3jqrMP4X1HTChzdGbW3TkR9HCNTc187Na5zF68nv3HZdcBDB/Yl2vOO4KTp48tc3Rm1hM4EfRwX/vDAv7vpbV8++xDeK9//ZvZTnBncQ92x+xXuOHhxVx03N5OAma205wIeqi5S9fz+Tvnc9x+o/nsaVPLHY6Z9WBOBD1QzaZtfOSncxg3fAD/fe5h9PEzcs1sF/gI0sNs297EpT+dQ219Iz8+fwYj0yMfzcx2ljuLe5CI4HO/fponX9nANf9wBAeMG1rukMysAjgR9BDL1tfxpbue5e4FNXzq5P15x4Hjyh2SmVUIJ4JubntTM9c9tIjv3/0CAJ87fSoXH7dPmaMys0riRNCNbW1o4p9umcN9z63mlOlj+eK7D2TPEQPLHZaZVRgngm5q49btXHzT48xesp6vnnUQ5x2zV7lDMrMK5UTQDa3atI3zr/8bL63ewg/OPZwzDt6j3CGZWQVzIuhmHn15LR+/9QnqGhq57oIjOWF/P1HMzErLiaCbiAiufuBlvvXnhUwePZhbLj7ap4eaWZdwIiijpuZg9uJ1zHq2hlkLaliyto4z3rQHV77vYIb096Yxs67ho02ZzFmyjv+4cz4LV26mX+9ezNx3Ny47eQpnHbqnHylpZl3KiaCLbahr4Bt/XMjPH3+F8cMH8J1zDuGUA8e5BmBmZeOjTxdasraW8657jOUbtnHpCfvwyZOmMNgJwMzKzEehLrJgxSbOv/5vbG9q5hcfmcnhk0aWOyQzM8CJoEvMWbKOC294nMH9+nDrP85kylifDWRm3YcTQYktWlPLh254nNFD+vPTi45iwshB5Q7JzOx1/DyCEtq8bTuX3Dyb3r3EzR92EjCz7sk1ghJpbg4+dfs8Fq2p5acXHcXEUU4CZtY9laxGIGmipPskLZD0jKRPpvGjJM2S9EL6X5G9pt+7+3nuXrCKL7xzOm/ed3S5wzEzK6iUTUONwKcjYhpwDPAxSdOBy4F7ImIKcE8arihPLF3PD+57kfcePoHzZ/quoWbWvZUsEUTEioiYm15vBhYAewJnAjel2W4CzipVDOVQ39jEv//qKcYOG8CX3j3dVwmbWbfXJZ3FkiYDhwGPAWMjYgVkyQLYvSti6Co/vO8lnq/ZwtfecxBDB/QtdzhmZu0qeSKQNAT4FXBZRGzqwPsulTRb0uzVq1eXLsBOtHDlJn54/4ucdeh43jZ1bLnDMTMrSkkTgaS+ZEngloj4dRpdI2mPNH0PYFVr742IayNiRkTMGDOm+9+Tf0NdA/9y+5MMG9CXL7zrwHKHY2ZWtFKeNSTgOmBBRHwnb9JdwAXp9QXAb0sVQ1ep2bSN91/zKC+u2sJVZx/CqMH9yh2SmVnRSnkdwbHAPwBPS5qXxn0O+AZwh6SLgKXA2SWMoeQWr8luJLe+toEbP3Qkb97Pp4qaWc9SskQQEQ8BhU6ZOalU6+1KqzfXc841j7C9qZlbLzmGQyaOKHdIZmYd5iuLd1Jzc/Cvv3iSjVu3c+c/Hcv08cPKHZKZ2U7xvYZ20vUPL+KB51fz+TOmOQmYWY/mRLAT5r+6kSv/tJC3Tx/Lecf4ymEz69mcCDqoobGZT/z8CUYN7seV7z3YVw6bWY/nPoIO+s28V3l5dS0/OX+GTxM1s4rgGkEHNDcH1zzwEtP2GMZJ0yrqzhhmVsWcCDrg7gU1vLS6lo+8ZR83CZlZxXAi6IBrHnyZCSMHcsab9ih3KGZmncaJoEiPL17HnCXrueT4fejT2x+bmVUOH9GKdPX9LzFqcD/OmTGx3KGYmXUqJ4IiLFlbyz0LV3HBzMkM7Ne73OGYmXUqJ4Ii/OHplQC8b8aEMkdiZtb5nAiK8Kf5KzhkwnD2HDGw3KGYmXU6J4J2LFtfx5PLNnLqQT5TyMwqkxNBO/40P2sWOu2gcWWOxMysNAreYkLS00AUmh4RB5ckom7mT/NXMm2PYUwePbjcoZiZlURb9xp6Z/r/sfT/p+n/B4G6kkXUjazatI05S9fzqZP3L3coZmYlUzARRMQSAEnHRsSxeZMul/Qw8JVSB1duf35mJRFuFjKzylZMH8FgScflBiS9GaiKdpI/zl/JvmMGM2Xs0HKHYmZWMsXchvoi4HpJw8n6DDYCHy5pVN3A2i31PPryWj524n7lDsXMrKTaTQQRMQc4RNIwQBGxsfRhld8fnl5Bc8DpvsGcmVW4dpuGJI2VdB1we0RslDRd0kVdEFtZ3fnEq0wdN5Rpe/h5xGZW2YrpI7gR+DMwPg0/D1xWqoC6g8Vrapm7dANnHbZnuUMxMyu5YhLB6Ii4A2gGiIhGoKmkUZXZb+a9igRnHjq+/ZnNzHq4YhJBraTdSBeXSTqGrMO4IkUEdz7xKjP32Y09hvveQmZW+Yo5a+hfgLuAfdP1A2OA95U0qjJ64pUNLFlbx8d9tpCZVYk2E4GkXsAA4C3AAYCA5yJiexfEVhZ3zn2V/n16caovIjOzKtFmIoiIZknfjoiZwDNdFFPZNDQ28/unlnPKgeMYOqBvucMxM+sSxfQR/EXSeyWp5NGU2cMvrmF93XbOciexmVWRYvsIBgNNkraSNQ9FRFTcCfZ3L6hhUL/eHDdldLlDMTPrMsVcWVwVN9qJCO5duIrjp4ymfx8/l9jMqkcxVxZL0nmS/jMNT5R0VOlD61oLV25mxcZtvG3q7uUOxcysSxXTR/BDYCbw92l4C/A/JYuoTO5duAqAEw9wIjCz6lJMH8HREXG4pCcAImK9pH4ljqvL3bOghoMnDGf3YQPKHYqZWZcqpkawXVJvdlxZPIZ0u4lKsa62gSde2eDagJlVpWISwX8BdwK7S/oa8BDw9ZJG1cXuf24VEXDSNCcCM6s+xZw1dIukOcBJZKeOnhURC0oeWRe6Z+Eqxgztz0Hjh5c7FDOzLtduIpD0fbJnEVRcBzHA9qZmHnx+NacftAe9elX8NXNmZm9QTNPQXODzkl6U9C1JM0odVFeavXg9m7c1cqJPGzWzKtVuIoiImyLidOAosofSXCnphfbeJ+l6Saskzc8bd4ikRyQ9Lel36fGXZfXIy2vpJTh2v93KHYqZWVkUUyPI2Q+YCkwGFhYx/43AqS3G/QS4PCLeRNYB/ZkOrL8k5ixZx9Rxw3yTOTOrWsVcWZyrAXyF7A6kR0TEu9p7X0Q8CKxrMfoA4MH0ehbw3o6F27kam5p5YukGZkweWc4wzMzKqpgLyhYBMyNiTSesbz7wbuC3wNnAxEIzSroUuBRg0qRJnbDqN1qwYjN1DU3MmDyqJMs3M+sJiukjuBp4s6Sr0l+7tYE2fBj4WDoddSjQ0MZ6r42IGRExY8yYMbuwysJmL8kqLDP2co3AzKpXMaePXkHWUXxLGvUJSW+OiM92dGURsRA4JS13f+CMji6jM81evJ49Rwxk/Ag/m9jMqlcxTUNnAIdGRDOApJuAJ4AOJwJJu0fEqvQIzM8DV3d0GZ0lIpi9ZB1H7+2zhcysuhV71tCIvNdFXX4r6TbgEeAAScskXQScK+l5srOOlgM3dCTYzrRs/VZqNtW7o9jMql4xNYIrgCck3Ud2i4kTKKI2EBHnFpj0/eLDK50d/QPuKDaz6lbMvYZuk3Q/cCRZIvj3iFhZ6sBKbfbi9Qzt34cDxlXFA9jMzAoq5jqC9wB1EXFXRPwW2CbprNKHVlqzF6/nsL1G0tv3FzKzKldMH8EXI2JjbiAiNgBfLF1IpbexbjvPr9rs00bNzCguEbQ2TzF9C93W3KXricAdxWZmFJcIZkv6jqR9Je0j6bvAnFIHVkoLVm4C4OAJI9qZ08ys8hWTCP6Z7Arg24E7gK3Ax0oZVKnVbNzG0AF9GNK/R1dszMw6RTFnDdUCl3dBLF1m5aZtjPND6s3MgI7dhrpirNxUz7jhTgRmZlCliaBm4zZ2H+pEYGYGVZgImpqD1VvqGTe8f7lDMTPrFoq5oOybkoZJ6ivpHklrJJ3XFcGVwtot9TQ1h/sIzMySYmoEp0TEJuCdwDJgf7rBIyZ31spN2wAY60RgZgYUlwhyD/M9HbgtIlo+frJHWbkxSwTuLDYzyxRzIv3vJC0ku37gnySNAbaVNqzSqUk1AjcNmZllinlU5eXATGBGRGwH6oAzSx1YqazctI3evcRuQ9xZbGYGxXUWDyK7kvhHadR4YEYpgyqlmk31jBnS33cdNTNLiukjuIHsFhNvTsPLgK+WLKISq9m0jbHuHzAze00xiWDfiPgmsB0gIraSPaCmR1q5cRvjhrlZyMwsp5hE0CBpIBAAkvYF6ksaVQn5PkNmZq9XzFlDXwT+BEyUdAtwLHBhKYMqlbqGRjZva3TTkJlZnmLuPjpL0lzgGLImoU9GxJqSR1YCNZuyisxY32fIzOw1xd6QfwCwPs0/XRIR8WDpwioNX0xmZvZG7SYCSVcC7weeAZrT6AB6XCKo8e0lzMzeoJgawVnAARHRYzuIc3L3GXKNwMxsh2LOGnqZHfcb6tFWbtzGkP5+RKWZWb5ijoh1wDxJ95B32mhEfKJkUZVIzaZtjPU1BGZmr1NMIrgr/fV4WSJws5CZWb5iTh+9qSsC6Qo1m+o5eu9R5Q7DzKxbKZgIJN0REedIepp0VXG+iDi4pJF1subm8H2GzMxa0VaN4JPp/zu7IpBSW1vbQKMfUWlm9gYFE0FErEj/l3RdOKXjawjMzFrXVtPQZlppEiK7zURExLCSRVUCNb6GwMysVW3VCIZ2ZSCltuOh9T591MwsXzEXlFWEVemGc2P8iEozs9epmkSwpb6Rwf1606d31RTZzKwoVXNUrK1vZLBvLWFm9gbVkwgampwIzMxaUT2JoL6Rwf17lzsMM7Nup2SJQNL1klZJmp837lBJj0qaJ2m2pKNKtf6WausbGdTPNQIzs5ZKWSO4ETi1xbhvAl+OiEOBL6ThLlHX0MTgfq4RmJm1VLJEkB5lua7laCB3IdpwYHmp1t+SO4vNzFrX1UfGy4A/S7qKLAmbA/g5AAAKP0lEQVS9udCMki4FLgWYNGnSLq+4tqGRwW4aMjN7g67uLP4o8KmImAh8Criu0IwRcW1EzIiIGWPGjNnlFdfW+6whM7PWdHUiuAD4dXr9C6BLOosjIqsR+KwhM7M36OpEsBx4S3r9NuCFrljp1u1NROAagZlZK0p2ZJR0G/BWYLSkZcAXgUuA70vqA2wj9QGUWm19E4DPGjIza0XJEkFEnFtg0hGlWmchdQ2NAL6OwMysFVVxZfGW+iwRuGnIzOyNqiIR1DWkpiF3FpuZvUFVJALXCMzMCquKRFD3WmexE4GZWUtVkQhqG3I1AjcNmZm1VB2JINc05BqBmdkbVEUiyHUWD3KNwMzsDaoiEWypb6Rvb9G/jxOBmVlLVZEI6vxQGjOzgqoiEWypb2KITx01M2tVVSSCuoZGBvk+Q2ZmraqKRFDb0MQg1wjMzFpVHYmgvpEhPmPIzKxVVZMI3FlsZta66kgEDY3uLDYzK6AqEkFdfZM7i83MCqiKRLCl3jUCM7NCKj4RNDY1U9/Y7D4CM7MCKj4R1G33Q2nMzNpS8Ymg1g+lMTNrUxUkgnTnUXcWm5m1qgoSQVYjcGexmVnrKj8RpKeTubPYzKx1lZ8I6t1ZbGbWlopPBHUN7iw2M2tLxSeC12oEbhoyM2tVFSSCXI3ATUNmZq2p/ETgzmIzszZVfiKob2Rg39707qVyh2Jm1i1VfiJoaHKzkJlZGyo/EfihNGZmbaqCRNDkU0fNzNpQ8YmgrqGRwb7PkJlZQRWfCGrrG10jMDNrQ+UnAncWm5m1qfITgTuLzczaVBWJwLegNjMrrKITQURQ29Dkh9KYmbWhZIlA0vWSVkmanzfudknz0t9iSfNKtX6A+sZmmprDncVmZm0o5RHyRuAHwM25ERHx/txrSd8GNpZw/dQ15O486hqBmVkhJUsEEfGgpMmtTZMk4BzgbaVaP/jB9WZmxShXH8HxQE1EvFBoBkmXSpotafbq1at3aiW1fiiNmVm7ypUIzgVua2uGiLg2ImZExIwxY8bs1EpyNQJ3FpuZFdblP5Ul9QH+Djii1OvKPZ3Mp4+amRVWjhrBycDCiFhW6hXtqBE4EZiZFVLK00dvAx4BDpC0TNJFadIHaKdZqLPUNrhGYGbWnlKeNXRugfEXlmqdLdXlHlPpew2ZmRVU0VcWb0lNQ64RmJkVVtGJoK6+iV6C/n0quphmZrukoo+QW+obGdyvD9n1a2Zm1pqKTgRTxw3ltDeNK3cYZmbdWkU3nn/gqEl84KhJ5Q7DzKxbq+gagZmZtc+JwMysyjkRmJlVOScCM7Mq50RgZlblnAjMzKqcE4GZWZVzIjAzq3KKiHLH0C5Jq4ElO/n20cCaTgynp6jGcldjmaE6y12NZYaOl3uviGj3EY89IhHsCkmzI2JGuePoatVY7mosM1RnuauxzFC6crtpyMysyjkRmJlVuWpIBNeWO4AyqcZyV2OZoTrLXY1lhhKVu+L7CMzMrG3VUCMwM7M2OBGYmVW5ik4Ekk6V9JykFyVdXu54SkHSREn3SVog6RlJn0zjR0maJemF9H9kuWPtbJJ6S3pC0u/T8N6SHktlvl1Sv3LH2NkkjZD0S0kL0zafWenbWtKn0r49X9JtkgZU4raWdL2kVZLm541rddsq81/p2PaUpMN3Zd0Vmwgk9Qb+BzgNmA6cK2l6eaMqiUbg0xExDTgG+Fgq5+XAPRExBbgnDVeaTwIL8oavBL6byrweuKgsUZXW94E/RcRU4BCy8lfstpa0J/AJYEZEHAT0Bj5AZW7rG4FTW4wrtG1PA6akv0uBH+3Kiis2EQBHAS9GxMsR0QD8HDizzDF1uohYERFz0+vNZAeGPcnKelOa7SbgrPJEWBqSJgBnAD9JwwLeBvwyzVKJZR4GnABcBxARDRGxgQrf1mSP1B0oqQ8wCFhBBW7riHgQWNdidKFteyZwc2QeBUZI2mNn113JiWBP4JW84WVpXMWSNBk4DHgMGBsRKyBLFsDu5YusJL4H/BvQnIZ3AzZERGMarsTtvQ+wGrghNYn9RNJgKnhbR8SrwFXAUrIEsBGYQ+Vv65xC27ZTj2+VnAjUyriKPVdW0hDgV8BlEbGp3PGUkqR3AqsiYk7+6FZmrbTt3Qc4HPhRRBwG1FJBzUCtSW3iZwJ7A+OBwWTNIi1V2rZuT6fu75WcCJYBE/OGJwDLyxRLSUnqS5YEbomIX6fRNbmqYvq/qlzxlcCxwLslLSZr8nsbWQ1hRGo+gMrc3suAZRHxWBr+JVliqORtfTKwKCJWR8R24NfAm6n8bZ1TaNt26vGtkhPB48CUdHZBP7IOprvKHFOnS23j1wELIuI7eZPuAi5Iry8AftvVsZVKRHw2IiZExGSy7XpvRHwQuA94X5qtosoMEBErgVckHZBGnQQ8SwVva7ImoWMkDUr7eq7MFb2t8xTatncB56ezh44BNuaakHZKRFTsH3A68DzwEvAf5Y6nRGU8jqxK+BQwL/2dTtZmfg/wQvo/qtyxlqj8bwV+n17vA/wNeBH4BdC/3PGVoLyHArPT9v4NMLLStzXwZWAhMB/4KdC/Erc1cBtZP8h2sl/8FxXatmRNQ/+Tjm1Pk51VtdPr9i0mzMyqXCU3DZmZWRGcCMzMqpwTgZlZlXMiMDOrck4EZmZVzonAKpqkKyS9VdJZHb0DraQx6Q6XT0g6vsW0n5TiJoaSPtfZyzRrj08ftYom6V6ym9N9HfhlRDzcgfd+ADgtIi5od+ZOImlLRAzpqvWZgWsEVqEkfUvSU8CRwCPAxcCPJH2hlXn3knRPuq/7PZImSToU+CZwuqR5kga2eM/9kmak11skfU3Sk5IelTQ2jb9R0tWS/irp+XSPJCRdKOkHecv6faq1fIPsLpvzJN0iabCk/03LnS/p/SX6uKzKORFYRYqIz5Ad/G8kSwZPRcTBEfGVVmb/AdktfQ8GbgH+KyLmAV8Abo+IQyNiaxurGww8GhGHAA8Cl+RNmwy8haxWcrWkAW3EfDmwNa3vg2T3pl8eEYdEdi/+PxVTdrOOciKwSnYY2S03ppLdn6aQmcCt6fVPyW7b0RENwO/T6zlkB/+cOyKiOSJeAF5OsRTraeBkSVdKOj4iNnYwLrOi9Gl/FrOeJTXr3Eh2R8Y1ZA8zkaR5wMx2ft1Dx2/nuz12dLY18frvVctlBdlT5fJ/hLVaS4iI5yUdQXbvqCsk/aVAjcZsl7hGYBUnIuZFxKFkNxycDtwLvKONJp7/I7uLKcAHgYc6MZyzJfWStC/ZjdKeAxYDh6bxE8meppezPd1WHEnjgbqI+BnZw1l26bm0ZoW4RmAVSdIYYH1ENEuaGhFtNQ19Arhe0mfIngD2oU4M5TngAWAs8JGI2CbpYWARWdPPfGBu3vzXAk9JmgvcDHxLUjPZHSk/2olxmb3Gp4+alYikG8lukf3L9uY1Kyc3DZmZVTnXCMzMqpxrBGZmVc6JwMysyjkRmJlVOScCM7Mq50RgZlbl/j9TZH7GMpSkQwAAAABJRU5ErkJggg==
"
>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that on average, we get full coverage after 40–60 fuzzing inputs.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Getting-Coverage-from-External-Programs">Getting Coverage from External Programs<a class="anchor-link" href="#Getting-Coverage-from-External-Programs">&#182;</a></h2><p>Of course, not all the world is programming in Python.  The good news is that the problem of obtaining coverage is ubiquitous, and almost every programming language has some facility to measure coverage.  Just as an example, let us therefore demonstrate how to obtain coverage for a C program.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our C program (again) implements <code>cgi_decode</code>; this time as a program to be executed from the command line:</p>
<div class="highlight"><pre><span></span>$ ./cgi_decode <span class="s1">&#39;Hello+World&#39;</span>
Hello World
</pre></div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here comes the C code, first as a Python string.  We start with the usual C includes:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cgi_c_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">/* CGI decoding as C program */</span>

<span class="s2">#include &lt;stdlib.h&gt;</span>
<span class="s2">#include &lt;string.h&gt;</span>
<span class="s2">#include &lt;stdio.h&gt;</span>

<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here comes the initialization of <code>hex_values</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cgi_c_code</span> <span class="o">+=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">int hex_values[256];</span>

<span class="s2">void init_hex_values() {</span>
<span class="s2">    for (int i = 0; i &lt; sizeof(hex_values) / sizeof(int); i++) {</span>
<span class="s2">        hex_values[i] = -1;</span>
<span class="s2">    }</span>
<span class="s2">    hex_values[&#39;0&#39;] = 0; hex_values[&#39;1&#39;] = 1; hex_values[&#39;2&#39;] = 2; hex_values[&#39;3&#39;] = 3;</span>
<span class="s2">    hex_values[&#39;4&#39;] = 4; hex_values[&#39;5&#39;] = 5; hex_values[&#39;6&#39;] = 6; hex_values[&#39;7&#39;] = 7;</span>
<span class="s2">    hex_values[&#39;8&#39;] = 8; hex_values[&#39;9&#39;] = 9;</span>

<span class="s2">    hex_values[&#39;a&#39;] = 10; hex_values[&#39;b&#39;] = 11; hex_values[&#39;c&#39;] = 12; hex_values[&#39;d&#39;] = 13;</span>
<span class="s2">    hex_values[&#39;e&#39;] = 14; hex_values[&#39;f&#39;] = 15;</span>

<span class="s2">    hex_values[&#39;A&#39;] = 10; hex_values[&#39;B&#39;] = 11; hex_values[&#39;C&#39;] = 12; hex_values[&#39;D&#39;] = 13;</span>
<span class="s2">    hex_values[&#39;E&#39;] = 14; hex_values[&#39;F&#39;] = 15;</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's the actual implementation of <code>cgi_decode()</code>, using pointers for input source (<code>s</code>) and output target (<code>t</code>):</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cgi_c_code</span> <span class="o">+=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">int cgi_decode(char *s, char *t) {</span>
<span class="s2">    while (*s != &#39;\0&#39;) {</span>
<span class="s2">        if (*s == &#39;+&#39;)</span>
<span class="s2">            *t++ = &#39; &#39;;</span>
<span class="s2">        else if (*s == &#39;%&#39;) {</span>
<span class="s2">            int digit_high = *++s;</span>
<span class="s2">            int digit_low = *++s;</span>
<span class="s2">            if (hex_values[digit_high] &gt;= 0 &amp;&amp; hex_values[digit_low] &gt;= 0) {</span>
<span class="s2">                *t++ = hex_values[digit_high] * 16 + hex_values[digit_low];</span>
<span class="s2">            }</span>
<span class="s2">            else</span>
<span class="s2">                return -1;</span>
<span class="s2">        }</span>
<span class="s2">        else</span>
<span class="s2">            *t++ = *s;</span>
<span class="s2">        s++;</span>
<span class="s2">    }</span>
<span class="s2">    *t = &#39;\0&#39;;</span>
<span class="s2">    return 0;</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Finally, here's a driver which takes the first argument and invokes <code>cgi_decode</code> with it:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cgi_c_code</span> <span class="o">+=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">int main(int argc, char *argv[]) {</span>
<span class="s2">    init_hex_values();</span>

<span class="s2">    if (argc &gt;= 2) {</span>
<span class="s2">        char *s = argv[1];</span>
<span class="s2">        char *t = malloc(strlen(s) + 1); /* output is at most as long as input */</span>
<span class="s2">        int ret = cgi_decode(s, t);</span>
<span class="s2">        printf(&quot;</span><span class="si">%s</span><span class="s2">\n&quot;, t);</span>
<span class="s2">        return ret;</span>
<span class="s2">    }</span>
<span class="s2">    else</span>
<span class="s2">    {</span>
<span class="s2">        printf(&quot;cgi_decode: usage: cgi_decode STRING\n&quot;);</span>
<span class="s2">        return 1;</span>
<span class="s2">    }</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us create the C source code:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;cgi_decode.c&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cgi_c_code</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now compile the C code into an executable.  The <code>--coverage</code> option instructs the C compiler to instrument the code such that at runtime, coverage information will be collected.  (The exact options vary from compiler to compiler.)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cc --coverage -o cgi_decode cgi_decode.c
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>When we now execute the program, coverage information will automatically be collected and stored in auxiliary files:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>./cgi_decode <span class="s1">&#39;Send+mail+to+me%40fuzzingbook.org&#39;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Send mail to me@fuzzingbook.org
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The coverage information is collected by the <code>gcov</code> program.  For every source file given, it produces a new <code>.gcov</code> file with coverage information.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>gcov cgi_decode.c
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>File &#39;cgi_decode.c&#39;
Lines executed:91.89% of 37
cgi_decode.c:creating &#39;cgi_decode.c.gcov&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the <code>.gcov</code> file, each line is prefixed with the number of times it was called (<code>-</code> stands for a non-executable line, <code>#####</code> stands for zero) as well as the line number.  We can take a look at <code>cgi_decode()</code>, for instance, and see that the only code not executed yet is the <code>return -1</code> for an illegal input.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lines</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;cgi_decode.c.gcov&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>        -:   26:int cgi_decode(char *s, char *t) {
       64:   27:    while (*s != &#39;\0&#39;) {
       31:   28:        if (*s == &#39;+&#39;)
        3:   29:            *t++ = &#39; &#39;;
       28:   30:        else if (*s == &#39;%&#39;) {
        1:   31:            int digit_high = *++s;
        1:   32:            int digit_low = *++s;
        2:   33:            if (hex_values[digit_high] &gt;= 0 &amp;&amp; hex_values[digit_low] &gt;= 0) {
        1:   34:                *t++ = hex_values[digit_high] * 16 + hex_values[digit_low];
        1:   35:            }
        -:   36:            else
    #####:   37:                return -1;
        1:   38:        }
        -:   39:        else
       27:   40:            *t++ = *s;
       31:   41:        s++;
        -:   42:    }
        1:   43:    *t = &#39;\0&#39;;
        1:   44:    return 0;
        1:   45:}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us read in this file to obtain a coverage set:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">read_gcov_coverage</span><span class="p">(</span><span class="n">c_file</span><span class="p">):</span>
    <span class="n">gcov_file</span> <span class="o">=</span> <span class="n">c_file</span> <span class="o">+</span> <span class="s2">&quot;.gcov&quot;</span>
    <span class="n">coverage</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">gcov_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="n">elems</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">covered</span> <span class="o">=</span> <span class="n">elems</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">line_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">elems</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">covered</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">covered</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">coverage</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">c_file</span><span class="p">,</span> <span class="n">line_number</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">coverage</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">coverage</span> <span class="o">=</span> <span class="n">read_gcov_coverage</span><span class="p">(</span><span class="s1">&#39;cgi_decode.c&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">coverage</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;cgi_decode.c&#39;, 19),
 (&#39;cgi_decode.c&#39;, 28),
 (&#39;cgi_decode.c&#39;, 48),
 (&#39;cgi_decode.c&#39;, 15),
 (&#39;cgi_decode.c&#39;, 35)]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With this set, we can now do the same coverage computations as with our Python programs.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Finding-Errors-with-Basic-Fuzzing">Finding Errors with Basic Fuzzing<a class="anchor-link" href="#Finding-Errors-with-Basic-Fuzzing">&#182;</a></h2><p>Given sufficient time, we can indeed cover each and every line within <code>cgi_decode()</code>, whatever the programming language would be.  This does not mean that they would be error-free, though.  Since we do not check the result of <code>cgi_decode()</code>, the function could return any value without us checking or noticing.  To catch such errors, we would have to set up a <em>results checker</em> (commonly called an <em>oracle</em>) that would verify test results.  In our case, we could compare the C and Python implementations of <code>cgi_decode()</code> and see whether both produce the same results.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Where fuzzing is great at, though, is in finding <em>internal errors</em> that can be detected even without checking the result.  Actually, if one runs our <code>fuzzer()</code> on <code>cgi_decode()</code>, one quickly finds such an error, as the following code shows:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="ExpectError.html" class="import" target="_blank">ExpectError</a></span> <span class="k">import</span> <span class="n">ExpectError</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">fuzzer</span><span class="p">()</span>
            <span class="n">cgi_decode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-47-086d4892c70e&gt;&#34;, line 5, in &lt;module&gt;
    cgi_decode(s)
  File &#34;&lt;ipython-input-1-4d0fb90b50b4&gt;&#34;, line 22, in cgi_decode
    digit_high, digit_low = s[i + 1], s[i + 2]
IndexError: string index out of range (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>So, it is possible to cause <code>cgi_decode()</code> to crash.  Why is that?  Let's take a look at its input:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;82 202*&amp;&lt;1&amp;($34\&#39;&#34;/\&#39;.&lt;5/!8&#34;\&#39;5:!4))%;&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The problem here is at the end of the string.  After a <code>'%'</code> character, our implementation will always attempt to access two more (hexadecimal) characters, but if these are not there, we will get an <code>IndexError</code> exception.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This problem is also present in our C variant, which inherits it from the original implementation [<a href="http://ix.cs.uoregon.edu/~michal/book/">Pezzè <em>et al</em>, 2008.</a>]:</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">digit_high</span> <span class="o">=</span> <span class="o">*++</span><span class="n">s</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">digit_low</span> <span class="o">=</span> <span class="o">*++</span><span class="n">s</span><span class="p">;</span>
</pre></div>
<p>Here, <code>s</code> is a pointer to the character to be read; <code>++</code> increments it by one character.
In the C implementation, the problem is actually much worse.  If the <code>'%'</code> character is at the end of the string, the above code will first read a terminating character (<code>'\0'</code> in C strings) and then the following character, which may be any memory content after the string, and which thus may cause the program to fail uncontrollably.  The somewhat good news is that <code>'\0'</code> is not a valid hexadecimal character, and thus, the C version will "only" read one character beyond the end of the string.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Interestingly enough, none of the manual tests we had designed earlier would trigger this bug.  Actually, neither statement nor branch coverage, nor any of the coverage criteria commonly discussed in literature would find it.  However, a simple fuzzing run can identify the error with a few runs – <em>if</em> appropriate run-time checks are in place that find such overflows.  This definitely calls for more fuzzing!</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned<a class="anchor-link" href="#Lessons-Learned">&#182;</a></h2><ul>
<li>Coverage metrics are a simple and fully automated means to approximate how much functionality of a program is actually executed during a test run.</li>
<li>A number of coverage metrics exist, the most important ones being statement coverage and branch coverage.</li>
<li>In Python, it is very easy to access the program state during execution, including the currently executed code.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>At the end of the day, let's clean up:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/os.html" class="import" target="_blank">os</a></span>
<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/glob.html" class="import" target="_blank">glob</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;cgi_decode&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;cgi_decode.*&quot;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps<a class="anchor-link" href="#Next-Steps">&#182;</a></h2><p>Coverage is not only a tool to <em>measure</em> test effectiveness, but also a great tool to <em>guide</em> test generation towards specific goals – in particular uncovered code.  We use coverage to</p>
<ul>
<li><a href="MutationFuzzer.html">guide <em>mutations</em> of existing inputs towards better coverage in the chapter on mutation fuzzing</a></li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Background">Background<a class="anchor-link" href="#Background">&#182;</a></h2><p>Coverage is a central concept in systematic software testing.  For discussions, see the books in the <a href="Intro_Testing.html">Introduction to Testing</a>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises<a class="anchor-link" href="#Exercises">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1:-Fixing-cgi_decode">Exercise 1: Fixing cgi_decode<a class="anchor-link" href="#Exercise-1:-Fixing-cgi_decode">&#182;</a></h3><p>Create an appropriate test to reproduce the <code>IndexError</code> discussed above.  Fix <code>cgi_decode()</code> to prevent the bug.  Show that your test (and additional <code>fuzzer()</code> runs) no longer expose the bug.  Do the same for the C variant.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2:-Branch-Coverage">Exercise 2: Branch Coverage<a class="anchor-link" href="#Exercise-2:-Branch-Coverage">&#182;</a></h3><p>Besides statement coverage, <em>branch coverage</em> is one of the most frequently used criteria to determine the quality of a test.  In a nutshell, branch coverage measures how many different <em>control decisions</em> are made in code.  In the statement</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">CONDITION</span><span class="p">:</span>
    <span class="n">do_a</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">do_b</span><span class="p">()</span>
</pre></div>
<p>for instance, both the cases where <code>CONDITION</code> is true (branching to <code>do_a()</code>) and where <code>CONDITION</code> is false (branching to <code>do_b()</code>) have to be covered.  This holds for all control statements with a condition (<code>if</code>, <code>while</code>, etc.).</p>
<p>How is branch coverage different from statement coverage?  In the above example, there is actually no difference.  In this one, though, there is:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">CONDITION</span><span class="p">:</span>
    <span class="n">do_a</span><span class="p">()</span>
<span class="n">something_else</span><span class="p">()</span>
</pre></div>
<p>Using statement coverage, a single test case where <code>CONDITION</code> is true suffices to cover the call to <code>do_a()</code>.  Using branch coverage, however, we would also have to create a test case where <code>do_a()</code> is <em>not</em> invoked.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Using our <code>Coverage</code> infrastructure, we can simulate branch coverage by considering  <em>pairs of subsequent lines executed</em>.  The <code>trace()</code> method gives us the list of lines executed one after the other:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">Coverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
    <span class="n">cgi_decode</span><span class="p">(</span><span class="s2">&quot;a+b&quot;</span><span class="p">)</span>
<span class="n">trace</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span>
<span class="n">trace</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;cgi_decode&#39;, 9),
 (&#39;cgi_decode&#39;, 10),
 (&#39;cgi_decode&#39;, 11),
 (&#39;cgi_decode&#39;, 12),
 (&#39;cgi_decode&#39;, 15)]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-1:-Compute-branch-coverage">Part 1: Compute branch coverage<a class="anchor-link" href="#Part-1:-Compute-branch-coverage">&#182;</a></h4><p>Define a function <code>branch_coverage()</code> that takes a trace and returns the set of pairs of subsequent lines in a trace – in the above example, this would be</p>
<div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span>
<span class="p">((</span><span class="s1">&#39;cgi_decode&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;cgi_decode&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
<span class="p">((</span><span class="s1">&#39;cgi_decode&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;cgi_decode&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)),</span>
<span class="c1"># more_pairs</span>
<span class="p">)</span>
</pre></div>
<p>Bonus for advanced Python programmers: Define <code>BranchCoverage</code> as a subclass of <code>Coverage</code> and make <code>branch_coverage()</code> as above a <code>coverage()</code> method of <code>BranchCoverage</code>.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-2:-Comparing-statement-coverage-and-branch-coverage">Part 2: Comparing statement coverage and branch coverage<a class="anchor-link" href="#Part-2:-Comparing-statement-coverage-and-branch-coverage">&#182;</a></h4><p>Use <code>branch_coverage()</code> to repeat the experiments in this chapter with branch coverage rather than statement coverage.  Do the manually written test cases cover all branches?</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-3:-Average-coverage">Part 3: Average coverage<a class="anchor-link" href="#Part-3:-Average-coverage">&#182;</a></h4><p>Again, repeat the above experiments with branch coverage.  Does <code>fuzzer()</code> cover all branches, and if so, how many tests does it take on average?</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Mutation-Based-Fuzzing">Mutation-Based Fuzzing<a class="anchor-link" href="#Mutation-Based-Fuzzing">&#182;</a></h1><p>Most <a href="Fuzzer.html">randomly generated inputs</a> are syntactically <em>invalid</em> and thus are quickly rejected by the processing program.  To exercise functionality beyond input processing, we must increase chances to obtain valid inputs.  One such way is <em>to mutate existing valid inputs</em> – that is, introducing small changes that may still keep the input valid, yet exercise new behavior.  We show how to create such mutations, and how to guide them towards yet uncovered code, applying central concepts from the popular AFL fuzzer.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>You should know how basic fuzzing works; for instance, from the <a href="Fuzzer.html">"Fuzzing"</a> chapter.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Fuzzing-a-URL-Parser">Fuzzing a URL Parser<a class="anchor-link" href="#Fuzzing-a-URL-Parser">&#182;</a></h2><p>Many programs expect their inputs to come in a very specific format before they would actually process them.  As an example, think of a program that accepts a URL (a Web address).  The URL has to be in a valid format (i.e., the URL format) such that the program can deal with it.  When fuzzing with random inputs, what are our chances to actually produce a valid URL?</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To get deeper into the problem, let us explore what URLs are made of.  A URL consists of a number of elements:</p>

<pre><code>scheme://netloc/path?query#fragment

</code></pre>
<p>where</p>
<ul>
<li><code>scheme</code> is the protocol to be used, including <code>http</code>, <code>https</code>, <code>ftp</code>, <code>file</code>...</li>
<li><code>netloc</code> is the name of the host to connect to, such as <code>www.google.com</code></li>
<li><code>path</code> is the path on that very host, such as <code>search</code></li>
<li><code>query</code> is a list of key/value pairs, such as <code>q=fuzzing</code></li>
<li><code>fragment</code> is a marker for a location in the retrieved document, such as <code>#result</code></li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In Python, we can use the <code>urlparse()</code> function to parse and decompose a URL into its parts.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/urlparse.html" class="import" target="_blank">urlparse</a></span> <span class="k">import</span> <span class="n">urlparse</span>      <span class="c1"># Python 2</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/urllib.parse.html" class="import" target="_blank">urllib.parse</a></span> <span class="k">import</span> <span class="n">urlparse</span>  <span class="c1"># Python 3</span>

<span class="n">urlparse</span><span class="p">(</span><span class="s2">&quot;http://www.google.com/search?q=fuzzing&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>ParseResult(scheme=&#39;http&#39;, netloc=&#39;www.google.com&#39;, path=&#39;/search&#39;, params=&#39;&#39;, query=&#39;q=fuzzing&#39;, fragment=&#39;&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see how the result encodes the individual parts of the URL in different attributes.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us now assume we have a program that takes a URL as input.  To simplify things, we won't let it do very much; we simply have it check the passed URL for validity.  If the URL is valid, it returns True; otherwise, it raises an exception.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">http_program</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">supported_schemes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;https&quot;</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_schemes</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Scheme must be one of &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">supported_schemes</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">netloc</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Host must be non-empty&quot;</span><span class="p">)</span>

    <span class="c1"># Do something with the URL</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us now go and fuzz <code>http_program()</code>.  To fuzz, we use the full range of printable ASCII characters, such that <code>:</code>, <code>/</code>, and lowercase letters are included.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Fuzzer.html" class="import" target="_blank">Fuzzer</a></span> <span class="k">import</span> <span class="n">fuzzer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fuzzer</span><span class="p">(</span><span class="n">char_start</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">char_range</span><span class="o">=</span><span class="mi">96</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;&#34;N&amp;+slk%h\x7fyp5o\&#39;@[3(rW*M5W]tMFPU4\\P@tz%[X?uo\\1?b4T;1bDeYtHx #UJ5w}pMmPodJM,_&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let's try to fuzz with 1000 random inputs and see whether we have some success.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">fuzzer</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">http_program</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success!&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What are the chances of actually getting a valid URL?  We need our string to start with <code>"http://"</code> or <code>"https://"</code>.  Let's take the <code>"http://"</code> case first.  That's seven very specific characters we need to start with.  The chance of producing these seven characters randomly (with a character range of 96 different characters) is $1 : 96^7$, or</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="mi">96</span> <span class="o">**</span> <span class="mi">7</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>75144747810816
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The odds of producing a <code>"https://"</code> prefix are even worse, at $1 : 96^8$:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="mi">96</span> <span class="o">**</span> <span class="mi">8</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>7213895789838336
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>which gives us a total chance of</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">likelihood</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">96</span> <span class="o">**</span> <span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">96</span> <span class="o">**</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">likelihood</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>1.344627131107667e-14
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>And this is the number of runs (on average) we'd need to produce a valid URL scheme:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="mi">1</span> <span class="o">/</span> <span class="n">likelihood</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>74370059689055.02
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let's measure how long one run of <code>http_program()</code> takes:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Timer.html" class="import" target="_blank">Timer</a></span> <span class="k">import</span> <span class="n">Timer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trials</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">fuzzer</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">http_program</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>

<span class="n">duration_per_run_in_seconds</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span> <span class="o">/</span> <span class="n">trials</span>
<span class="n">duration_per_run_in_seconds</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>8.476452999457251e-05
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>That's pretty fast, isn't it?  Unfortunately, we have a lot of runs to cover.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seconds_until_success</span> <span class="o">=</span> <span class="n">duration_per_run_in_seconds</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">likelihood</span><span class="p">)</span>
<span class="n">seconds_until_success</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>6303943155.211052
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>which translates into</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hours_until_success</span> <span class="o">=</span> <span class="n">seconds_until_success</span> <span class="o">/</span> <span class="mi">3600</span>
<span class="n">days_until_success</span> <span class="o">=</span> <span class="n">hours_until_success</span> <span class="o">/</span> <span class="mi">24</span>
<span class="n">years_until_success</span> <span class="o">=</span> <span class="n">days_until_success</span> <span class="o">/</span> <span class="mf">365.25</span>
<span class="n">years_until_success</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>199.75990427697457
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Even if we parallelize things a lot, we're still in for months to years of waiting.  And that's for getting <em>one</em> successful run that will get deeper into <code>http_program()</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What basic fuzzing will do well is to test <code>urlparse()</code>, and if there is an error in this parsing function, it has good chances of uncovering it.  But as long as we cannot produce a valid input, we are out of luck in reaching any deeper functionality.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Mutating-Inputs">Mutating Inputs<a class="anchor-link" href="#Mutating-Inputs">&#182;</a></h2><p>The alternative to generating random strings from scratch is to start with a given <em>valid</em> input, and then to subsequently <em>mutate</em> it.  A <em>mutation</em> in this context is a simple string manipulation - say, inserting a (random) character, deleting a character, or flipping a bit in a character representation.  Here are some mutations to get you started:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/random.html" class="import" target="_blank">random</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">delete_random_character</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns s with a random character deleted&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="n">pos</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># print(&quot;Deleting&quot;, repr(s[pos]), &quot;at&quot;, pos)</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">[:</span><span class="n">pos</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seed_input</span> <span class="o">=</span> <span class="s2">&quot;A quick brown fox&quot;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">delete_random_character</span><span class="p">(</span><span class="n">seed_input</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&#39;A uick brown fox&#39;
&#39;A quic brown fox&#39;
&#39;A quick brown fo&#39;
&#39;A quic brown fox&#39;
&#39;A quick bown fox&#39;
&#39;A quick bown fox&#39;
&#39;A quick brown fx&#39;
&#39;A quick brown ox&#39;
&#39;A quick brow fox&#39;
&#39;A quic brown fox&#39;
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">insert_random_character</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns s with a random character inserted&quot;&quot;&quot;</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="n">random_character</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">128</span><span class="p">))</span>
    <span class="c1"># print(&quot;Inserting&quot;, repr(random_character), &quot;at&quot;, pos)</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">[:</span><span class="n">pos</span><span class="p">]</span> <span class="o">+</span> <span class="n">random_character</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">insert_random_character</span><span class="p">(</span><span class="n">seed_input</span><span class="p">)))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&#39;A quick brvown fox&#39;
&#39;A quwick brown fox&#39;
&#39;A qBuick brown fox&#39;
&#39;A quick broSwn fox&#39;
&#39;A quick brown fvox&#39;
&#39;A quick brown 3fox&#39;
&#39;A quick brNown fox&#39;
&#39;A quick brow4n fox&#39;
&#39;A quick brown fox8&#39;
&#39;A equick brown fox&#39;
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">flip_random_character</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns s with a random bit flipped in a random position&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="n">pos</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
    <span class="n">bit</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">new_c</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">^</span> <span class="n">bit</span><span class="p">)</span>
    <span class="c1"># print(&quot;Flipping&quot;, bit, &quot;in&quot;, repr(c) + &quot;, giving&quot;, repr(new_c))</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">[:</span><span class="n">pos</span><span class="p">]</span> <span class="o">+</span> <span class="n">new_c</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">flip_random_character</span><span class="p">(</span><span class="n">seed_input</span><span class="p">)))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&#39;A quick bRown fox&#39;
&#39;A quici brown fox&#39;
&#39;A&#34;quick brown fox&#39;
&#39;A quick brown$fox&#39;
&#39;A quick bpown fox&#39;
&#39;A quick brown!fox&#39;
&#39;A 1uick brown fox&#39;
&#39;@ quick brown fox&#39;
&#39;A quic+ brown fox&#39;
&#39;A quick bsown fox&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us now create a random mutator that randomly chooses which mutation to apply:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return s with a random mutation applied&quot;&quot;&quot;</span>
    <span class="n">mutators</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">delete_random_character</span><span class="p">,</span>
        <span class="n">insert_random_character</span><span class="p">,</span>
        <span class="n">flip_random_character</span>
    <span class="p">]</span>
    <span class="n">mutator</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">mutators</span><span class="p">)</span>
    <span class="c1"># print(mutator)</span>
    <span class="k">return</span> <span class="n">mutator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">mutate</span><span class="p">(</span><span class="s2">&quot;A quick brown fox&quot;</span><span class="p">)))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&#39;A qzuick brown fox&#39;
&#39; quick brown fox&#39;
&#39;A quick Brown fox&#39;
&#39;A qMuick brown fox&#39;
&#39;A qu_ick brown fox&#39;
&#39;A quick bXrown fox&#39;
&#39;A quick brown fx&#39;
&#39;A quick!brown fox&#39;
&#39;A! quick brown fox&#39;
&#39;A quick brownfox&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The idea is now that <em>if</em> we have some valid input(s) to begin with, we may create more input candidates by applying one of the above mutations.  To see how this works, let's get back to URLs.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Mutating-URLs">Mutating URLs<a class="anchor-link" href="#Mutating-URLs">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us now get back to our URL parsing problem.  Let us create a function <code>is_valid_url()</code> that checks whether <code>http_program()</code> accepts the input.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">is_valid_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">http_program</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">is_valid_url</span><span class="p">(</span><span class="s2">&quot;http://www.google.com/search?q=fuzzing&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid_url</span><span class="p">(</span><span class="s2">&quot;xyzzy&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us now apply the <code>mutate()</code> function on a given URL and see how many valid inputs we obtain.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seed_input</span> <span class="o">=</span> <span class="s2">&quot;http://www.google.com/search?q=fuzzing&quot;</span>
<span class="n">valid_inputs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="n">trials</span> <span class="o">=</span> <span class="mi">20</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
    <span class="n">inp</span> <span class="o">=</span> <span class="n">mutate</span><span class="p">(</span><span class="n">seed_input</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_valid_url</span><span class="p">(</span><span class="n">inp</span><span class="p">):</span>
        <span class="n">valid_inputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now observe that by <em>mutating</em> the original input, we get a high proportion of valid inputs:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">valid_inputs</span><span class="p">)</span> <span class="o">/</span> <span class="n">trials</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>0.8
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What are the odds of also producing a <code>https:</code> prefix by mutating a <code>http:</code> sample seed input?  We have to insert ($1 : 3$) the right character <code>'s'</code> ($1 : 96$) into the correct position ($1 : l$), where $l$ is the length of our seed input.  This means that on average, we need this many runs:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trials</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">96</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">seed_input</span><span class="p">)</span>
<span class="n">trials</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>10944
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can actually afford this.  Let's try:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Timer.html" class="import" target="_blank">Timer</a></span> <span class="k">import</span> <span class="n">Timer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trials</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">trials</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">mutate</span><span class="p">(</span><span class="n">seed_input</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inp</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;https://&quot;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Success after&quot;</span><span class="p">,</span>
                <span class="n">trials</span><span class="p">,</span>
                <span class="s2">&quot;trials in&quot;</span><span class="p">,</span>
                <span class="n">t</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">(),</span>
                <span class="s2">&quot;seconds&quot;</span><span class="p">)</span>
            <span class="k">break</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Success after 3659 trials in 0.015765349002322182 seconds
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Of course, if we wanted to get, say, an <code>"ftp://"</code> prefix, we would need more mutations and more runs – most important, though, we would need to apply <em>multiple</em> mutations.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Multiple-Mutations">Multiple Mutations<a class="anchor-link" href="#Multiple-Mutations">&#182;</a></h2><p>So far, we have only applied one single mutation on a sample string.  However, we can also apply <em>multiple</em> mutations, further changing it.  What happens, for instance, if we apply, say, 20 mutations on our sample string?</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seed_input</span> <span class="o">=</span> <span class="s2">&quot;http://www.google.com/search?q=fuzzing&quot;</span>
<span class="n">mutations</span> <span class="o">=</span> <span class="mi">50</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inp</span> <span class="o">=</span> <span class="n">seed_input</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mutations</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;mutations:&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">inp</span><span class="p">))</span>
    <span class="n">inp</span> <span class="o">=</span> <span class="n">mutate</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0 mutations: &#39;http://www.google.com/search?q=fuzzing&#39;
5 mutations: &#39;http:/L/www.googlej.com/seaRchq=fuz:ing&#39;
10 mutations: &#39;http:/L/www.ggoWglej.com/seaRchqfu:in&#39;
15 mutations: &#39;http:/L/wwggoWglej.com/seaR3hqf,u:in&#39;
20 mutations: &#39;htt://wwggoVgle&#34;j.som/seaR3hqf,u:in&#39;
25 mutations: &#39;htt://fwggoVgle&#34;j.som/eaRd3hqf,u^:in&#39;
30 mutations: &#39;htv://&gt;fwggoVgle&#34;j.qom/ea0Rd3hqf,u^:i&#39;
35 mutations: &#39;htv://&gt;fwggozVle&#34;\x7fj.qom/eapRd[3hqf,u^:i&#39;
40 mutations: &#39;htv\\://&gt;fwegozTle&#34;\x7fj.qom/eapd[38hqf,u^:i&#39;
45 mutations: &#39;htv\\://&gt;fweg]ozTle&#34;\x7fjM.qom/eap[8hqf,u^:i&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As you see, the original seed input is hardly recognizable anymore.  By mutating the input again and again, we get a higher variety in the input.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To implement such multiple mutations in a single package, let us introduce a <code>MutationFuzzer</code> class.  It takes a seed (a list of strings) as well as a minimum and a maximum number of mutations.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Fuzzer.html" class="import" target="_blank">Fuzzer</a></span> <span class="k">import</span> <span class="n">Fuzzer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">MutationFuzzer</span><span class="p">(</span><span class="n">Fuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">min_mutations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_mutations</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_mutations</span> <span class="o">=</span> <span class="n">min_mutations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_mutations</span> <span class="o">=</span> <span class="n">max_mutations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">population</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed_index</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the following, let us develop <code>MutationFuzzer</code> further by adding more methods to it.  The Python language requires us to define an entire class with all methods as a single, continuous unit; however, we would like to introduce one method after another.  To avoid this problem, we use a special hack: Whenever we want to introduce a new method to some class <code>C</code>, we use the construct</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">new_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
<p>This seems to define <code>C</code> as a subclass of itself, which would make no sense – but actually, it introduces a new <code>C</code> class as a subclass of the <em>old</em> <code>C</code> class, and then shadowing the old <code>C</code> definition.  What this gets us is a <code>C</code> class with <code>new_method()</code> as a method, which is just what we want.  (<code>C</code> objects defined earlier will retain the earlier <code>C</code> definition, though, and thus must be rebuilt.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Using this hack, we can now add a <code>mutate()</code> method that actually invokes the above <code>mutate()</code> function.  Having <code>mutate()</code> as a method is useful when we want to extend a <code>MutationFuzzer</code> later.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">MutationFuzzer</span><span class="p">(</span><span class="n">MutationFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mutate</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let's get back to our strategy, maximizing <em>diversity in coverage</em> in our population.  First, let us create a method <code>create_candidate()</code>, which randomly picks some input from our current population (<code>self.population</code>), and then applies between <code>min_mutations</code> and <code>max_mutations</code> mutation steps, returning the final result:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">MutationFuzzer</span><span class="p">(</span><span class="n">MutationFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">create_candidate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">candidate</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">population</span><span class="p">)</span>
        <span class="n">trials</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_mutations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_mutations</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
            <span class="n">candidate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutate</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">candidate</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>fuzz()</code> method is set to first pick the seeds; when these are gone, we mutate:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">MutationFuzzer</span><span class="p">(</span><span class="n">MutationFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">fuzz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">):</span>
            <span class="c1"># Still seeding</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">seed_index</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seed_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Mutating</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_candidate</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inp</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seed_input</span> <span class="o">=</span> <span class="s2">&quot;http://www.google.com/search?q=fuzzing&quot;</span>
<span class="n">mutation_fuzzer</span> <span class="o">=</span> <span class="n">MutationFuzzer</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="p">[</span><span class="n">seed_input</span><span class="p">])</span>
<span class="n">mutation_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;http://www.google.com/search?q=fuzzing&#39;
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mutation_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;http://www.goglg.om/sarch?q=tzzine&#39;
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mutation_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;htotq://www0.goo;@ge.cyom/earch?=fuzzi0ng&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With every new invocation of <code>fuzz()</code>, we get another variant with multiple mutations applied.  The higher variety in inputs, though, increases the risk of having an invalid input.  The key to success lies in the idea of <em>guiding</em> these mutations – that is, <em>keeping those that are especially valuable.</em></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Guiding-by-Coverage">Guiding by Coverage<a class="anchor-link" href="#Guiding-by-Coverage">&#182;</a></h2><p>To cover as much functionality as possible, one can rely on either <em>specified</em> or <em>implemented</em> functionality, as discussed in the <a href="Coverage.html">"Coverage"</a> chapter.  For now, we will not assume that there is a specification of program behavior (although it <em>definitely</em> would be good to have one!).  We <em>will</em> assume, though, that the program to be tested exists – and that we can leverage its structure to guide test generation.</p>
<p>Since testing always executes the program at hand, one can always gather information about its execution – the least is the information needed to decide whether a test passes or fails.  Since coverage is frequently measured as well to determine test quality, let us also assume we can retrieve coverage of a test run.  The question is then: <em>How can we leverage coverage to guide test generation?</em></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>One particularly successful idea is implemented in the popular fuzzer named <a href="http://lcamtuf.coredump.cx/afl/"><em>American fuzzy lop</em></a>, or AFL for short.  Just like our examples above, AFL evolves test cases that have been successful – but for AFL, "success" means <em>finding a new path through the program execution</em>.  This way, AFL can keep on mutating inputs that so far have found new paths; and if an input finds another path, it will be retained as well.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us build such a strategy.  We start with introducing a <code>Runner</code> class that captures the coverage for a given function.  First, a <code>FunctionRunner</code> class:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Fuzzer.html" class="import" target="_blank">Fuzzer</a></span> <span class="k">import</span> <span class="n">Runner</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">FunctionRunner</span><span class="p">(</span><span class="n">Runner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize.  `function` is a function to be executed&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">function</span>

    <span class="k">def</span> <span class="nf">run_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_function</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PASS</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FAIL</span>

        <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">outcome</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">http_runner</span> <span class="o">=</span> <span class="n">FunctionRunner</span><span class="p">(</span><span class="n">http_program</span><span class="p">)</span>
<span class="n">http_runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;https://foo.bar/&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>(True, &#39;PASS&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now extend the <code>FunctionRunner</code> class such that it also measures coverage.  After invoking <code>run()</code>, the <code>coverage()</code> method returns the coverage achieved in the last run.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Coverage.html" class="import" target="_blank">Coverage</a></span> <span class="k">import</span> <span class="n">Coverage</span><span class="p">,</span> <span class="n">population_coverage</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">FunctionCoverageRunner</span><span class="p">(</span><span class="n">FunctionRunner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">Coverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run_function</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_coverage</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">coverage</span><span class="p">()</span>
                <span class="k">raise</span> <span class="n">exc</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_coverage</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">coverage</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coverage</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">http_runner</span> <span class="o">=</span> <span class="n">FunctionCoverageRunner</span><span class="p">(</span><span class="n">http_program</span><span class="p">)</span>
<span class="n">http_runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;https://foo.bar/&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>(True, &#39;PASS&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here are the first five locations covered:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">http_runner</span><span class="o">.</span><span class="n">coverage</span><span class="p">())[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[(&#39;urlsplit&#39;, 402), (&#39;http_program&#39;, 4), (&#39;__exit__&#39;, 25), (&#39;__new__&#39;, 14), (&#39;urlsplit&#39;, 403)]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Now for the main class.  We maintain the population and a set of coverages already achieved (<code>coverages_seen</code>).  The <code>fuzz()</code> helper function takes an input and runs the given <code>function()</code> on it.  If its coverage is new (i.e. not in <code>coverages_seen</code>), the input is added to <code>population</code> and the coverage to <code>coverages_seen</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">MutationCoverageFuzzer</span><span class="p">(</span><span class="n">MutationFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coverages_seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c1"># Now empty; we fill this with seed in the first fuzz runs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">population</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run function(inp) while tracking coverage.</span>
<span class="sd">           If we reach new coverage,</span>
<span class="sd">           add inp to population and its coverage to population_coverage</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">outcome</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">runner</span><span class="p">)</span>
        <span class="n">new_coverage</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">runner</span><span class="o">.</span><span class="n">coverage</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">outcome</span> <span class="o">==</span> <span class="n">Runner</span><span class="o">.</span><span class="n">PASS</span> <span class="ow">and</span> <span class="n">new_coverage</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coverages_seen</span><span class="p">:</span>
            <span class="c1"># We have new coverage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coverages_seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_coverage</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us now put this to use:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seed_input</span> <span class="o">=</span> <span class="s2">&quot;http://www.google.com/search?q=fuzzing&quot;</span>
<span class="n">mutation_fuzzer</span> <span class="o">=</span> <span class="n">MutationCoverageFuzzer</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="p">[</span><span class="n">seed_input</span><span class="p">])</span>
<span class="n">mutation_fuzzer</span><span class="o">.</span><span class="n">runs</span><span class="p">(</span><span class="n">http_runner</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">mutation_fuzzer</span><span class="o">.</span><span class="n">population</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;http://www.google.com/search?q=fuzzing&#39;,
 &#39;http://lwww.google.com/searcTh?=fuzzing&#39;,
 &#39;http://lwww&amp;google.com/searcTh\x1f=fuzzing&#39;,
 &#39;Http://www.g/ogle.com/earchq=fuzzing&#39;,
 &#39;http://lwww&amp;goOgle.com\&#39;searcTh\x1f=fu zzin&#34;g&#39;,
 &#39;httP://lw\x7fw&amp;goOgleom\&#39;seXarcTh\x1f=fu zzin&#34;g&#39;,
 &#39;http://ww7Y&amp;oOgle.com\&#39;sear#T`\x1f=fu zin&#34;g&#39;,
 &#39;Http://www*g?ogle.k@omaWrchq=fu3zzing&#39;,
 &#39;Http://www.g/ogle.ol/ercq=fuzzin.Gr&#39;,
 &#39;Http://www*g?ogle.k@omWrchq=f53zzing&#39;,
 &#39;Http://ww*gole.k@olarcq=fu#zzing&#39;,
 &#39;Http://w@w*/gole.k@olrOcq=bE#zzing&#39;,
 &#39;httP://lNw\x7fw&amp;gOOgleom\&#39;seXarcTh\x1f=fu zziN&#34;g&#39;,
 &#39;http://lwww&amp;google.som/seakrcth\x1f=fuzzing&#39;,
 &#34;http://lwww&amp;google.somsckrcth=fuzzin&#39;&#34;,
 &#39;http://lwww.goocle,com/searcTh;=fuzzing&#39;,
 &#39;http://\x7fw7Y&amp;oOge.cnm\&#39;sear#T`\x1f=fu zin&#34;g&#39;,
 &#39;Http://www*g?ole.k@omWr&gt;#hq=f@53zzing&#39;,
 &#39;http://lww.go`olecom/searcTh;=fu&amp;zzing&#39;,
 &#39;http://lww.o`ol!ecom/searcT`;?fu&amp;zzing&#39;,
 &#39;htTp://luw.gI`olFecom/searcTh;=*fu&amp;zing&#39;,
 &#39;http://lww.o`ol!ecom/reacT`;?fu&amp;zzing&#39;,
 &#34;HttP://w!w*g?olG&#39;eC.k@omWr&gt;#hq=f@53?zng&#34;,
 &#39;http://\x7f?w7Y&amp;oOge.7cnm\&#39;ear#T\x1f=fu 2iqn&#34;g&#39;,
 &#39;http://lww.o`ol!ecom/recT`;/fuzzn&#39;,
 &#39;Http://lww.o`ol!ecom/recT`;/&amp;uzzn&#39;,
 &#39;http://l7wgo`nlecom/searc1Tl;=f#u&amp;zzzing&#39;,
 &#39;http://l7wgo`nleC&#34;om/searc1TA&gt;,;=f#u&amp;zz6zing&#39;,
 &#39;hTtp://lww.o`kd!ecom/}reacT`;?fu&amp;zzing&#39;,
 &#39;hTtp://mlww.o`kd!ecom/}sreacT`;?f#u&amp;zzing&#39;,
 &#39;hTtp://wwi.o`kd!ecom/}reacT`;?fu&amp;:zig&#39;,
 &#39;hTtp://mlww.od!eom/}sZrdacT`;;f#ufzzing&#39;,
 &#39;hTtp://mww.o`kd!eOm/}sreVacT`;?=f#uf~zing&#39;,
 &#39;http://lww.o`kl!com/rec4`;/fuzn&#39;,
 &#39;hTtp://Qmlww.o!&#34;eom/}sZrdac-T`;;f#fzzing&#39;,
 &#39;http://\x7f?w7Y&amp;oOge.6cnm\&#39;ear#T\x1f}fu 2iqn&#34;g&#39;,
 &#39;http://mww.o`kd!eOm/}os2eVcT`;m?=f#uf~zing&#39;,
 &#39;htTp://lu7.gI`olFecof6m/saHrcTh;=*fuzaing&#39;,
 &#39;Http://lW}w.o`olcom/recd;/&amp;uzzn&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Success!  In our population, <em>each and every input</em> now is valid and has a different coverage, coming from various combinations of schemes, paths, queries, and fragments.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_coverage</span><span class="p">,</span> <span class="n">cumulative_coverage</span> <span class="o">=</span> <span class="n">population_coverage</span><span class="p">(</span>
    <span class="n">mutation_fuzzer</span><span class="o">.</span><span class="n">population</span><span class="p">,</span> <span class="n">http_program</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/matplotlib.pyplot.html" class="import" target="_blank">matplotlib.pyplot</a></span> <span class="k">as</span> <span class="nn"><a href="https://docs.python.org/3/library/plt.html" class="import" target="_blank">plt</a></span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cumulative_coverage</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Coverage of urlparse() with random inputs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;# of inputs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;lines covered&#39;</span><span class="p">);</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYIAAAEWCAYAAABrDZDcAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADl0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uIDIuMi4zLCBodHRwOi8vbWF0cGxvdGxpYi5vcmcvIxREBQAAIABJREFUeJzt3XmcXFWZ//HPN509ZIUkJpAQWQTBCQlEFHCUERdAFBjFwTWCio4LOM44IuNPcQWRGdRxBkXZRLYMi6DOMAiKDChLkg77DiEJ2aErJOkk3el+fn/c01C0vVSnu7qqbn3fr1e/ququT92+dZ97zrn3XEUEZmZWv4ZUOgAzM6ssJwIzszrnRGBmVuecCMzM6pwTgZlZnXMiMDOrc04EVhaSjpe0XNImSXMHYHkfk3THQMQ20CTd2fEdJZ0q6ewBWObMtO0aepgmJO3V33UNBEmzUjxDB2FdD0k6vNzrqSdOBANE0gclLUw/3lWS/kfSmyodVwWdC3wuInaKiMZKB1Mukt4NbCz6jhcAH5Y0pT/LjYhladu1pfXcJukT/Qw3FyJi/4i4rdzrkXSJpG+Xez3VwIlgAEj6IvAD4LvAVGAm8J/AsYMYgyRV0/9zd+ChgVhQOc8yB2DZnwYu6/gQEVuB/wE+2s/lltVgnLlbDYkI//XjDxgPbAJO6GGaEWSJYmX6+wEwIo17BDimaNqhwHrgwPT5jcCfgAJwH3B40bS3Ad8B7gS2AHsBJ6VlbgSeBj7VKZZ/BlalOD4BBLBXUZznAsuANcBPgFHdfKchwFeBZ4G1wC/SthiRtkcAm4Gnuph3Vho/tNN3+UR6/7H0nc4DXgC+nYbdUTR9AKem77ge+D4wJI3bE/g98HwadzkwoWjepcCXgfuBbWmbfxl4Lm23x4Ajir7n6cBTaXkLgElp3PC03Xfr9P0+BPyhm+32DeDf0/thaRudkz6PArYCE4u3Ufoft6Vxm4AfF22DTwNPAE3AfwDqZr1nAtcAvwReTP/7g4E/k+1bq4AfA8M7beMulw80pH1lffoffLb4fwpMB25M/78ngU92iuW/UiwbgQeA1wBfIduXlgPv6OH3tBR4W9GyFpDtfxvJTj7mdZr2K8DD6TtcDIws2s/u6LTsIPsdnQK0Ai1pm/86je9yP6n1v4oHUOt/wJHAdooOal1M803gLmAKMJnswP6tNO5rwOVF074LeDS935Xs4HM02QHp7enz5DT+NrKD9v7pgDEszb8nIOAtQDMvJ5UjgdVp+tFkZ7LFieAH6cc7CRgL/Bo4q5vvdHL6ge8B7ARcB1xWNP6l5XYx7yx6TwTbgc+n7zWq8482zf+HFOtM4PGi+fdK22pE2t63Az8omncpsASYkZa9D9nBZ3pRfHum919I/7vd0vJ+ClyZxu0PbO7i+x0IvNDNd38r8EB6fyhZgrm7aNx9XW2j4u3TaRv8BpiQtsE64Mhu1nsm2YHtOLJ9aRRwENmJxtC0vkeAL5SyfLIE8WjahpPS/6I43j+SlYpHAnPSvEcUxbIVeGda9y+AZ4B/IduHPwk808PvaSmvTARbyX4jDcBZwF2dpn2wKM47gW8X7WddJoL0/pKOadPnbveTWv+reAC1/kd29re6l2meAo4u+vxOYGl6vxfZ2cXo9Ply4Gvp/ZcpOrimYf8LzE/vbwO+2cu6fwWclt5fRNGBPa274wxIZGenexaNP6S7HyRwK/CZos/7kB1oOg4E/U0EyzrN84ofbZr/yKLPnwFu7WZ9xwGNRZ+XAid32g5rgbcBwzrN+whFZ33AtI7vCRzW1f8e2Bto6yaWjrP+nclKGmcAK8iS6TeAH3W1jeg+Ebyp6PMC4PRu1nsmcHsv+8oXgOtLWT5ZievTRePewcslmBlkJZixRePPAi4piuV3RePeTXbW3ZA+j03LmtBNnEt5ZSK4pWjcfsCWTtMWx3k0qZTaeZ/qvN/yl4mg2/2k1v+qqU65Vj0P7NJLnet0siqUDs+mYUTEk2QHm3dLGg28B7giTbc7cIKkQscf8Cayg1GH5cUrknSUpLskvZCmPxrYpSiO5d3MO5mslLCoaF03peGlfqehZG0kA2F575O8YpqXtqmkKZKukvScpBfJqiB26W7e9D/4AtlBZW2ad3oavTtwfdE2eYTsIDeVrKphbBdxjQU2dBVwRGwBFpKV1t5Mdub8J7Kk8pb0uS9WF71vJkso3em8r7xG0m8krU7b6bv85Xbqbvmd96XifWE6WYloY6fxuxZ9XlP0fguwPlLDePpML9+lpxhHdvo9drmf9FUv+0lNcyLovz+TneEd18M0K8kOKB1mpmEdrgQ+QNa4/HDa4SDbgS+LiAlFf2MiovjyxOh4I2kEcC1Z3e3UiJgA/DfZ2T5k9cC7Fc07o+j9erIf4P5F6xofEd39GLv6Ttt55Q+8O5vT6+iiYa/qNE3Qu+L4i7fpWWn+2RExDvgwL2+DLpcfEVdExJvIvlMA30ujlgNHdfofjIyI58jqziVpV17ptWTtOd35I1k10Fzg3vT5nWR19rd3M08p26M3nZdxPln1zt5pO53BX26n7qziL7d/h5XAJEljO41/rm/hDpju9pPNFO2DknrdB3vYT2qaE0E/RcQGsnr+/5B0nKTRkoalM/Nz0mRXAl+VNFnSLmn6XxYt5iqyovXf83JpgDTNuyW9U1KDpJGSDpdUfDAvNpysHnsdsF3SUWm5HRYAJ0l6bSp9fK3oe7QDPwPO67j0UdKukt7ZzbquBP5B0qsl7UR2Nnl1RGzvaXulda0jOyh8OH2vk8naNfrqS5ImSpoBnAZcnYaPJatqKKSD9Jd6WoikfSS9NSXSrWQJsePs9CfAdyTtnqadLOnY9D1agVvIzuSLvYXsyqHu/JHsqqKHI6KFVO1DVg23rpt51pC1xwyksWQNx5sk7Uu2/5VqAXCqpN0kTSSr5gIgIpaTlXLOSvvsbODjZNWelfDZFOcksmTXsZ/cB+wvaY6kkWRn+sVesc172U9qmhPBAIiIfwO+SHYVzTqys8jPkdXPQ3bVy0Kyq1QeABanYR3zryIrWRzKyztpxw/qWLKdt2O5X6Kb/1sqip9K9iNtAj5I1vjbMf5/gB+RNew9mdYJ2ZUzkLVJPAnclaoKbiGr++/KRWSNzbeTNfRtJWvcLdUn03d5nqzR9U99mLfDDcAisobf3wIXpuHfIGuw3ZCGX9fLckYAZ5OVilaTNeqfkcb9kGwb3ixpI1nD8RuK5v0p8JGOD+mAcjRwaQ/r+xNZW0HH2f/DZNuvu9JARxzvk9Qk6Ue9fJ9S/RPZPrKR7CTg6p4nf4WfkbVX3Ue2P3fexh8ga+dYCVwPfD0iftfPeHfUFcDNZFc3PU367UXE42QXctxCVrrrfMPihcB+qVrwV/S8n9S0jkvBrA5Jei3ZFRUjSjmTryaSgqxK48leJy5/LHcAn4+IRkmfB2ZExD9XOi4DSUvJGtlvqXQs1cw3ldQZSceTnSWPIavf/HWtJYFqk+qMO97/eyVjMdsRrhqqP58iq2Z6iqx+sy/1wmaWQ64aMjOrcy4RmJnVuZpoI9hll11i1qxZlQ7DzKymLFq0aH1EdHdT6EtqIhHMmjWLhQsXVjoMM7OaIunZ3qdy1ZCZWd1zIjAzq3NOBGZmdc6JwMyszjkRmJnVuXI+C3YfXtmJ1R5kvV1OIOtwrKOXxTMi4r/LFYeZmfWsbIkgIh4je0QdkhrIuh2+nuyZuudFxLnlWreZmZVusO4jOILs8XDPSqU+98LM+mPdxm1cfe8yWra3VzoU64fjD9yNV+8ypqzrGKxEcCLZg0w6fE7SR8n66P/HiGjqPIOkU4BTAGbOnNl5tJn14NnnN/ORC+9h2QvN+Nyrth24+8SyJ4KydzonaTjZwyn2j4g1kqaSPdghgG8B0yLi5J6WMW/evPCdxWaleWjlBuZfdC9t7e1cfNLBzJkxodIhWYVIWhQR83qbbjCuGjoKWBwRawAiYk1EtBU9GvHgQYjBrC7c9fTznPjTuxjeIP7r04c6CVhJBiMRfICiaiFJ04rGHU/2hCwz66f/fWg1H73oHqaOH8m1nzmUvabsVOmQrEaUtY0gPSD97WQPQ+lwjqQ5ZFVDSzuNM7MdcPW9y/jKdQ9wwIwJXDT/9UwcM7zSIVkNKWsiiIhmYOdOwz7SzeRm1kcRwfl/fIpzbnqMt7xmMud/+EBGD6+JToWtiniPsZrV1h48tW4T29vq9yl71yxawUV3PsNxc6bz/RMOYFiDOwuwvnMisJp1xd3P8v9ueKjSYVTcSYfN4v+9az+GDPF1orZjnAisZt319Au8atxIznzP/pUOpWImjh7Gwa+ehG/UtP5wIrCa1biside/ehJHvu5VlQ7FrKa5QtFq0uoNW1m5YStzfZ28Wb85EVhNWrI865Vk7kwnArP+ciKwmtS4rMDwhiHsN31cpUMxq3lOBFaTGpcV2H/XcYwY2lDpUMxqnhOB1ZzWtnbuf67A3BkTKx2KWS44EVjNeWz1Rra2trt9wGyAOBFYzWlc5oZis4HkRGA1p3FZgcljR7DrhFGVDsUsF5wIrOY0Li8wd8YE301rNkCcCKymNG1u4Zn1m5k70w3FZgPFicBqypLlBcDtA2YDyYnAakrjsiaGCGbvNr7SoZjlhhOB1ZTG5QX2fdU4P3zFbAA5EVjNaG8PliwruFrIbIA5EVjNeGrdJjZu2+6GYrMB5kRgNaNxmRuKzcrBicBqRuPyJsaPGsardx5T6VDMcsWJwGpG47ICc2ZM8LN5zQaYE4HVhE3btvPYmo2uFjIrAycCqwn3Ly8QgRuKzcrAicBqQmO6o3jObi4RmA00JwKrCY3Lmthz8hjGjx5W6VDMcseJwKpeRNC4rOBqIbMycSKwqrf8hS08v7nFDcVmZVK2RCBpH0lLiv5elPQFSZMk/U7SE+nVp3nWo8bl6YlkfkaxWVmULRFExGMRMSci5gAHAc3A9cDpwK0RsTdwa/ps1q3GZQVGD2/gNVN3qnQoZrk0WFVDRwBPRcSzwLHApWn4pcBxgxSD1ajGZU3M3m08Qxtck2lWDoP1yzoRuDK9nxoRqwDS65SuZpB0iqSFkhauW7dukMK0arO1tY2HVr7ohmKzMip7IpA0HHgP8F99mS8iLoiIeRExb/LkyeUJzqreQys3sL09mDvDDcVm5TIYJYKjgMURsSZ9XiNpGkB6XTsIMViN6uhxdI6vGDIrm8FIBB/g5WohgBuB+en9fOCGQYjBalTjsgK7TRzFlLEjKx2KWW6VNRFIGg28HbiuaPDZwNslPZHGnV3OGKy2NS5rcvuAWZmV9cGvEdEM7Nxp2PNkVxGZ9Wj1hq2s3LCVT7h9wKys/ARwq5il6zdzyZ+W0h7R5fhVG7YCfiKZWbk5EVjF/Oj3T/CrxucYP6r7juT2nz6O/aaPG8SozOqPE4FVRHPLdm56cDXvnzeDs987u9LhmNU136ppFXHzQ2tobmnj+Lm7VjoUs7rnRGAVce3iFew2cRSvnzWp0qGY1T0nAht0a1/cyp1Pruf4ubv6QfRmVcCJwAbdDUtW0h64WsisSjgR2KC7dvEK5syYwB6T3a20WTVwIrBB9fDKF3l09Ub+9kCXBsyqhROBDarrG1cwrEEcM3t6pUMxs8SJwAZNW3tww5KVHL7PFCaNGV7pcMwscSKwQXPnk+tZu3Ebf+tGYrOq4kRgg+a6xSsYN3Iob31tlw+lM7MKcSKwQbFp23b+96E1HHPAdEYMbah0OGZWxInABsVND65mS2ubq4XMqpATgQ2K6xtXMHPSaA7a3Q+ZMas2TgRWdqs2bOFPTz3P8XN3RXKXEmbVxonAyu5XjSsJdylhVrWcCKysIoLrFq/goN0nMmuXMZUOx8y64ERgZfXQyhd5Yu0mlwbMqpgTgZXVdYufY3jDEI6ZPa3SoZhZN5wIrGy2t7Vz433P8dZ9pzBhtLuUMKtWfmaxdWvJ8gJX3bOMtvbYofkLW1pZv6mF493TqFlVcyKwLv3+0TV85vLFDBsyhLEjd3w3mbf7RP5mH3cpYVbNnAjsL1y7aAX/fO397DdtHBef9Hp22WlEpUMyszLqNhFIegDotk4gImaXJSKrqJ//39N8+7ePcNheO/PTj8xjpxE+VzDLu55+5cek18+m18vS64eA5rJFZBUREXzvpsf4yR+f4ui/ehXn/d0cdw5nVie6TQQR8SyApMMi4rCiUadLuhP4Zm8LlzQB+DnwOrLSxcnAO4FPAuvSZGdExH/vWPg2ELa3tXPG9Q+wYOEKPvSGmXzz2NfRMMRdQZjVi1LK/WMkvSki7gCQdChQ6i2iPwRuioj3SRoOjCZLBOdFxLk7FLENqK2tbXzuikZueWQNpx2xN194297uD8iszpSSCD4OXCRpPNlZ/QayM/seSRoHvBn4GEBEtAAtPsgMnM3btnPP0heI2LHLOyPgp7c/zb1LX+Ab79mf+YfOGtgAzawm9JoIImIRcEA6sCsiNpS47D3Iqn8ulnQAsAg4LY37nKSPAguBf4yIps4zSzoFOAVg5syZJa6yfqzesJX5F93DY2s29ms5wxrED0+cy3sO8MPkzeqVejublDQV+C4wPSKOkrQfcEhEXNjLfPOAu4DDIuJuST8EXgR+DKwnK118C5gWET2WMObNmxcLFy4s9Tvl3tPrNvGRC++h0NzC9943mxkTR+/wsqaMG8G08aMGMDozqxaSFkXEvN6mK6Vq6BLgYuBf0ufHgauBHhMBsAJYERF3p8/XAKdHxJqiIH8G/KaEGCy5f0WBj118LwKuOuUQ/mq38ZUOycxqXCl9De0SEQuAdoCI2A609TZTRKwGlkvaJw06AnhYUnHvY8cDD/Yt5Pp1xxPr+cAFdzF6eAPX/P2hTgJmNiBKKRFslrQz6eYySW8kazAuxeeBy9MVQ08DJwE/kjQnLW8p8Km+Bl2PfnP/Sv7h6iXssctO/OLjBzN13MhKh2RmOVFKIvgicCOwZ7p/YDLwvlIWHhFLgM71Ux/pU4TGZXc9y9dueJCDZk7kwvmvZ/zoYZUOycxypMdEIGkIMBJ4C7APIOCxiGgdhNjqXkTww1uf4Ae3PMER+07hxx88kFHDfbevmQ2sHhNBRLRL+teIOAR4aJBiMqCtPTjzxoe47K5nee+Bu3H2e/+KYQ1+fISZDbxSjiw3S3qvfCfYoNm2vY1Tr2rksrue5ZQ378G5J8x2EjCzsim1jWAM0CZpC1n1UETEuLJGVqc2bdvOpy9bxB1PrucrR+3Lp96yZ6VDMrOcK+XO4rGDEYjB85u2cfIl9/Lgyhf5/vtmc8K8GZUOyczqQK+JIFUJfQh4dUR8S9IMsruB7yl7dHVkRVMzH73oHp5r2sJPP3wQb9tvaqVDMrM6UUrF838ChwAfTJ83Af9Rtojq0ONrNvK+8//Muo3b+OUn3uAkYGaDqpQ2gjdExIGSGgEioindIGYDYNGzTZx8yb2MGDqEBZ86hNdOc9OLmQ2uUhJBq6QGXr6zeDKpu4l6t2R5gYvueKb753n2IiK45ZE1vGrcSC77+BuYMWnHO48zM9tRpSSCHwHXA1MkfYfsruKvljWqGnHNouX89oFV7N6PA/gb99iZc084wA+IN7OKKeWqocslLSLrNE7AcRHxSNkjqwFNza3sPmk0v/+nwysdipnZDivlqqEfAldHhBuIOyk0tzDB/f6YWY0r5aqhxcBXJT0p6fvpgTMGFJpbmTja7eZmVtt6TQQRcWlEHA0cTPZQmu9JeqLskdWAQnOrewI1s5rXlw5s9gL2BWYBj5YlmhrT1NziEoGZ1bxeE4GkjhLAN8l6ID0oIt5d9siq3LbtbTS3tDHRJQIzq3GlXD76DNnD6teXO5hasqE5eyTDeJcIzKzGlXL56E8kvUfSm9OgP0bEr8scV9VrSonAJQIzq3WlVA2dBZwGPJz+Tk3D6lqhuQXAbQRmVvNKqRp6FzAnItoBJF0KNAJfKWdg1a6jRDB+lEsEZlbbSr1qaELR+/HlCKTWvFQiGOMSgZnVtlJKBGcBjZL+QNbFxJup89IAQGGL2wjMLB9KaSy+UtJtwOvJEsGXI2J1uQOrdk3NLQxvGMKoYQ2VDsXMrF9KaSw+HmiOiBsj4gZgq6Tjyh9adStsbmXC6GFkD3AzM6tdpbQRfD0iNnR8iIgC8PXyhVQbfFexmeVFKYmgq2lKaVvItcIW9zNkZvlQSiJYKOnfJO0paQ9J5wGLyh1YtSs0t7ih2MxyoZRE8HmgBbgaWABsAT5bzqBqQZO7oDaznCjlqqHNwOk7snBJE4CfA68je+bxycBjZEllFrAUeH9ENO3I8islItjQ3MoEJwIzy4G+dEO9I34I3BQR+wIHAI+QJZVbI2Jv4FZ2MMlUUnNLGy1t7X46mZnlQtkSgaRxZDefXQgQES3piqNjgUvTZJcCNXcpatNL/Qw5EZhZ7StniWAPYB1wsaRGST+XNAaYGhGrANLrlK5mlnSKpIWSFq5bt66MYfZdIfUz5KohM8uDUm4oO0fSOEnDJN0qab2kD5ew7KHAgcD5ETEX6FNbQ0RcEBHzImLe5MmTS51tULyUCNzhnJnlQCklgndExIvAMcAK4DXAl0qYbwWwIiLuTp+vIUsMayRNA0iva/scdYU1ucM5M8uRUhJBx2nv0cCVEfFCKQtO/REtl7RPGnQE2fMMbgTmp2HzgRtKD7c6dHQ458ZiM8uDUu4Q/rWkR8nuH/iMpMnA1hKX/3ngcknDgaeBk8iSzwJJHweWASf0PezKKmzOSgQTRrlEYGa1r5T7CE6X9D3gxYhok9RMduVPryJiCTCvi1FH9C3M6tLU3MqY4Q0MH1ruq2/NzMqvlMbi0WR3Ep+fBk2n64N73ShsafEVQ2aWG6Wc0l5M1sXEoenzCuDbZYuoBhSaW90+YGa5UUoi2DMizgFaASJiC9kDauqWu6A2szwpJRG0SBpF1lcQkvYEtpU1qiq3wSUCM8uRUq4a+jpwEzBD0uXAYcDHyhlUtWtqbnEiMLPcKOWqod9JWgy8kaxK6LSIWF/2yKpUe3uwYYu7oDaz/Cj1SWMjgaY0/X6SiIjbyxdW9dq4dTvt4X6GzCw/ek0E6R6CvwMeAtrT4ADqMhF0dC/hfobMLC9KKREcB+wTEXXdQNzh5X6GnAjMLB9KuWroaV7ub6juvdzPkKuGzCwfSikRNANLJN1K0WWjEXFq2aKqYgVXDZlZzpSSCG5MfwY0bc5KBL5qyMzyopTLRy/tbZp6UtjSigTjXCIws5zoNhFIWhAR75f0AOmu4mIRMbuskVWpQnML40YOo2FIXfeyYWY50lOJ4LT0esxgBFIrmppb/dB6M8uVbhNB0QPmnx28cKpfodldUJtZvvRUNbSRLqqEyLqZiIgYV7aoqlihuZWdd3IiMLP86KlEMHYwA6kVTc0t7DVlp0qHYWY2YPysxT5yF9RmljdOBH3Q2tbOxm3b/dB6M8sVJ4I+KDSnm8ncz5CZ5YgTQR9s2JK6l/BVQ2aWI04EfdCUSgTuZ8jM8sSJoA+aNqcuqF0iMLMccSLog442Al81ZGZ54kTQB4WX2gicCMwsP5wI+qCpuZWhQ8ROI0p91LOZWfVzIuiDjn6GJPc8amb5UdZEIGmppAckLZG0MA07U9JzadgSSUeXM4aBVHDPo2aWQ4NRx/E3EbG+07DzIuLcQVj3gGpqbnH7gJnljquG+qDQ3Oqbycwsd8qdCAK4WdIiSacUDf+cpPslXSRpYlczSjpF0kJJC9etW1fmMEvjqiEzy6NyJ4LDIuJA4Cjgs5LeDJwP7AnMAVYB/9rVjBFxQUTMi4h5kydPLnOYpWnyQ2nMLIfKmggiYmV6XQtcDxwcEWsioi0i2oGfAQeXM4aBsqWljW3b291GYGa5U7ZEIGmMpLEd74F3AA9KmlY02fHAg+WKYSB13Ezm7iXMLG/KedXQVOD6dM39UOCKiLhJ0mWS5pC1HywFPlXGGAZM02Z3OGdm+VS2RBARTwMHdDH8I+VaZzkVmt0FtZnlky8fLVFhix9KY2b55ERQoqaOEoEfU2lmOeNEUCJ3QW1meeVEUKJCcwujhjUwclhDpUMxMxtQTgQlampudWnAzHLJiaBEBd9VbGY55URQIvczZGZ55URQIndBbWZ55URQIndBbWZ55URQgoigsMVVQ2aWT04EJdi4bTtt7eGbycwsl5wISlDY7JvJzCy/nAhK4C6ozSzPnAhK0OTuJcwsx5wISuAuqM0sz5wIStDR4ZyvGjKzPHIiKEFHF9Tj/XQyM8shJ4ISFJpbGTtyKEMbvLnMLH98ZCtBobnFVwyZWW45EZTAXVCbWZ45EZTAXVCbWZ45EZTA/QyZWZ45EZSgaXMLE3zFkJnllBNBL7a3tfPi1u2uGjKz3HIi6MWGLb6ZzMzyzYmgF4UtHf0MuURgZvnkRNCLl/sZconAzPJpaDkXLmkpsBFoA7ZHxDxJk4CrgVnAUuD9EdFUzjj6o2lzR9WQSwRmlk+DUSL4m4iYExHz0ufTgVsjYm/g1vS5ahW2OBGYWb5VomroWODS9P5S4LgKxFCyjqqh8a4aMrOcKnciCOBmSYsknZKGTY2IVQDpdUpXM0o6RdJCSQvXrVtX5jC719TcQsMQMW5kWWvRzMwqptxHt8MiYqWkKcDvJD1a6owRcQFwAcC8efOiXAH2ptDcyoRRw5BUqRDMzMqqrCWCiFiZXtcC1wMHA2skTQNIr2vLGUN/FZpbXS1kZrlWtkQgaYyksR3vgXcADwI3AvPTZPOBG8oVw0BochfUZpZz5awamgpcn6pUhgJXRMRNku4FFkj6OLAMOKGMMfRbobmV6RNGVjoMM7OyKVsiiIingQO6GP48cES51jvQCs0tvHbauEqHYWZWNr6zuBdNze6C2szyzYmgB1tb29jS2sbEMW4jMLP8ciLoQUfPo+P9LAIzyzEngh40pbuKfdWQmeWZE0EPCs1+FoGZ5Z8TQQ/cz5CZ1QMngh40NbvnUTPLPyeCHhScCMysDuS6S81/v/UJbrxv5Q7P//zmFoYPHcLIYc6XZpZfuU4Ek8eOYO+pO+3w/HsDr9t1vHseNbNcy3UiOPHgmZx48MxKh2EadVPpAAAGo0lEQVRmVtVc52FmVuecCMzM6pwTgZlZnXMiMDOrc04EZmZ1zonAzKzOORGYmdU5JwIzszqniKh0DL2StA54dgdn3wVYP4DhDDTH1z+Or38cX/9Vc4y7R8Tk3iaqiUTQH5IWRsS8SsfRHcfXP46vfxxf/9VCjL1x1ZCZWZ1zIjAzq3P1kAguqHQAvXB8/eP4+sfx9V8txNij3LcRmJlZz+qhRGBmZj1wIjAzq3O5TgSSjpT0mKQnJZ1e6Xg6k7RU0gOSlkhaWAXxXCRpraQHi4ZNkvQ7SU+k14lVFt+Zkp5L23CJpKMrGN8MSX+Q9IikhySdloZXxTbsIb6q2IaSRkq6R9J9Kb5vpOGvlnR32n5XS6rIQ8R7iO8SSc8Ubb85lYivP3LbRiCpAXgceDuwArgX+EBEPFzRwIpIWgrMi4iquBlF0puBTcAvIuJ1adg5wAsRcXZKphMj4stVFN+ZwKaIOLcSMRWTNA2YFhGLJY0FFgHHAR+jCrZhD/G9nyrYhsqeCTsmIjZJGgbcAZwGfBG4LiKukvQT4L6IOL+K4vs08JuIuGawYxooeS4RHAw8GRFPR0QLcBVwbIVjqmoRcTvwQqfBxwKXpveXkh04KqKb+KpGRKyKiMXp/UbgEWBXqmQb9hBfVYjMpvRxWPoL4K1Ax0G2ktuvu/hqXp4Twa7A8qLPK6iinT4J4GZJiySdUulgujE1IlZBdiABplQ4nq58TtL9qeqoYlVXxSTNAuYCd1OF27BTfFAl21BSg6QlwFrgd8BTQCEitqdJKvo77hxfRHRsv++k7XeepBGVim9H5TkRqIth1Za9D4uIA4GjgM+mqg/rm/OBPYE5wCrgXysbDkjaCbgW+EJEvFjpeDrrIr6q2YYR0RYRc4DdyEr1r+1qssGNqmjFneKT9DrgK8C+wOuBSUBFqk77I8+JYAUwo+jzbsDKCsXSpYhYmV7XAteT7fjVZk2qW+6oY15b4XheISLWpB9nO/AzKrwNU93xtcDlEXFdGlw127Cr+KptG6aYCsBtwBuBCZKGplFV8Tsuiu/IVOUWEbENuJgq2H59ledEcC+wd7riYDhwInBjhWN6iaQxqcEOSWOAdwAP9jxXRdwIzE/v5wM3VDCWv9BxgE2Op4LbMDUmXgg8EhH/VjSqKrZhd/FVyzaUNFnShPR+FPA2snaMPwDvS5NVcvt1Fd+jRUleZO0X1fg77lFurxoCSJfB/QBoAC6KiO9UOKSXSNqDrBQAMBS4otLxSboSOJysW901wNeBXwELgJnAMuCEiKhIg2038R1OVqURwFLgUx318RWI703A/wEPAO1p8Blk9fAV34Y9xPcBqmAbSppN1hjcQHaSuiAivpl+K1eRVbs0Ah9OZ9/VEt/vgclk1dFLgE8XNSrXhFwnAjMz612eq4bMzKwETgRmZnXOicDMrM45EZiZ1TknAjOzOudEYLkm6SxJh0s6Tn3sgTZdN363pEZJf91p3M8l7Tew0YKkMwZ6mWa98eWjlmvpGu93Ad8FromIO/sw74nAURExv9eJB4ikTRGx02CtzwxcIrCckvR9SfeT9f/yZ+ATwPmSvtbFtLtLujV1GnarpJmpT/lzgKNTH/OjOs1zm6R56f0mSd9J/dTfJWlqGn6JpJ9I+j9Jj0s6Jg3/mKQfFy3rN6nUcjYwKq3v8nT3+W/Tch+U9Hdl2lxW55wILJci4ktkB/9LyJLB/RExOyK+2cXkPyZ7xsFs4HLgRxGxBPgacHVEzImILT2sbgxwV0QcANwOfLJo3CzgLWSlkp9IGtlDzKcDW9L6PgQcCayMiAPS8xduKuW7m/WVE4Hl2VyyW/73BXp6INEhwBXp/WXAm/q4nhbgN+n9IrKDf4cFEdEeEU8AT6dYSvUA8DZJ35P01xGxoY9xmZVkaO+TmNWWVK1zCVlPleuB0dlgLQEO6eXsHvrezXFrvNzY1sYrf1edlxXAdl55EtZlKSEiHpd0EHA0cJakm7sp0Zj1i0sEljsRsST1Gf84sB/we+CdPVTx/Imsd1qAD5E9gnCgnCBpiKQ9gT2Ax8g6dpuThs/gld0Wt6auopE0HWiOiF8C5wIHDmBcZi9xicBySdJkoCki2iXt28uzqk8FLpL0JWAdcNIAhvIY8EdgKlmvlFsl3Qk8Q1b18yCwuGj6C4D7JS0GfgF8X1I70Ar8/QDGZfYSXz5qViaSLqHGH2pu9cFVQ2Zmdc4lAjOzOucSgZlZnXMiMDOrc04EZmZ1zonAzKzOORGYmdW5/w8wB1IARDHCDgAAAABJRU5ErkJggg==
"
>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The nice thing about this strategy is that, applied to larger programs, it will happily explore one path after the other – covering functionality after functionality.  All that is needed is a means to capture the coverage.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned<a class="anchor-link" href="#Lessons-Learned">&#182;</a></h2><ul>
<li>Randomly generated inputs are frequently invalid – and thus exercise mostly input processing functionality.</li>
<li>Mutations from existing valid inputs have much higher chances to be valid, and thus to exercise functionality beyond input processing.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps<a class="anchor-link" href="#Next-Steps">&#182;</a></h2><p>Our aim is still to sufficiently cover functionality, such that we can trigger as many bugs as possible.  To this end, we focus on two classes of techniques:</p>
<ol>
<li><p>Try to cover as much <em>specified</em> functionality as possible.  Here, we would need a <em>specification of the input format,</em> distinguishing between individual input elements such as (in our case) numbers, operators, comments, and strings – and attempting to cover as many of these as possible.  We will explore this as it comes to <a href="GrammarFuzzer.html">grammar-based testing</a>, and especially in <a href="Parser.html">grammar-based mutations</a>.</p>
</li>
<li><p>Try to cover as much <em>implemented</em> functionality as possible.  The concept of a "population" that is systematically "evolved" through "mutations" will be explored in depth when discussing <a href="SearchBasedFuzzer.html">search-based testing</a>.  Furthermore, <a href="SymbolicFuzzer.html">symbolic testing</a> introduces how to systematically reach program locations by solving the conditions that lie on their paths.</p>
</li>
</ol>
<p>These two techniques make up the gist of the book; and, of course, they can also be combined with each other.  As usual, we provide runnable code for all.  Enjoy!</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises<a class="anchor-link" href="#Exercises">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1:-Fuzzing-CGI-decode-with-Mutations">Exercise 1: Fuzzing CGI decode with Mutations<a class="anchor-link" href="#Exercise-1:-Fuzzing-CGI-decode-with-Mutations">&#182;</a></h3><p>Apply the above <em>guided</em> mutation-based fuzzing technique on <code>cgi_decode()</code> from the <a href="Coverage.html">"Coverage"</a> chapter.  How many trials do you need until you cover all variations of <code>+</code>, <code>%</code> (valid and invalid), and regular characters?</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Coverage.html" class="import" target="_blank">Coverage</a></span> <span class="k">import</span> <span class="n">cgi_decode</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seed</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Hello World&quot;</span><span class="p">]</span>
<span class="n">cgi_runner</span> <span class="o">=</span> <span class="n">FunctionCoverageRunner</span><span class="p">(</span><span class="n">cgi_decode</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">MutationCoverageFuzzer</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">runs</span><span class="p">(</span><span class="n">cgi_runner</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">population</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;Hello World&#39;, &#39;Hell+O Worlpd&#39;, &#39;B%5bmo bWOrl)d&#39;, &#39;B%5bmo!+WOrld&#39;]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cgi_runner</span><span class="o">.</span><span class="n">coverage</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{(&#39;__exit__&#39;, 25),
 (&#39;cgi_decode&#39;, 9),
 (&#39;cgi_decode&#39;, 10),
 (&#39;cgi_decode&#39;, 11),
 (&#39;cgi_decode&#39;, 12),
 (&#39;cgi_decode&#39;, 15),
 (&#39;cgi_decode&#39;, 16),
 (&#39;cgi_decode&#39;, 17),
 (&#39;cgi_decode&#39;, 18),
 (&#39;cgi_decode&#39;, 19),
 (&#39;cgi_decode&#39;, 21),
 (&#39;cgi_decode&#39;, 30),
 (&#39;cgi_decode&#39;, 31),
 (&#39;cgi_decode&#39;, 32),
 (&#39;run_function&#39;, 7)}
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_coverage</span><span class="p">,</span> <span class="n">cumulative_coverage</span> <span class="o">=</span> <span class="n">population_coverage</span><span class="p">(</span>
    <span class="n">m</span><span class="o">.</span><span class="n">population</span><span class="p">,</span> <span class="n">cgi_decode</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/matplotlib.pyplot.html" class="import" target="_blank">matplotlib.pyplot</a></span> <span class="k">as</span> <span class="nn"><a href="https://docs.python.org/3/library/plt.html" class="import" target="_blank">plt</a></span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cumulative_coverage</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Coverage of cgi_decode() with random inputs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;# of inputs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;lines covered&#39;</span><span class="p">);</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYIAAAEWCAYAAABrDZDcAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADl0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uIDIuMi4zLCBodHRwOi8vbWF0cGxvdGxpYi5vcmcvIxREBQAAIABJREFUeJzt3XecFYXV//HPoVdB2IWlL70tirpiVzQWsKFJ/CUaazQaE6NJfPJo7DXGNJM8JjFGCbHEaEzsgmIDu4KiLL0X2WXpfWHL+f0xs3pdt1xg751bvu/Xa187d+qZO3PnTD1j7o6IiGSvJlEHICIi0VIiEBHJckoEIiJZTolARCTLKRGIiGQ5JQIRkSynRCC7zczONLMVZrbVzA5oxPHOMrPRuznMaDNb2VgxxDnNW8zskd3o/zIz+33Y3NXM5phZy0aIY6KZXVBP9wlmdsfeTqexmNkbZnZJEqZznZk9kOjpZBIlgjiY2TlmNi3c8BWHP8Ajo44rQr8BrnD3du7+cWON1N2Hu/sbjTW+VGBmLYAbgF8DuPtq4HXg0r0dt7uPdfd/hNO50Mze2ttxZgJ3/4W7JyPhJH0nJFGUCBpgZj8Ffg/8AugK9Ab+DIxLYgxmZqm0rPoAs6IOIk2MA+a6+2cx7R4FLosonriYWbOoY5Akcnf91fEHdAC2AmfV009LgkSxKvz7PdAy7DYHODWm32bAWuDA8POhwDvARuATYHRMv28AdwJvAzuAAcBF4Ti3AIuBy2rE8r9AcRjHJYADA2Li/A2wHFgN3Ae0rmOemhDsxS4DSoGHwu+iZfh9OLANWFTH8MOBycD6cFrXhe1bA/8ANoTz8b/AypjhlgLHN7BMWgMTwnHMBn5WYxzdgf8Aa4AlwJUx3ZoC1wGLwu9wOtAr7HY48CGwKfx/eMxwfYEp4TCTgXuBR2K617ccxwM31JiHZsB2oE8t89c3HE+T8PMDQGlM90eAH8esI5cAQ4EyoDJcPhvD7hOAPwEvhLG/D/Sv43vND5frxeE6MjVs/2+gJPxepgLDY4apd/zACcDccNh7w+/wkvrWsRqxXASsCJf194GDgU/D7+feetaRW6qXT8y4Lgjnay1wfY1+nwQeD+fhI2D/mO6f/4Zi5vkOoC3B77Iq/M63Eqx7o4BpwGaCdf93UW/H4trWRR1AKv8BY4AKoFk9/dwGvAd0AXIJNgi3h91uAh6N6fcUgr1DgB7AOuDk8EdxQvg5N+z+RrjiDifYcDQPh+8PGHAMwcbkwJhYS8L+2wAP8+VE8HvgWaAT0B54Drirjnn6LrAQ6Ae0A/4LPBzT/Us/jhrDtidIRlcDrcLPh4TdfkmwMdgX6Bn+qHc3EfwSeDOcj15AUfU4wu9xevi9twjjXwycFHb/GTATGBx+h/sDncNxbQDOC7/rs8PPncPh3gV+R5AIjybYYDwS53L8kFp2JMJ5P72OeVwOHBQ2zwvnYWhMtwNi1pHqDeuFwFs1xjOBIBmPCufrUeBfdUwzP1yuDxFs5FrHrAvt+WKHZ0Y84wdyCDaG3yRYd39C8Fu6JGa8ta5jMbHcR7AOnUiQ6J4m+J31IEgex9QxL7fw1UTwN4KdiP2BnTHf5y1AeUyc/0OwA9G8tnU9nOc7wubRxKy/MevKeWFzO+DQqLdjcW3rog4glf+A7wAlDfSzCDg55vNJwNKweQDBRqNN+PlR4Kaw+RpiNq5hu5eAC8LmN4DbGpj208BVYfN4Yjbs4bQ9/G8Ee/Cxe2uHAUvqGO+rwA9iPg8OfyzNws/1JYKzgY/r6Pb5Rjn8fAm7nwgWA2NiPl/KF4ngEGB5jf5/Dvw9bJ4HjKtlnOcBH9Ro9y7BxrU3wQasbUy3f8ZsaBpajgti443p523g/Drm8WHgp0BeGPOvCPaIax4tvEHDieCBmM8nE+6I1DLN/HC59qvnu+8Y9tOhofED5wPvxXQzYGVMvHWuYzGx9Ijpvg74Vszn/xAeGdUS5y18NRH0jOn+AfDtmH5j42xCsCNzVG3rOg0ngqnArUBOfetxqv2l0nnnVLQOyGngfGl3gsPbasvCdrj7QoJTIKeZWRvgdIKNCATn2c8ys43Vf8CRQLeYca2InZCZjTWz98xsfdj/yQR7XtVxrKhj2FyCo4TpMdOaFLaPd56aEVwjaUgvguRY13jrijFeNccRG2cfoHuN7/Q6voi7rthqzm/1eHuE3Ta4+7Z6plnfctxAsEddU3uCjXptphBsZI4m2LC8QXAEeAzwprtX1TFcbUpimrcT7KXW5/Pv1syamtkvzWyRmW0mSNTwxTpX3/i/tJw82ErGLrd41rHVMc07avnc0LzEqu97iI2ziiBhdd+Ncce6GBgEzDWzD83s1D0cT1IpEdTvXYJD0jPq6WcVwcagWu+wXbXHCPaSxwGzw+QAwcr3sLt3jPlr6+6/jBnWqxvC2w3/Q3Cev6u7dwReJNjTgmAvpmfMsL1imtcS/HCGx0yrg7vX9UOqbZ4q+PIPsS4rCE5f1aa+GONVXGO43jWmvaTGd9re3U9uILaa81s93s/C6e1rZm3rmWZ9y/FTgg3D58IdiwEE1xNqMwU4iiAZTAHeAo4gSART6hjG62i/u2LHcw7Bens8wTWi/LC90bAvLSczM7683PZmHWtssXE2IVhHq3/D2wl2oqrlxTR/5Tt39wXufjbBKay7gSdrrDspSYmgHu6+ieB885/M7Awza2NmzcM981+FvT0G3GBmuWaWE/Yfe4/5vwjOcV7OF0cDhP2cZmYnhXtercLb0WI3lLFaEJynXQNUmNnYcLzVngAuMrOh4dHHTTHzUUVwjvQeM+sCYGY9zOykOqb1GPATM+trZu0I7ph63N0r6vu+Qs8DeWb2YzNraWbtzeyQmBh/bmb7mlkP4Io4xldT7Dh6Aj+K6fYBsNnMrjGz1uH3WmBmB4fdHwBuN7OB4Z1Y+5lZZ4KEOii8TbiZmX0LGAY87+7LCC7+3WpmLcLbhk+LmWZDy/FFgg14rFEEpw9rHoUAwcaEIHGfS3DRtvrC4zeoOxGsBnqGt6s2lvYE59PXEWwMf7Ebw74ADDezr4eJ70q+vBHdm3WssR0UE+ePCeb5vbDbDOCccNmO4cvLcjXQ2cw6VLcws3PNLDf8zVUf8VUmfhb2jhJBA9z9dwTna28g2AivINiAPR32cgfBhuJTgguRH4XtqocvJjiyOJzgzoTq9isI9rauixnvz6hjmbj7FoIf0xMEpxvOIbj4W919IvBHgnvUF4bThGClhuBc9kLgvfAw/xWC87K1GU9wnnoqwYWzMr68wa1TGOcJBBvLEoJz5MeGnW8jOOxeEk7/yZj44nUrwWmEJcDLYZzV064Mpzsy7L6WYONf/UP9HcH39zLBhcwHCS6KrgNOJbjAvY7gbqZT3X1tONw5BNcf1gM3E1xQrZ5mQ8vxOWCImcWeavgOwYXQ+kwB1rn78pjPBtT13MZrBLf0lpjZ2jr62V0PEXzXnxHcofVe/b1/IfzuziK4uL8OGEhwXaTaHq9jCfAM8C2+uGHg6+5eHna7imCd2kiw3Kp/97j7XIKEtjg8Ldid4KaNWWa2FfgDwbWIsqTNyR6y8AKHZBgzG0pwR03LiPayGmRmlxP8UGruMWcUM7sUGObuPw6PyKYQ3PmT8huITGdmtxBcDD436liipIdGMoiZnUlwSN6W4Pzkc6mUBMysG8Htgu8S7CFeTXB/eUZz9/tjmksJ7vsXSRk6NZRZLiM4PbGI4Lzk5dGG8xUtgL8S3FL7GsEh+Z9r9hSW8Nhay991SY5XJCvo1JCISJbTEYGISJZLi2sEOTk5np+fH3UYIiJpZfr06Wvdva4HRz+XFokgPz+fadOmRR2GiEhaMbNan1WpSaeGRESynBKBiEiWUyIQEclySgQiIllOiUBEJMslLBGYWS8ze93M5pjZLDO7Kmzfycwmm9mC8P++iYpBREQalsgjggrgancfSvBO1x+a2TDgWuBVdx9I8JaiaxMYg4iINCBhzxGE5ZeLw+YtZjaH4I1P4wheuAHBi8zfICiRLCIRmVO8mYkzi6MOQ2px5oE96ZuT2HfbJOWBMjPLBw4A3id4u1Z1giiuflFKLcNcSvA+Wnr37l1bLyLSCDbtKOe8Bz9g7dadWDzvHpOkOrDPvumfCMK3D1W/aHqzxbmmhaV77wcoLCxUZTyRBPnNS/NYv20nz//oSAp6dGh4AMk4Cb1ryMyaEySBR939v2Hr1WFd+ur69KWJjEFE6vbJio088v4yzj8sX0kgiyXyriEjeBXgnPB1j9WeBS4Imy8gqEkvIklWUVnFdU/NJLddS64+cVDU4UiEEnlq6AiC93/ONLMZYbvrCN5h+oSZXQwsJ3ivqYgk2cPvLWPWqs3ce84BtG/VPOpwJEKJvGvoLYKXbdfma4marog0bPXmMn778nyOHpTLKSO6RR2ORExPFotkoduen82uyipuHzeceG/gkMylRCCSZabMX8MLnxZzxbED6NM5sbclSnpQIhDJImXlldz0TBH9ctpy2TH9og5HUkRavKFMRBrHn19fyLJ12/nnJYfQslnTqMORFKEjApEssWjNVv4yZRFnjOzO4QNyog5HUogSgUgWcHdufLqIVs2bcv0pw6IOR1KMEoFIFnhmxireWbSOa8YMIbd9y6jDkRSjRCCS4TZtL+eOF2azf6+OnDNKBRzlq5QIRDLcr1+ey/ptu7jzjAKaNNEzA/JVSgQiGezj5Rt49P3lXHh4XxWVkzopEYhkqIrKKq5/qogu7VvyUxWVk3ooEYhkqIfeXcbs4s3cfNpw2rXUI0NSNyUCkQxUsqmM3748j9GDcxlbkBd1OJLilAhEMtBtz8+iosq57fQCFZWTBikRiGSY1+eV8uLMEn503AB6d24TdTiSBpQIRDJIdVG5/rlt+d7RKion8dEVJJEMcu9rC1mxfgf//J6Kykn8dEQgkiEWlm7lr1MX8fUDenB4fxWVk/gpEYhkAHfnhqdn0rp5U647ZWjU4UiaUSIQyQBPffwZ7y1ezzVjh5DTTkXlZPcoEYikuU3by7nzhTkc0LsjZx+sonKy+3SxWCTN3f3SXDbuKOfhM0aoqJzsER0RiKSxj5Zv4J/vL+fCw/MZ1n2fqMORNKVEIJKmqovK5e3Tip+coKJysucSlgjMbLyZlZpZUUy7/c3sXTObaWbPmZl2YUT20IR3ljKneDO3nD5MReVkryTyiGACMKZGuweAa919BPAU8LMETl8kYxVv2sE9k+dz7OBcThquonKydxKWCNx9KrC+RuvBwNSweTLwjURNXyST3fbc7KCo3DgVlZO9l+xrBEXA6WHzWUCvuno0s0vNbJqZTVuzZk1SghNJB6/NXc3EohKu/NpAenVSUTnZe8lOBN8Ffmhm04H2wK66enT3+9290N0Lc3NzkxagSCrbsauSm56ZxYAu7fjeUSoqJ40jqVeY3H0ucCKAmQ0CTknm9EXS3b2vL2Dlhh3869JDadFMN/1J40jqmmRmXcL/TYAbgPuSOX2RdLZg9Rbun7qYbxzYk0P7dY46HMkgibx99DHgXWCwma00s4uBs81sPjAXWAX8PVHTF8kkQVG5Itq0aMZ1Jw+JOhzJMAk7NeTuZ9fR6Q+JmqZIpvrvR5/x/pL13PX1EXRWUTlpZDrJKJLiNm7fxZ0vzuHA3h35VmGdN9qJ7DElApEUd/ekuWzaUc6dZ6qonCSGEoFICpu+bD2PfbCC7x6Rz9BuqsgiiaFEIJKiysOict06tOLHx6uonCSOEoFIiprw9lLmlmzh5tOG01ZF5SSBlAhEUtCqjTu455X5fG1IF04a3jXqcCTDKRGIpKBbn5tFlTu3nD5cReUk4ZQIRFLMq3NW89Ks1SoqJ0mjRCCSQqqLyg3s0o5LjlRROUkOXYESSSF/fG0Bn23cweMqKidJpDVNJEXMX72Fv01dzDcP6skhKionSaREIJIC3J0bniqiXatm/HysispJcikRiKSAJ6ev5IOl6/n52CEqKidJp0QgErEN23bxixfncFCffTnrIBWVk+RTIhCJ2N2T5rK5rII7zyxQUTmJhBKBSISmLV3Pvz5cwSVH9mVInorKSTSUCEQiUl1UrnuHVlz5tYFRhyNZTM8RiETk728vYd7qLdx/3kEqKieR0hGBSAQ+27iDeyYv4PihXTlxeF7U4UiWUyIQicAtz84K/p8+LOJIRJQIRJJu8uzVTJ69mquOH0jPfVVUTqKnRCCSRNt3VXDLs7MY1LUdFx/ZN+pwRABdLBZJqj+8GhSV+/f3D6N5U+2HSWrQmiiSJPNKtvDgm0v4f4U9OTi/U9ThiHwuYYnAzMabWamZFcW0G2lm75nZDDObZmajEjV9kVRSVeXc8PRM2rdqxrVjh0YdjsiXJPKIYAIwpka7XwG3uvtI4Kbws0jGe3L6Sj5cuoGfjx1Kp7Ytog5H5EsSlgjcfSqwvmZroPo5+g7AqkRNXyRVrN+2i7smzuHg/H355kE9ow5H5CuSfbH4x8BLZvYbgiR0eF09mtmlwKUAvXv3Tk50Ignwy4lz2FJWwR1njFBROUlJyb5YfDnwE3fvBfwEeLCuHt39fncvdPfC3NzcpAUo0pg+XLqeJ6at5OKj+jI4r33U4YjUqs4jAjObSXAqp1buvt8eTO8C4Kqw+d/AA3swDpG0EBSVm0mPjq25SkXlJIXVd2ro1PD/D8P/D4f/vwNs38PprQKOAd4AjgMW7OF4RFLeg28tYf7qrTxwfiFtWuiRHUldda6d7r4MwMyOcPcjYjpda2ZvA7fVN2IzewwYDeSY2UrgZuB7wB/MrBlQRngNQCTTrNywnT+8soAThnXl+GFdow5HpF7x7Ka0NbMj3f0tADM7HGjb0EDufnYdnQ7ajfhE0tItz84O/p8+POJIRBoWTyK4GBhvZh0IrhlsAr6b0KhE0tjLs0p4Zc5qrjt5CD06to46HJEGNZgI3H06sL+Z7QOYu29KfFgi6WnbzqCo3OCu7bnoCBWVk/TQ4O2jZtbVzB4EHnf3TWY2zMwuTkJsImnnj68uYNWmMu48s0BF5SRtxLOmTgBeArqHn+cTPBgmIjHmlmzmgbeW8O2De1GoonKSRuJJBDnu/gRQBeDuFUBlQqMSSTNVVc71TxXRoXVzrhkzJOpwRHZLPIlgm5l1Jny4zMwOJbhgLCKhf09fwfRlG/j52CHsq6JykmbiuWvop8CzQP/w+YFc4JsJjUokjazbupO7Js5lVN9OKionaaneRGBmTYBWBE8DDwYMmOfu5UmITSQt3DVxLlvLKrjjjALMVFRO0k+9p4bcvQr4rbtXuPssdy9SEhD5wvuL1/Hk9JV87+h+DOqqonKSnuK5RvCymX3DtKsj8iW7Kqq44ekieu7bmiuPU1E5SV/xXiNoC1Sa2Q6C00Pu7vvUP5hIZnvgrcUsKN3KgxcU0rpF06jDEdlj8TxZrONdkRpWrN/OH19dwEnDu/K1oSoqJ+ktnieLzczONbMbw8+99NJ5yWbuzs3PzqKJGTefpqJykv7iuUbwZ+Aw4Jzw81bgTwmLSCTFvTRrNa/NLeUnxw+iu4rKSQaI5xrBIe5+oJl9DODuG8xMT8xIVtq2s4Jbn5vFkLz2XHhEftThiDSKeBJBuZk15Ysni3MJy02IZJvfvzKf4k1l3HvOgSoqJxkjnjX5j8BTQBczuxN4C/hFQqMSSUFzijcz/u2lnD2qFwf12TfqcEQaTTx3DT1qZtOBrxHcOnqGu89JeGQiKSQoKjdTReUkIzWYCMzsDwTvItAFYslaj09bwUfLN/Lbs/anYxtdIpPMEs+poY+AG8xsoZn92swKEx2USCpZu3Unv5w4l0P6duLrB/aIOhyRRtdgInD3f7j7ycAogpfS3G1mCxIemUiKuOvFuWzfVcGdZ6qonGSm3bntYQAwBMgH5iYkGpEU8+6idfzno5VcenQ/BnTRQ/aSmeJ5srj6COA2YBZwkLuflvDIRCK2q6KKG58JispdcayKyknmiuc5giXAYe6+NtHBiKSSv725mIWlW/n7hQerqJxktHhuH73PzE43s6PDVlPc/bmGhjOz8cCpQKm7F4TtHid4wQ1AR2Cju4/cs9BFEmf5uqCo3NiCPI4d0iXqcEQSKp5TQ3cBVwGzw78rw3YNmQCMiW3h7t9y95Hhxv8/wH93O2KRBAuKyhXRrIlx02nDog5HJOHiOTV0CjAyfFsZZvYP4GPg5/UN5O5TzSy/tm7hS27+H3Dc7gQrkgwvzSrh9XlruOGUoXTroKJykvnivWuoY0xzh0aY7lHAanev8zZUM7vUzKaZ2bQ1a9Y0wiRFGrZ1ZwW3PDubod324cLD86MORyQp4jkiuAv42MxeJygxcTQNHA3E4Wzgsfp6cPf7gfsBCgsLfS+nJxKXeybPZ/WWMv587oE0U1E5yRLxXCx+zMzeAA4mSATXuHvJnk7QzJoBXwcO2tNxiCTCrFWbmPDOUs4e1ZsDe6uonGSPeC4Wnwlsd/dn3f0ZoMzMztiLaR4PzHX3lXsxDpFGFRSVK6Jj6+Zcc5KKykl2iefY92Z331T9wd03Ajc3NJCZPQa8Cww2s5VmdnHY6ds0cFpIJNke+3A5M1Zs5PpThtKhTfOowxFJqniuEdSWLOI5pXR2He0vjGOaIkmzdutO7p44l0P7deLMA1RUTrJPPEcE08zsd2bW38z6mdk9wPREByaSLL94YQ47yiu544wRKionWSmeRPAjYBfwOPAEsAP4YSKDEkmWdxat5b8ff8b3j+nPgC7tog5HJBLxnOLZBlybhFhEkmpnRSU3PF1E705t+OGxA6IORyQy8VwjEMlIf5u6mMVrtjHhooNp1VxF5SR76YkZyUrL123n/15byCkjujF6sIrKSXZTIpCs4+7c+ExQVO7GU1VUTiSeB8p+ZWb7mFlzM3vVzNaa2bnJCE4kESYWlTBl/hquPnEweR1aRR2OSOTiOSI40d03E7xbYCUwCPhZQqMSSZAtZeXc+twshnffh/MP6xN1OCIpIZ5EUP2Y5cnAY+6+PoHxiCTUPZMXULplJ3eeOUJF5URC8dw19JyZzSV4fuAHZpYLlCU2LJHGV/TZJia8s4TvHNKbkb06NjyASJZocJfI3a8FDgMK3b0c2A6MS3RgIo2pssq5/ukiOrVtwc9UVE7kS+K5WNyG4Eniv4StugOFiQxKpLE99sFyPlmxkRtOGUaH1ioqJxIrnpOkfycoMXF4+HklcEfCIhJpZGu27OTuSXM5vH9nxo3sHnU4IiknnkTQ391/BZQDuPsOghfUiKSFO1+Yzc7yKm4/o0BF5URqEU8i2GVmrQEHMLP+wM6ERiXSSN5ZuJanZ6zi+8f0o3+uisqJ1Caeu4ZuBiYBvczsUeAI4MJEBiXSGKqLyvXp3IYfqKicSJ3iqT462cw+Ag4lOCV0lbuvTXhkInvpr1MWs3jtNv7x3VEqKidSj3irj7YCNoT9DzMz3H1q4sIS2TtL127j3tcXcsp+3ThmUG7U4YiktAYTgZndDXwLmAVUha0dUCKQlFRdVK5F0ybcpKJyIg2K54jgDGCwu+sCsaSFF2YW8+aCtdxy2jC67qOiciINieeuocV8UW9IJKVtKSvntudmU9BjH847LD/qcETSQjxHBNuBGWb2KjG3jbr7lQmLSmQP/fbl+azZupO/nV9I0yZ6ZkAkHvEkgmfDP5GUVvTZJh56dynnHdqH/VVUTiRu8dw++o9kBCKyNyqrnOufmkmnti25+sTBUYcjklbqvEZgZk+E/2ea2ac1/xoasZmNN7NSMyuq0f5HZjbPzGaZ2a/2fhZE4J/vL+OTlZu48dShKionspvqOyK4Kvx/6h6OewJwL/BQdQszO5aghPV+7r7TzPTWcNlrpVvK+NWkeRw5IIfT91dROZHdVWcicPfi8P+yPRmxu081s/warS8Hfll9K6q7l+7JuEVi3fnCHHZWVHHbuOEqKieyB+o7NbTFzDbX8rfFzDbv4fQGAUeZ2ftmNsXMDq5n+pea2TQzm7ZmzZo9nJxkurcWrOWZGau4fHR/+qmonMgeqe+IoH2CprcvQd2ig4EnzKyfu3st078fuB+gsLDwK91FysorufGZIvI7t+Hy0f2jDkckbSX77d0rgf964AOCkhU5SY5BMsRfpyxmydpt3H5GgYrKieyFZCeCp4HjAMxsENACUCVT2W1L1m7jT28s5LT9u3PUQBWVE9kb8VYf3W1m9hgwGsgxs5UE7zUYD4wPbyndBVxQ22khkfq4Ozc9U0TLpk248ZShUYcjkvYSlgjc/ew6Op2bqGlKdnj+06Co3K2nD6eLisqJ7LVknxoS2Suby8q57fnZjOjRgXMP7RN1OCIZIWFHBCKJ8NuX5rFu607GX3CwisqJNBIdEUja+HTlRh5+bxnnHdqHET07RB2OSMZQIpC0EBSVK6Jzu5ZcfZKKyok0JiUCSQuPvLeMmZ9t4qZTh7FPKxWVE2lMSgSS8ko3l/Gbl+Zx1MAcTt2vW9ThiGQcJQJJebe/MIedlVXcNq5AReVEEkCJQFLamwvW8Nwnq/jh6AH0zWkbdTgiGUmJQFJWWXklNz5dRN+ctnx/dL+owxHJWHqOQFLWX95YxNJ123nk4kNo2UxF5UQSRUcEkpIWr9nKX95YxLiR3TlyoArUiiSSEoGknKCo3CxaNm/C9SoqJ5JwSgSScp79ZBVvLVzL/540mC7tVVROJNGUCCSlbNpRzu3Pz2H/nh045xAVlRNJBl0slpTy25fnsX7bTiZcpKJyIsmiIwJJGZ+sCIrKnX9YPgU9VFROJFmUCCQlVFY51z89k9x2Lbn6xEFRhyOSVZQIJCU8/O5Sij7bzE2nDaO9isqJJJUSgURu9eYyfvPyfI4elMspI1RUTiTZlAgkcrc9P5tdlVXcPm64isqJRECJQCI1Zf4aXvi0mCuOHUCfzioqJxIFJQKJTFl5JTc9U0S/nLZcdoyKyolERc8RSGT+/PpClq3bzj8vUVE5kSjpiEAisWjNVu6bspgzRnbn8AEqKicSpYQlAjMbb2alZlYU0+4WM/vMzGaEfycnavqSutydG58uCovKDYs6HJGsl8gjggnAmFra3+PuI8M+9AhSAAANUklEQVS/FxM4fUlRz8xYxTuL1nHNmCHktm8ZdTgiWS9h1wjcfaqZ5Sdq/JJ+lq/bzsSiYv46dTH79+rIOaN6Rx2SiBDNxeIrzOx8YBpwtbtvqK0nM7sUuBSgd29tMNLVwtKtTCoq5sWZJcwu3gzAfj078Jtv7kcTFZUTSQnm7okbeXBE8Ly7F4SfuwJrAQduB7q5+3cbGk9hYaFPmzYtYXFK43F35hRvYVJRMROLSlhQuhWAA3t3ZGxBN8YU5NGrU5uIoxTJDmY23d0LG+ovqUcE7r66utnM/gY8n8zpS2K4O5+s3MTEomImFZWwbN12mhiM6tuJcw8dzknD88jroBfMiKSqpCYCM+vm7sXhxzOBovr6l9RVVeVMX76BiTNLeGlWCZ9t3EGzJsZh/Ttz2dH9OXF4V3La6UKwSDpIWCIws8eA0UCOma0EbgZGm9lIglNDS4HLEjV9aXwVlVW8v2Q9E4uKeWnWatZs2UmLZk04emAOPzlhECcM7UqHNqocKpJuEnnX0Nm1tH4wUdOTxNhVUcXbi9YycWYxk2evZsP2clo3b8qxQ3IZU9CN44Z0oV1LPaAuks70C5avKCuvZMr8NUwqKuGVOavZUlZBu5bN+NrQLowtyOOYQV1o3UIlIUQyhRKBALBtZwWvzS1lUlEJr88rZfuuSjq2ac6Y4XmMHZHHEQNyVA9IJEMpEWSxTTvKeXXOaiYWlTBl/hp2VVSR064FZxzQg5MLunFIv040b6pyVCKZTokgy6zbupPJs4ON/zuL1lJe6XTr0IpzRvVmbEEehfmdaKoHvUSyihJBFijdXMZLs0p4cWYJ7y9ZR5VDr06tueiIvowtyGP/nh31lK9IFlMiyFArN2xnUlEJk4pKmL58A+7QP7ctPxg9gDEFeQzvvo9eCykigBJBRlmydtvnT/d+unITAEO77cNPjh/E2II8BnZtH3GEIpKKlAjSmLuzoHQrE2eWMLGomLklWwDYv2cHrhkzhLEFeeTn6D3AIlI/JYI04+7MWrWZiWFRt8VrtmEGhX325cZThzGmII8eHVtHHaaIpBElgjRQVeXMWLmRiTOLmTSrhBXrd9C0iXFI305cdHg+Jw3Po8s+KuomIntGiSBFVVY5Hy5d//kF35LNZTRvahwxIIcrjh3ACcPy6NS2RdRhikgGUCJIIeWVVby7aB0Ti0qYPLuEtVt30bJZE44elMs1IwZz3JCudGitom4i0riUCCK2s6KStxasDTf+q9m0o5w2LZpy7JCgrs+xg7vQVkXdRCSBtIWJwPZdFUyZt4aJRSW8NreUrTsraN+qGScM7cqYgjyOHpRLq+aq6yMiyaFEkCRbysp5bW4pE2eW8Mb8UsrKq9i3TXNOGdGNMSPyOKJ/Di2aqa6PiCSfEkECbdy+i8mzVzOpqIQ3F6xlV2UVue1bctZBvRhbkMeovp1opqJuIhIxJYJGtmbLTl6eHdzp8+6idVRUOT06tubcQ/tw8og8Duy9r+r6iEhKUSJoBCWbyphUVMyLRSVMW7qeKof8zm245Kh+jC3IY7+eHVTXR0RSlhLBHlqxfvvnT/d+vHwjAIO6tuOK4wYytiCPIXnttfEXkbSgRLAbFpZuZVK48Z+1ajMAw7vvw/+cOIgxBd0Y0KVdxBGKiOw+JYJ6uDtzS7YwsaiEiTOLWVC6FYADenfkupOHMGZ4N3p3bhNxlCIie0eJoAZ359OVm5hYVMKkomKWrtuOGRyc34mbTwuKunXroKJuIpI5lAgIirp9tHwDL84s4aVZJXy2MSjqdnj/znzv6H6cOCyP3PYtow5TRCQhsjYRVFRW8cGS9UwsCjb+pVt20qJpE44cmMOPjx/ICcO60rGNirqJSOZLWCIws/HAqUCpuxfU6PY/wK+BXHdfm6gYatpVUcXbi9YyaWYJk+esZv22XbRq3oTRg7owdkQexw3pQvtWKuomItklkUcEE4B7gYdiW5pZL+AEYHkCp/25svJKps4P6vq8Mmc1W8oqaNeyGceFRd2OGZxLmxZZe2AkIpK4RODuU80sv5ZO9wD/CzyTqGlX++OrC7hvyiK276qkQ+vmnDgsj7EFeRw5MEdF3UREQkndFTaz04HP3P2Thh62MrNLgUsBevfuvUfTy+vQinEjezC2II/D+nemuer6iIh8hbl74kYeHBE87+4FZtYGeB040d03mdlSoDCeawSFhYU+bdq0hMUpIpKJzGy6uxc21F8yd5H7A32BT8Ik0BP4yMzykhiDiIjUkLRTQ+4+E+hS/Xl3jghERCRxEnZEYGaPAe8Cg81spZldnKhpiYjInkvkXUNnN9A9P1HTFhGR+Ok2GhGRLKdEICKS5ZQIRESynBKBiEiWS+gDZY3FzNYAy/Zw8BwgU25R1byknkyZD9C8pKq9mZc+7p7bUE9pkQj2hplNi+fJunSgeUk9mTIfoHlJVcmYF50aEhHJckoEIiJZLhsSwf1RB9CINC+pJ1PmAzQvqSrh85Lx1whERKR+2XBEICIi9VAiEBHJchmTCMxsjJnNM7OFZnZtLd1bmtnjYff363iNZkqIY14uNLM1ZjYj/LskijgbYmbjzazUzIrq6G5m9sdwPj81swOTHWM84piP0Wa2KWZ53JTsGONlZr3M7HUzm2Nms8zsqlr6SZflEs+8pPyyMbNWZvaBmX0SzsettfST2O2Xu6f9H9AUWAT0A1oAnwDDavTzA+C+sPnbwONRx70X83IhcG/UscYxL0cDBwJFdXQ/GZgIGHAo8H7UMe/hfIwmeBNf5LHGMS/dgAPD5vbA/FrWr3RZLvHMS8ovm/B7bhc2NwfeBw6t0U9Ct1+ZckQwCljo7ovdfRfwL2BcjX7GAf8Im58EvmYNvTg5GvHMS1pw96nA+np6GQc85IH3gI5m1i050cUvjvlIG+5e7O4fhc1bgDlAjxq9pctyiWdeUl74PW8NPzYP/2rexZPQ7VemJIIewIqYzyv56grxeT/uXgFsAjonJbrdE8+8AHwjPGx/0sx6JSe0RhfvvKaDw8JD+4lmNjzqYOIRnl44gGAPNFbaLZd65gXSYNmYWVMzmwGUApPdvc5lkojtV6YkgtoyY82MGk8/qSCeOJ8D8t19P+AVvthTSDfpskwa8hFBTZf9gf8Dno44ngaZWTvgP8CP3X1zzc61DJKyy6WBeUmLZePule4+kuBd7qPMrKBGLwldJpmSCFYCsXvFPYFVdfVjZs2ADqTm4X6D8+Lu69x9Z/jxb8BBSYqtscWz3FKeu2+uPrR39xeB5maWE3FYdTKz5gQbzkfd/b+19JI2y6WheUm3ZePuG4E3gDE1OiV0+5UpieBDYKCZ9TWzFgQXU56t0c+zwAVh8zeB1zy88pJiGpyXGudrTyc4N5qOngXOD+9SORTY5O7FUQe1u8wsr/p8rZmNIvhdrYs2qtqFcT4IzHH339XRW1osl3jmJR2WjZnlmlnHsLk1cDwwt0ZvCd1+Jeydxcnk7hVmdgXwEsFdN+PdfZaZ3QZMc/dnCVaYh81sIUEm/XZ0Edctznm50sxOByoI5uXCyAKuh5k9RnDXRo6ZrQRuJrgQhrvfB7xIcIfKQmA7cFE0kdYvjvn4JnC5mVUAO4Bvp+hOBsARwHnAzPCcNMB1QG9Ir+VCfPOSDsumG/APM2tKkKiecPfnk7n9UokJEZEslymnhkREZA8pEYiIZDklAhGRLKdEICKS5ZQIRESynBKBZDQzuyusQHmG1VLJtYFhc8NKjx+b2VE1uj1gZsMaN1ows+sae5wiDdHto5LRzOw14BTgF8CT7v72bgz7bWCsu1/QYM+NxMy2unu7ZE1PBHREIBnKzH5tZp8CBwPvApcAf6mtHr2Z9TGzV8Mifq+aWW8zGwn8Cjg5rGPfusYwb5hZYdi81czuDAubvWdmXcP2E8zsPjN708zmm9mpYfsLzezemHE9Hx61/BJoHU7vUTNra2YvhOMtMrNvJejrkiynRCAZyd1/RrDxn0CQDD519/3c/bZaer+XoOzyfsCjwB/dfQZwE0Hd95HuvqOeybUF3gsLm00FvhfTLR84huCo5D4za1VPzNcCO8LpfYeg3swqd9/f3QuASfHMu8juUiKQTHYAMAMYAsyup7/DgH+GzQ8DR+7mdHYBz4fN0wk2/tWecPcqd18ALA5jiddM4Hgzu9vMjnL3TbsZl0hcMqLWkEis8LTOBIKqmWuBNkFrmwEc1sDePex+ed/ymPo1lXz5d1VzXE5QIyp2J6zWowR3n29mBxHU/bnLzF6u44hGZK/oiEAyjrvPCGu7zweGAa8BJ9Vziucdviji9R3grUYM5ywza2Jm/QlePzoPWAqMDNv3IngrXbXysLQyZtYd2O7ujwC/IXhdpkij0xGBZCQzywU2uHuVmQ1x9/pODV0JjDeznwFraNxqm/OAKUBX4PvuXmZmbwNLCE79FBG8PKXa/cCnZvYR8BDwazOrAsqByxsxLpHP6fZRkQQxswkEL05/MupYROqjU0MiIllORwQiIllORwQiIllOiUBEJMspEYiIZDklAhGRLKdEICKS5f4/sHUNJbySbLcAAAAASUVORK5CYII=
"
>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>After 10,000 runs, we have managed to synthesize a <code>+</code> character and a valid <code>%xx</code> form.  We can still do better.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2:-Fuzzing-bc-with-Mutations">Exercise 2: Fuzzing bc with Mutations<a class="anchor-link" href="#Exercise-2:-Fuzzing-bc-with-Mutations">&#182;</a></h3><p>Apply the above mutation-based fuzzing technique on <code>bc</code>, as in the chapter <a href="Fuzzer.html">"Introduction to Fuzzing"</a>.</p>
<h4 id="Part-1:-Non-Guided-Mutations">Part 1: Non-Guided Mutations<a class="anchor-link" href="#Part-1:-Non-Guided-Mutations">&#182;</a></h4><p>Start with non-guided mutations.  How many of the inputs are valid?</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-2:-Guided-Mutations">Part 2: Guided Mutations<a class="anchor-link" href="#Part-2:-Guided-Mutations">&#182;</a></h4><p>Continue with <em>guided</em> mutations.  To this end, you will have to find a way to extract coverage from a C program such as <code>bc</code>.  Proceed in these steps:</p>
<p>First, get GNU bc <a href="https://www.gnu.org/software/bc/">from the source</a>; download, say, <code>bc-1.07.1.tar.gz</code> and unpack it:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>curl -O http://ftp.gnu.org/gnu/bc/bc-1.07.1.tar.gz
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  410k  100  410k    0     0   399k      0  0:00:01  0:00:01 --:--:--  399k
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>tar xfz bc-1.07.1.tar.gz
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Second, configure the package:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span><span class="nb">cd</span> bc-1.07.1<span class="p">;</span> ./configure
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... ./install-sh -c -d
checking for gawk... no
checking for mawk... no
checking for nawk... no
checking for awk... awk
checking whether make sets $(MAKE)... yes
checking whether make supports nested variables... yes
checking for gcc... gcc
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables... 
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking whether gcc understands -c and -o together... yes
checking for style of include used by make... GNU
checking dependency style of gcc... gcc3
checking how to run the C preprocessor... gcc -E
checking for grep that handles long lines and -e... /usr/bin/grep
checking for egrep... /usr/bin/grep -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking minix/config.h usability... no
checking minix/config.h presence... no
checking for minix/config.h... no
checking whether it is safe to define __EXTENSIONS__... yes
checking for flex... flex
checking lex output file root... lex.yy
checking lex library... -ll
checking whether yytext is a pointer... yes
checking for ar... ar
checking the archiver (ar) interface... ar
checking for bison... bison -y
checking for ranlib... ranlib
checking whether make sets $(MAKE)... (cached) yes
checking for stdarg.h... yes
checking for stddef.h... yes
checking for stdlib.h... (cached) yes
checking for string.h... (cached) yes
checking for errno.h... yes
checking for limits.h... yes
checking for unistd.h... (cached) yes
checking for lib.h... no
checking for an ANSI C-conforming const... yes
checking for size_t... yes
checking for ptrdiff_t... yes
checking for vprintf... yes
checking for _doprnt... no
checking for isgraph... yes
checking for setvbuf... yes
checking for fstat... yes
checking for strtol... yes
Adding GCC specific compile flags.
checking that generated files are newer than configure... done
configure: creating ./config.status
config.status: creating Makefile
config.status: creating bc/Makefile
config.status: creating dc/Makefile
config.status: creating lib/Makefile
config.status: creating doc/Makefile
config.status: creating doc/texi-ver.incl
config.status: creating config.h
config.status: config.h is unchanged
config.status: executing depfiles commands
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Third, compile the package with special flags:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span><span class="nb">cd</span> bc-1.07.1<span class="p">;</span> make <span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">&quot;--coverage&quot;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/Applications/Xcode.app/Contents/Developer/usr/bin/make  all-recursive
Making all in lib
make[3]: Nothing to be done for `all&#39;.
Making all in bc
make[3]: Nothing to be done for `all&#39;.
Making all in dc
make[3]: Nothing to be done for `all&#39;.
Making all in doc
restore=: &amp;&amp; backupdir=&#34;.am$$&#34; &amp;&amp; \
	am__cwd=`pwd` &amp;&amp; CDPATH=&#34;${ZSH_VERSION+.}:&#34; &amp;&amp; cd . &amp;&amp; \
	rm -rf $backupdir &amp;&amp; mkdir $backupdir &amp;&amp; \
	if (makeinfo --no-split --version) &gt;/dev/null 2&gt;&amp;1; then \
	  for f in bc.info bc.info-[0-9] bc.info-[0-9][0-9] bc.i[0-9] bc.i[0-9][0-9]; do \
	    if test -f $f; then mv $f $backupdir; restore=mv; else :; fi; \
	  done; \
	else :; fi &amp;&amp; \
	cd &#34;$am__cwd&#34;; \
	if makeinfo --no-split   -I . \
	 -o bc.info bc.texi; \
	then \
	  rc=0; \
	  CDPATH=&#34;${ZSH_VERSION+.}:&#34; &amp;&amp; cd .; \
	else \
	  rc=$?; \
	  CDPATH=&#34;${ZSH_VERSION+.}:&#34; &amp;&amp; cd . &amp;&amp; \
	  $restore $backupdir/* `echo &#34;./bc.info&#34; | sed &#39;s|[^/]*$||&#39;`; \
	fi; \
	rm -rf $backupdir; exit $rc
restore=: &amp;&amp; backupdir=&#34;.am$$&#34; &amp;&amp; \
	am__cwd=`pwd` &amp;&amp; CDPATH=&#34;${ZSH_VERSION+.}:&#34; &amp;&amp; cd . &amp;&amp; \
	rm -rf $backupdir &amp;&amp; mkdir $backupdir &amp;&amp; \
	if (makeinfo --no-split --version) &gt;/dev/null 2&gt;&amp;1; then \
	  for f in dc.info dc.info-[0-9] dc.info-[0-9][0-9] dc.i[0-9] dc.i[0-9][0-9]; do \
	    if test -f $f; then mv $f $backupdir; restore=mv; else :; fi; \
	  done; \
	else :; fi &amp;&amp; \
	cd &#34;$am__cwd&#34;; \
	if makeinfo --no-split   -I . \
	 -o dc.info dc.texi; \
	then \
	  rc=0; \
	  CDPATH=&#34;${ZSH_VERSION+.}:&#34; &amp;&amp; cd .; \
	else \
	  rc=$?; \
	  CDPATH=&#34;${ZSH_VERSION+.}:&#34; &amp;&amp; cd . &amp;&amp; \
	  $restore $backupdir/* `echo &#34;./dc.info&#34; | sed &#39;s|[^/]*$||&#39;`; \
	fi; \
	rm -rf $backupdir; exit $rc
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The file <code>bc/bc</code> should now be executable...</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span><span class="nb">cd</span> bc-1.07.1/bc<span class="p">;</span> <span class="nb">echo</span> <span class="m">2</span> + <span class="m">2</span> <span class="p">|</span> ./bc
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>4
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>...and you should be able to run the <code>gcov</code> program to retrieve coverage information.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span><span class="nb">cd</span> bc-1.07.1/bc<span class="p">;</span> gcov main.c
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>File &#39;main.c&#39;
Lines executed:51.69% of 118
main.c:creating &#39;main.c.gcov&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As sketched in the <a href="Coverage.html">"Coverage" chapter</a>, the file <a href="bc-1.07.1/bc/main.c.gcov">bc-1.07.1/bc/main.c.gcov</a> now holds the coverage information for <code>bc.c</code>.  Each line is prefixed with the number of times it was executed. <code>#####</code> means zero times; <code>-</code> means non-executable line.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Parse the GCOV file for <code>bc</code> and create a <code>coverage</code> set, as in <code>FunctionCoverageRunner</code>.  Make this a <code>ProgramCoverageRunner</code> class that would be constructed with a list of source files (<code>bc.c</code>, <code>main.c</code>, <code>load.c</code>) to run <code>gcov</code> on.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>When you're done, don't forget to clean up:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>rm -fr bc-1.07.1 bc-1.07.1.tar.gz
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-3">Exercise 3<a class="anchor-link" href="#Exercise-3">&#182;</a></h3><p>In this <a href="https://lcamtuf.blogspot.com/2014/08/binary-fuzzing-strategies-what-works.html">blog post</a>, the author of <em>American Fuzzy Lop</em> (AFL), a very popular mutation-based fuzzer discusses the efficiency of various mutation operators.  Implement four of them and evaluate their efficiency as in the examples above.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-4">Exercise 4<a class="anchor-link" href="#Exercise-4">&#182;</a></h3><p>When adding a new element to the list of candidates, AFL does actually not compare the <em>coverage</em>, but adds an element if it exercises a new <em>branch</em>.  Using branch coverage from the exercises of the <a href="Coverage.html">"Coverage"</a> chapter, implement this "branch" strategy and compare it against the "coverage" strategy, above.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-5">Exercise 5<a class="anchor-link" href="#Exercise-5">&#182;</a></h3><p>Design and implement a system that will gather a population of URLs from the Web.  Can you achieve a higher coverage with these samples?  What if you use them as initial population for further mutation?</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Fuzzing-with-Grammars">Fuzzing with Grammars<a class="anchor-link" href="#Fuzzing-with-Grammars">&#182;</a></h1><p>In the chapter on <a href="MutationFuzzer.html">"Mutation-Based Fuzzing"</a>, we have seen how to use extra hints – such as sample input files – to speed up test generation.  In this chapter, we take this idea one step further, by providing a <em>specification</em> of the legal inputs to a program.  These <em>grammars</em> allow for very systematic and efficient test generation, in particular for complex input formats.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>You should know how basic fuzzing works, e.g. from the <a href="Fuzzer.html">Chapter introducing fuzzing</a>.</li>
<li>Knowledge on <a href="MutationFuzzer.html">mutation-based fuzzing</a> and <a href="Coverage.html">coverage</a> is <em>not</em> required yet, but still recommended.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Input-Languages">Input Languages<a class="anchor-link" href="#Input-Languages">&#182;</a></h2><p>All possible behaviors of a program can be triggered by its input.  "Input" here can be a wide range of possible sources: We are talking about data that is read from files, from the environment, or over the network, data input by the user, or data acquired from interaction with other resources.  The set of all these inputs determines how the program will behave – including its failures.  When testing, it is thus very helpful to think about possible input sources, how to get them under control, and <em>how to systematically test them</em>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For the sake of simplicity, we will assume for now that the program has only one source of inputs; this is the same assumption we have been using in the previous chapters, too.  The set of valid inputs to a program is called a <em>language</em>.  Languages range from the simple to the complex: the CSV language denotes the set of valid comma-separated inputs, whereas the Python language denotes the set of valid Python programs.  We commonly separate data languages and programming languages, although any program can also be treated as input data (say, to a compiler).  The <a href="https://en.wikipedia.org/wiki/List_of_file_formats">Wikipedia page on file formats</a> lists more than 1,000 different file formats, each of which is its own language.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To formally describe languages, the field of <em>formal languages</em> has devised a number of <em>language specifications</em> that describe a language.  <em>Regular expressions</em>, for instance, denote sets of strings: The regular expression <code>[a-z]*</code>, for instance, denotes a (possibly empty) sequence of lowercase letters.  <em>Automata theory</em> connects these languages to automata that accept these inputs; <em>finite state machines</em>, for instance, can be used to specify the same language as regular expressions.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Regular expressions are great for not-too-complex input formats, and the associated finite state machine have many properties that make them great for reasoning.  To specify more complex inputs, though, they quickly encounter limitations.  On the other hand of the language spectrum, we have <em>universal grammars</em> that denote the language accepted by <em>Turing machines</em>.  A Turing machine can compute anything that can be computed; and with Python being a Turing-complete language, this means that we can also use a Python program $p$ to specify or even enumerate legal inputs.  But then, computer science theory also tells us that each such testing program has to be written specifically for the program to be tested, which is not the level of automation we want.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Grammars">Grammars<a class="anchor-link" href="#Grammars">&#182;</a></h2><p>The middle ground between regular expressions and Turing machines is covered by <em>grammars</em>.  Grammars are among the most popular (and best understood) formalisms to formally specify input languages.  Using a grammar, one can express a wide range of the properties of an input language.  Grammars are particularly great for expressing the <em>syntactical structure</em> of an input, and are the formalism of choice to express nested or recursive inputs.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Rules-and-Expansions">Rules and Expansions<a class="anchor-link" href="#Rules-and-Expansions">&#182;</a></h3><p>A grammar consists of a <em>start symbol</em> and a set of <em>rules</em> which indicate how the start symbol (and other symbols) can be expanded.  As an example, consider the following grammar, denoting a sequence of two digits:</p>

<pre><code>&lt;start&gt; ::= &lt;digit&gt;&lt;digit&gt;
&lt;digit&gt; ::= 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9</code></pre>
<p>To read such a grammar, start with the starting symbol (<code>&lt;start&gt;</code>).  A rule <code>&lt;A&gt; ::= &lt;B&gt;</code> means that the symbol on the left side (<code>&lt;A&gt;</code>) can be replaced by the string on the right side (<code>&lt;B&gt;</code>).  In the above grammar, <code>&lt;start&gt;</code> would be replaced by <code>&lt;digit&gt;&lt;digit&gt;</code>.</p>
<p>In this string again, <code>&lt;digit&gt;</code> would be replaced by the string on the right side of the <code>&lt;digit&gt;</code> rule.  The special operator <code>|</code> denotes <em>alternatives</em>, meaning that any of the digits can be chosen for an expansion.  Each <code>&lt;digit&gt;</code> thus would be expanded into one of the given digits, eventually yielding a string between <code>00</code> and <code>99</code>.  There are no further expansions for <code>0</code> to <code>9</code>, so we are all set.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The interesting thing about grammars is that they can be <em>recursive</em>. That is, expansions can make use of symbols expanded earlier – which would then be expanded again.  As an example, consider a grammar that describes integers:</p>

<pre><code>&lt;start&gt;  ::= &lt;integer&gt;
&lt;integer&gt; ::= &lt;digit&gt; | &lt;digit&gt;&lt;integer&gt;
&lt;digit&gt;   ::= 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9</code></pre>
<p>Here, a <code>&lt;integer&gt;</code> is either a single digit, or a digit followed by another integer.  The number <code>1234</code> thus would be represented as a single digit <code>1</code>, followed by the integer <code>234</code>, which in turn is a digit <code>2</code>, followed by the integer <code>34</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If we wanted to express that an integer can be preceded by a sign (<code>+</code> or <code>-</code>), we would write the grammar as</p>

<pre><code>&lt;start&gt;   ::= &lt;number&gt;
&lt;number&gt;  ::= &lt;integer&gt; | +&lt;integer&gt; | -&lt;integer&gt;
&lt;integer&gt; ::= &lt;digit&gt; | &lt;digit&gt;&lt;integer&gt;
&lt;digit&gt;   ::= 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9</code></pre>
<p>These rules formally define the language: Anything that can be derived from the start symbol is part of the language; anything that cannot is not.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Arithmetic-Expressions">Arithmetic Expressions<a class="anchor-link" href="#Arithmetic-Expressions">&#182;</a></h3><p>Let us expand our grammar to cover full <em>arithmetic expressions</em> – a poster child example for a grammar.  We see that an expression (<code>&lt;expr&gt;</code>) is either a sum, or a difference, or a term; a term is either a product or a division, or a factor; and a factor is either a number or a parenthesized expression.  Almost all rules can have recursion, and thus allow arbitrary complex expressions such as <code>(1 + 2) * (3.4 / 5.6 - 789)</code>.</p>

<pre><code>&lt;start&gt;   ::= &lt;expr&gt;
&lt;expr&gt;    ::= &lt;term&gt; + &lt;expr&gt; | &lt;term&gt; - &lt;expr&gt; | &lt;term&gt;
&lt;term&gt;    ::= &lt;term&gt; * &lt;factor&gt; | &lt;term&gt; / &lt;factor&gt; | &lt;factor&gt;
&lt;factor&gt;  ::= +&lt;factor&gt; | -&lt;factor&gt; | (&lt;expr&gt;) | &lt;integer&gt; | &lt;integer&gt;.&lt;integer&gt;
&lt;integer&gt; ::= &lt;digit&gt;&lt;integer&gt; | &lt;digit&gt;
&lt;digit&gt;   ::= 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9</code></pre>
<p>In such a grammar, if we start with <code>&lt;start&gt;</code> and then expand one symbol after another, randomly choosing alternatives, we can quickly produce one valid arithmetic expression after another.  Such <em>grammar fuzzing</em> is highly effective as it comes to produce complex inputs, and this is what we will implement in this chapter.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Representing-Grammars-in-Python">Representing Grammars in Python<a class="anchor-link" href="#Representing-Grammars-in-Python">&#182;</a></h2><p>Our first step in building a grammar fuzzer is to find an appropriate format for grammars.  To make the writing of grammars as simple as possible, we use a format that is based on strings and lists.  Our grammars in Python take the format of a <em>mapping</em> between symbol names and expansions, where expansions are <em>lists</em> of alternatives.  A one-rule grammar for digits thus takes the form</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DIGIT_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span> <span class="s2">&quot;9&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>whereas the full grammar for arithmetic expressions looks like this:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">EXPR_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;term&gt; + &lt;expr&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;term&gt; - &lt;expr&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;factor&gt; * &lt;term&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;factor&gt; / &lt;term&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;factor&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;factor&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;+&lt;factor&gt;&quot;</span><span class="p">,</span>
         <span class="s2">&quot;-&lt;factor&gt;&quot;</span><span class="p">,</span>
         <span class="s2">&quot;(&lt;expr&gt;)&quot;</span><span class="p">,</span>
         <span class="s2">&quot;&lt;integer&gt;.&lt;integer&gt;&quot;</span><span class="p">,</span>
         <span class="s2">&quot;&lt;integer&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;integer&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;digit&gt;&lt;integer&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span> <span class="s2">&quot;9&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the grammar, we can access any rule by its symbol...</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">EXPR_GRAMMAR</span><span class="p">[</span><span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>....and we can check whether a symbol is in the grammar:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s2">&quot;&lt;identifier&gt;&quot;</span> <span class="ow">in</span> <span class="n">EXPR_GRAMMAR</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>False
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Some-Definitions">Some Definitions<a class="anchor-link" href="#Some-Definitions">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We assume that the canonical start symbol is <code>&lt;start&gt;</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">START_SYMBOL</span> <span class="o">=</span> <span class="s2">&quot;&lt;start&gt;&quot;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The handy <code>nonterminals()</code> function extracts the list of nonterminal symbols (i.e., anything between <code>&lt;</code> and <code>&gt;</code>, except spaces) from an expansion.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/re.html" class="import" target="_blank">re</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">RE_NONTERMINAL</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(&lt;[^&lt;&gt; ]*&gt;)&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">nonterminals</span><span class="p">(</span><span class="n">expansion</span><span class="p">):</span>
    <span class="c1"># In later chapters, we allow expansions to be tuples,</span>
    <span class="c1"># with the expansion being the first element</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">expansion</span> <span class="o">=</span> <span class="n">expansion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">RE_NONTERMINAL</span><span class="p">,</span> <span class="n">expansion</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">nonterminals</span><span class="p">(</span><span class="s2">&quot;&lt;term&gt; * &lt;factor&gt;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;factor&gt;&quot;</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">nonterminals</span><span class="p">(</span><span class="s2">&quot;&lt;digit&gt;&lt;integer&gt;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;integer&gt;&quot;</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">nonterminals</span><span class="p">(</span><span class="s2">&quot;1 &lt; 3 &gt; 2&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]</span>
<span class="k">assert</span> <span class="n">nonterminals</span><span class="p">(</span><span class="s2">&quot;1 &lt;3&gt; 2&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;&lt;3&gt;&quot;</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">nonterminals</span><span class="p">(</span><span class="s2">&quot;1 + 2&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]</span>
<span class="k">assert</span> <span class="n">nonterminals</span><span class="p">((</span><span class="s2">&quot;&lt;1&gt;&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;option&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">}))</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;&lt;1&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Likewise, <code>is_nonterminal()</code> checks whether some symbol is a nonterminal:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">is_nonterminal</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">RE_NONTERMINAL</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">is_nonterminal</span><span class="p">(</span><span class="s2">&quot;&lt;abc&gt;&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">is_nonterminal</span><span class="p">(</span><span class="s2">&quot;&lt;symbol-1&gt;&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">is_nonterminal</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="A-Simple-Grammar-Fuzzer">A Simple Grammar Fuzzer<a class="anchor-link" href="#A-Simple-Grammar-Fuzzer">&#182;</a></h2><p>Let us now put the above grammars to use.   We will build a very simple grammar fuzzer that starts with a start symbol (<code>"&lt;start&gt;"</code>) and then keeps on expanding it.  To avoid expansion to infinite inputs, we place a limit (<code>max_symbols</code>) on the number of symbols.  Furthermore, to avoid being stuck in a situation where we cannot reduce the number of symbols any further, we also limit the total number of expansion steps.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/random.html" class="import" target="_blank">random</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ExpansionError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">simple_grammar_fuzzer</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">start_symbol</span><span class="o">=</span><span class="n">START_SYMBOL</span><span class="p">,</span>
                          <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_expansion_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                          <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">term</span> <span class="o">=</span> <span class="n">start_symbol</span>
    <span class="n">expansion_trials</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">nonterminals</span><span class="p">(</span><span class="n">term</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">symbol_to_expand</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">nonterminals</span><span class="p">(</span><span class="n">term</span><span class="p">))</span>
        <span class="n">expansions</span> <span class="o">=</span> <span class="n">grammar</span><span class="p">[</span><span class="n">symbol_to_expand</span><span class="p">]</span>
        <span class="n">expansion</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">expansions</span><span class="p">)</span>
        <span class="n">new_term</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">symbol_to_expand</span><span class="p">,</span> <span class="n">expansion</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nonterminals</span><span class="p">(</span><span class="n">new_term</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">max_nonterminals</span><span class="p">:</span>
            <span class="n">term</span> <span class="o">=</span> <span class="n">new_term</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%-40s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">symbol_to_expand</span> <span class="o">+</span> <span class="s2">&quot; -&gt; &quot;</span> <span class="o">+</span> <span class="n">expansion</span><span class="p">),</span> <span class="n">term</span><span class="p">)</span>
            <span class="n">expansion_trials</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expansion_trials</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">expansion_trials</span> <span class="o">&gt;=</span> <span class="n">max_expansion_trials</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExpansionError</span><span class="p">(</span><span class="s2">&quot;Cannot expand &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">term</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">term</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us see how this simple grammar fuzzer obtains an arithmetic expression from the start symbol:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">simple_grammar_fuzzer</span><span class="p">(</span><span class="n">grammar</span><span class="o">=</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;start&gt; -&gt; &lt;expr&gt;                        &lt;expr&gt;
&lt;expr&gt; -&gt; &lt;term&gt; + &lt;expr&gt;                &lt;term&gt; + &lt;expr&gt;
&lt;term&gt; -&gt; &lt;factor&gt;                       &lt;factor&gt; + &lt;expr&gt;
&lt;factor&gt; -&gt; &lt;integer&gt;                    &lt;integer&gt; + &lt;expr&gt;
&lt;integer&gt; -&gt; &lt;digit&gt;                     &lt;digit&gt; + &lt;expr&gt;
&lt;digit&gt; -&gt; 6                             6 + &lt;expr&gt;
&lt;expr&gt; -&gt; &lt;term&gt; - &lt;expr&gt;                6 + &lt;term&gt; - &lt;expr&gt;
&lt;expr&gt; -&gt; &lt;term&gt;                         6 + &lt;term&gt; - &lt;term&gt;
&lt;term&gt; -&gt; &lt;factor&gt;                       6 + &lt;factor&gt; - &lt;term&gt;
&lt;factor&gt; -&gt; -&lt;factor&gt;                    6 + -&lt;factor&gt; - &lt;term&gt;
&lt;term&gt; -&gt; &lt;factor&gt;                       6 + -&lt;factor&gt; - &lt;factor&gt;
&lt;factor&gt; -&gt; (&lt;expr&gt;)                     6 + -(&lt;expr&gt;) - &lt;factor&gt;
&lt;factor&gt; -&gt; (&lt;expr&gt;)                     6 + -(&lt;expr&gt;) - (&lt;expr&gt;)
&lt;expr&gt; -&gt; &lt;term&gt;                         6 + -(&lt;term&gt;) - (&lt;expr&gt;)
&lt;expr&gt; -&gt; &lt;term&gt;                         6 + -(&lt;term&gt;) - (&lt;term&gt;)
&lt;term&gt; -&gt; &lt;factor&gt;                       6 + -(&lt;factor&gt;) - (&lt;term&gt;)
&lt;factor&gt; -&gt; +&lt;factor&gt;                    6 + -(+&lt;factor&gt;) - (&lt;term&gt;)
&lt;factor&gt; -&gt; +&lt;factor&gt;                    6 + -(++&lt;factor&gt;) - (&lt;term&gt;)
&lt;term&gt; -&gt; &lt;factor&gt;                       6 + -(++&lt;factor&gt;) - (&lt;factor&gt;)
&lt;factor&gt; -&gt; (&lt;expr&gt;)                     6 + -(++(&lt;expr&gt;)) - (&lt;factor&gt;)
&lt;factor&gt; -&gt; &lt;integer&gt;                    6 + -(++(&lt;expr&gt;)) - (&lt;integer&gt;)
&lt;expr&gt; -&gt; &lt;term&gt;                         6 + -(++(&lt;term&gt;)) - (&lt;integer&gt;)
&lt;integer&gt; -&gt; &lt;digit&gt;                     6 + -(++(&lt;term&gt;)) - (&lt;digit&gt;)
&lt;digit&gt; -&gt; 9                             6 + -(++(&lt;term&gt;)) - (9)
&lt;term&gt; -&gt; &lt;factor&gt; * &lt;term&gt;              6 + -(++(&lt;factor&gt; * &lt;term&gt;)) - (9)
&lt;term&gt; -&gt; &lt;factor&gt;                       6 + -(++(&lt;factor&gt; * &lt;factor&gt;)) - (9)
&lt;factor&gt; -&gt; &lt;integer&gt;                    6 + -(++(&lt;integer&gt; * &lt;factor&gt;)) - (9)
&lt;integer&gt; -&gt; &lt;digit&gt;                     6 + -(++(&lt;digit&gt; * &lt;factor&gt;)) - (9)
&lt;digit&gt; -&gt; 2                             6 + -(++(2 * &lt;factor&gt;)) - (9)
&lt;factor&gt; -&gt; +&lt;factor&gt;                    6 + -(++(2 * +&lt;factor&gt;)) - (9)
&lt;factor&gt; -&gt; -&lt;factor&gt;                    6 + -(++(2 * +-&lt;factor&gt;)) - (9)
&lt;factor&gt; -&gt; -&lt;factor&gt;                    6 + -(++(2 * +--&lt;factor&gt;)) - (9)
&lt;factor&gt; -&gt; -&lt;factor&gt;                    6 + -(++(2 * +---&lt;factor&gt;)) - (9)
&lt;factor&gt; -&gt; -&lt;factor&gt;                    6 + -(++(2 * +----&lt;factor&gt;)) - (9)
&lt;factor&gt; -&gt; &lt;integer&gt;.&lt;integer&gt;          6 + -(++(2 * +----&lt;integer&gt;.&lt;integer&gt;)) - (9)
&lt;integer&gt; -&gt; &lt;digit&gt;                     6 + -(++(2 * +----&lt;digit&gt;.&lt;integer&gt;)) - (9)
&lt;integer&gt; -&gt; &lt;digit&gt;                     6 + -(++(2 * +----&lt;digit&gt;.&lt;digit&gt;)) - (9)
&lt;digit&gt; -&gt; 1                             6 + -(++(2 * +----1.&lt;digit&gt;)) - (9)
&lt;digit&gt; -&gt; 7                             6 + -(++(2 * +----1.7)) - (9)
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;6 + -(++(2 * +----1.7)) - (9)&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>By increasing the limit of nonterminals, we can quickly get much longer productions:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">simple_grammar_fuzzer</span><span class="p">(</span><span class="n">grammar</span><span class="o">=</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>7 / +48.5
-5.9 / 9 - 4 * +-(-+++((1 + (+7 - (-1 * (++-+7.7 - -+-4.0))))) * +--4 - -(6) + 64)
8.2 - 27 - -9 / +((+9 * --2 + --+-+-((-1 * +(8 - 5 - 6)) * (-((-+(((+(4))))) - ++4) / +(-+---((5.6 - --(3 * -1.8 * +(6 * +-(((-(-6) * ---+6)) / +--(+-+-7 * (-0 * (+(((((2)) + 8 - 3 - ++9.0 + ---(--+7 / (1 / +++6.37) + (1) / 482) / +++-+0)))) * -+5 + 7.513)))) - (+1 / ++((-84)))))))) * ++5 / +-(--2 - -++-9.0)))) / 5 * --++090
1 - -3 * 7 - 28 / 9
(+9) * +-5 * ++-926.2 - (+9.03 / -+(-(-6) / 2 * +(-+--(8) / -(+1.0) - 5 + 4)) * 3.5)
8 + -(9.6 - 3 - -+-4 * +77)
-(((((++((((+((++++-((+-37))))))))))))) / ++(-(+++(+6)) * -++-(+(++(---6 * (((7)) * (1) / (-7.6 * 535338) + +256) * 0) * 0))) - 4 + +1
5.43
(9 / -405 / -23 - +-((+-(2 * (13))))) + +6 - +8 - 934
-++2 - (--+715769550) / 8 / (1)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Note that this fuzzer is rather inefficient due to the large number of search and replace operations.  On the other hand, the implementation is straightforward and does the job in most cases.  For this chapter, we'll stick to it; in the <a href="GrammarFuzzer.html">next chapter</a>, we'll show how to build a more efficient one.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Some-Grammars">Some Grammars<a class="anchor-link" href="#Some-Grammars">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With grammars, we can easily specify the format for several of the examples we discussed earlier.  The above arithmetic expressions, for instance, can be directly sent into <code>bc</code> (or any other program that takes arithmetic expressions).</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="A-CGI-Grammar">A CGI Grammar<a class="anchor-link" href="#A-CGI-Grammar">&#182;</a></h3><p>Let us create some more grammars.  Here's one for <code>cgi_decode()</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">CGI_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;string&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;string&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;letter&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;letter&gt;&lt;string&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;letter&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;plus&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;percent&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;other&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;plus&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;+&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;percent&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;%&lt;hexdigit&gt;&lt;hexdigit&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;hexdigit&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span>
            <span class="s2">&quot;8&quot;</span><span class="p">,</span> <span class="s2">&quot;9&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;other&gt;&quot;</span><span class="p">:</span>  <span class="c1"># Actually, could be _all_ letters</span>
        <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In contrast to <a href="Fuzzer.html">basic fuzzing</a> or <a href="MutationFuzzer.html">mutation-based fuzzing</a>, the grammar quickly produces all sorts of combinations:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">simple_grammar_fuzzer</span><span class="p">(</span><span class="n">grammar</span><span class="o">=</span><span class="n">CGI_GRAMMAR</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+%9a
+++%ce+
+_
+%c6c
++
+%cd+5
1%ee
%b9%d5
%96
%57d%42
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="A-URL-Grammar">A URL Grammar<a class="anchor-link" href="#A-URL-Grammar">&#182;</a></h3><p>The same properties we have seen for CGI input also hold for more complex inputs.  Let us use a grammar to produce a large number of valid URLs:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">URL_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;url&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;url&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;scheme&gt;://&lt;authority&gt;&lt;path&gt;&lt;query&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;scheme&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="s2">&quot;ftp&quot;</span><span class="p">,</span> <span class="s2">&quot;ftps&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;authority&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;host&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;host&gt;:&lt;port&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;userinfo&gt;@&lt;host&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;userinfo&gt;@&lt;host&gt;:&lt;port&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;host&gt;&quot;</span><span class="p">:</span>  <span class="c1"># Just a few</span>
        <span class="p">[</span><span class="s2">&quot;cispa.saarland&quot;</span><span class="p">,</span> <span class="s2">&quot;www.google.com&quot;</span><span class="p">,</span> <span class="s2">&quot;fuzzingbook.com&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;port&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;80&quot;</span><span class="p">,</span> <span class="s2">&quot;8080&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;nat&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;nat&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;digit&gt;&lt;digit&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span> <span class="s2">&quot;9&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;userinfo&gt;&quot;</span><span class="p">:</span>  <span class="c1"># Just one</span>
        <span class="p">[</span><span class="s2">&quot;user:password&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;path&gt;&quot;</span><span class="p">:</span>  <span class="c1"># Just a few</span>
        <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;/&lt;id&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;id&gt;&quot;</span><span class="p">:</span>  <span class="c1"># Just a few</span>
        <span class="p">[</span><span class="s2">&quot;abc&quot;</span><span class="p">,</span> <span class="s2">&quot;def&quot;</span><span class="p">,</span> <span class="s2">&quot;x&lt;digit&gt;&lt;digit&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;query&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;?&lt;params&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;params&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;param&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;param&gt;&amp;&lt;params&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;param&gt;&quot;</span><span class="p">:</span>  <span class="c1"># Just a few</span>
        <span class="p">[</span><span class="s2">&quot;&lt;id&gt;=&lt;id&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;id&gt;=&lt;nat&gt;&quot;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Again, within milliseconds, we can produce plenty of valid inputs.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">simple_grammar_fuzzer</span><span class="p">(</span><span class="n">grammar</span><span class="o">=</span><span class="n">URL_GRAMMAR</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>https://user:password@cispa.saarland:80/
http://fuzzingbook.com?def=56&amp;x89=3&amp;x46=48&amp;def=def
ftp://cispa.saarland/?x71=5&amp;x35=90&amp;def=abc
https://cispa.saarland:80/def?def=7&amp;x23=abc
https://fuzzingbook.com:80/
https://fuzzingbook.com:80/abc?def=abc&amp;abc=x14&amp;def=abc&amp;abc=2&amp;def=38
ftps://fuzzingbook.com/x87
https://user:password@fuzzingbook.com:6?def=54&amp;x44=abc
http://fuzzingbook.com:80?x33=25&amp;def=8
http://fuzzingbook.com:8080/def
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Grammars-as-Mutation-Seeds">Grammars as Mutation Seeds<a class="anchor-link" href="#Grammars-as-Mutation-Seeds">&#182;</a></h2><p>One very useful property of grammars is that they produce mostly valid inputs.  From a syntactical standpoint, the inputs are actually <em>always</em> valid, as they satisfy the constraints of the given grammar.  (Of course, one needs a valid grammar in the first place.)  However, there are also <em>semantical</em> properties that cannot be easily expressed in a grammar.  If, say, for a URL, the port range is supposed to be between 1024 and 2048, this is hard to write in a grammar.  If one has to satisfy more complex constraints, one quickly reaches the limits of what a grammar can express.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>One way around this is to attach constraints to grammars, as we will discuss <a href="ConstraintFuzzer.html">later in this book</a>.  Another possibility is to put together the strengths of grammar-based fuzzing and <a href="MutationFuzzer.html">mutation-based fuzzing</a>.  The idea is to use the grammar-generated inputs as <em>seeds</em> for further mutation-based fuzzing.  This way, we can explore not only <em>valid</em> inputs, but also check out the <em>boundaries</em> between valid and invalid inputs – and, by the way, also again errors due to invalid inputs.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To use our generated inputs as seeds, we can feed them directly into the mutation fuzzers introduced earlier:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="MutationFuzzer.html" class="import" target="_blank">MutationFuzzer</a></span> <span class="k">import</span> <span class="n">MutationFuzzer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">number_of_seeds</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">seeds</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">simple_grammar_fuzzer</span><span class="p">(</span>
        <span class="n">grammar</span><span class="o">=</span><span class="n">URL_GRAMMAR</span><span class="p">,</span>
        <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_seeds</span><span class="p">)]</span>
<span class="n">seeds</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;https://user:password@fuzzingbook.com:80/abc&#39;,
 &#39;ftp://fuzzingbook.com:8080?x85=def&amp;x18=def&#39;,
 &#39;ftp://fuzzingbook.com/def?x41=def&#39;,
 &#39;https://www.google.com:80/?abc=31&#39;,
 &#39;https://cispa.saarland&#39;,
 &#39;ftps://user:password@cispa.saarland:7?def=abc&#39;,
 &#39;http://www.google.com/x85&#39;,
 &#39;http://user:password@www.google.com:00/?abc=def&amp;x08=abc&#39;,
 &#39;http://cispa.saarland/x39?def=abc&#39;,
 &#39;ftps://www.google.com&#39;]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">MutationFuzzer</span><span class="p">(</span><span class="n">seeds</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>https://user:password@fuzzingbook.com:80/abc
ftp://fuzzingbook.com:8080?x85=def&amp;x18=def
ftp://fuzzingbook.com/def?x41=def
https://www.google.com:80/?abc=31
https://cispa.saarland
ftps://user:password@cispa.saarland:7?def=abc
http://www.google.com/x85
http://user:password@www.google.com:00/?abc=def&amp;x08=abc
http://cispa.saarland/x39?def=abc
ftps://www.google.com
http://ww.3google.cm/x85
xttp://www.gMoglecom/x85
fTps://7ww.Nogn.cdzm
htp:u//wwwe.google.com/885
ftp:/+fuzingbk.aom:880x85=df&amp;x18=def
xttip:/&#39;wvH.goofl1e.com/x81
ftp://fwUzzingbook.com/def?41=df
ftp:/i/fuzzingbook.com/def?y41=def
ftp//f!uz&gt;zijgbookncomG(odef;x41=daf
http:/.user:1pasword@ww+w.goglecom:00/?abc=def&amp;x0:=abc
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>While the first 10 <code>fuzz()</code> calls return the seeded inputs (as designed), the later ones again create arbitrary mutations.  Using <code>MutationCoverageFuzzer</code> instead of <code>MutationFuzzer</code>, we could again have our search guided by coverage – and thus bring together the best of multiple worlds.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Grammar-Shortcuts">Grammar Shortcuts<a class="anchor-link" href="#Grammar-Shortcuts">&#182;</a></h2><p>Let us now introduce a few techniques that help us writing grammars.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Escapes">Escapes<a class="anchor-link" href="#Escapes">&#182;</a></h3><p>With <code>&lt;</code> and <code>&gt;</code> delimiting non-terminals in our grammars, how can we actually express that some input should contain <code>&lt;</code> and <code>&gt;</code>?  The answer is simple: Just introduce a symbol for them.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nonterminal_grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;nonterminal&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;nonterminal&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;left-angle&gt;&lt;identifier&gt;&lt;right-angle&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;left-angle&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;right-angle&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&gt;&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In <code>nonterminal_grammar</code>, neither the expansion for <code>&lt;left-angle&gt;</code> nor the expansion for <code>&lt;right-angle&gt;</code> can be mistaken as a nonterminal.  Hence, we can produce as many as we want.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Character-Classes">Character Classes<a class="anchor-link" href="#Character-Classes">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the above <code>nonterminal_grammar</code>, we have left out the definition for <code>&lt;identifier&gt;</code>.  That is because enumerating all letters or digits in a grammar manually, as in <code>&lt;letter&gt; ::= 'a' | 'b' | 'c' ...</code> is a bit painful.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>However, remember that grammars are part of a program, and can thus also be constructed programmatically.  In Python, the constant <code>string.ascii_letters</code> contains all letters in the ASCII character set:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/string.html" class="import" target="_blank">string</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>From this, we can construct a list of all letters:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">srange</span><span class="p">(</span><span class="n">characters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Construct a list with all characters in the string }`characters`&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">characters</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">srange</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;, &#39;h&#39;, &#39;i&#39;, &#39;j&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now use this in our grammar to define identifiers:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nonterminal_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;identifier&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;idchar&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;idchar&gt;&lt;identifier&gt;&quot;</span><span class="p">]</span>
<span class="n">nonterminal_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;idchar&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">srange</span><span class="p">(</span>
    <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">)</span> <span class="o">+</span> <span class="n">srange</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="o">+</span> <span class="n">srange</span><span class="p">(</span><span class="s2">&quot;-_&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span><span class="n">simple_grammar_fuzzer</span><span class="p">(</span><span class="n">nonterminal_grammar</span><span class="p">,</span> <span class="s2">&quot;&lt;identifier&gt;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;cC&#39;, &#39;b&#39;, &#39;rQ&#39;, &#39;8&#39;, &#39;h&#39;, &#39;M&#39;, &#39;0&#39;, &#39;I&#39;, &#39;z&#39;, &#39;YI&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The shortcut <code>crange(start, end)</code> returns a list of all characters in the ASCII range of <code>start</code> to (including) <code>end</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">crange</span><span class="p">(</span><span class="n">character_start</span><span class="p">,</span> <span class="n">character_end</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">character_start</span><span class="p">),</span> <span class="nb">ord</span><span class="p">(</span><span class="n">character_end</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can use this to express ranges of characters:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">crange</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">crange</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">srange</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Grammar-Shortcuts">Grammar Shortcuts<a class="anchor-link" href="#Grammar-Shortcuts">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the above <code>nonterminal_grammar</code>, as in other grammars, we have to express repetitions of characters using <em>recursion</em>, that is, by referring to the original definition:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nonterminal_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;identifier&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;&lt;idchar&gt;&#39;, &#39;&lt;idchar&gt;&lt;identifier&gt;&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>It could be a bit easier if we simply could state that a nonterminal should be a non-empty sequence of letters – for instance, as in</p>

<pre><code>&lt;identifier&gt; = &lt;idchar&gt;+</code></pre>
<p>where <code>+</code> denotes a non-empty repetition of the symbol it follows.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Operators such as <code>+</code> are frequently introduced as handy <em>shortcuts</em> in grammars.  Formally, our grammars come in the so-called <a href="https://en.wikipedia.org/wiki/Backus-Naur_form">Backus-Naur form</a>, or BNF for short.  Operators <em>extend</em> BNF to so-called <em>extended</em> BNF, or EBNF for short:</p>
<ul>
<li>The form <code>&lt;symbol&gt;?</code> indicates that <code>&lt;symbol&gt;</code> is optional – that is, it can occur 0 or 1 times.</li>
<li>The form <code>&lt;symbol&gt;+</code> indicates that <code>&lt;symbol&gt;</code> can occur 1 or more times repeatedly.</li>
<li>The form <code>&lt;symbol&gt;*</code> indicates that <code>&lt;symbol&gt;</code> can occur 0 or more times.  (In other words, it is an optional repetition.)</li>
</ul>
<p>To make matters even more interesting, we would like to use <em>parentheses</em> with the above shortcuts.  Thus, <code>(&lt;foo&gt;&lt;bar&gt;)?</code> indicates that the sequence of <code>&lt;foo&gt;</code> and <code>&lt;bar&gt;</code> is optional.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Using such operators, we can define the identifier rule in a simpler way.  To this end, let us create a copy of the original grammar and modify the <code>&lt;identifier&gt;</code> rule:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/copy.html" class="import" target="_blank">copy</a></span> <span class="k">import</span> <span class="n">deepcopy</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nonterminal_ebnf_grammar</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">nonterminal_grammar</span><span class="p">)</span>
<span class="n">nonterminal_ebnf_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;identifier&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&lt;idchar&gt;+&quot;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Likewise, we can simplify the expression grammar.  Consider how signs are optional, and how integers can be expressed as sequences of digits.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">EXPR_EBNF_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;term&gt; + &lt;expr&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;term&gt; - &lt;expr&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;factor&gt; * &lt;term&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;factor&gt; / &lt;term&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;factor&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;factor&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;sign&gt;?&lt;factor&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;(&lt;expr&gt;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;integer&gt;(.&lt;integer&gt;)?&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;sign&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;integer&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;digit&gt;+&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">:</span>
        <span class="n">srange</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our aim is to convert EBNF grammars such as the ones above into a regular BNF grammar.  This is done by four rules:</p>
<ol>
<li>An expression <code>(content)op</code>, where <code>op</code> is one of <code>?</code>, <code>+</code>, <code>*</code>, becomes <code>&lt;new-symbol&gt;op</code>, with a new rule <code>&lt;new-symbol&gt; ::= content</code>.</li>
<li>An expression <code>&lt;symbol&gt;?</code> becomes <code>&lt;new-symbol&gt;</code>, where <code>&lt;new-symbol&gt; ::= &lt;empty&gt; | &lt;symbol&gt;</code>.</li>
<li>An expression <code>&lt;symbol&gt;+</code> becomes <code>&lt;new-symbol&gt;</code>, where <code>&lt;new-symbol&gt; ::= &lt;symbol&gt; | &lt;symbol&gt;&lt;new-symbol&gt;</code>.</li>
<li>An expression <code>&lt;symbol&gt;*</code> becomes <code>&lt;new-symbol&gt;</code>, where <code>&lt;new-symbol&gt; ::= &lt;empty&gt; | &lt;symbol&gt;&lt;new-symbol&gt;</code>.</li>
</ol>
<p>Here, <code>&lt;empty&gt;</code> expands to the empty string, as in <code>&lt;empty&gt; ::=</code></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If these operators remind you of <em>regular expressions</em>, this is not by accident: Actually, any basic regular expression can be converted into a grammar using the above rules (and character classes with <code>crange()</code>, as defined above).</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Applying these rules on the examples above yields the following results:</p>
<ul>
<li><code>&lt;idchar&gt;+</code> becomes <code>&lt;idchar&gt;&lt;new-symbol&gt;</code> with <code>&lt;new-symbol&gt; ::= &lt;idchar&gt; | &lt;idchar&gt;&lt;new-symbol&gt;</code>.  </li>
<li><code>&lt;integer&gt;(.&lt;integer&gt;)?</code> becomes <code>&lt;integer&gt;&lt;new-symbol&gt;</code> with <code>&lt;new-symbol&gt; ::= &lt;empty&gt; | .&lt;integer&gt;</code>.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us implement these rules in three steps.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Creating-New-Symbols">Creating New Symbols<a class="anchor-link" href="#Creating-New-Symbols">&#182;</a></h4><p>First, we need a mechanism to create new symbols.  This is fairly straightforward.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">new_symbol</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">symbol_name</span><span class="o">=</span><span class="s2">&quot;&lt;symbol&gt;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a new symbol for `grammar` based on `symbol_name`&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">symbol_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grammar</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">symbol_name</span>

    <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">tentative_symbol_name</span> <span class="o">=</span> <span class="n">symbol_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span>
        <span class="k">if</span> <span class="n">tentative_symbol_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grammar</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tentative_symbol_name</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">new_symbol</span><span class="p">(</span><span class="n">EXPR_EBNF_GRAMMAR</span><span class="p">,</span> <span class="s1">&#39;&lt;expr&gt;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&lt;expr-1&gt;&#39;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Expanding-Parenthesized-Expressions">Expanding Parenthesized Expressions<a class="anchor-link" href="#Expanding-Parenthesized-Expressions">&#182;</a></h4></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Next, we need a means to extract parenthesized expressions from our expansions and expand them according to the rules above.  Let's start with extracting expressions:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">RE_PARENTHESIZED_EXPR</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\([^())]*\)[?+*]&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">parenthesized_expressions</span><span class="p">(</span><span class="n">expansion</span><span class="p">):</span>
    <span class="c1"># In later chapters, we allow expansions to be tuples,</span>
    <span class="c1"># with the expansion being the first element</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">expansion</span> <span class="o">=</span> <span class="n">expansion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">RE_PARENTHESIZED_EXPR</span><span class="p">,</span> <span class="n">expansion</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">parenthesized_expressions</span><span class="p">(</span><span class="s2">&quot;(&lt;foo&gt;)* (&lt;foo&gt;&lt;bar&gt;)+ (+&lt;foo&gt;)? &lt;integer&gt;(.&lt;integer&gt;)?&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span>
    <span class="s1">&#39;(&lt;foo&gt;)*&#39;</span><span class="p">,</span> <span class="s1">&#39;(&lt;foo&gt;&lt;bar&gt;)+&#39;</span><span class="p">,</span> <span class="s1">&#39;(+&lt;foo&gt;)?&#39;</span><span class="p">,</span> <span class="s1">&#39;(.&lt;integer&gt;)?&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now use these to apply rule number 1, above, introducing new symbols for expressions in parentheses.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">convert_ebnf_parentheses</span><span class="p">(</span><span class="n">ebnf_grammar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a grammar in extended BNF to BNF&quot;&quot;&quot;</span>
    <span class="n">grammar</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">ebnf_grammar</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">nonterminal</span> <span class="ow">in</span> <span class="n">ebnf_grammar</span><span class="p">:</span>
        <span class="n">expansions</span> <span class="o">=</span> <span class="n">ebnf_grammar</span><span class="p">[</span><span class="n">nonterminal</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expansions</span><span class="p">)):</span>
            <span class="n">expansion</span> <span class="o">=</span> <span class="n">expansions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">parenthesized_exprs</span> <span class="o">=</span> <span class="n">parenthesized_expressions</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parenthesized_exprs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">parenthesized_exprs</span><span class="p">:</span>
                    <span class="n">operator</span> <span class="o">=</span> <span class="n">expr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="n">contents</span> <span class="o">=</span> <span class="n">expr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

                    <span class="n">new_sym</span> <span class="o">=</span> <span class="n">new_symbol</span><span class="p">(</span><span class="n">grammar</span><span class="p">)</span>
                    <span class="n">expansion</span> <span class="o">=</span> <span class="n">grammar</span><span class="p">[</span><span class="n">nonterminal</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="n">expr</span><span class="p">,</span> <span class="n">new_sym</span> <span class="o">+</span> <span class="n">operator</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">grammar</span><span class="p">[</span><span class="n">nonterminal</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">expansion</span>
                    <span class="n">grammar</span><span class="p">[</span><span class="n">new_sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">contents</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This does the conversion as sketched above:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">convert_ebnf_parentheses</span><span class="p">({</span><span class="s2">&quot;&lt;number&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;integer&gt;(.&lt;integer&gt;)?&quot;</span><span class="p">]})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;number&gt;&#39;: [&#39;&lt;integer&gt;&lt;symbol&gt;?&#39;], &#39;&lt;symbol&gt;&#39;: [&#39;.&lt;integer&gt;&#39;]}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This even works for nested parenthesized expressions:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">convert_ebnf_parentheses</span><span class="p">({</span><span class="s2">&quot;&lt;foo&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;((&lt;foo&gt;)?)+&quot;</span><span class="p">]})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;foo&gt;&#39;: [&#39;&lt;symbol-1&gt;+&#39;], &#39;&lt;symbol&gt;&#39;: [&#39;&lt;foo&gt;&#39;], &#39;&lt;symbol-1&gt;&#39;: [&#39;&lt;symbol&gt;?&#39;]}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Expanding-Operators">Expanding Operators<a class="anchor-link" href="#Expanding-Operators">&#182;</a></h4><p>After expanding parenthesized expressions, we now need to take care of symbols followed by operators (<code>?</code>, <code>*</code>, <code>+</code>).  As with <code>convert_ebnf_parentheses()</code>, above, we first extract all symbols followed by an operator.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">RE_EXTENDED_NONTERMINAL</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(&lt;[^&lt;&gt; ]*&gt;[?+*])&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">extended_nonterminals</span><span class="p">(</span><span class="n">expansion</span><span class="p">):</span>
    <span class="c1"># In later chapters, we allow expansions to be tuples,</span>
    <span class="c1"># with the expansion being the first element</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">expansion</span> <span class="o">=</span> <span class="n">expansion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">RE_EXTENDED_NONTERMINAL</span><span class="p">,</span> <span class="n">expansion</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">extended_nonterminals</span><span class="p">(</span>
    <span class="s2">&quot;&lt;foo&gt;* &lt;bar&gt;+ &lt;elem&gt;? &lt;none&gt;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;&lt;foo&gt;*&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;bar&gt;+&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;elem&gt;?&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our converter extracts the symbol and the operator, and adds new symbols according to the rules laid out above.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">convert_ebnf_operators</span><span class="p">(</span><span class="n">ebnf_grammar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a grammar in extended BNF to BNF&quot;&quot;&quot;</span>
    <span class="n">grammar</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">ebnf_grammar</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">nonterminal</span> <span class="ow">in</span> <span class="n">ebnf_grammar</span><span class="p">:</span>
        <span class="n">expansions</span> <span class="o">=</span> <span class="n">ebnf_grammar</span><span class="p">[</span><span class="n">nonterminal</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expansions</span><span class="p">)):</span>
            <span class="n">expansion</span> <span class="o">=</span> <span class="n">expansions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">extended_symbols</span> <span class="o">=</span> <span class="n">extended_nonterminals</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">extended_symbol</span> <span class="ow">in</span> <span class="n">extended_symbols</span><span class="p">:</span>
                <span class="n">operator</span> <span class="o">=</span> <span class="n">extended_symbol</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">original_symbol</span> <span class="o">=</span> <span class="n">extended_symbol</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">new_sym</span> <span class="o">=</span> <span class="n">new_symbol</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">original_symbol</span><span class="p">)</span>
                <span class="n">grammar</span><span class="p">[</span><span class="n">nonterminal</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">grammar</span><span class="p">[</span><span class="n">nonterminal</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="n">extended_symbol</span><span class="p">,</span> <span class="n">new_sym</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;?&#39;</span><span class="p">:</span>
                    <span class="n">grammar</span><span class="p">[</span><span class="n">new_sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">original_symbol</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
                    <span class="n">grammar</span><span class="p">[</span><span class="n">new_sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">original_symbol</span> <span class="o">+</span> <span class="n">new_sym</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>
                    <span class="n">grammar</span><span class="p">[</span><span class="n">new_sym</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">original_symbol</span><span class="p">,</span> <span class="n">original_symbol</span> <span class="o">+</span> <span class="n">new_sym</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">convert_ebnf_operators</span><span class="p">({</span><span class="s2">&quot;&lt;integer&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;digit&gt;+&quot;</span><span class="p">]})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;integer&gt;&#39;: [&#39;&lt;digit&gt;&#39;], &#39;&lt;digit&gt;&#39;: [&#39;&lt;digit&gt;&#39;, &#39;&lt;digit&gt;&lt;digit&gt;&#39;]}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="All-Together">All Together<a class="anchor-link" href="#All-Together">&#182;</a></h4><p>We can combine the two, first extending parentheses and then operators:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">convert_ebnf_grammar</span><span class="p">(</span><span class="n">ebnf_grammar</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">convert_ebnf_operators</span><span class="p">(</span><span class="n">convert_ebnf_parentheses</span><span class="p">(</span><span class="n">ebnf_grammar</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">convert_ebnf_grammar</span><span class="p">({</span><span class="s2">&quot;&lt;authority&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;(&lt;userinfo&gt;@)?&lt;host&gt;(:&lt;port&gt;)?&quot;</span><span class="p">]})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;authority&gt;&#39;: [&#39;&lt;symbol-2&gt;&lt;host&gt;&lt;symbol-1-1&gt;&#39;],
 &#39;&lt;symbol&gt;&#39;: [&#39;&lt;userinfo&gt;@&#39;],
 &#39;&lt;symbol-1&gt;&#39;: [&#39;:&lt;port&gt;&#39;],
 &#39;&lt;symbol-2&gt;&#39;: [&#39;&#39;, &#39;&lt;symbol&gt;&#39;],
 &#39;&lt;symbol-1-1&gt;&#39;: [&#39;&#39;, &#39;&lt;symbol-1&gt;&#39;]}
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expr_grammar</span> <span class="o">=</span> <span class="n">convert_ebnf_grammar</span><span class="p">(</span><span class="n">EXPR_EBNF_GRAMMAR</span><span class="p">)</span>
<span class="n">expr_grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;start&gt;&#39;: [&#39;&lt;expr&gt;&#39;],
 &#39;&lt;expr&gt;&#39;: [&#39;&lt;term&gt; + &lt;expr&gt;&#39;, &#39;&lt;term&gt; - &lt;expr&gt;&#39;, &#39;&lt;term&gt;&#39;],
 &#39;&lt;term&gt;&#39;: [&#39;&lt;factor&gt; * &lt;term&gt;&#39;, &#39;&lt;factor&gt; / &lt;term&gt;&#39;, &#39;&lt;factor&gt;&#39;],
 &#39;&lt;factor&gt;&#39;: [&#39;&lt;sign-1&gt;&lt;factor&gt;&#39;, &#39;(&lt;expr&gt;)&#39;, &#39;&lt;integer&gt;&lt;symbol-1&gt;&#39;],
 &#39;&lt;sign&gt;&#39;: [&#39;+&#39;, &#39;-&#39;],
 &#39;&lt;integer&gt;&#39;: [&#39;&lt;digit-1&gt;&#39;],
 &#39;&lt;digit&gt;&#39;: [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;],
 &#39;&lt;symbol&gt;&#39;: [&#39;.&lt;integer&gt;&#39;],
 &#39;&lt;sign-1&gt;&#39;: [&#39;&#39;, &#39;&lt;sign&gt;&#39;],
 &#39;&lt;symbol-1&gt;&#39;: [&#39;&#39;, &#39;&lt;symbol&gt;&#39;],
 &#39;&lt;digit-1&gt;&#39;: [&#39;&lt;digit&gt;&#39;, &#39;&lt;digit&gt;&lt;digit-1&gt;&#39;]}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Success! We have nicely converted the EBNF grammar into BNF.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With character classes and EBNF grammar conversion, we have two powerful tools that make the writing of grammars easier.  We will use these again and again as it comes to working with grammars.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Checking-Grammars">Checking Grammars<a class="anchor-link" href="#Checking-Grammars">&#182;</a></h2><p>Since grammars are represented as strings, it is fairly easy to introduce errors.  So let us introduce a helper function that checks a grammar for consistency.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The helper function <code>is_valid_grammar()</code> iterates over a grammar to check whether all used symbols are defined, and vice versa, which is very useful for debugging.  You don't have to delve into details here, but as always, it is important to get the input data straight before we make use of it.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/sys.html" class="import" target="_blank">sys</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">def_used_nonterminals</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">start_symbol</span><span class="o">=</span><span class="n">START_SYMBOL</span><span class="p">):</span>
    <span class="n">defined_nonterminals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">used_nonterminals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">start_symbol</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">defined_nonterminal</span> <span class="ow">in</span> <span class="n">grammar</span><span class="p">:</span>
        <span class="n">defined_nonterminals</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">defined_nonterminal</span><span class="p">)</span>
        <span class="n">expansions</span> <span class="o">=</span> <span class="n">grammar</span><span class="p">[</span><span class="n">defined_nonterminal</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansions</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">defined_nonterminal</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: expansion is not a list&quot;</span><span class="p">,</span>
                  <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expansions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">defined_nonterminal</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: expansion list empty&quot;</span><span class="p">,</span>
                  <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">expansion</span> <span class="ow">in</span> <span class="n">expansions</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">expansion</span> <span class="o">=</span> <span class="n">expansion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">defined_nonterminal</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span>
                      <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: not a string&quot;</span><span class="p">,</span>
                      <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">used_nonterminal</span> <span class="ow">in</span> <span class="n">nonterminals</span><span class="p">(</span><span class="n">expansion</span><span class="p">):</span>
                <span class="n">used_nonterminals</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">used_nonterminal</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">defined_nonterminals</span><span class="p">,</span> <span class="n">used_nonterminals</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">is_valid_grammar</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">start_symbol</span><span class="o">=</span><span class="n">START_SYMBOL</span><span class="p">):</span>
    <span class="n">defined_nonterminals</span><span class="p">,</span> <span class="n">used_nonterminals</span> <span class="o">=</span> <span class="n">def_used_nonterminals</span><span class="p">(</span>
        <span class="n">grammar</span><span class="p">,</span> <span class="n">start_symbol</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">defined_nonterminals</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">used_nonterminals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">for</span> <span class="n">unused_nonterminal</span> <span class="ow">in</span> <span class="n">defined_nonterminals</span> <span class="o">-</span> <span class="n">used_nonterminals</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">unused_nonterminal</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: defined, but not used&quot;</span><span class="p">,</span>
              <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">undefined_nonterminal</span> <span class="ow">in</span> <span class="n">used_nonterminals</span> <span class="o">-</span> <span class="n">defined_nonterminals</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">undefined_nonterminal</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: used, but not defined&quot;</span><span class="p">,</span>
              <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">used_nonterminals</span> <span class="o">==</span> <span class="n">defined_nonterminals</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our grammars defined above pass the test:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">CGI_GRAMMAR</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">URL_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The check can also be applied to EBNF grammars:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">EXPR_EBNF_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>These ones do not pass the test, though:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid_grammar</span><span class="p">({</span><span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;x&gt;&quot;</span><span class="p">],</span> <span class="s2">&quot;&lt;y&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">]})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>&#39;&lt;y&gt;&#39;: defined, but not used
&#39;&lt;x&gt;&#39;: used, but not defined
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid_grammar</span><span class="p">({</span><span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span> <span class="s2">&quot;123&quot;</span><span class="p">})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>&#39;&lt;start&gt;&#39;: expansion is not a list
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid_grammar</span><span class="p">({</span><span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span> <span class="p">[]})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>&#39;&lt;start&gt;&#39;: expansion list empty
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid_grammar</span><span class="p">({</span><span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>&#39;&lt;start&gt;&#39;: 1: not a string
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>From here on, we will always use <code>is_valid_grammar()</code> when defining a grammar.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned<a class="anchor-link" href="#Lessons-Learned">&#182;</a></h2><ul>
<li>Grammars are powerful tools to express and produce syntactically valid inputs.</li>
<li>Inputs produced from grammars can be used as is, or used as seeds for mutation-based fuzzing.</li>
<li>Grammars can be extended with character classes and operators to make writing easier.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps<a class="anchor-link" href="#Next-Steps">&#182;</a></h2><p>As they make a great foundation for generating software tests, we use grammars again and again in this work – and they become especially valuable when we can <em>infer</em> them automatically from a given domain, dropping the need to write them manually.  But before we get there, we first have to learn how to</p>
<ul>
<li><a href="GrammarFuzzer.html">create an efficient grammar fuzzer</a></li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Background">Background<a class="anchor-link" href="#Background">&#182;</a></h2><p>As one of the foundations of human language, grammars have been around as long as human language existed.  The first <em>formalization</em> of generative grammars was by Dakṣiputra Pāṇini in 350 BC [<a href="https://en.wikipedia.org/wiki/P%C4%81%E1%B9%87ini%23A%E1%B9%A3%E1%B9%AD%C4%81dhy%C4%81y%C4%AB">Dakṣiputra Pāṇini, 350 BCE.</a>].</p>
<p>\todo{Add more. Discuss LangFuzz, CSmith, Zhendong Su's work}</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises<a class="anchor-link" href="#Exercises">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1:-A-JSON-Grammar">Exercise 1: A JSON Grammar<a class="anchor-link" href="#Exercise-1:-A-JSON-Grammar">&#182;</a></h3><p>Take a look at the <a href="http://www.json.org">JSON specification</a> and derive a grammar from it:</p>
<ul>
<li>Use <em>character classes</em> to express valid characters</li>
<li>Use EBNF to express repetitions and optional parts</li>
<li>Assume that<ul>
<li>a string is a sequence of digits, ASCII letters, punctuation and space characters without quotes or escapes</li>
<li>whitespace is just a single space.</li>
</ul>
</li>
<li>Use <code>is_valid_grammar()</code> to ensure the grammar is valid.</li>
</ul>
<p>Feed the grammar into <code>simple_grammar_fuzzer()</code>.  Do you encounter any errors, and why?</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2:-Finding-Bugs">Exercise 2: Finding Bugs<a class="anchor-link" href="#Exercise-2:-Finding-Bugs">&#182;</a></h3><p>The name <code>simple_grammar_fuzzer()</code> does not come by accident: The way it expands grammars is limited in several ways.  What happens if you apply <code>simple_gramar_fuzzer()</code> on <code>nonterminal_grammar</code> and <code>expr_grammar</code>, as defined above, and why?</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-3:-Grammars-with-Regular-Expressions">Exercise 3: Grammars with Regular Expressions<a class="anchor-link" href="#Exercise-3:-Grammars-with-Regular-Expressions">&#182;</a></h3><p>In a <em>grammar extended with regular expressions</em>, we can use the special form</p>

<pre><code>/regex/</code></pre>
<p>to include regular expressions in expansions.  For instance, we can have a rule</p>

<pre><code>&lt;integer&gt; ::= /[+-]?[0-9]+/</code></pre>
<p>to quickly express that an integer is an optional sign, followed by a sequence of digits.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-1:-Convert-regular-expressions">Part 1: Convert regular expressions<a class="anchor-link" href="#Part-1:-Convert-regular-expressions">&#182;</a></h4><p>Write a converter <code>convert_regex(r)</code> that takes a regular expression <code>r</code> and creates an equivalent grammar.  Support the following regular expression constructs:</p>
<ul>
<li><code>*</code>, <code>+</code>, <code>?</code>, <code>()</code> should work just in EBNFs, above.</li>
<li><code>a|b</code> should translate into a list of alternatives <code>[a, b]</code>.</li>
<li><code>.</code> should match any character except newline.</li>
<li><code>[abc]</code> should translate into <code>srange("abc")</code></li>
<li><code>[^abc]</code> should translate into the set of ASCII characters <em>except</em> <code>srange("abc")</code>.</li>
<li><code>[a-b]</code> should translate into <code>crange(a, b)</code></li>
<li><code>[^a-b]</code> should translate into the set of ASCII characters <em>except</em> <code>crange(a, b)</code>.</li>
</ul>
<p>Example: <code>convert_regex(r"[0-9]+")</code> should yield a grammar such as</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;s1&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;s1&gt;&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;&lt;s2&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;s1&gt;&lt;s2&gt;&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;&lt;s2&gt;&quot;</span><span class="p">:</span> <span class="n">crange</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-2:-Identify-and-expand-regular-expressions">Part 2: Identify and expand regular expressions<a class="anchor-link" href="#Part-2:-Identify-and-expand-regular-expressions">&#182;</a></h4><p>Write a converter <code>convert_regex_grammar(g)</code> that takes a EBNF grammar <code>g</code> containing regular expressions in the form <code>/.../</code> and creates an equivalent BNF grammar.  Support the regular expression constructs as above.</p>
<p>Example: <code>convert_regex_grammar({ "&lt;integer&gt;" : "/[+-]?[0-9]+/" })</code> should yield a grammar such as</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;&lt;integer&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;s1&gt;&lt;s3&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;s1&gt;&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;s2&gt;&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;&lt;s2&gt;&quot;</span><span class="p">:</span> <span class="n">srange</span><span class="p">(</span><span class="s2">&quot;+-&quot;</span><span class="p">),</span>
    <span class="s2">&quot;&lt;s3&gt;&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;&lt;s4&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;s4&gt;&lt;s3&gt;&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;&lt;s4&gt;&quot;</span><span class="p">:</span> <span class="n">crange</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Optional: Support <em>escapes</em> in regular expressions: <code>\c</code> translates to the literal character <code>c</code>; <code>\/</code> translates to <code>/</code> (and thus does not end the regular expression); <code>\\</code> translates to <code>\</code>.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-4:-Defining-Grammars-as-Functions-(Advanced)">Exercise 4: Defining Grammars as Functions (Advanced)<a class="anchor-link" href="#Exercise-4:-Defining-Grammars-as-Functions-(Advanced)">&#182;</a></h3><p>To obtain a nicer syntax for specifying grammars, one can make use of Python constructs which then will be <em>parsed</em> by an additional function.  For instance, we can imagine a grammar definition which uses <code>|</code> as a means to separate alternatives:</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">expression_grammar_fn</span><span class="p">():</span>
    <span class="n">start</span> <span class="o">=</span> <span class="s2">&quot;&lt;expr&gt;&quot;</span>
    <span class="n">expr</span> <span class="o">=</span> <span class="s2">&quot;&lt;term&gt; + &lt;expr&gt;&quot;</span> <span class="o">|</span> <span class="s2">&quot;&lt;term&gt; - &lt;expr&gt;&quot;</span>
    <span class="n">term</span> <span class="o">=</span> <span class="s2">&quot;&lt;factor&gt; * &lt;term&gt;&quot;</span> <span class="o">|</span> <span class="s2">&quot;&lt;factor&gt; / &lt;term&gt;&quot;</span> <span class="o">|</span> <span class="s2">&quot;&lt;factor&gt;&quot;</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="s2">&quot;+&lt;factor&gt;&quot;</span> <span class="o">|</span> <span class="s2">&quot;-&lt;factor&gt;&quot;</span> <span class="o">|</span> <span class="s2">&quot;(&lt;expr&gt;)&quot;</span> <span class="o">|</span> <span class="s2">&quot;&lt;integer&gt;.&lt;integer&gt;&quot;</span> <span class="o">|</span> <span class="s2">&quot;&lt;integer&gt;&quot;</span>
    <span class="n">integer</span> <span class="o">=</span> <span class="s2">&quot;&lt;digit&gt;&lt;integer&gt;&quot;</span> <span class="o">|</span> <span class="s2">&quot;&lt;digit&gt;&quot;</span>
    <span class="n">digit</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">|</span> <span class="s1">&#39;1&#39;</span> <span class="o">|</span> <span class="s1">&#39;2&#39;</span> <span class="o">|</span> <span class="s1">&#39;3&#39;</span> <span class="o">|</span> <span class="s1">&#39;4&#39;</span> <span class="o">|</span> <span class="s1">&#39;5&#39;</span> <span class="o">|</span> <span class="s1">&#39;6&#39;</span> <span class="o">|</span> <span class="s1">&#39;7&#39;</span> <span class="o">|</span> <span class="s1">&#39;8&#39;</span> <span class="o">|</span> <span class="s1">&#39;9&#39;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If we execute <code>expression_grammar_fn()</code>, this will yield an error.  Yet, the purpose of <code>expression_grammar_fn()</code> is not to be executed, but to be used as <em>data</em> from which the grammar will be constructed.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">alt_expression_grammar</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-74-2307bcdfd05a&gt;&#34;, line 2, in &lt;module&gt;
    alt_expression_grammar()
NameError: name &#39;alt_expression_grammar&#39; is not defined (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To this end, we make use of the <code>ast</code> (abstract syntax tree) and <code>inspect</code> (code inspection) modules.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/ast.html" class="import" target="_blank">ast</a></span>
<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/inspect.html" class="import" target="_blank">inspect</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>First, we obtain the source code of <code>expression_grammar_fn()</code>...</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">source</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">expression_grammar_fn</span><span class="p">)</span>
<span class="n">source</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;def expression_grammar_fn():\n    start = &#34;&lt;expr&gt;&#34;\n    expr = &#34;&lt;term&gt; + &lt;expr&gt;&#34; | &#34;&lt;term&gt; - &lt;expr&gt;&#34;\n    term = &#34;&lt;factor&gt; * &lt;term&gt;&#34; | &#34;&lt;factor&gt; / &lt;term&gt;&#34; | &#34;&lt;factor&gt;&#34;\n    factor = &#34;+&lt;factor&gt;&#34; | &#34;-&lt;factor&gt;&#34; | &#34;(&lt;expr&gt;)&#34; | &#34;&lt;integer&gt;.&lt;integer&gt;&#34; | &#34;&lt;integer&gt;&#34;\n    integer = &#34;&lt;digit&gt;&lt;integer&gt;&#34; | &#34;&lt;digit&gt;&#34;\n    digit = \&#39;0\&#39; | \&#39;1\&#39; | \&#39;2\&#39; | \&#39;3\&#39; | \&#39;4\&#39; | \&#39;5\&#39; | \&#39;6\&#39; | \&#39;7\&#39; | \&#39;8\&#39; | \&#39;9\&#39;\n&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>... which we then parse into an abstract syntax tree:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now parse the tree to find operators and alternatives.  <code>get_alternatives()</code> iterates over all nodes <code>op</code> of the tree; If the node looks like a binary <em>or</em> (<code>|</code> ) operation, we drill deeper and recurse. If not, we have reached a single production, and we try to get the expression from the production. We define the <code>to_expr</code> parameter depending on how we want to represent the production. In this case, we represent a single production by a single string.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_alternatives</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">to_expr</span><span class="o">=</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BitOr</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">get_alternatives</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">to_expr</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">to_expr</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">right</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">to_expr</span><span class="p">(</span><span class="n">op</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><code>funct_parser()</code> takes the abstract syntax tree of a function (say, <code>expression_grammar_fn()</code>) and iterates over all assignments:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">funct_parser</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">to_expr</span><span class="o">=</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">assign</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">get_alternatives</span><span class="p">(</span><span class="n">assign</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">to_expr</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">assign</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">body</span><span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The result is a grammar in our regular format:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">grammar</span> <span class="o">=</span> <span class="n">funct_parser</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">grammar</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">&quot;::=&quot;</span><span class="p">,</span> <span class="n">grammar</span><span class="p">[</span><span class="n">symbol</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>start ::= [&#39;&lt;expr&gt;&#39;]
expr ::= [&#39;&lt;term&gt; + &lt;expr&gt;&#39;, &#39;&lt;term&gt; - &lt;expr&gt;&#39;]
term ::= [&#39;&lt;factor&gt; * &lt;term&gt;&#39;, &#39;&lt;factor&gt; / &lt;term&gt;&#39;, &#39;&lt;factor&gt;&#39;]
factor ::= [&#39;+&lt;factor&gt;&#39;, &#39;-&lt;factor&gt;&#39;, &#39;(&lt;expr&gt;)&#39;, &#39;&lt;integer&gt;.&lt;integer&gt;&#39;, &#39;&lt;integer&gt;&#39;]
integer ::= [&#39;&lt;digit&gt;&lt;integer&gt;&#39;, &#39;&lt;digit&gt;&#39;]
digit ::= [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-1-(a):-One-Single-Function">Part 1 (a): One Single Function<a class="anchor-link" href="#Part-1-(a):-One-Single-Function">&#182;</a></h4><p>Write a single function <code>define_grammar(fn)</code> that takes a grammar defined as function (such as <code>expression_grammar_fn</code>) and returns a regular grammar.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-1-(b):-Alternative-representations">Part 1 (b): Alternative representations<a class="anchor-link" href="#Part-1-(b):-Alternative-representations">&#182;</a></h4></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We note that the grammar representation we designed previously does not allow simple generation of alternatives such as <code>srange</code> and <code>crange</code>. Further, one may find the string representation of expressions limiting. Turns out, it is simple to extend our grammar definition to support grammars such as below:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">define_name</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">o</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span> <span class="k">else</span> <span class="n">o</span><span class="o">.</span><span class="n">s</span>

<span class="k">def</span> <span class="nf">define_expr</span><span class="p">(</span><span class="n">op</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Add</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">define_expr</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">left</span><span class="p">),</span> <span class="n">define_name</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">right</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">define_name</span><span class="p">(</span><span class="n">op</span><span class="p">),)</span>

<span class="k">def</span> <span class="nf">define_ex_grammar</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">define_grammar</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">define_expr</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The grammar:</p>
<div class="highlight"><pre><span></span><span class="nd">@define_ex_grammar</span>
<span class="k">def</span> <span class="nf">expression_grammar</span><span class="p">():</span>
    <span class="n">start</span>   <span class="o">=</span> <span class="n">expr</span>
    <span class="n">expr</span>    <span class="o">=</span> <span class="p">(</span><span class="n">term</span> <span class="o">+</span> <span class="s1">&#39;+&#39;</span> <span class="o">+</span> <span class="n">expr</span>
            <span class="o">|</span>  <span class="n">term</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">expr</span><span class="p">)</span>
    <span class="n">term</span>    <span class="o">=</span> <span class="p">(</span><span class="n">factor</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="n">term</span>
            <span class="o">|</span>  <span class="n">factor</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">term</span>
            <span class="o">|</span>  <span class="n">factor</span><span class="p">)</span>
    <span class="n">factor</span>  <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span> <span class="o">+</span> <span class="n">factor</span>
            <span class="o">|</span>  <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">factor</span>
            <span class="o">|</span>  <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">expr</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="o">|</span>  <span class="n">integer</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">integer</span>
            <span class="o">|</span>  <span class="n">integer</span><span class="p">)</span>
    <span class="n">integer</span> <span class="o">=</span> <span class="p">(</span><span class="n">digit</span> <span class="o">+</span> <span class="n">integer</span>
            <span class="o">|</span>  <span class="n">digit</span><span class="p">)</span>
    <span class="n">digit</span>   <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">|</span> <span class="s1">&#39;1&#39;</span> <span class="o">|</span> <span class="s1">&#39;2&#39;</span> <span class="o">|</span> <span class="s1">&#39;3&#39;</span> <span class="o">|</span> <span class="s1">&#39;4&#39;</span> <span class="o">|</span> <span class="s1">&#39;5&#39;</span> <span class="o">|</span> <span class="s1">&#39;6&#39;</span> <span class="o">|</span> <span class="s1">&#39;7&#39;</span> <span class="o">|</span> <span class="s1">&#39;8&#39;</span> <span class="o">|</span> <span class="s1">&#39;9&#39;</span>

<span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">expression_grammar</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="s2">&quot;::=&quot;</span><span class="p">,</span> <span class="n">expression_grammar</span><span class="p">[</span><span class="n">symbol</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Note.</strong> The grammar data structure thus obtained is a little more detailed than the standard data structure. It represents each production as a tuple.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We note that we have not enabled <code>srange</code> or <code>crange</code> in the above grammar. How would you go about adding these? (<em>Hint:</em> wrap <code>define_expr</code> to look for <code>ast.Call</code>)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-2:-Extended-Grammars">Part 2: Extended Grammars<a class="anchor-link" href="#Part-2:-Extended-Grammars">&#182;</a></h4><p>Introduce an operator <code>*</code> that takes a pair <code>(min, max)</code> where <code>min</code> and <code>max</code> are the minimum and maximum number of repetitions, respectively.  A missing value <code>min</code> stands for zero; a missing value <code>max</code> for infinity.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">identifier_grammar_fn</span><span class="p">():</span>
    <span class="n">identifier</span> <span class="o">=</span> <span class="n">idchar</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With the <code>*</code> operator, we can generalize the EBNF operators – <code>?</code> becomes (0,1), <code>*</code> becomes (0,), and <code>+</code> becomes (1,).  Write a converter that takes an extended grammar defined using <code>*</code>, parse it, and convert it into BNF.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Efficient-Grammar-Fuzzing">Efficient Grammar Fuzzing<a class="anchor-link" href="#Efficient-Grammar-Fuzzing">&#182;</a></h1><p>In the <a href="Grammars.html">chapter on grammars</a>, we have seen how to use <em>grammars</em> for very effective and efficient testing.  In this chapter, we refine the previous string-based algorithm into a tree-based algorithm, which is much faster and allows for much more control over the production of fuzz inputs.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The algorithm in this chapter serves as a foundation for several more techniques; this chapter thus is a "hub" in the book.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>You should know how grammar-based fuzzing works, e.g. from the <a href="Grammars.html">chapter on grammars</a>.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="An-Insufficient-Algorithm">An Insufficient Algorithm<a class="anchor-link" href="#An-Insufficient-Algorithm">&#182;</a></h2><p>In the <a href="Grammars.html">previous chapter</a>, we have introduced the <code>simple_grammar_fuzzer()</code> function which takes a grammar and automatically produces a syntactically valid string from it.  However, <code>simple_grammar_fuzzer()</code> is just what its name suggests – simple.  To illustrate the problem, let us get back to the <code>expr_grammar</code> we created from <code>EXPR_GRAMMAR_BNF</code> in the <a href="Grammars.html">chapter on grammars</a>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="k">import</span> <span class="n">EXPR_EBNF_GRAMMAR</span><span class="p">,</span> <span class="n">convert_ebnf_grammar</span><span class="p">,</span> <span class="n">simple_grammar_fuzzer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expr_grammar</span> <span class="o">=</span> <span class="n">convert_ebnf_grammar</span><span class="p">(</span><span class="n">EXPR_EBNF_GRAMMAR</span><span class="p">)</span>
<span class="n">expr_grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;start&gt;&#39;: [&#39;&lt;expr&gt;&#39;],
 &#39;&lt;expr&gt;&#39;: [&#39;&lt;term&gt; + &lt;expr&gt;&#39;, &#39;&lt;term&gt; - &lt;expr&gt;&#39;, &#39;&lt;term&gt;&#39;],
 &#39;&lt;term&gt;&#39;: [&#39;&lt;factor&gt; * &lt;term&gt;&#39;, &#39;&lt;factor&gt; / &lt;term&gt;&#39;, &#39;&lt;factor&gt;&#39;],
 &#39;&lt;factor&gt;&#39;: [&#39;&lt;sign-1&gt;&lt;factor&gt;&#39;, &#39;(&lt;expr&gt;)&#39;, &#39;&lt;integer&gt;&lt;symbol-1&gt;&#39;],
 &#39;&lt;sign&gt;&#39;: [&#39;+&#39;, &#39;-&#39;],
 &#39;&lt;integer&gt;&#39;: [&#39;&lt;digit-1&gt;&#39;],
 &#39;&lt;digit&gt;&#39;: [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;],
 &#39;&lt;symbol&gt;&#39;: [&#39;.&lt;integer&gt;&#39;],
 &#39;&lt;sign-1&gt;&#39;: [&#39;&#39;, &#39;&lt;sign&gt;&#39;],
 &#39;&lt;symbol-1&gt;&#39;: [&#39;&#39;, &#39;&lt;symbol&gt;&#39;],
 &#39;&lt;digit-1&gt;&#39;: [&#39;&lt;digit&gt;&#39;, &#39;&lt;digit&gt;&lt;digit-1&gt;&#39;]}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><code>expr_grammar</code> has an interesting property.  If we feed it into <code>simple_grammar_fuzzer()</code>, the function gets stuck in an infinite expansion:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="ExpectError.html" class="import" target="_blank">ExpectError</a></span> <span class="k">import</span> <span class="n">ExpectTimeout</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectTimeout</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">simple_grammar_fuzzer</span><span class="p">(</span><span class="n">grammar</span><span class="o">=</span><span class="n">expr_grammar</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-5-fbcda5f486bb&gt;&#34;, line 2, in &lt;module&gt;
    simple_grammar_fuzzer(grammar=expr_grammar, max_nonterminals=3)
  File &#34;&lt;string&gt;&#34;, line 10, in simple_grammar_fuzzer
  File &#34;/Users/zeller/anaconda3/lib/python3.6/random.py&#34;, line 258, in choice
    i = self._randbelow(len(seq))
  File &#34;/Users/zeller/anaconda3/lib/python3.6/random.py&#34;, line 236, in _randbelow
    return r
  File &#34;/Users/zeller/anaconda3/lib/python3.6/random.py&#34;, line 236, in _randbelow
    return r
  File &#34;&lt;string&gt;&#34;, line 16, in check_time
TimeoutError (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Why is that so?  The problem is in this rule:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expr_grammar</span><span class="p">[</span><span class="s1">&#39;&lt;factor&gt;&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;&lt;sign-1&gt;&lt;factor&gt;&#39;, &#39;(&lt;expr&gt;)&#39;, &#39;&lt;integer&gt;&lt;symbol-1&gt;&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here, any choice except for <code>(expr)</code> increases the number of symbols, even if only temporary.  Since we place a hard limit on the number of symbols to expand, the only choice left for expanding <code>&lt;factor&gt;</code> is <code>(&lt;expr&gt;)</code>, which leads to an infinite addition of parentheses.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The problem of potentially infinite expansion is only one of the problems with <code>simple_grammar_fuzzer()</code>.  More problems include:</p>
<ol>
<li><p><em>It is inefficient</em>.  With each iteration, this fuzzer would go search the string produced so far for symbols to expand.  This becomes inefficient as the production string grows.</p>
</li>
<li><p><em>It is hard to control.</em>  Even while limiting the number of symbols, it is still possible to obtain very long strings – and even infinitely long ones, as discussed above.</p>
</li>
</ol>
<p>Let us illustrate both problems by plotting the time required for strings of different lengths.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="k">import</span> <span class="n">simple_grammar_fuzzer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="k">import</span> <span class="n">START_SYMBOL</span><span class="p">,</span> <span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">URL_GRAMMAR</span><span class="p">,</span> <span class="n">CGI_GRAMMAR</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="k">import</span> <span class="n">RE_NONTERMINAL</span><span class="p">,</span> <span class="n">nonterminals</span><span class="p">,</span> <span class="n">is_nonterminal</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Timer.html" class="import" target="_blank">Timer</a></span> <span class="k">import</span> <span class="n">Timer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trials</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">xs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">simple_grammar_fuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">average_time</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span> <span class="o">/</span> <span class="n">trials</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average time:&quot;</span><span class="p">,</span> <span class="n">average_time</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Average time: 0.27485354430013104
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/matplotlib.pyplot.html" class="import" target="_blank">matplotlib.pyplot</a></span> <span class="k">as</span> <span class="nn"><a href="https://docs.python.org/3/library/plt.html" class="import" target="_blank">plt</a></span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Time required for generating an output&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>Text(0.5,1,&#39;Time required for generating an output&#39;)
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXcAAAEICAYAAACktLTqAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADl0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uIDIuMi4zLCBodHRwOi8vbWF0cGxvdGxpYi5vcmcvIxREBQAAGjRJREFUeJzt3X+U3HV97/Hni80Glh8lCKmSJRCsmFYKGtxC/HGUcxUDKCaleEFqQbSleuVUz9XcC2ovuRYKXq6cW4pHikr5IQdUGtNYsSm96KVWQBYSCCFGIoLZTYTwY8OvLWzC+/7x/Uz4ZjKzM7M7uzPzndfjnD078/35+Xy/s6/9zufzme8oIjAzs2LZo9UFMDOz5nO4m5kVkMPdzKyAHO5mZgXkcDczKyCHu5lZATncp5Ckz0v6RqvL0WzNrpekZZK+Nc78T0p6XNLzkg5s1n47kaSrJP1lq8th7U8e5z5xkp7PPd0beAnYkZ7/eUTcOP2l6jySlgFviIiPVJjXCzwLLIyI+6e7bK0k6aPAn0bEO1tdluki6XjgWxFxSDtur5PMaHUBOllE7Ft6LOlRsj/Ef21diXaWZUZEbC/Ivl8L7AWsm0BZRHYB80oTy9MUrTxH1h3cLDOF8s0NkuZJCknnSNok6RlJn5D0B5IekDQi6cqy9T8maX1adpWkw6rsp7Ttj0v6NXB7mr5Q0k/Ttu9PVzGldQ6X9P8kPSfpNklX5sp6vKShsn08Kum949RrwvsGDqpSrzcCG9LTEUmlbb9d0j2StqXfb8+t82NJF0v6d+BF4PUVtnuMpNVp/9+V9G1JF+Xmf0DSmlT2n0o6uuw4fC6ds21p3b0aWPe/S3oAeEHSDEnnS/plKstDkv4wLft7wFXA21Jz1Eiafm2prKXzJOmzkp6QtEXSObn9HSjp+5KeTcfpIkk/qXSs0/LflfSbVK87JB2Zm3etpK9K+kEq692SfmecbX1Q0rp0HH6c6lOaF5LeULbtiyTtA/wQmJPq/LykOen1dks61s9Juk/Smye6vWplLpyI8E8TfoBHgfeWTVtG9pYQYB4QZH+wewHvA/4DWAH8NtAPPAG8Oy2/BNgI/B7ZO6wvAj+tsu/Stq8H9gH60vaeAk4m+yd+Qno+O61zJ3A5sCfwLuC5XFmPB4aq1a9KvZqy73HqNiM9fw3wDPAn6bh8OD0/MM3/MfBr4Mg0v7dsezOBx4BPA73AqcDLwEVp/jHpPBwH9ABnp7rvmTsOPwPmpLKsBz7RwLprgLlAX5r2obStPYDTgReAg9O8jwI/KSv/tbmyHg9sB76U6nIy2T+0A9L8m9PP3sCbgE3l2yvb9seA/dJ5+T/AmrL9Pg0cm47rjcDNVbbzxlSPE1K5/hvZa3lmmh9kzXDV6lT+2lsGjAGnpe19DvhV6dw2ur1u+fGV+/T7q4j4j4j4F7I/gJsi4omIGAb+DViQlvtz4JKIWB/Z2/e/Bt6iKlfvybKIeCEiRoGPALdGxK0R8UpE3AYMAidLOhT4A+AvI+KliLgD+P4k6zVd+34/8HBE3BAR2yPiJuDnwCm5Za6NiHVp/ljZ+gvJwumKiBiLiOVkYV3yZ8DfRcTdEbEjIq4j60tZmFvmiojYHBFPp7K/pcF1N6XjRER8N23rlYj4NvAwWYDWawz4UqrLrcDzwHxJPcAfARdGxIsR8RBw3XgbiohrIuK5iHiJLFDfLGn/3CLLI+Jn6fV4Y67e5U4HfhARt6Xj/7/J/um/vcry9bg3Im5J27uc7AJpYY11uprDffo9nns8WuF5qR3/MOBv0tvaEbKrJpFdFVezKff4MOBDpfXTNt4JHEx2pfhMRLyQW/6xCdVm+vc9p8Lyj7HrcdlEdXOA4UiXdVXK/tmyss9N65X8Jvf4RXY9Z7XW3aVsks7KNeOMAL9PlWaqKp6KXdvuS+WZTfZPLL+/qsdFUo+kS1MT0bNk7zIoK0u1epfb5RxF1uexifFfu7XsLHva3hC7Hlcr4w7V9rUJuDgaG3FTHlg3RMSflS+Urv4PkLRPLmQPza3/Atlb+dLyPWRhMR37rmUzWYjmHQr8c5WylNsC9EtSLuDnAr/Mlf3iiLi4zvLk1bPuzrKlY/F14D3AnRGxQ9Iasn/itepRy1ayJptDgF+kaXPHWf5MYDHwXrJg35+suUvjrFPNZuCo0hNJSvseTpNeJPf6Al5HFtZQvc47yy5pD7J6bZ7E9grPV+7t6yrgglKnlqT9JX2ogfW/BZwiaVG6KtsrdcAdEhGPkTWT/E9JMyW9k12bNX4B7CXp/cqGIn6RrB12OvZdy63AGyWdmTokTydrT/6nOte/k2y46nlp/cXs2gzydeATko5TZp90HParY9uNrrsPWfhsBUidob+fm/84cIikmXXWbaeI2AEsB5ZJ2lvS7wJnjbPKfmRNSE+RBeVfN7rPnO8A75f0nvT6+Wza9k/T/DXAmem1cSLw7ty6jwMHljUHAbxV0qmSZgCfSdu7axLbKzyHe5uKiO8BXwZuTm+THwROamD9TWRXYp8nC49NwFJePednknX8PQ1cSNYhWlp3G/BfgG+QXW29wKtXQlO67zq2/RTwAbLAeIqss+4DEfFkneu/TNaJ+nFghKx/4J/IwoKIGCRrO7+S7Mp1I1nHZj3bbmjd1A7+FbJ/OI+TXe3+e26R28mGgP5GUl31K3Me2RX4b4AbgJtI9azgerKmlGHgIV4NzoZFxAay4/q3wJNk/7xPSccess7sU8iO/x+TDSoorfvzVM5HUlNVqenlH8na8kud6afm+lMmsr3C84eYDBj/g0RFJ+lu4KqI+PtWl2UqSfoy8LqIOLvVZWlEN782J8NX7tZ1JL1b0utSs8zZwNHs2mZfCJJ+V9LRqYnoWLJ3K99rdblserhD1brRfLJ24X3JOlJPi4gtrS3SlNiPrEliDtn4+6+QNW9YF3CzjJlZAblZxsysgFrWLHPQQQfFvHnzWrV7M7OOdO+99z4ZEbU+d9K6cJ83bx6Dg4Ot2r2ZWUeSVNcnut0sY2ZWQA53M7MCcribmRWQw93MrIAc7mZmBeRwNzMrIIe7mVkB+d4yZmbTZMXqYS5btYHNI6PMmdXH0kXzWbJgMl9QVZ3D3cxsGqxYPcwFy9cyOrYDgOGRUS5YvhZgSgLezTJmZtPgslUbdgZ7yejYDi5btWFK9udwNzObBptHRhuaPlkOdzOzaTBnVl9D0yfL4W5mNg2WLppPX2/PLtP6entYumj+lOyvZrhLmivpR5LWS1on6dMVlpGkKyRtlPSApGOmpLRmZh1qyYJ+Ljn1KPpn9SGgf1Yfl5x6VEtHy2wHPhsR90naD7hX0m3pm9tLTgKOSD/HAV9Lv83MLFmyoH/KwrxczSv3iNgSEfelx88B64Hy0i0Gro/MXcAsSQc3vbRmZlaXhtrcJc0DFgB3l83qBzblng+x+z8AJJ0raVDS4NatWxsrqZmZ1a3ucJe0L/APwGci4tny2RVW2e2btyPi6ogYiIiB2bNrfkuUmZlNUF3hLqmXLNhvjIjlFRYZAubmnh8CbJ588czMbCLqGS0j4JvA+oi4vMpiK4Gz0qiZhcC2iNjSxHKamVkD6hkt8w7gT4C1ktakaZ8HDgWIiKuAW4GTgY3Ai8A5zS+qmZnVq2a4R8RPqNymnl8mgE81q1BmZjY5/oSqmVkBOdzNzArI4W5mVkAOdzOzAnK4m5kVkMPdzKyAHO5mZgXkcDczKyCHu5lZATnczcwKyOFuZlZADnczswJyuJuZFZDD3cysgBzuZmYF5HA3Mysgh7uZWQE53M3MCsjhbmZWQA53M7MCcribmRWQw93MrIAc7mZmBeRwNzMrIIe7mVkBOdzNzArI4W5mVkAOdzOzAnK4m5kVkMPdzKyAHO5mZgXkcDczKyCHu5lZATnczcwKyOFuZlZADnczswJyuJuZFZDD3cysgGqGu6RrJD0h6cEq84+XtE3SmvTzP5pfTDMza8SMOpa5FrgSuH6cZf4tIj7QlBKZmdmk1bxyj4g7gKenoSxmZtYkzWpzf5uk+yX9UNKR1RaSdK6kQUmDW7dubdKuzcysXDPC/T7gsIh4M/C3wIpqC0bE1RExEBEDs2fPbsKuzcyskkmHe0Q8GxHPp8e3Ar2SDpp0yczMbMImHe6SXidJ6fGxaZtPTXa7ZmY2cTVHy0i6CTgeOEjSEHAh0AsQEVcBpwGflLQdGAXOiIiYshKbmVlNNcM9Ij5cY/6VZEMlzcysTfgTqmZmBeRwNzMroHo+oWpmVtWK1cNctmoDm0dGmTOrj6WL5rNkQX+ri9X1HO5mNmErVg9zwfK1jI7tAGB4ZJQLlq8FcMC3mJtlzGzCLlu1YWewl4yO7eCyVRtaVCIrcbib2YRtHhltaLpNH4e7mU3YnFl9DU236eNwN7MJW7poPn29PbtM6+vtYemi+S0qkZW4Q9XMJqzUaerRMu3H4W5mk7JkQb/DvA053M1sXB7H3pkc7mZWlcexdy53qJpZVR7H3rkc7mZWlcexdy6Hu5lV5XHsncvhbmZVeRx753KHqplV5XHsncvhbmbj8jj2zuRmGTOzAvKVu1kX8geTis/hbtZl/MGk7uBmGbMu4w8mdQeHu1mX8QeTuoPD3azL+INJ3cHhbtZl/MGk7uAOVbMu4w8mdQeHu1kX8geTis/NMmZmBeRwNzMrIIe7mVkBOdzNzArI4W5mVkAOdzOzAnK4m5kVkMPdzKyAHO5mZgXkcDczKyCHu5lZAdUMd0nXSHpC0oNV5kvSFZI2SnpA0jHNL6aZmTWiniv3a4ETx5l/EnBE+jkX+Nrki2VmZpNRM9wj4g7g6XEWWQxcH5m7gFmSDm5WAc3MrHHNaHPvBzblng+labuRdK6kQUmDW7dubcKuzcyskmbcz10VpkWlBSPiauBqgIGBgYrLmHWzFauH/SUa1hTNCPchYG7u+SHA5iZs16yrrFg9zAXL1zI6tgOA4ZFRLli+FsABbw1rRrPMSuCsNGpmIbAtIrY0YbtmXeWyVRt2BnvJ6NgOLlu1oUUlsk5W88pd0k3A8cBBkoaAC4FegIi4CrgVOBnYCLwInDNVhTUrss0jow1NNxtPzXCPiA/XmB/Ap5pWIrMuNWdWH8MVgnzOrL4WlMY6nT+hatYmli6aT19vzy7T+np7WLpofotKZJ2sGR2qZtYEpU5Tj5axZnC4m7WRJQv6HebWFG6WMTMrIIe7mVkBOdzNzArIbe5mTeDbBli7cbibTZJvG2DtyM0yZpPk2wZYO3K4m02Sbxtg7cjhbjZJ1W4P4NsGWCs53M0mybcNsHbkDlWzBow3KsajZaydONzN6lRrVIzD3NqJm2XM6uRRMdZJHO5mdfKoGOskDnezOnlUjHUSh7tZnTwqxjqJO1TN6uRRMdZJHO5mDfCoGOsUbpYxMysgh7uZWQE53M3MCsjhbmZWQA53M7MCcribmRWQw93MrIAc7mZmBeRwNzMrIIe7mVkBOdzNzArI4W5mVkC+cZi1rfG+r9TMxudwt7ZU6/tKzWx8bpaxtuTvKzWbHIe7tSV/X6nZ5DjcrS35+0rNJsfhbm3J31dqNjl1hbukEyVtkLRR0vkV5n9U0lZJa9LPnza/qNZNlizo55JTj6J/Vh8C+mf1ccmpR7kz1axONUfLSOoBvgqcAAwB90haGREPlS367Yg4bwrKaF3K31dqNnH1DIU8FtgYEY8ASLoZWAyUh7tZXTx+3Wzq1dMs0w9syj0fStPK/ZGkByTdImlupQ1JOlfSoKTBrVu3TqC41ulK49eHR0YJXh2/vmL1cKuLZlYo9YS7KkyLsuffB+ZFxNHAvwLXVdpQRFwdEQMRMTB79uzGSmqF4PHrZtOjnnAfAvJX4ocAm/MLRMRTEfFSevp14K3NKZ4Vjcevm02PesL9HuAISYdLmgmcAazMLyDp4NzTDwLrm1dEKxKPXzebHjXDPSK2A+cBq8hC+zsRsU7SlyR9MC32F5LWSbof+Avgo1NVYOtsHr9uNj0UUd58Pj0GBgZicHCwJfu2iWnWKBePljGbOEn3RsRAreV8V0irSzPv0ujx62ZTz7cfsLp4lItZZ3G4W108ysWsszjcrS4e5WLWWRzuxorVw7zj0ts5/Pwf8I5Lb6/4aVGPcjHrLO5Q7XL1dpSWHnuUi1lncLh3uWodpctWrtstuD3KxaxzuFmmy1XrEB0ZHfPNvMw6mMO9y43XIephjmady+He5cbrEPUwR7PO5XDvcksW9HPA3r0V53mYo1nncodqh8vfp2XW3r1EwLbRsYZGs1x4ypG7jJgBD3M063QO9w5WPozxmRfHds5r5N4vHuZoVjwO9w5WaRhjXuneL/WEtIc5mhWL29w7WD0dnu4UNetODvcOtn9f5Y7QPHeKmnUnN8t0mFIH6nAdV+TuFDXrXg73DvLFFWu58a5fM953Z0lA4E5Rsy7ncG9j+WGO+/f1MjI6VnulgF9d+v6pL5yZtTWHe5sqH+ZYV7DjNnYzy7hDtU3VGuZYidvYzazEV+7TJN/EUk97eKNDGPvdxm5mOQ73aVDvF2LkzZnVV3NEjIA/XngoFy05qqnlNbPO53CfIvkr9T0kdsSuY1xGx3bwX7+zBqgc8EsXzd/tfi+9e4h995rByIuN3TvGzLqPw30KlF+plwd7ySsBS2+5H9g94H2/FzObDIf7FGikM3RsR1S9/4vv92JmE+XRMlOg0c5Q3//FzJrN4T4FGh1r7rHpZtZsDvcpsHTRfPp6e3aZ1tujige7t0cem25mTec29xom8k1H1TpDAZatXLfz06YH7N3Lhacc6XZ1M2s6RZWRHFNtYGAgBgcHW7LvepWPeinX19vDJace5XA2s2kj6d6IGKi1nK/cy6xYPbzL1fV4GvmmIzOz6eRwp7F7pJfzSBcza0ddH+61ml5q8UgXM2tHXT9aZiJ3XyzxXRjNrF0V/so93+TSk+7xkr+DYiPNKnsIfmuv3pqjZczMWq2Q4Z4P9PStc8Cr93jJ35Wxnrsvllz+n9/iMDezjlCIcC//OroXXt7O2I4syKsN9CyNdKl098VKPrLwUAe7mXWMusJd0onA3wA9wDci4tKy+XsC1wNvBZ4CTo+IR5tb1EytoYr1fh0dZCNdyj9wtH9fL2M7XuGFl7Own9XXy7IP+oNGZtZZaoa7pB7gq8AJwBBwj6SVEfFQbrGPA89ExBsknQF8GTi92YU9+sJ/5tmXJtb5WUlppIvvvmhmRVPPaJljgY0R8UhEvAzcDCwuW2YxcF16fAvwHklqXjHhuItva2qwe6SLmRVZPeHeD2zKPR9K0youExHbgW3Agc0oYMnjz7084XVL/2V60v+b/ll9vm2AmRVaPW3ula7Ay/sp61kGSecC5wIceuihdex6Yvx1dGbW7eoJ9yFgbu75IcDmKssMSZoB7A88Xb6hiLgauBqyG4dNpMC1uAPUzKy+cL8HOELS4cAwcAZwZtkyK4GzgTuB04Dbo8m3m3ztfjPHbZpxqJuZvapmuEfEdknnAavIhkJeExHrJH0JGIyIlcA3gRskbSS7Yj+j2QW9+wsncNzFt+0W8Hv1iJ9ffHKzd2dm1tF8P3czsw5S7/3cu/7GYWZmReRwNzMrIIe7mVkBOdzNzArI4W5mVkAOdzOzAmrZUEhJW4HHJrj6QcCTTSxOJ+i2OndbfaH76uz6TsxhETG71kItC/fJkDRYzzjPIum2OndbfaH76uz6Ti03y5iZFZDD3cysgDo13K9udQFaoNvq3G31he6rs+s7hTqyzd3MzMbXqVfuZmY2Doe7mVkBdVy4SzpR0gZJGyWd3+ryTIakRyWtlbRG0mCa9hpJt0l6OP0+IE2XpCtSvR+QdExuO2en5R+WdHar6lOJpGskPSHpwdy0ptVR0lvTMdyY1m3qF7M3qkp9l0kaTud5jaSTc/MuSGXfIGlRbnrF17mkwyXdnY7DtyXNnL7a7U7SXEk/krRe0jpJn07TC3mOx6lv+53jiOiYH7IvC/kl8HpgJnA/8KZWl2sS9XkUOKhs2v8Czk+Pzwe+nB6fDPyQ7PtqFwJ3p+mvAR5Jvw9Ijw9odd1y9XkXcAzw4FTUEfgZ8La0zg+Bk9qwvsuAz1VY9k3pNbwncHh6bfeM9zoHvgOckR5fBXyyxfU9GDgmPd4P+EWqVyHP8Tj1bbtz3GlX7scCGyPikYh4GbgZWNziMjXbYuC69Pg6YElu+vWRuQuYJelgYBFwW0Q8HRHPALcBJ053oauJiDvY/ft0m1LHNO+3IuLOyP4Srs9tqyWq1LeaxcDNEfFSRPwK2Ej2Gq/4Ok9XrP8JuCWtnz92LRERWyLivvT4OWA90E9Bz/E49a2mZee408K9H9iUez7E+Ae23QXwL5LulXRumvbaiNgC2QsJ+O00vVrdO/GYNKuO/elx+fR2dF5qhrim1ERB4/U9EBiJiO1l09uCpHnAAuBuuuAcl9UX2uwcd1q4V2pr6+SxnO+IiGOAk4BPSXrXOMtWq3uRjkmjdeyUun8N+B3gLcAW4CtpemHqK2lf4B+Az0TEs+MtWmFax9W5Qn3b7hx3WrgPAXNzzw8BNreoLJMWEZvT7yeA75G9VXs8vRUl/X4iLV6t7p14TJpVx6H0uHx6W4mIxyNiR0S8Anyd7DxD4/V9kqwZY0bZ9JaS1EsWdDdGxPI0ubDnuFJ92/Ecd1q43wMckXqTZwJnACtbXKYJkbSPpP1Kj4H3AQ+S1ac0UuBs4B/T45XAWWm0wUJgW3q7uwp4n6QD0lvB96Vp7awpdUzznpO0MLVVnpXbVtsohVzyh2TnGbL6niFpT0mHA0eQdR5WfJ2nNucfAael9fPHriXScf8msD4iLs/NKuQ5rlbftjzHrep1nugPWW/7L8h6mr/Q6vJMoh6vJ+shvx9YV6oLWZvb/wUeTr9fk6YL+Gqq91pgILetj5F11GwEzml13crqeRPZ29QxsquVjzezjsBA+kP6JXAl6VPXbVbfG1J9HiD7Yz84t/wXUtk3kBsFUu11nl43P0vH4bvAni2u7zvJmg0eANakn5OLeo7HqW/bnWPffsDMrIA6rVnGzMzq4HA3Mysgh7uZWQE53M3MCsjhbmZWQA53M7MCcribmRXQ/wdT7alFS3PbqAAAAABJRU5ErkJggg==
"
>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that (1) the effort increases quadratically over time, and (2) we can easily produce outputs that are tens of thousands of characters long.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To address these problem, we need a <em>smarter algorithm</em> – one that is more efficient, that gets us better control over expansions, and that is able to foresee in <code>expr_grammar</code> that the <code>(expr)</code> alternative yields a potentially infinite expansion, in contrast to the other two.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Derivation-Trees">Derivation Trees<a class="anchor-link" href="#Derivation-Trees">&#182;</a></h2><p>To both obtain a more efficient algorithm <em>and</em> exercise better control over expansions, we will use a special representation for the strings that our grammar produces.  The general idea is to use a <em>tree</em> structure that will be subsequently expanded – a so-called <em>derivation tree</em>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Like other trees used in programming, a derivation tree consists of <em>nodes</em> which have other nodes as their <em>children</em>.  The tree starts with one node that has no parent; this is called the <em>root node</em>; a node without children is called a <em>leaf</em>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The grammar expansion process with derivation trees is illustrated in the following steps, using the arithmetic grammar <a href="Grammars.html">from
the chapter on grammars</a>.  We start with a single node as root of the tree, representing the <em>start symbol</em> – in our case <code>&lt;start&gt;</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tree</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: root Pages: 1 -->
<svg width="48pt" height="23pt"
 viewBox="0.00 0.00 48.00 23.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 19)">
<title>root</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-19 44,-19 44,4 -4,4"/>
<!-- \&lt;start\&gt; -->
<g id="node1" class="node">
<title>\&lt;start\&gt;</title>
<text text-anchor="middle" x="20" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To expand the tree, we traverse it, searching for a symbol $S$ without children to expand, and chose an expansion for $S$ from the grammar.  Then, we add the expansion as a new child of $S$.  In the case of our start symbol <code>&lt;start&gt;</code>, its only expansion is <code>&lt;expr&gt;</code>, so we add this as a child.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tree</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: root Pages: 1 -->
<svg width="49pt" height="74pt"
 viewBox="0.00 0.00 49.00 74.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 70)">
<title>root</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-70 45,-70 45,4 -4,4"/>
<!-- \&lt;start\&gt; -->
<g id="node1" class="node">
<title>\&lt;start\&gt;</title>
<text text-anchor="middle" x="20.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- \&lt;expr\&gt; -->
<g id="node2" class="node">
<title>\&lt;expr\&gt;</title>
<text text-anchor="middle" x="20.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- \&lt;start\&gt;&#45;&gt;\&lt;expr\&gt; -->
<g id="edge1" class="edge">
<title>\&lt;start\&gt;&#45;&gt;\&lt;expr\&gt;</title>
<path fill="none" stroke="#000000" d="M20.5,-50.9748C20.5,-44.195 20.5,-33.966 20.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="24.0001,-25.0561 20.5,-15.0561 17.0001,-25.0561 24.0001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To construct the produced string from a derivation tree, we traverse the tree in order and collect the symbols at the leaves of the tree.  In the case above, we obtain the string <code>"&lt;expr&gt;"</code>.</p>
<p>To further expand the tree, we choose another symbol to expand, and add its expansion as new children.  This would get us the <code>&lt;expr&gt;</code> symbol, which gets expanded into <code>&lt;expr&gt; + &lt;term&gt;</code>, adding three children.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tree</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: root Pages: 1 -->
<svg width="140pt" height="125pt"
 viewBox="0.00 0.00 139.50 125.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 121)">
<title>root</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-121 135.5,-121 135.5,4 -4,4"/>
<!-- \&lt;start\&gt; -->
<g id="node1" class="node">
<title>\&lt;start\&gt;</title>
<text text-anchor="middle" x="67.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- \&lt;expr\&gt; -->
<g id="node2" class="node">
<title>\&lt;expr\&gt;</title>
<text text-anchor="middle" x="67.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- \&lt;start\&gt;&#45;&gt;\&lt;expr\&gt; -->
<g id="edge1" class="edge">
<title>\&lt;start\&gt;&#45;&gt;\&lt;expr\&gt;</title>
<path fill="none" stroke="#000000" d="M67.5,-101.9748C67.5,-95.195 67.5,-84.966 67.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="71.0001,-76.0561 67.5,-66.0561 64.0001,-76.0561 71.0001,-76.0561"/>
</g>
<!-- \&lt;expr\&gt;  -->
<g id="node3" class="node">
<title>\&lt;expr\&gt; </title>
<text text-anchor="middle" x="22.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt; </text>
</g>
<!-- \&lt;expr\&gt;&#45;&gt;\&lt;expr\&gt;  -->
<g id="edge2" class="edge">
<title>\&lt;expr\&gt;&#45;&gt;\&lt;expr\&gt; </title>
<path fill="none" stroke="#000000" d="M60.8601,-50.9748C54.3462,-43.5923 44.2238,-32.1203 36.0125,-22.8142"/>
<polygon fill="#000000" stroke="#000000" points="38.4078,-20.2388 29.1671,-15.0561 33.159,-24.8702 38.4078,-20.2388"/>
</g>
<!-- + -->
<g id="node4" class="node">
<title>+</title>
<text text-anchor="middle" x="67.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- \&lt;expr\&gt;&#45;&gt;+ -->
<g id="edge3" class="edge">
<title>\&lt;expr\&gt;&#45;&gt;+</title>
<path fill="none" stroke="#000000" d="M67.5,-50.9748C67.5,-44.195 67.5,-33.966 67.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="71.0001,-25.0561 67.5,-15.0561 64.0001,-25.0561 71.0001,-25.0561"/>
</g>
<!-- \&lt;term\&gt; -->
<g id="node5" class="node">
<title>\&lt;term\&gt;</title>
<text text-anchor="middle" x="110.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- \&lt;expr\&gt;&#45;&gt;\&lt;term\&gt; -->
<g id="edge4" class="edge">
<title>\&lt;expr\&gt;&#45;&gt;\&lt;term\&gt;</title>
<path fill="none" stroke="#000000" d="M73.8448,-50.9748C80.0692,-43.5923 89.7417,-32.1203 97.5881,-22.8142"/>
<polygon fill="#000000" stroke="#000000" points="100.359,-24.9574 104.1292,-15.0561 95.0073,-20.4452 100.359,-24.9574"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We repeat the expansion until there are no symbols left to expand:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tree</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea output_execute_result">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: root Pages: 1 -->
<svg width="153pt" height="380pt"
 viewBox="0.00 0.00 153.00 380.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 376)">
<title>root</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-376 149,-376 149,4 -4,4"/>
<!-- \&lt;start\&gt; -->
<g id="node1" class="node">
<title>\&lt;start\&gt;</title>
<text text-anchor="middle" x="74.5" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- \&lt;expr\&gt; -->
<g id="node2" class="node">
<title>\&lt;expr\&gt;</title>
<text text-anchor="middle" x="74.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- \&lt;start\&gt;&#45;&gt;\&lt;expr\&gt; -->
<g id="edge1" class="edge">
<title>\&lt;start\&gt;&#45;&gt;\&lt;expr\&gt;</title>
<path fill="none" stroke="#000000" d="M74.5,-356.9748C74.5,-350.195 74.5,-339.966 74.5,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="78.0001,-331.0561 74.5,-321.0561 71.0001,-331.0561 78.0001,-331.0561"/>
</g>
<!-- \&lt;expr\&gt;  -->
<g id="node3" class="node">
<title>\&lt;expr\&gt; </title>
<text text-anchor="middle" x="29.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt; </text>
</g>
<!-- \&lt;expr\&gt;&#45;&gt;\&lt;expr\&gt;  -->
<g id="edge2" class="edge">
<title>\&lt;expr\&gt;&#45;&gt;\&lt;expr\&gt; </title>
<path fill="none" stroke="#000000" d="M67.8601,-305.9748C61.3462,-298.5923 51.2238,-287.1203 43.0125,-277.8142"/>
<polygon fill="#000000" stroke="#000000" points="45.4078,-275.2388 36.1671,-270.0561 40.159,-279.8702 45.4078,-275.2388"/>
</g>
<!-- + -->
<g id="node4" class="node">
<title>+</title>
<text text-anchor="middle" x="74.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- \&lt;expr\&gt;&#45;&gt;+ -->
<g id="edge3" class="edge">
<title>\&lt;expr\&gt;&#45;&gt;+</title>
<path fill="none" stroke="#000000" d="M74.5,-305.9748C74.5,-299.195 74.5,-288.966 74.5,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="78.0001,-280.0561 74.5,-270.0561 71.0001,-280.0561 78.0001,-280.0561"/>
</g>
<!-- \&lt;term\&gt; -->
<g id="node5" class="node">
<title>\&lt;term\&gt;</title>
<text text-anchor="middle" x="117.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- \&lt;expr\&gt;&#45;&gt;\&lt;term\&gt; -->
<g id="edge4" class="edge">
<title>\&lt;expr\&gt;&#45;&gt;\&lt;term\&gt;</title>
<path fill="none" stroke="#000000" d="M80.8448,-305.9748C87.0692,-298.5923 96.7417,-287.1203 104.5881,-277.8142"/>
<polygon fill="#000000" stroke="#000000" points="107.359,-279.9574 111.1292,-270.0561 102.0073,-275.4452 107.359,-279.9574"/>
</g>
<!-- \&lt;term\&gt;  -->
<g id="node6" class="node">
<title>\&lt;term\&gt; </title>
<text text-anchor="middle" x="29.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt; </text>
</g>
<!-- \&lt;expr\&gt; &#45;&gt;\&lt;term\&gt;  -->
<g id="edge5" class="edge">
<title>\&lt;expr\&gt; &#45;&gt;\&lt;term\&gt; </title>
<path fill="none" stroke="#000000" d="M29.5,-254.9748C29.5,-248.195 29.5,-237.966 29.5,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="33.0001,-229.0561 29.5,-219.0561 26.0001,-229.0561 33.0001,-229.0561"/>
</g>
<!-- \&lt;factor\&gt; -->
<g id="node11" class="node">
<title>\&lt;factor\&gt;</title>
<text text-anchor="middle" x="117.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- \&lt;term\&gt;&#45;&gt;\&lt;factor\&gt; -->
<g id="edge10" class="edge">
<title>\&lt;term\&gt;&#45;&gt;\&lt;factor\&gt;</title>
<path fill="none" stroke="#000000" d="M117.5,-254.9748C117.5,-248.195 117.5,-237.966 117.5,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="121.0001,-229.0561 117.5,-219.0561 114.0001,-229.0561 121.0001,-229.0561"/>
</g>
<!-- \&lt;factor\&gt;  -->
<g id="node7" class="node">
<title>\&lt;factor\&gt; </title>
<text text-anchor="middle" x="29.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt; </text>
</g>
<!-- \&lt;term\&gt; &#45;&gt;\&lt;factor\&gt;  -->
<g id="edge6" class="edge">
<title>\&lt;term\&gt; &#45;&gt;\&lt;factor\&gt; </title>
<path fill="none" stroke="#000000" d="M29.5,-203.9748C29.5,-197.195 29.5,-186.966 29.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="33.0001,-178.0561 29.5,-168.0561 26.0001,-178.0561 33.0001,-178.0561"/>
</g>
<!-- \&lt;integer\&gt;  -->
<g id="node8" class="node">
<title>\&lt;integer\&gt; </title>
<text text-anchor="middle" x="29.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt; </text>
</g>
<!-- \&lt;factor\&gt; &#45;&gt;\&lt;integer\&gt;  -->
<g id="edge7" class="edge">
<title>\&lt;factor\&gt; &#45;&gt;\&lt;integer\&gt; </title>
<path fill="none" stroke="#000000" d="M29.5,-152.9748C29.5,-146.195 29.5,-135.966 29.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="33.0001,-127.0561 29.5,-117.0561 26.0001,-127.0561 33.0001,-127.0561"/>
</g>
<!-- \&lt;digit\&gt;  -->
<g id="node9" class="node">
<title>\&lt;digit\&gt; </title>
<text text-anchor="middle" x="29.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt; </text>
</g>
<!-- \&lt;integer\&gt; &#45;&gt;\&lt;digit\&gt;  -->
<g id="edge8" class="edge">
<title>\&lt;integer\&gt; &#45;&gt;\&lt;digit\&gt; </title>
<path fill="none" stroke="#000000" d="M29.5,-101.9748C29.5,-95.195 29.5,-84.966 29.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="33.0001,-76.0561 29.5,-66.0561 26.0001,-76.0561 33.0001,-76.0561"/>
</g>
<!-- 2  -->
<g id="node10" class="node">
<title>2 </title>
<text text-anchor="middle" x="29.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">2 </text>
</g>
<!-- \&lt;digit\&gt; &#45;&gt;2  -->
<g id="edge9" class="edge">
<title>\&lt;digit\&gt; &#45;&gt;2 </title>
<path fill="none" stroke="#000000" d="M29.5,-50.9748C29.5,-44.195 29.5,-33.966 29.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="33.0001,-25.0561 29.5,-15.0561 26.0001,-25.0561 33.0001,-25.0561"/>
</g>
<!-- \&lt;integer\&gt; -->
<g id="node12" class="node">
<title>\&lt;integer\&gt;</title>
<text text-anchor="middle" x="117.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- \&lt;factor\&gt;&#45;&gt;\&lt;integer\&gt; -->
<g id="edge11" class="edge">
<title>\&lt;factor\&gt;&#45;&gt;\&lt;integer\&gt;</title>
<path fill="none" stroke="#000000" d="M117.5,-203.9748C117.5,-197.195 117.5,-186.966 117.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="121.0001,-178.0561 117.5,-168.0561 114.0001,-178.0561 121.0001,-178.0561"/>
</g>
<!-- \&lt;digit\&gt; -->
<g id="node13" class="node">
<title>\&lt;digit\&gt;</title>
<text text-anchor="middle" x="117.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- \&lt;integer\&gt;&#45;&gt;\&lt;digit\&gt; -->
<g id="edge12" class="edge">
<title>\&lt;integer\&gt;&#45;&gt;\&lt;digit\&gt;</title>
<path fill="none" stroke="#000000" d="M117.5,-152.9748C117.5,-146.195 117.5,-135.966 117.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="121.0001,-127.0561 117.5,-117.0561 114.0001,-127.0561 121.0001,-127.0561"/>
</g>
<!-- 2 -->
<g id="node14" class="node">
<title>2</title>
<text text-anchor="middle" x="117.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- \&lt;digit\&gt;&#45;&gt;2 -->
<g id="edge13" class="edge">
<title>\&lt;digit\&gt;&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M117.5,-101.9748C117.5,-95.195 117.5,-84.966 117.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="121.0001,-76.0561 117.5,-66.0561 114.0001,-76.0561 121.0001,-76.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We now have a representation for the string <code>2 + 2</code>.  In contrast to the string alone, though, the derivation tree records <em>the entire structure</em> (and production history, or <em>derivation</em> history) of the produced string.  It also allows for simple comparison and manipulation – say, replacing one subtree (substructure) against another.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Representing-Derivation-Trees">Representing Derivation Trees<a class="anchor-link" href="#Representing-Derivation-Trees">&#182;</a></h2><p>To represent a derivation tree in Python, we use the following format.  A node is a pair</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">SYMBOL_NAME</span><span class="p">,</span> <span class="n">CHILDREN</span><span class="p">)</span>
</pre></div>
<p>where <code>SYMBOL_NAME</code> is a string representing the node (i.e. <code>"&lt;start&gt;"</code> or <code>"+"</code>) and <code>CHILDREN</code> is a list of children nodes.</p>
<p><code>CHILDREN</code> can take some special values:</p>
<ol>
<li><code>None</code> as a placeholder for future expansion.  This means that the node is a <em>nonterminal symbol</em> that should be expanded further.</li>
<li><code>[]</code> (i.e., the empty list) to indicate <em>no</em> children.  This means that the node is a <em>terminal symbol</em> that can no longer be expanded.</li>
</ol>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us take a very simple derivation tree, representing the intermediate step <code>&lt;expr&gt; + &lt;term&gt;</code>, above.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">derivation_tree</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">,</span>
                   <span class="p">[(</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">,</span>
                     <span class="p">[(</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                      <span class="p">(</span><span class="s2">&quot; + &quot;</span><span class="p">,</span> <span class="p">[]),</span>
                         <span class="p">(</span><span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
                     <span class="p">)])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To better understand the structure of this tree, let us introduce a function that visualizes this tree.  We use the <code>dot</code> drawing program from the <code>graphviz</code> package algorithmically, traversing the above structure.  (Unless you're deeply interested in tree visualization, you can directly skip to the example below.)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="IPython.display.html" class="import" target="_blank">IPython.display</a></span> <span class="k">import</span> <span class="n">display</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/re.html" class="import" target="_blank">re</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">dot_escape</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return s in a form suitable for dot&quot;&quot;&quot;</span>
    <span class="c1"># s = s.replace(&quot;\\&quot;, &quot;\\\\&quot;)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([^a-zA-Z0-9&quot; ])&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">\1&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">dot_escape</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;hello&quot;</span>
<span class="k">assert</span> <span class="n">dot_escape</span><span class="p">(</span><span class="s2">&quot;&lt;hello&gt;, world&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&lt;hello</span><span class="se">\\</span><span class="s2">&gt;</span><span class="se">\\</span><span class="s2">, world&quot;</span>
<span class="k">assert</span> <span class="n">dot_escape</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">n&quot;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Visualize a derivation tree as SVG using the graphviz/dot package.&quot;&quot;&quot;</span>

    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">traverse_tree</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="n">dot</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="n">dot_escape</span><span class="p">(</span><span class="n">symbol</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                <span class="k">nonlocal</span> <span class="n">counter</span>  <span class="c1"># Assign each node a unique identifier</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">child_id</span> <span class="o">=</span> <span class="n">counter</span>
                <span class="n">dot</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">child_id</span><span class="p">))</span>
                <span class="n">traverse_tree</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">child_id</span><span class="p">)</span>

    <span class="n">dot</span> <span class="o">=</span> <span class="n">Digraph</span><span class="p">(</span><span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Derivation Tree&quot;</span><span class="p">)</span>
    <span class="n">dot</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">)</span>
    <span class="n">traverse_tree</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="n">derivation_tree</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">dot</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">dot</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is what our tree visualizes into:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="143pt" height="125pt"
 viewBox="0.00 0.00 142.50 125.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 121)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-121 138.5,-121 138.5,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="66.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="66.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M66.5,-101.9748C66.5,-95.195 66.5,-84.966 66.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="70.0001,-76.0561 66.5,-66.0561 63.0001,-76.0561 70.0001,-76.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="20.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M59.7125,-50.9748C52.9859,-43.517 42.495,-31.8857 34.0564,-22.53"/>
<polygon fill="#000000" stroke="#000000" points="36.612,-20.1376 27.3153,-15.0561 31.414,-24.826 36.612,-20.1376"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="66.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 1&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>1&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M66.5,-50.9748C66.5,-44.195 66.5,-33.966 66.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="70.0001,-25.0561 66.5,-15.0561 63.0001,-25.0561 70.0001,-25.0561"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="113.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>1&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M73.435,-50.9748C80.3079,-43.517 91.0269,-31.8857 99.6488,-22.53"/>
<polygon fill="#000000" stroke="#000000" points="102.3334,-24.7816 106.5365,-15.0561 97.1859,-20.0378 102.3334,-24.7816"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To turn the tree into a string, the following <code>all_terminals()</code> function comes in handy:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">tree</span>
    <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># This is a nonterminal symbol not expanded yet</span>
        <span class="k">return</span> <span class="n">symbol</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># This is a terminal symbol</span>
        <span class="k">return</span> <span class="n">symbol</span>

    <span class="c1"># This is an expanded symbol:</span>
    <span class="c1"># Concatenate all terminal symbols from all children</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_terminals</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;&lt;expr&gt; + &lt;term&gt;&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Expanding-a-Node">Expanding a Node<a class="anchor-link" href="#Expanding-a-Node">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us now develop an algorithm that takes a tree with unexpanded symbols (say, <code>derivation_tree</code>, above), and expands all these symbols one after the other.  As with earlier fuzzers, we create a special subclass of <code>Fuzzer</code> – in this case, <code>GrammarFuzzer</code>.  A <code>GrammarFuzzer</code> gets a grammar and a start symbol; the other parameters will be used later to further control creation and to support debugging.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Fuzzer.html" class="import" target="_blank">Fuzzer</a></span> <span class="k">import</span> <span class="n">Fuzzer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">Fuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grammar</span><span class="p">,</span> <span class="n">start_symbol</span><span class="o">=</span><span class="n">START_SYMBOL</span><span class="p">,</span>
                 <span class="n">min_nonterminals</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span> <span class="o">=</span> <span class="n">grammar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_symbol</span> <span class="o">=</span> <span class="n">start_symbol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_nonterminals</span> <span class="o">=</span> <span class="n">min_nonterminals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_nonterminals</span> <span class="o">=</span> <span class="n">max_nonterminals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp</span> <span class="o">=</span> <span class="n">disp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the following, we will add further methods to <code>GrammarFuzzer</code>, using the hack already introduced for <a href="MutationFuzzer.html">the <code>MutationFuzzer</code> class</a>.  The construct</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">new_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
<p>allows us to add a new method <code>new_method()</code> to the <code>GrammarFuzzer</code> class. (Actually, we get a new <code>GrammarFuzzer</code> class that extends the old one, but for all our purposes, this does not matter.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Using this hack, let us define a helper method <code>init_tree()</code> that constructs a tree with just the start symbol:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">init_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_symbol</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">init_tree</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="48pt" height="23pt"
 viewBox="0.00 0.00 48.00 23.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 19)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-19 44,-19 44,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="20" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Next, we will need a helper function <code>expansion_to_children()</code> that takes an expansion string and converts it into a list of derivation trees.  It uses the <code>re.split()</code> method to split an expansion string into a list of children nodes:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">expansion_to_children</span><span class="p">(</span><span class="n">expansion</span><span class="p">):</span>
    <span class="c1"># print(&quot;Converting &quot; + repr(expansion))</span>
    <span class="c1"># strings contains all substrings -- both terminals and non-terminals such</span>
    <span class="c1"># that &#39;&#39;.join(strings) == expansion</span>

    <span class="c1"># See nonterminals() in Grammars.py</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">expansion</span> <span class="o">=</span> <span class="n">expansion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">expansion</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>  <span class="c1"># Special case: empty expansion</span>
        <span class="k">return</span> <span class="p">[(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[])]</span>

    <span class="n">strings</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">RE_NONTERMINAL</span><span class="p">,</span> <span class="n">expansion</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_nonterminal</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expansion_to_children</span><span class="p">(</span><span class="s2">&quot;&lt;term&gt; + &lt;expr&gt;&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;&lt;term&gt;&#39;, None), (&#39; + &#39;, []), (&#39;&lt;expr&gt;&#39;, None)]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The case of an empty expansion needs special treatment:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expansion_to_children</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;&#39;, [])]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Just like <code>nonterminals()</code> in the <a href="Grammars.html">chapter on Grammars</a>, we provide for future extensions, allowing the expansion to be a tuple with extra data (which will be ignored).</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expansion_to_children</span><span class="p">((</span><span class="s2">&quot;+&lt;term&gt;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;extra_data&quot;</span><span class="p">]))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;+&#39;, []), (&#39;&lt;term&gt;&#39;, None)]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We realize this helper as a method in <code>GrammarFuzzer</code> such that it can be overloaded by subclasses:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expansion_to_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expansion</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">expansion_to_children</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With this, we can now take some unexpanded node in the tree, choose a random expansion, and return the new tree.  This is what the method <code>expand_node_randomly()</code> does, using a helper function <code>choose_node_expansion()</code> to randomly pick an index from an array of possible children.  (<code>choose_node_expansion()</code> can be overloaded in subclasses.)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/random.html" class="import" target="_blank">random</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">choose_node_expansion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">possible_children</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return index of expansion in `possible_children` to be selected.  Defaults to random.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">possible_children</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">expand_node_randomly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
        <span class="k">assert</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Expanding&quot;</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="s2">&quot;randomly&quot;</span><span class="p">)</span>

        <span class="c1"># Fetch the possible expansions from grammar...</span>
        <span class="n">expansions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
        <span class="n">possible_children</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion_to_children</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span> <span class="k">for</span> <span class="n">expansion</span> <span class="ow">in</span> <span class="n">expansions</span><span class="p">]</span>

        <span class="c1"># ... and select a random expansion</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">choose_node_expansion</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">possible_children</span><span class="p">)</span>
        <span class="n">children</span> <span class="o">=</span> <span class="n">possible_children</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="c1"># Return with new children</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The generic <code>expand_node()</code> method can later be used to select different expansion strategies; as of now, it only uses <code>expand_node_randomly()</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expand_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_randomly</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is how <code>expand_node_randomly()</code> works:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before:&quot;</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After:&quot;</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_node_randomly</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Before:
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="50pt" height="23pt"
 viewBox="0.00 0.00 50.00 23.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 19)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-19 46,-19 46,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="21" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
</g>
</svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>After:
Expanding &lt;term&gt; randomly
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="147pt" height="74pt"
 viewBox="0.00 0.00 146.50 74.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 70)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-70 142.5,-70 142.5,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="72.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="24.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M65.4174,-50.9748C58.3983,-43.517 47.4513,-31.8857 38.6459,-22.53"/>
<polygon fill="#000000" stroke="#000000" points="41.014,-19.9393 31.6116,-15.0561 35.9166,-24.7369 41.014,-19.9393"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="72.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000"> / </text>
</g>
<!-- 0&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>0&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M72.5,-50.9748C72.5,-44.195 72.5,-33.966 72.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="76.0001,-25.0561 72.5,-15.0561 69.0001,-25.0561 76.0001,-25.0561"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="117.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 0&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>0&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M79.1399,-50.9748C85.6538,-43.5923 95.7762,-32.1203 103.9875,-22.8142"/>
<polygon fill="#000000" stroke="#000000" points="106.841,-24.8702 110.8329,-15.0561 101.5922,-20.2388 106.841,-24.8702"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Expanding-a-Tree">Expanding a Tree<a class="anchor-link" href="#Expanding-a-Tree">&#182;</a></h2><p>Let us now apply the above node expansion to some node in the tree.  To this end, we first need to search the tree for unexpanded nodes.  <code>possible_expansions()</code> counts how many unexpanded symbols there are in a tree:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">possible_expansions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
        <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">possible_expansions</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The method <code>any_possible_expansions()</code> returns True if the tree has any unexpanded nodes.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">any_possible_expansions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
        <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>True
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here comes <code>expand_tree_once()</code>, the core method of our tree expansion algorithm.  It first checks whether it is currently being applied on a nonterminal symbol without expansion; if so, it invokes <code>expand_node()</code> on it as above.</p>
<p>If the node is already expanded (i.e. has children), it checks the subset of children which still have unexpanded symbols; randomly selects one of them, and applies itself recursively on that child.</p>
<p>The <code>expand_tree_once()</code> method replaces the child <em>in place</em>, meaning that it actually mutates the tree being passed as an argument rather than returning a new tree.  This in-place mutation is what makes this function particularly efficient.  Again, we use a helper method (<code>choose_tree_expansion()</code>) to return the chosen index from a list of children that can be expanded.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">choose_tree_expansion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">children</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return index of subtree in `children` to be selected for expansion.  Defaults to random.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">expand_tree_once</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Expand this node</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

        <span class="c1"># Find all children with possible expansions</span>
        <span class="n">expandable_children</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span>

        <span class="c1"># `index_map` translates an index in `expandable_children`</span>
        <span class="c1"># back into the original index in `children`</span>
        <span class="n">index_map</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
                     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span>

        <span class="c1"># Select a random child</span>
        <span class="n">child_to_be_expanded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">choose_tree_expansion</span><span class="p">(</span>
            <span class="n">tree</span><span class="p">,</span> <span class="n">expandable_children</span><span class="p">)</span>

        <span class="c1"># Expand in place</span>
        <span class="n">children</span><span class="p">[</span><span class="n">index_map</span><span class="p">[</span><span class="n">child_to_be_expanded</span><span class="p">]]</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">expandable_children</span><span class="p">[</span><span class="n">child_to_be_expanded</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">tree</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let's put it to use, expanding our derivation tree from above twice.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">derivation_tree</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">,</span>
                   <span class="p">[(</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">,</span>
                     <span class="p">[(</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                      <span class="p">(</span><span class="s2">&quot; + &quot;</span><span class="p">,</span> <span class="p">[]),</span>
                         <span class="p">(</span><span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
                     <span class="p">)])</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="143pt" height="125pt"
 viewBox="0.00 0.00 142.50 125.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 121)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-121 138.5,-121 138.5,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="66.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="66.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M66.5,-101.9748C66.5,-95.195 66.5,-84.966 66.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="70.0001,-76.0561 66.5,-66.0561 63.0001,-76.0561 70.0001,-76.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="20.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M59.7125,-50.9748C52.9859,-43.517 42.495,-31.8857 34.0564,-22.53"/>
<polygon fill="#000000" stroke="#000000" points="36.612,-20.1376 27.3153,-15.0561 31.414,-24.826 36.612,-20.1376"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="66.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 1&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>1&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M66.5,-50.9748C66.5,-44.195 66.5,-33.966 66.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="70.0001,-25.0561 66.5,-15.0561 63.0001,-25.0561 70.0001,-25.0561"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="113.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>1&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M73.435,-50.9748C80.3079,-43.517 91.0269,-31.8857 99.6488,-22.53"/>
<polygon fill="#000000" stroke="#000000" points="102.3334,-24.7816 106.5365,-15.0561 97.1859,-20.0378 102.3334,-24.7816"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;expr&gt; randomly
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="188pt" height="176pt"
 viewBox="0.00 0.00 188.00 176.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 172)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-172 184,-172 184,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="112" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="112" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M112,-152.9748C112,-146.195 112,-135.966 112,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="115.5001,-127.0561 112,-117.0561 108.5001,-127.0561 115.5001,-127.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="66" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M105.2125,-101.9748C98.4859,-94.517 87.995,-82.8857 79.5564,-73.53"/>
<polygon fill="#000000" stroke="#000000" points="82.112,-71.1376 72.8153,-66.0561 76.914,-75.826 82.112,-71.1376"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="112" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 1&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>1&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M112,-101.9748C112,-95.195 112,-84.966 112,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="115.5001,-76.0561 112,-66.0561 108.5001,-76.0561 115.5001,-76.0561"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="159" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>1&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M118.935,-101.9748C125.8079,-94.517 136.5269,-82.8857 145.1488,-73.53"/>
<polygon fill="#000000" stroke="#000000" points="147.8334,-75.7816 152.0365,-66.0561 142.6859,-71.0378 147.8334,-75.7816"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="21" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M59.3601,-50.9748C52.8462,-43.5923 42.7238,-32.1203 34.5125,-22.8142"/>
<polygon fill="#000000" stroke="#000000" points="36.9078,-20.2388 27.6671,-15.0561 31.659,-24.8702 36.9078,-20.2388"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="66" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000"> &#45; </text>
</g>
<!-- 2&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>2&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M66,-50.9748C66,-44.195 66,-33.966 66,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="69.5001,-25.0561 66,-15.0561 62.5001,-25.0561 69.5001,-25.0561"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="111" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>2&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M72.6399,-50.9748C79.1538,-43.5923 89.2762,-32.1203 97.4875,-22.8142"/>
<polygon fill="#000000" stroke="#000000" points="100.341,-24.8702 104.3329,-15.0561 95.0922,-20.2388 100.341,-24.8702"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;term&gt; randomly
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="192pt" height="227pt"
 viewBox="0.00 0.00 191.50 227.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 223)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-223 187.5,-223 187.5,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="115.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="115.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M115.5,-203.9748C115.5,-197.195 115.5,-186.966 115.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="119.0001,-178.0561 115.5,-168.0561 112.0001,-178.0561 119.0001,-178.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="69.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M108.7125,-152.9748C101.9859,-145.517 91.495,-133.8857 83.0564,-124.53"/>
<polygon fill="#000000" stroke="#000000" points="85.612,-122.1376 76.3153,-117.0561 80.414,-126.826 85.612,-122.1376"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="115.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 1&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>1&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M115.5,-152.9748C115.5,-146.195 115.5,-135.966 115.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="119.0001,-127.0561 115.5,-117.0561 112.0001,-127.0561 119.0001,-127.0561"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="162.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>1&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M122.435,-152.9748C129.3079,-145.517 140.0269,-133.8857 148.6488,-124.53"/>
<polygon fill="#000000" stroke="#000000" points="151.3334,-126.7816 155.5365,-117.0561 146.1859,-122.0378 151.3334,-126.7816"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="24.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M62.8601,-101.9748C56.3462,-94.5923 46.2238,-83.1203 38.0125,-73.8142"/>
<polygon fill="#000000" stroke="#000000" points="40.4078,-71.2388 31.1671,-66.0561 35.159,-75.8702 40.4078,-71.2388"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="69.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000"> &#45; </text>
</g>
<!-- 2&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>2&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M69.5,-101.9748C69.5,-95.195 69.5,-84.966 69.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="73.0001,-76.0561 69.5,-66.0561 66.0001,-76.0561 73.0001,-76.0561"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="114.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>2&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M76.1399,-101.9748C82.6538,-94.5923 92.7762,-83.1203 100.9875,-73.8142"/>
<polygon fill="#000000" stroke="#000000" points="103.841,-75.8702 107.8329,-66.0561 98.5922,-71.2388 103.841,-75.8702"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="24.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M24.5,-50.9748C24.5,-44.195 24.5,-33.966 24.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="28.0001,-25.0561 24.5,-15.0561 21.0001,-25.0561 28.0001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that which each step, one more symbol is expanded.  Now all it takes is to apply this again and again, expanding the tree further and further.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Closing-the-Expansion">Closing the Expansion<a class="anchor-link" href="#Closing-the-Expansion">&#182;</a></h2><p>With <code>expand_tree_once()</code>, we can keep on expanding the tree – but how do we actually stop?  The key idea here, introduced by Luke in [<a href="https://doi.org/10.1109/4235.873237">Luke <em>et al</em>, 2000.</a>], is that after inflating the derivation tree to some maximum size, we <em>only want to apply expansions that increase the size of the tree by a minimum</em>.  For <code>&lt;factor&gt;</code>, for instance, we would prefer an expansion into <code>&lt;integer&gt;</code>, as this will not introduce further recursion (and potential size inflation); for <code>&lt;integer&gt;</code>, likewise, an expansion into <code>&lt;digit&gt;</code> is preferred, as it will less increase tree size than <code>&lt;digit&gt;&lt;integer&gt;</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To identify the <em>cost</em> of expanding a symbol, we introduce two functions that mutually rely on each other:</p>
<ul>
<li><code>symbol_cost()</code> returns the minimum cost of all expansions of a symbol, using <code>expansion_cost()</code> to compute the cost for each expansion.</li>
<li><code>expansion_cost()</code> returns the sum of all expansions in <code>expansions</code>.  If a nonterminal is encountered again during traversal, the cost of the expansion is $\infty$, indicating (potentially infinite) recursion.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">symbol_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="nb">set</span><span class="p">()):</span>
        <span class="n">expansions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion_cost</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">seen</span> <span class="o">|</span> <span class="p">{</span><span class="n">symbol</span><span class="p">})</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">expansions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">expansion_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expansion</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="nb">set</span><span class="p">()):</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="n">nonterminals</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>  <span class="c1"># no symbol</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">s</span> <span class="ow">in</span> <span class="n">seen</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>

        <span class="c1"># the value of a expansion is the sum of all expandable variables</span>
        <span class="c1"># inside + 1</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbol_cost</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">seen</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's two examples: The minimum cost of expanding a digit is 1, since we have to choose between one of its expansions.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">f</span><span class="o">.</span><span class="n">symbol_cost</span><span class="p">(</span><span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The minimum cost of expanding <code>&lt;expr&gt;</code>, though, is five, as this is the minimum number of expansions required.  (<code>&lt;expr&gt;</code> $\rightarrow$ <code>&lt;term&gt;</code> $\rightarrow$ <code>&lt;factor&gt;</code> $\rightarrow$ <code>&lt;integer&gt;</code> $\rightarrow$ <code>&lt;digit&gt;</code> $\rightarrow$ 1)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">f</span><span class="o">.</span><span class="n">symbol_cost</span><span class="p">(</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's now a variant of <code>expand_node()</code> that takes the above cost into account.  It determines the minimum cost <code>cost</code> across all children and then chooses a child from the list using the <code>choose</code> function, which by default is the minimum cost.  If multiple children all have the same minimum cost, it chooses randomly between these.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expand_node_by_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">choose</span><span class="o">=</span><span class="nb">min</span><span class="p">):</span>
        <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
        <span class="k">assert</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span>

        <span class="c1"># Fetch the possible expansions from grammar...</span>
        <span class="n">expansions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>

        <span class="n">possible_children_with_cost</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion_to_children</span><span class="p">(</span><span class="n">expansion</span><span class="p">),</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">expansion_cost</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="p">{</span><span class="n">symbol</span><span class="p">}))</span>
                                       <span class="k">for</span> <span class="n">expansion</span> <span class="ow">in</span> <span class="n">expansions</span><span class="p">]</span>

        <span class="n">costs</span> <span class="o">=</span> <span class="p">[</span><span class="n">cost</span> <span class="k">for</span> <span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span> <span class="ow">in</span> <span class="n">possible_children_with_cost</span><span class="p">]</span>
        <span class="n">chosen_cost</span> <span class="o">=</span> <span class="n">choose</span><span class="p">(</span><span class="n">costs</span><span class="p">)</span>
        <span class="n">children_with_chosen_cost</span> <span class="o">=</span> <span class="p">[</span><span class="n">child</span> <span class="k">for</span> <span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">child_cost</span><span class="p">)</span> <span class="ow">in</span> <span class="n">possible_children_with_cost</span>
                                     <span class="k">if</span> <span class="n">child_cost</span> <span class="o">==</span> <span class="n">chosen_cost</span><span class="p">]</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">choose_node_expansion</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">children_with_chosen_cost</span><span class="p">)</span>

        <span class="c1"># Return with a new list</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children_with_chosen_cost</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The shortcut <code>expand_node_min_cost()</code> passes <code>min()</code> as the <code>choose</code> function, which makes it expand nodes at minimum cost.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expand_node_min_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Expanding&quot;</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="s2">&quot;at minimum cost&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_by_cost</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">min</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now apply this function to close the expansion of our derivation tree, using <code>expand_tree_once()</code> with the above <code>expand_node_min_cost()</code> as expansion function.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expand_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_min_cost</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="192pt" height="227pt"
 viewBox="0.00 0.00 191.50 227.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 223)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-223 187.5,-223 187.5,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="115.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="115.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M115.5,-203.9748C115.5,-197.195 115.5,-186.966 115.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="119.0001,-178.0561 115.5,-168.0561 112.0001,-178.0561 119.0001,-178.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="69.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M108.7125,-152.9748C101.9859,-145.517 91.495,-133.8857 83.0564,-124.53"/>
<polygon fill="#000000" stroke="#000000" points="85.612,-122.1376 76.3153,-117.0561 80.414,-126.826 85.612,-122.1376"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="115.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 1&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>1&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M115.5,-152.9748C115.5,-146.195 115.5,-135.966 115.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="119.0001,-127.0561 115.5,-117.0561 112.0001,-127.0561 119.0001,-127.0561"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="162.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>1&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M122.435,-152.9748C129.3079,-145.517 140.0269,-133.8857 148.6488,-124.53"/>
<polygon fill="#000000" stroke="#000000" points="151.3334,-126.7816 155.5365,-117.0561 146.1859,-122.0378 151.3334,-126.7816"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="24.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M62.8601,-101.9748C56.3462,-94.5923 46.2238,-83.1203 38.0125,-73.8142"/>
<polygon fill="#000000" stroke="#000000" points="40.4078,-71.2388 31.1671,-66.0561 35.159,-75.8702 40.4078,-71.2388"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="69.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000"> &#45; </text>
</g>
<!-- 2&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>2&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M69.5,-101.9748C69.5,-95.195 69.5,-84.966 69.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="73.0001,-76.0561 69.5,-66.0561 66.0001,-76.0561 73.0001,-76.0561"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="114.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>2&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M76.1399,-101.9748C82.6538,-94.5923 92.7762,-83.1203 100.9875,-73.8142"/>
<polygon fill="#000000" stroke="#000000" points="103.841,-75.8702 107.8329,-66.0561 98.5922,-71.2388 103.841,-75.8702"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="24.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M24.5,-50.9748C24.5,-44.195 24.5,-33.966 24.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="28.0001,-25.0561 24.5,-15.0561 21.0001,-25.0561 28.0001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">):</span>
    <span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
    <span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;expr&gt; at minimum cost
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="192pt" height="227pt"
 viewBox="0.00 0.00 191.50 227.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 223)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-223 187.5,-223 187.5,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="115.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="115.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M115.5,-203.9748C115.5,-197.195 115.5,-186.966 115.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="119.0001,-178.0561 115.5,-168.0561 112.0001,-178.0561 119.0001,-178.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="69.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M108.7125,-152.9748C101.9859,-145.517 91.495,-133.8857 83.0564,-124.53"/>
<polygon fill="#000000" stroke="#000000" points="85.612,-122.1376 76.3153,-117.0561 80.414,-126.826 85.612,-122.1376"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="115.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 1&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>1&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M115.5,-152.9748C115.5,-146.195 115.5,-135.966 115.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="119.0001,-127.0561 115.5,-117.0561 112.0001,-127.0561 119.0001,-127.0561"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="162.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>1&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M122.435,-152.9748C129.3079,-145.517 140.0269,-133.8857 148.6488,-124.53"/>
<polygon fill="#000000" stroke="#000000" points="151.3334,-126.7816 155.5365,-117.0561 146.1859,-122.0378 151.3334,-126.7816"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="24.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M62.8601,-101.9748C56.3462,-94.5923 46.2238,-83.1203 38.0125,-73.8142"/>
<polygon fill="#000000" stroke="#000000" points="40.4078,-71.2388 31.1671,-66.0561 35.159,-75.8702 40.4078,-71.2388"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="69.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000"> &#45; </text>
</g>
<!-- 2&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>2&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M69.5,-101.9748C69.5,-95.195 69.5,-84.966 69.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="73.0001,-76.0561 69.5,-66.0561 66.0001,-76.0561 73.0001,-76.0561"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="114.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>2&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M76.1399,-101.9748C82.6538,-94.5923 92.7762,-83.1203 100.9875,-73.8142"/>
<polygon fill="#000000" stroke="#000000" points="103.841,-75.8702 107.8329,-66.0561 98.5922,-71.2388 103.841,-75.8702"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="24.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M24.5,-50.9748C24.5,-44.195 24.5,-33.966 24.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="28.0001,-25.0561 24.5,-15.0561 21.0001,-25.0561 28.0001,-25.0561"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="114.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M114.5,-50.9748C114.5,-44.195 114.5,-33.966 114.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="118.0001,-25.0561 114.5,-15.0561 111.0001,-25.0561 118.0001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">):</span>
    <span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
    <span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;term&gt; at minimum cost
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="192pt" height="278pt"
 viewBox="0.00 0.00 191.50 278.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 274)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-274 187.5,-274 187.5,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="115.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="115.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M115.5,-254.9748C115.5,-248.195 115.5,-237.966 115.5,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="119.0001,-229.0561 115.5,-219.0561 112.0001,-229.0561 119.0001,-229.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="69.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M108.7125,-203.9748C101.9859,-196.517 91.495,-184.8857 83.0564,-175.53"/>
<polygon fill="#000000" stroke="#000000" points="85.612,-173.1376 76.3153,-168.0561 80.414,-177.826 85.612,-173.1376"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="115.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 1&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>1&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M115.5,-203.9748C115.5,-197.195 115.5,-186.966 115.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="119.0001,-178.0561 115.5,-168.0561 112.0001,-178.0561 119.0001,-178.0561"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="162.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>1&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M122.435,-203.9748C129.3079,-196.517 140.0269,-184.8857 148.6488,-175.53"/>
<polygon fill="#000000" stroke="#000000" points="151.3334,-177.7816 155.5365,-168.0561 146.1859,-173.0378 151.3334,-177.7816"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="24.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M62.8601,-152.9748C56.3462,-145.5923 46.2238,-134.1203 38.0125,-124.8142"/>
<polygon fill="#000000" stroke="#000000" points="40.4078,-122.2388 31.1671,-117.0561 35.159,-126.8702 40.4078,-122.2388"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="69.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000"> &#45; </text>
</g>
<!-- 2&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>2&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M69.5,-152.9748C69.5,-146.195 69.5,-135.966 69.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="73.0001,-127.0561 69.5,-117.0561 66.0001,-127.0561 73.0001,-127.0561"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="114.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>2&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M76.1399,-152.9748C82.6538,-145.5923 92.7762,-134.1203 100.9875,-124.8142"/>
<polygon fill="#000000" stroke="#000000" points="103.841,-126.8702 107.8329,-117.0561 98.5922,-122.2388 103.841,-126.8702"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="24.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M24.5,-101.9748C24.5,-95.195 24.5,-84.966 24.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="28.0001,-76.0561 24.5,-66.0561 21.0001,-76.0561 28.0001,-76.0561"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="114.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M114.5,-101.9748C114.5,-95.195 114.5,-84.966 114.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="118.0001,-76.0561 114.5,-66.0561 111.0001,-76.0561 118.0001,-76.0561"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="114.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M114.5,-50.9748C114.5,-44.195 114.5,-33.966 114.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="118.0001,-25.0561 114.5,-15.0561 111.0001,-25.0561 118.0001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">):</span>
    <span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
    <span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;term&gt; at minimum cost
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="210pt" height="278pt"
 viewBox="0.00 0.00 210.00 278.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 274)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-274 206,-274 206,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="126.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="126.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M126.5,-254.9748C126.5,-248.195 126.5,-237.966 126.5,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="130.0001,-229.0561 126.5,-219.0561 123.0001,-229.0561 130.0001,-229.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="76.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M119.1223,-203.9748C111.7369,-196.4417 100.1768,-184.6503 90.958,-175.2472"/>
<polygon fill="#000000" stroke="#000000" points="93.4079,-172.7466 83.9079,-168.0561 88.4094,-177.6471 93.4079,-172.7466"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="126.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 1&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>1&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M126.5,-203.9748C126.5,-197.195 126.5,-186.966 126.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="130.0001,-178.0561 126.5,-168.0561 123.0001,-178.0561 130.0001,-178.0561"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="175.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>1&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M133.7301,-203.9748C140.8954,-196.517 152.0706,-184.8857 161.0594,-175.53"/>
<polygon fill="#000000" stroke="#000000" points="163.8358,-177.6921 168.2402,-168.0561 158.7881,-172.8423 163.8358,-177.6921"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="24.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M68.8272,-152.9748C61.1464,-145.4417 49.1239,-133.6503 39.5363,-124.2472"/>
<polygon fill="#000000" stroke="#000000" points="41.7944,-121.5594 32.2043,-117.0561 36.8929,-126.557 41.7944,-121.5594"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="69.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000"> &#45; </text>
</g>
<!-- 2&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>2&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M75.4671,-152.9748C74.5366,-146.195 73.1326,-135.966 71.9202,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="75.3645,-126.4873 70.5371,-117.0561 68.4295,-127.4392 75.3645,-126.4873"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="114.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>2&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M82.107,-152.9748C87.5516,-145.6677 95.9813,-134.354 102.8767,-125.0997"/>
<polygon fill="#000000" stroke="#000000" points="105.7017,-127.1661 108.87,-117.0561 100.0885,-122.9837 105.7017,-127.1661"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="24.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M24.5,-101.9748C24.5,-95.195 24.5,-84.966 24.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="28.0001,-76.0561 24.5,-66.0561 21.0001,-76.0561 28.0001,-76.0561"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="114.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M114.5,-101.9748C114.5,-95.195 114.5,-84.966 114.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="118.0001,-76.0561 114.5,-66.0561 111.0001,-76.0561 118.0001,-76.0561"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="114.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M114.5,-50.9748C114.5,-44.195 114.5,-33.966 114.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="118.0001,-25.0561 114.5,-15.0561 111.0001,-25.0561 118.0001,-25.0561"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="177.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M175.7951,-152.9748C176.061,-146.195 176.4621,-135.966 176.8085,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="180.309,-127.1856 177.2037,-117.0561 173.3144,-126.9112 180.309,-127.1856"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We keep on expanding until all nonterminals are expanded.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">while</span> <span class="n">f</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">):</span>
    <span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>    
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;factor&gt; at minimum cost
Expanding &lt;factor&gt; at minimum cost
Expanding &lt;factor&gt; at minimum cost
Expanding &lt;integer&gt; at minimum cost
Expanding &lt;integer&gt; at minimum cost
Expanding &lt;digit&gt; at minimum cost
Expanding &lt;integer&gt; at minimum cost
Expanding &lt;digit&gt; at minimum cost
Expanding &lt;digit&gt; at minimum cost
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here is the final tree:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="219pt" height="431pt"
 viewBox="0.00 0.00 219.00 431.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 427)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-427 215,-427 215,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="129.5" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="129.5" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M129.5,-407.9748C129.5,-401.195 129.5,-390.966 129.5,-382.1331"/>
<polygon fill="#000000" stroke="#000000" points="133.0001,-382.0561 129.5,-372.0561 126.0001,-382.0561 133.0001,-382.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="79.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M122.1223,-356.9748C114.7369,-349.4417 103.1768,-337.6503 93.958,-328.2472"/>
<polygon fill="#000000" stroke="#000000" points="96.4079,-325.7466 86.9079,-321.0561 91.4094,-330.6471 96.4079,-325.7466"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="129.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 1&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>1&#45;&gt;15</title>
<path fill="none" stroke="#000000" d="M129.5,-356.9748C129.5,-350.195 129.5,-339.966 129.5,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="133.0001,-331.0561 129.5,-321.0561 126.0001,-331.0561 133.0001,-331.0561"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="178.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>1&#45;&gt;16</title>
<path fill="none" stroke="#000000" d="M136.7301,-356.9748C143.8954,-349.517 155.0706,-337.8857 164.0594,-328.53"/>
<polygon fill="#000000" stroke="#000000" points="166.8358,-330.6921 171.2402,-321.0561 161.7881,-325.8423 166.8358,-330.6921"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="27.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M71.8272,-305.9748C64.1464,-298.4417 52.1239,-286.6503 42.5363,-277.2472"/>
<polygon fill="#000000" stroke="#000000" points="44.7944,-274.5594 35.2043,-270.0561 39.8929,-279.557 44.7944,-274.5594"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="72.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000"> &#45; </text>
</g>
<!-- 2&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>2&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M78.4671,-305.9748C77.5366,-299.195 76.1326,-288.966 74.9202,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="78.3645,-279.4873 73.5371,-270.0561 71.4295,-280.4392 78.3645,-279.4873"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="117.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>2&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M85.107,-305.9748C90.5516,-298.6677 98.9813,-287.354 105.8767,-278.0997"/>
<polygon fill="#000000" stroke="#000000" points="108.7017,-280.1661 111.87,-270.0561 103.0885,-275.9837 108.7017,-280.1661"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="27.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M27.5,-254.9748C27.5,-248.195 27.5,-237.966 27.5,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-229.0561 27.5,-219.0561 24.0001,-229.0561 31.0001,-229.0561"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="27.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M27.5,-203.9748C27.5,-197.195 27.5,-186.966 27.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-178.0561 27.5,-168.0561 24.0001,-178.0561 31.0001,-178.0561"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="27.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M27.5,-152.9748C27.5,-146.195 27.5,-135.966 27.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-127.0561 27.5,-117.0561 24.0001,-127.0561 31.0001,-127.0561"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="27.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">0</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M27.5,-101.9748C27.5,-95.195 27.5,-84.966 27.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-76.0561 27.5,-66.0561 24.0001,-76.0561 31.0001,-76.0561"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="116.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M117.3524,-254.9748C117.2195,-248.195 117.0189,-237.966 116.8457,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="120.3436,-228.9855 116.6482,-219.0561 113.345,-229.1228 120.3436,-228.9855"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="116.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M116.5,-203.9748C116.5,-197.195 116.5,-186.966 116.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="120.0001,-178.0561 116.5,-168.0561 113.0001,-178.0561 120.0001,-178.0561"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="116.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>11&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M116.5,-152.9748C116.5,-146.195 116.5,-135.966 116.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="120.0001,-127.0561 116.5,-117.0561 113.0001,-127.0561 120.0001,-127.0561"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="116.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12&#45;&gt;13</title>
<path fill="none" stroke="#000000" d="M116.5,-101.9748C116.5,-95.195 116.5,-84.966 116.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="120.0001,-76.0561 116.5,-66.0561 113.0001,-76.0561 120.0001,-76.0561"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="116.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">9</text>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13&#45;&gt;14</title>
<path fill="none" stroke="#000000" d="M116.5,-50.9748C116.5,-44.195 116.5,-33.966 116.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="120.0001,-25.0561 116.5,-15.0561 113.0001,-25.0561 120.0001,-25.0561"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="182.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 16&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>16&#45;&gt;17</title>
<path fill="none" stroke="#000000" d="M179.0902,-305.9748C179.622,-299.195 180.4242,-288.966 181.117,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="184.6146,-280.2992 181.9074,-270.0561 177.6361,-279.7518 184.6146,-280.2992"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="183.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 17&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>17&#45;&gt;18</title>
<path fill="none" stroke="#000000" d="M182.6476,-254.9748C182.7805,-248.195 182.9811,-237.966 183.1543,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="186.655,-229.1228 183.3518,-219.0561 179.6564,-228.9855 186.655,-229.1228"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="183.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 18&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>18&#45;&gt;19</title>
<path fill="none" stroke="#000000" d="M183.5,-203.9748C183.5,-197.195 183.5,-186.966 183.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="187.0001,-178.0561 183.5,-168.0561 180.0001,-178.0561 187.0001,-178.0561"/>
</g>
<!-- 20 -->
<g id="node21" class="node">
<title>20</title>
<text text-anchor="middle" x="183.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">9</text>
</g>
<!-- 19&#45;&gt;20 -->
<g id="edge20" class="edge">
<title>19&#45;&gt;20</title>
<path fill="none" stroke="#000000" d="M183.5,-152.9748C183.5,-146.195 183.5,-135.966 183.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="187.0001,-127.0561 183.5,-117.0561 180.0001,-127.0561 187.0001,-127.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that in each step, <code>expand_node_min_cost()</code> chooses an expansion that does not increase the number of symbols, eventually closing all open expansions.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Node-Inflation">Node Inflation<a class="anchor-link" href="#Node-Inflation">&#182;</a></h2><p>Especially at the beginning of an expansion, we may be interested in getting <em>as many nodes as possible</em> – that is, we'd like to prefer expansions that give us <em>more</em> nonterminals to expand.  This is actually the exact opposite from what <code>expand_node_min_cost()</code> gives us, and we can implement a method <code>expand_node_max_cost()</code> that will always choose among the nodes with the <em>highest</em> cost:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expand_node_max_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Expanding&quot;</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="s2">&quot;at maximum cost&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_by_cost</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">max</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To illustrate <code>expand_node_max_cost()</code>, we can again redefine <code>expand_node()</code> to use it, and then use <code>expand_tree_once()</code> to show a few expansion steps:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expand_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_max_cost</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">derivation_tree</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">,</span>
                   <span class="p">[(</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">,</span>
                     <span class="p">[(</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                      <span class="p">(</span><span class="s2">&quot; + &quot;</span><span class="p">,</span> <span class="p">[]),</span>
                         <span class="p">(</span><span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
                     <span class="p">)])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="143pt" height="125pt"
 viewBox="0.00 0.00 142.50 125.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 121)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-121 138.5,-121 138.5,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="66.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="66.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M66.5,-101.9748C66.5,-95.195 66.5,-84.966 66.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="70.0001,-76.0561 66.5,-66.0561 63.0001,-76.0561 70.0001,-76.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="20.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M59.7125,-50.9748C52.9859,-43.517 42.495,-31.8857 34.0564,-22.53"/>
<polygon fill="#000000" stroke="#000000" points="36.612,-20.1376 27.3153,-15.0561 31.414,-24.826 36.612,-20.1376"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="66.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 1&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>1&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M66.5,-50.9748C66.5,-44.195 66.5,-33.966 66.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="70.0001,-25.0561 66.5,-15.0561 63.0001,-25.0561 70.0001,-25.0561"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="113.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>1&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M73.435,-50.9748C80.3079,-43.517 91.0269,-31.8857 99.6488,-22.53"/>
<polygon fill="#000000" stroke="#000000" points="102.3334,-24.7816 106.5365,-15.0561 97.1859,-20.0378 102.3334,-24.7816"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">):</span>
    <span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
    <span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;term&gt; at maximum cost
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="188pt" height="176pt"
 viewBox="0.00 0.00 187.50 176.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 172)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-172 183.5,-172 183.5,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="66.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="66.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M66.5,-152.9748C66.5,-146.195 66.5,-135.966 66.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="70.0001,-127.0561 66.5,-117.0561 63.0001,-127.0561 70.0001,-127.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="20.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M59.7125,-101.9748C52.9859,-94.517 42.495,-82.8857 34.0564,-73.53"/>
<polygon fill="#000000" stroke="#000000" points="36.612,-71.1376 27.3153,-66.0561 31.414,-75.826 36.612,-71.1376"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="66.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 1&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>1&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M66.5,-101.9748C66.5,-95.195 66.5,-84.966 66.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="70.0001,-76.0561 66.5,-66.0561 63.0001,-76.0561 70.0001,-76.0561"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="113.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>1&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M73.435,-101.9748C80.3079,-94.517 91.0269,-82.8857 99.6488,-73.53"/>
<polygon fill="#000000" stroke="#000000" points="102.3334,-75.7816 106.5365,-66.0561 97.1859,-71.0378 102.3334,-75.7816"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="65.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M106.4174,-50.9748C99.3983,-43.517 88.4513,-31.8857 79.6459,-22.53"/>
<polygon fill="#000000" stroke="#000000" points="82.014,-19.9393 72.6116,-15.0561 76.9166,-24.7369 82.014,-19.9393"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="113.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000"> / </text>
</g>
<!-- 4&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>4&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M113.5,-50.9748C113.5,-44.195 113.5,-33.966 113.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="117.0001,-25.0561 113.5,-15.0561 110.0001,-25.0561 117.0001,-25.0561"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="158.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 4&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>4&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M120.1399,-50.9748C126.6538,-43.5923 136.7762,-32.1203 144.9875,-22.8142"/>
<polygon fill="#000000" stroke="#000000" points="147.841,-24.8702 151.8329,-15.0561 142.5922,-20.2388 147.841,-24.8702"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">):</span>
    <span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
    <span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;expr&gt; at maximum cost
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="296pt" height="176pt"
 viewBox="0.00 0.00 296.00 176.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 172)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-172 292,-172 292,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="143" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="143" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M143,-152.9748C143,-146.195 143,-135.966 143,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="146.5001,-127.0561 143,-117.0561 139.5001,-127.0561 146.5001,-127.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="90" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M135.1797,-101.9748C127.3511,-94.4417 115.0974,-82.6503 105.3255,-73.2472"/>
<polygon fill="#000000" stroke="#000000" points="107.485,-70.4679 97.8524,-66.0561 102.6313,-75.5119 107.485,-70.4679"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="143" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 1&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>1&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M143,-101.9748C143,-95.195 143,-84.966 143,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="146.5001,-76.0561 143,-66.0561 139.5001,-76.0561 146.5001,-76.0561"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="194" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>1&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M150.5252,-101.9748C158.0583,-94.4417 169.8497,-82.6503 179.2528,-73.2472"/>
<polygon fill="#000000" stroke="#000000" points="181.8477,-75.6021 186.4439,-66.0561 176.8979,-70.6523 181.8477,-75.6021"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="21" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M79.8188,-50.9748C69.2193,-43.1403 52.3885,-30.7002 39.4415,-21.1307"/>
<polygon fill="#000000" stroke="#000000" points="41.3451,-18.1854 31.223,-15.0561 37.1844,-23.8147 41.3451,-18.1854"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="66" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000"> &#45; </text>
</g>
<!-- 2&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>2&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M86.4587,-50.9748C83.1619,-43.969 78.1319,-33.2803 73.8845,-24.2547"/>
<polygon fill="#000000" stroke="#000000" points="76.9807,-22.614 69.5558,-15.0561 70.647,-25.5946 76.9807,-22.614"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="111" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>2&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M93.0986,-50.9748C95.9523,-44.0443 100.2901,-33.5097 103.9809,-24.5464"/>
<polygon fill="#000000" stroke="#000000" points="107.3175,-25.6355 107.8887,-15.0561 100.8447,-22.9702 107.3175,-25.6355"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="174" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M191.0489,-50.9748C188.3311,-44.0443 184.1999,-33.5097 180.6849,-24.5464"/>
<polygon fill="#000000" stroke="#000000" points="183.8725,-23.088 176.9632,-15.0561 177.3557,-25.6437 183.8725,-23.088"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="222" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000"> / </text>
</g>
<!-- 7&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>7&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M198.1315,-50.9748C202.0192,-43.8936 207.9726,-33.05 212.9609,-23.9641"/>
<polygon fill="#000000" stroke="#000000" points="216.1069,-25.5063 217.8516,-15.0561 209.9709,-22.1375 216.1069,-25.5063"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="267" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 7&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>7&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M204.7714,-50.9748C216.0932,-43.065 234.1349,-30.4606 247.8834,-20.8554"/>
<polygon fill="#000000" stroke="#000000" points="249.9913,-23.6524 256.1844,-15.0561 245.9823,-17.9141 249.9913,-23.6524"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">):</span>
    <span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
    <span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expanding &lt;term&gt; at maximum cost
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="341pt" height="227pt"
 viewBox="0.00 0.00 341.00 227.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 223)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-223 337,-223 337,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="143" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="143" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M143,-203.9748C143,-197.195 143,-186.966 143,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="146.5001,-178.0561 143,-168.0561 139.5001,-178.0561 146.5001,-178.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="90" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M135.1797,-152.9748C127.3511,-145.4417 115.0974,-133.6503 105.3255,-124.2472"/>
<polygon fill="#000000" stroke="#000000" points="107.485,-121.4679 97.8524,-117.0561 102.6313,-126.5119 107.485,-121.4679"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="143" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 1&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>1&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M143,-152.9748C143,-146.195 143,-135.966 143,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="146.5001,-127.0561 143,-117.0561 139.5001,-127.0561 146.5001,-127.0561"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="194" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>1&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M150.5252,-152.9748C158.0583,-145.4417 169.8497,-133.6503 179.2528,-124.2472"/>
<polygon fill="#000000" stroke="#000000" points="181.8477,-126.6021 186.4439,-117.0561 176.8979,-121.6523 181.8477,-126.6021"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="21" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M79.8188,-101.9748C69.2193,-94.1403 52.3885,-81.7002 39.4415,-72.1307"/>
<polygon fill="#000000" stroke="#000000" points="41.3451,-69.1854 31.223,-66.0561 37.1844,-74.8147 41.3451,-69.1854"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="66" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000"> &#45; </text>
</g>
<!-- 2&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>2&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M86.4587,-101.9748C83.1619,-94.969 78.1319,-84.2803 73.8845,-75.2547"/>
<polygon fill="#000000" stroke="#000000" points="76.9807,-73.614 69.5558,-66.0561 70.647,-76.5946 76.9807,-73.614"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="111" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>2&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M93.0986,-101.9748C95.9523,-95.0443 100.2901,-84.5097 103.9809,-75.5464"/>
<polygon fill="#000000" stroke="#000000" points="107.3175,-76.6355 107.8887,-66.0561 100.8447,-73.9702 107.3175,-76.6355"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="174" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M191.0489,-101.9748C188.3311,-95.0443 184.1999,-84.5097 180.6849,-75.5464"/>
<polygon fill="#000000" stroke="#000000" points="183.8725,-74.088 176.9632,-66.0561 177.3557,-76.6437 183.8725,-74.088"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="222" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000"> / </text>
</g>
<!-- 7&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>7&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M198.1315,-101.9748C202.0192,-94.8936 207.9726,-84.05 212.9609,-74.9641"/>
<polygon fill="#000000" stroke="#000000" points="216.1069,-76.5063 217.8516,-66.0561 209.9709,-73.1375 216.1069,-76.5063"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="267" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 7&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>7&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M204.7714,-101.9748C216.0932,-94.065 234.1349,-81.4606 247.8834,-71.8554"/>
<polygon fill="#000000" stroke="#000000" points="249.9913,-74.6524 256.1844,-66.0561 245.9823,-68.9141 249.9913,-74.6524"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="219" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M259.9174,-50.9748C252.8983,-43.517 241.9513,-31.8857 233.1459,-22.53"/>
<polygon fill="#000000" stroke="#000000" points="235.514,-19.9393 226.1116,-15.0561 230.4166,-24.7369 235.514,-19.9393"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="267" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000"> / </text>
</g>
<!-- 10&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>10&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M267,-50.9748C267,-44.195 267,-33.966 267,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="270.5001,-25.0561 267,-15.0561 263.5001,-25.0561 270.5001,-25.0561"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="312" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 10&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>10&#45;&gt;13</title>
<path fill="none" stroke="#000000" d="M273.6399,-50.9748C280.1538,-43.5923 290.2762,-32.1203 298.4875,-22.8142"/>
<polygon fill="#000000" stroke="#000000" points="301.341,-24.8702 305.3329,-15.0561 296.0922,-20.2388 301.341,-24.8702"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that with each step, the number of nonterminals increases.  Obviously, we have to put a limit on this number.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Three-Expansion-Phases">Three Expansion Phases<a class="anchor-link" href="#Three-Expansion-Phases">&#182;</a></h2><p>We can now put all three phases together in a single function <code>expand_tree()</code> which will work as follows:</p>
<ol>
<li><strong>Max cost expansion.</strong> Expand the tree using expansions with maximum cost until we have at least <code>min_nonterminals</code> nonterminals.  This phase can be easily skipped by setting <code>min_nonterminals</code> to zero.</li>
<li><strong>Random expansion.</strong>  Keep on expanding the tree randomly until we reach <code>max_nonterminals</code> nonterminals.</li>
<li><strong>Min cost expansion.</strong> Close the expansion with minimum cost.</li>
</ol>
<p>We implement these three phases by having <code>expand_node</code> reference the expansion method to apply.  This is controlled by setting <code>expand_node</code> (the method reference) to first <code>expand_node_max_cost</code> (i.e., calling <code>expand_node()</code> invokes <code>expand_node_max_cost()</code>), then <code>expand_node_randomly</code>, and finally <code>expand_node_min_cost</code>.  In the first two phases, we also set a maximum limit of <code>min_nonterminals</code> and <code>max_nonterminals</code>, respectively.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">log_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Output a tree if self.log is set; if self.display is also set, show the tree structure&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tree:&quot;</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp</span><span class="p">:</span>
                <span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
            <span class="c1"># print(self.possible_expansions(tree), &quot;possible expansion(s) left&quot;)</span>

    <span class="k">def</span> <span class="nf">expand_tree_with_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">expand_node_method</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Expand tree using `expand_node_method` as node expansion function</span>
<span class="sd">        until the number of possible expansions reaches `limit`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expand_node</span> <span class="o">=</span> <span class="n">expand_node_method</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">possible_expansions</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
               <span class="o">&lt;</span> <span class="n">limit</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">any_possible_expansions</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tree</span>

    <span class="k">def</span> <span class="nf">expand_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Expand `tree` in a three-phase strategy until all expansions are complete.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_tree_with_strategy</span><span class="p">(</span>
            <span class="n">tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_max_cost</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_nonterminals</span><span class="p">)</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_tree_with_strategy</span><span class="p">(</span>
            <span class="n">tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_randomly</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_nonterminals</span><span class="p">)</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_tree_with_strategy</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_min_cost</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">possible_expansions</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">tree</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us try this out on our example.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">derivation_tree</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">,</span>
                   <span class="p">[(</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">,</span>
                     <span class="p">[(</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                      <span class="p">(</span><span class="s2">&quot; + &quot;</span><span class="p">,</span> <span class="p">[]),</span>
                         <span class="p">(</span><span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
                     <span class="p">)])</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span>
    <span class="n">EXPR_GRAMMAR</span><span class="p">,</span>
    <span class="n">min_nonterminals</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">derivation_tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Tree: &lt;expr&gt; + &lt;term&gt;
Expanding &lt;expr&gt; at maximum cost
Tree: &lt;term&gt; + &lt;expr&gt; + &lt;term&gt;
Expanding &lt;expr&gt; randomly
Tree: &lt;term&gt; + &lt;term&gt; - &lt;expr&gt; + &lt;term&gt;
Expanding &lt;term&gt; randomly
Tree: &lt;term&gt; + &lt;term&gt; - &lt;expr&gt; + &lt;factor&gt;
Expanding &lt;factor&gt; randomly
Tree: &lt;term&gt; + &lt;term&gt; - &lt;expr&gt; + -&lt;factor&gt;
Expanding &lt;expr&gt; randomly
Tree: &lt;term&gt; + &lt;term&gt; - &lt;term&gt; + -&lt;factor&gt;
Expanding &lt;factor&gt; randomly
Tree: &lt;term&gt; + &lt;term&gt; - &lt;term&gt; + -(&lt;expr&gt;)
Expanding &lt;expr&gt; randomly
Tree: &lt;term&gt; + &lt;term&gt; - &lt;term&gt; + -(&lt;term&gt;)
Expanding &lt;term&gt; randomly
Tree: &lt;factor&gt; * &lt;term&gt; + &lt;term&gt; - &lt;term&gt; + -(&lt;term&gt;)
Expanding &lt;term&gt; at minimum cost
Tree: &lt;factor&gt; * &lt;term&gt; + &lt;factor&gt; - &lt;term&gt; + -(&lt;term&gt;)
Expanding &lt;term&gt; at minimum cost
Tree: &lt;factor&gt; * &lt;term&gt; + &lt;factor&gt; - &lt;term&gt; + -(&lt;factor&gt;)
Expanding &lt;factor&gt; at minimum cost
Tree: &lt;factor&gt; * &lt;term&gt; + &lt;factor&gt; - &lt;term&gt; + -(&lt;integer&gt;)
Expanding &lt;integer&gt; at minimum cost
Tree: &lt;factor&gt; * &lt;term&gt; + &lt;factor&gt; - &lt;term&gt; + -(&lt;digit&gt;)
Expanding &lt;term&gt; at minimum cost
Tree: &lt;factor&gt; * &lt;factor&gt; + &lt;factor&gt; - &lt;term&gt; + -(&lt;digit&gt;)
Expanding &lt;factor&gt; at minimum cost
Tree: &lt;integer&gt; * &lt;factor&gt; + &lt;factor&gt; - &lt;term&gt; + -(&lt;digit&gt;)
Expanding &lt;term&gt; at minimum cost
Tree: &lt;integer&gt; * &lt;factor&gt; + &lt;factor&gt; - &lt;factor&gt; + -(&lt;digit&gt;)
Expanding &lt;factor&gt; at minimum cost
Tree: &lt;integer&gt; * &lt;factor&gt; + &lt;integer&gt; - &lt;factor&gt; + -(&lt;digit&gt;)
Expanding &lt;integer&gt; at minimum cost
Tree: &lt;digit&gt; * &lt;factor&gt; + &lt;integer&gt; - &lt;factor&gt; + -(&lt;digit&gt;)
Expanding &lt;digit&gt; at minimum cost
Tree: &lt;digit&gt; * &lt;factor&gt; + &lt;integer&gt; - &lt;factor&gt; + -(2)
Expanding &lt;factor&gt; at minimum cost
Tree: &lt;digit&gt; * &lt;factor&gt; + &lt;integer&gt; - &lt;integer&gt; + -(2)
Expanding &lt;integer&gt; at minimum cost
Tree: &lt;digit&gt; * &lt;factor&gt; + &lt;integer&gt; - &lt;digit&gt; + -(2)
Expanding &lt;digit&gt; at minimum cost
Tree: 9 * &lt;factor&gt; + &lt;integer&gt; - &lt;digit&gt; + -(2)
Expanding &lt;factor&gt; at minimum cost
Tree: 9 * &lt;integer&gt; + &lt;integer&gt; - &lt;digit&gt; + -(2)
Expanding &lt;integer&gt; at minimum cost
Tree: 9 * &lt;digit&gt; + &lt;integer&gt; - &lt;digit&gt; + -(2)
Expanding &lt;digit&gt; at minimum cost
Tree: 9 * 3 + &lt;integer&gt; - &lt;digit&gt; + -(2)
Expanding &lt;integer&gt; at minimum cost
Tree: 9 * 3 + &lt;digit&gt; - &lt;digit&gt; + -(2)
Expanding &lt;digit&gt; at minimum cost
Tree: 9 * 3 + &lt;digit&gt; - 4 + -(2)
Expanding &lt;digit&gt; at minimum cost
Tree: 9 * 3 + 6 - 4 + -(2)
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="415pt" height="533pt"
 viewBox="0.00 0.00 415.00 533.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 529)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-529 411,-529 411,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="261.5" y="-513.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="261.5" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M261.5,-509.9748C261.5,-503.195 261.5,-492.966 261.5,-484.1331"/>
<polygon fill="#000000" stroke="#000000" points="265.0001,-484.0561 261.5,-474.0561 258.0001,-484.0561 265.0001,-484.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="205.5" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M253.237,-458.9748C244.8826,-451.3663 231.7586,-439.4141 221.384,-429.9658"/>
<polygon fill="#000000" stroke="#000000" points="223.547,-427.2017 213.7969,-423.0561 218.8337,-432.3771 223.547,-427.2017"/>
</g>
<!-- 28 -->
<g id="node29" class="node">
<title>28</title>
<text text-anchor="middle" x="261.5" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 1&#45;&gt;28 -->
<g id="edge28" class="edge">
<title>1&#45;&gt;28</title>
<path fill="none" stroke="#000000" d="M261.5,-458.9748C261.5,-452.195 261.5,-441.966 261.5,-433.1331"/>
<polygon fill="#000000" stroke="#000000" points="265.0001,-433.0561 261.5,-423.0561 258.0001,-433.0561 265.0001,-433.0561"/>
</g>
<!-- 29 -->
<g id="node30" class="node">
<title>29</title>
<text text-anchor="middle" x="313.5" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;29 -->
<g id="edge29" class="edge">
<title>1&#45;&gt;29</title>
<path fill="none" stroke="#000000" d="M269.1728,-458.9748C276.8536,-451.4417 288.8761,-439.6503 298.4637,-430.2472"/>
<polygon fill="#000000" stroke="#000000" points="301.1071,-432.557 305.7957,-423.0561 296.2056,-427.5594 301.1071,-432.557"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="101.5" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M190.1544,-407.9748C173.2566,-399.6883 145.8519,-386.2495 125.9798,-376.5045"/>
<polygon fill="#000000" stroke="#000000" points="127.4281,-373.3166 116.9085,-372.0561 124.346,-379.6016 127.4281,-373.3166"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="186.5" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 2&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>2&#45;&gt;14</title>
<path fill="none" stroke="#000000" d="M202.6965,-407.9748C200.1145,-401.0443 196.1899,-390.5097 192.8506,-381.5464"/>
<polygon fill="#000000" stroke="#000000" points="196.086,-380.205 189.315,-372.0561 189.5264,-382.6488 196.086,-380.205"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="232.5" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>2&#45;&gt;15</title>
<path fill="none" stroke="#000000" d="M209.4839,-407.9748C213.2328,-400.8936 218.9735,-390.05 223.7837,-380.9641"/>
<polygon fill="#000000" stroke="#000000" points="226.914,-382.5316 228.4997,-372.0561 220.7275,-379.2564 226.914,-382.5316"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="27.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M90.581,-356.9748C79.1041,-349.065 60.8153,-336.4606 46.8785,-326.8554"/>
<polygon fill="#000000" stroke="#000000" points="48.6839,-323.849 38.4638,-321.0561 44.7115,-329.6127 48.6839,-323.849"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="77.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000"> * </text>
</g>
<!-- 3&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>3&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M97.9587,-356.9748C94.6619,-349.969 89.6319,-339.2803 85.3845,-330.2547"/>
<polygon fill="#000000" stroke="#000000" points="88.4807,-328.614 81.0558,-321.0561 82.147,-331.5946 88.4807,-328.614"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="124.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 3&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>3&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M104.8937,-356.9748C108.0532,-349.969 112.8736,-339.2803 116.944,-330.2547"/>
<polygon fill="#000000" stroke="#000000" points="120.1718,-331.6109 121.0923,-321.0561 113.7907,-328.7331 120.1718,-331.6109"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="27.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M27.5,-305.9748C27.5,-299.195 27.5,-288.966 27.5,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-280.0561 27.5,-270.0561 24.0001,-280.0561 31.0001,-280.0561"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="27.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M27.5,-254.9748C27.5,-248.195 27.5,-237.966 27.5,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-229.0561 27.5,-219.0561 24.0001,-229.0561 31.0001,-229.0561"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="27.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">9</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M27.5,-203.9748C27.5,-197.195 27.5,-186.966 27.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-178.0561 27.5,-168.0561 24.0001,-178.0561 31.0001,-178.0561"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="121.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M124.0573,-305.9748C123.6585,-299.195 123.0568,-288.966 122.5372,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="126.0258,-279.8333 121.9445,-270.0561 119.0378,-280.2444 126.0258,-279.8333"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="119.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M121.2049,-254.9748C120.939,-248.195 120.5379,-237.966 120.1915,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="123.6856,-228.9112 119.7963,-219.0561 116.691,-229.1856 123.6856,-228.9112"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="119.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>11&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M119.5,-203.9748C119.5,-197.195 119.5,-186.966 119.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="123.0001,-178.0561 119.5,-168.0561 116.0001,-178.0561 123.0001,-178.0561"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="119.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">3</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12&#45;&gt;13</title>
<path fill="none" stroke="#000000" d="M119.5,-152.9748C119.5,-146.195 119.5,-135.966 119.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="123.0001,-127.0561 119.5,-117.0561 116.0001,-127.0561 123.0001,-127.0561"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="187.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15&#45;&gt;16</title>
<path fill="none" stroke="#000000" d="M225.8601,-356.9748C219.3462,-349.5923 209.2238,-338.1203 201.0125,-328.8142"/>
<polygon fill="#000000" stroke="#000000" points="203.4078,-326.2388 194.1671,-321.0561 198.159,-330.8702 203.4078,-326.2388"/>
</g>
<!-- 21 -->
<g id="node22" class="node">
<title>21</title>
<text text-anchor="middle" x="232.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000"> &#45; </text>
</g>
<!-- 15&#45;&gt;21 -->
<g id="edge21" class="edge">
<title>15&#45;&gt;21</title>
<path fill="none" stroke="#000000" d="M232.5,-356.9748C232.5,-350.195 232.5,-339.966 232.5,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="236.0001,-331.0561 232.5,-321.0561 229.0001,-331.0561 236.0001,-331.0561"/>
</g>
<!-- 22 -->
<g id="node23" class="node">
<title>22</title>
<text text-anchor="middle" x="277.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 15&#45;&gt;22 -->
<g id="edge22" class="edge">
<title>15&#45;&gt;22</title>
<path fill="none" stroke="#000000" d="M239.1399,-356.9748C245.6538,-349.5923 255.7762,-338.1203 263.9875,-328.8142"/>
<polygon fill="#000000" stroke="#000000" points="266.841,-330.8702 270.8329,-321.0561 261.5922,-326.2388 266.841,-330.8702"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="189.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 16&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>16&#45;&gt;17</title>
<path fill="none" stroke="#000000" d="M187.7951,-305.9748C188.061,-299.195 188.4621,-288.966 188.8085,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="192.309,-280.1856 189.2037,-270.0561 185.3144,-279.9112 192.309,-280.1856"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="192.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 17&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>17&#45;&gt;18</title>
<path fill="none" stroke="#000000" d="M189.9427,-254.9748C190.3415,-248.195 190.9432,-237.966 191.4628,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="194.9622,-229.2444 192.0555,-219.0561 187.9742,-228.8333 194.9622,-229.2444"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="192.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 18&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>18&#45;&gt;19</title>
<path fill="none" stroke="#000000" d="M192.5,-203.9748C192.5,-197.195 192.5,-186.966 192.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="196.0001,-178.0561 192.5,-168.0561 189.0001,-178.0561 196.0001,-178.0561"/>
</g>
<!-- 20 -->
<g id="node21" class="node">
<title>20</title>
<text text-anchor="middle" x="192.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">6</text>
</g>
<!-- 19&#45;&gt;20 -->
<g id="edge20" class="edge">
<title>19&#45;&gt;20</title>
<path fill="none" stroke="#000000" d="M192.5,-152.9748C192.5,-146.195 192.5,-135.966 192.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="196.0001,-127.0561 192.5,-117.0561 189.0001,-127.0561 196.0001,-127.0561"/>
</g>
<!-- 23 -->
<g id="node24" class="node">
<title>23</title>
<text text-anchor="middle" x="277.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 22&#45;&gt;23 -->
<g id="edge23" class="edge">
<title>22&#45;&gt;23</title>
<path fill="none" stroke="#000000" d="M277.5,-305.9748C277.5,-299.195 277.5,-288.966 277.5,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="281.0001,-280.0561 277.5,-270.0561 274.0001,-280.0561 281.0001,-280.0561"/>
</g>
<!-- 24 -->
<g id="node25" class="node">
<title>24</title>
<text text-anchor="middle" x="277.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 23&#45;&gt;24 -->
<g id="edge24" class="edge">
<title>23&#45;&gt;24</title>
<path fill="none" stroke="#000000" d="M277.5,-254.9748C277.5,-248.195 277.5,-237.966 277.5,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="281.0001,-229.0561 277.5,-219.0561 274.0001,-229.0561 281.0001,-229.0561"/>
</g>
<!-- 25 -->
<g id="node26" class="node">
<title>25</title>
<text text-anchor="middle" x="277.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 24&#45;&gt;25 -->
<g id="edge25" class="edge">
<title>24&#45;&gt;25</title>
<path fill="none" stroke="#000000" d="M277.5,-203.9748C277.5,-197.195 277.5,-186.966 277.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="281.0001,-178.0561 277.5,-168.0561 274.0001,-178.0561 281.0001,-178.0561"/>
</g>
<!-- 26 -->
<g id="node27" class="node">
<title>26</title>
<text text-anchor="middle" x="277.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 25&#45;&gt;26 -->
<g id="edge26" class="edge">
<title>25&#45;&gt;26</title>
<path fill="none" stroke="#000000" d="M277.5,-152.9748C277.5,-146.195 277.5,-135.966 277.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="281.0001,-127.0561 277.5,-117.0561 274.0001,-127.0561 281.0001,-127.0561"/>
</g>
<!-- 27 -->
<g id="node28" class="node">
<title>27</title>
<text text-anchor="middle" x="277.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">4</text>
</g>
<!-- 26&#45;&gt;27 -->
<g id="edge27" class="edge">
<title>26&#45;&gt;27</title>
<path fill="none" stroke="#000000" d="M277.5,-101.9748C277.5,-95.195 277.5,-84.966 277.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="281.0001,-76.0561 277.5,-66.0561 274.0001,-76.0561 281.0001,-76.0561"/>
</g>
<!-- 30 -->
<g id="node31" class="node">
<title>30</title>
<text text-anchor="middle" x="318.5" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 29&#45;&gt;30 -->
<g id="edge30" class="edge">
<title>29&#45;&gt;30</title>
<path fill="none" stroke="#000000" d="M314.2378,-407.9748C314.9025,-401.195 315.9053,-390.966 316.7713,-382.1331"/>
<polygon fill="#000000" stroke="#000000" points="320.2667,-382.3499 317.7592,-372.0561 313.3001,-381.6669 320.2667,-382.3499"/>
</g>
<!-- 31 -->
<g id="node32" class="node">
<title>31</title>
<text text-anchor="middle" x="318.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&#45;</text>
</g>
<!-- 30&#45;&gt;31 -->
<g id="edge31" class="edge">
<title>30&#45;&gt;31</title>
<path fill="none" stroke="#000000" d="M318.5,-356.9748C318.5,-350.195 318.5,-339.966 318.5,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="322.0001,-331.0561 318.5,-321.0561 315.0001,-331.0561 322.0001,-331.0561"/>
</g>
<!-- 32 -->
<g id="node33" class="node">
<title>32</title>
<text text-anchor="middle" x="363.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 30&#45;&gt;32 -->
<g id="edge32" class="edge">
<title>30&#45;&gt;32</title>
<path fill="none" stroke="#000000" d="M325.1399,-356.9748C331.6538,-349.5923 341.7762,-338.1203 349.9875,-328.8142"/>
<polygon fill="#000000" stroke="#000000" points="352.841,-330.8702 356.8329,-321.0561 347.5922,-326.2388 352.841,-330.8702"/>
</g>
<!-- 33 -->
<g id="node34" class="node">
<title>33</title>
<text text-anchor="middle" x="322.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">(</text>
</g>
<!-- 32&#45;&gt;33 -->
<g id="edge33" class="edge">
<title>32&#45;&gt;33</title>
<path fill="none" stroke="#000000" d="M357.4503,-305.9748C350.6341,-297.4961 339.4814,-283.6232 331.6104,-273.8324"/>
<polygon fill="#000000" stroke="#000000" points="334.1088,-271.3541 325.1154,-265.7533 328.6531,-275.74 334.1088,-271.3541"/>
</g>
<!-- 34 -->
<g id="node35" class="node">
<title>34</title>
<text text-anchor="middle" x="363.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 32&#45;&gt;34 -->
<g id="edge34" class="edge">
<title>32&#45;&gt;34</title>
<path fill="none" stroke="#000000" d="M363.5,-305.9748C363.5,-299.195 363.5,-288.966 363.5,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="367.0001,-280.0561 363.5,-270.0561 360.0001,-280.0561 367.0001,-280.0561"/>
</g>
<!-- 40 -->
<g id="node41" class="node">
<title>40</title>
<text text-anchor="middle" x="404.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">)</text>
</g>
<!-- 32&#45;&gt;40 -->
<g id="edge40" class="edge">
<title>32&#45;&gt;40</title>
<path fill="none" stroke="#000000" d="M369.5497,-305.9748C376.3659,-297.4961 387.5186,-283.6232 395.3896,-273.8324"/>
<polygon fill="#000000" stroke="#000000" points="398.3469,-275.74 401.8846,-265.7533 392.8912,-271.3541 398.3469,-275.74"/>
</g>
<!-- 35 -->
<g id="node36" class="node">
<title>35</title>
<text text-anchor="middle" x="363.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 34&#45;&gt;35 -->
<g id="edge35" class="edge">
<title>34&#45;&gt;35</title>
<path fill="none" stroke="#000000" d="M363.5,-254.9748C363.5,-248.195 363.5,-237.966 363.5,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="367.0001,-229.0561 363.5,-219.0561 360.0001,-229.0561 367.0001,-229.0561"/>
</g>
<!-- 36 -->
<g id="node37" class="node">
<title>36</title>
<text text-anchor="middle" x="363.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 35&#45;&gt;36 -->
<g id="edge36" class="edge">
<title>35&#45;&gt;36</title>
<path fill="none" stroke="#000000" d="M363.5,-203.9748C363.5,-197.195 363.5,-186.966 363.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="367.0001,-178.0561 363.5,-168.0561 360.0001,-178.0561 367.0001,-178.0561"/>
</g>
<!-- 37 -->
<g id="node38" class="node">
<title>37</title>
<text text-anchor="middle" x="363.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 36&#45;&gt;37 -->
<g id="edge37" class="edge">
<title>36&#45;&gt;37</title>
<path fill="none" stroke="#000000" d="M363.5,-152.9748C363.5,-146.195 363.5,-135.966 363.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="367.0001,-127.0561 363.5,-117.0561 360.0001,-127.0561 367.0001,-127.0561"/>
</g>
<!-- 38 -->
<g id="node39" class="node">
<title>38</title>
<text text-anchor="middle" x="363.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 37&#45;&gt;38 -->
<g id="edge38" class="edge">
<title>37&#45;&gt;38</title>
<path fill="none" stroke="#000000" d="M363.5,-101.9748C363.5,-95.195 363.5,-84.966 363.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="367.0001,-76.0561 363.5,-66.0561 360.0001,-76.0561 367.0001,-76.0561"/>
</g>
<!-- 39 -->
<g id="node40" class="node">
<title>39</title>
<text text-anchor="middle" x="363.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 38&#45;&gt;39 -->
<g id="edge39" class="edge">
<title>38&#45;&gt;39</title>
<path fill="none" stroke="#000000" d="M363.5,-50.9748C363.5,-44.195 363.5,-33.966 363.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="367.0001,-25.0561 363.5,-15.0561 360.0001,-25.0561 367.0001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_terminals</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;9 * 3 + 6 - 4 + -(2)&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Putting-it-all-Together">Putting it all Together<a class="anchor-link" href="#Putting-it-all-Together">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Based on this, we can now define a function <code>fuzz()</code> that – like <code>simple_grammar_fuzzer()</code> – simply takes a grammar and produces a string from it.  It thus no longer exposes the complexity of derivation trees.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">fuzz_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Create an initial derivation tree</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_tree</span><span class="p">()</span>
        <span class="c1"># print(tree)</span>

        <span class="c1"># Expand all nonterminals</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp</span><span class="p">:</span>
            <span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tree</span>

    <span class="k">def</span> <span class="nf">fuzz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derivation_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_tree</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">all_terminals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now apply this on all our defined grammars (and visualize the derivation tree along)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;6.74 + (8 * 2 - 4 + 1) * 8 - 10&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>After calling <code>fuzz()</code>, the produced derivation tree is accessible in the <code>derivation_tree</code> attribute:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display_tree</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="638pt" height="635pt"
 viewBox="0.00 0.00 637.50 635.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 631)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-631 633.5,-631 633.5,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="341" y="-615.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="341" y="-564.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M341,-611.9748C341,-605.195 341,-594.966 341,-586.1331"/>
<polygon fill="#000000" stroke="#000000" points="344.5001,-586.0561 341,-576.0561 337.5001,-586.0561 344.5001,-586.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="225" y="-513.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M323.8838,-560.9748C304.7792,-552.5753 273.6336,-538.882 251.4024,-529.1079"/>
<polygon fill="#000000" stroke="#000000" points="252.7494,-525.8769 242.1864,-525.0561 249.9321,-532.2849 252.7494,-525.8769"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="341" y="-513.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 1&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>1&#45;&gt;14</title>
<path fill="none" stroke="#000000" d="M341,-560.9748C341,-554.195 341,-543.966 341,-535.1331"/>
<polygon fill="#000000" stroke="#000000" points="344.5001,-535.0561 341,-525.0561 337.5001,-535.0561 344.5001,-535.0561"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="422" y="-513.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>1&#45;&gt;15</title>
<path fill="none" stroke="#000000" d="M352.9518,-560.9748C365.6341,-552.9897 385.9152,-540.22 401.223,-530.5818"/>
<polygon fill="#000000" stroke="#000000" points="403.4017,-533.3461 409.9991,-525.0561 399.6719,-527.4225 403.4017,-533.3461"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="116" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M208.9167,-509.9748C191.126,-501.6507 162.2229,-488.1272 141.3732,-478.3719"/>
<polygon fill="#000000" stroke="#000000" points="142.6902,-475.124 132.1493,-474.0561 139.7236,-481.4643 142.6902,-475.124"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="29" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M103.1629,-458.9748C89.4127,-450.9143 67.346,-437.9787 50.8522,-428.3099"/>
<polygon fill="#000000" stroke="#000000" points="52.2868,-425.0939 41.8898,-423.0561 48.7468,-431.1328 52.2868,-425.0939"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="92" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">.</text>
</g>
<!-- 3&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>3&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M112.4587,-458.9748C108.745,-451.0832 102.8322,-438.5185 98.3161,-428.9217"/>
<polygon fill="#000000" stroke="#000000" points="101.4273,-427.3129 94.0024,-419.7551 95.0935,-430.2936 101.4273,-427.3129"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="140" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 3&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>3&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M119.5413,-458.9748C122.8381,-451.969 127.8681,-441.2803 132.1155,-432.2547"/>
<polygon fill="#000000" stroke="#000000" points="135.353,-433.5946 136.4442,-423.0561 129.0193,-430.614 135.353,-433.5946"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="21" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M27.8196,-407.9748C26.7561,-401.195 25.1515,-390.966 23.766,-382.1331"/>
<polygon fill="#000000" stroke="#000000" points="27.1927,-381.3929 22.1853,-372.0561 20.2773,-382.4777 27.1927,-381.3929"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="21" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">6</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M21,-356.9748C21,-350.195 21,-339.966 21,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="24.5001,-331.0561 21,-321.0561 17.5001,-331.0561 24.5001,-331.0561"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="81" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M131.2943,-407.9748C122.4053,-400.291 108.391,-388.177 97.4111,-378.6859"/>
<polygon fill="#000000" stroke="#000000" points="99.5956,-375.9478 89.7414,-372.0561 95.0179,-381.2435 99.5956,-375.9478"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="148" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 8&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>8&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M141.1804,-407.9748C142.2439,-401.195 143.8485,-390.966 145.234,-382.1331"/>
<polygon fill="#000000" stroke="#000000" points="148.7227,-382.4777 146.8147,-372.0561 141.8073,-381.3929 148.7227,-382.4777"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="81" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">7</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M81,-356.9748C81,-350.195 81,-339.966 81,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="84.5001,-331.0561 81,-321.0561 77.5001,-331.0561 84.5001,-331.0561"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="136" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>11&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M146.2294,-356.9748C144.6164,-350.1196 142.1737,-339.7383 140.0798,-330.8392"/>
<polygon fill="#000000" stroke="#000000" points="143.4753,-329.9886 137.7779,-321.0561 136.6614,-331.5919 143.4753,-329.9886"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="118" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">4</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12&#45;&gt;13</title>
<path fill="none" stroke="#000000" d="M133.344,-305.9748C130.898,-299.0443 127.1799,-288.5097 124.0164,-279.5464"/>
<polygon fill="#000000" stroke="#000000" points="127.2956,-278.3211 120.6669,-270.0561 120.6947,-280.6509 127.2956,-278.3211"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="400" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15&#45;&gt;16</title>
<path fill="none" stroke="#000000" d="M418.7538,-509.9748C415.7317,-502.969 411.1209,-492.2803 407.2275,-483.2547"/>
<polygon fill="#000000" stroke="#000000" points="410.4342,-481.8519 403.2595,-474.0561 404.0067,-484.6246 410.4342,-481.8519"/>
</g>
<!-- 52 -->
<g id="node53" class="node">
<title>52</title>
<text text-anchor="middle" x="445" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#000000"> &#45; </text>
</g>
<!-- 15&#45;&gt;52 -->
<g id="edge52" class="edge">
<title>15&#45;&gt;52</title>
<path fill="none" stroke="#000000" d="M425.3937,-509.9748C428.5532,-502.969 433.3736,-492.2803 437.444,-483.2547"/>
<polygon fill="#000000" stroke="#000000" points="440.6718,-484.6109 441.5923,-474.0561 434.2907,-481.7331 440.6718,-484.6109"/>
</g>
<!-- 53 -->
<g id="node54" class="node">
<title>53</title>
<text text-anchor="middle" x="498" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 15&#45;&gt;53 -->
<g id="edge53" class="edge">
<title>15&#45;&gt;53</title>
<path fill="none" stroke="#000000" d="M433.2141,-509.9748C445.0012,-502.065 463.7843,-489.4606 478.0978,-479.8554"/>
<polygon fill="#000000" stroke="#000000" points="480.3865,-482.5346 486.7399,-474.0561 476.486,-476.722 480.3865,-482.5346"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="330" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 16&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>16&#45;&gt;17</title>
<path fill="none" stroke="#000000" d="M389.6713,-458.9748C378.9181,-451.1403 361.8434,-438.7002 348.7088,-429.1307"/>
<polygon fill="#000000" stroke="#000000" points="350.5145,-426.1159 340.3711,-423.0561 346.3925,-431.7736 350.5145,-426.1159"/>
</g>
<!-- 46 -->
<g id="node47" class="node">
<title>46</title>
<text text-anchor="middle" x="400" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000"> * </text>
</g>
<!-- 16&#45;&gt;46 -->
<g id="edge46" class="edge">
<title>16&#45;&gt;46</title>
<path fill="none" stroke="#000000" d="M400,-458.9748C400,-452.195 400,-441.966 400,-433.1331"/>
<polygon fill="#000000" stroke="#000000" points="403.5001,-433.0561 400,-423.0561 396.5001,-433.0561 403.5001,-433.0561"/>
</g>
<!-- 47 -->
<g id="node48" class="node">
<title>47</title>
<text text-anchor="middle" x="457" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 16&#45;&gt;47 -->
<g id="edge47" class="edge">
<title>16&#45;&gt;47</title>
<path fill="none" stroke="#000000" d="M408.4105,-458.9748C416.9141,-451.3663 430.2725,-439.4141 440.8323,-429.9658"/>
<polygon fill="#000000" stroke="#000000" points="443.4363,-432.3324 448.5549,-423.0561 438.7687,-427.1157 443.4363,-432.3324"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="288" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">(</text>
</g>
<!-- 17&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>17&#45;&gt;18</title>
<path fill="none" stroke="#000000" d="M323.8028,-407.9748C316.7476,-399.4078 305.1571,-385.3336 297.0817,-375.5278"/>
<polygon fill="#000000" stroke="#000000" points="299.738,-373.2476 290.6791,-367.7533 294.3345,-377.6976 299.738,-373.2476"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="329" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 17&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>17&#45;&gt;19</title>
<path fill="none" stroke="#000000" d="M329.8524,-407.9748C329.7195,-401.195 329.5189,-390.966 329.3457,-382.1331"/>
<polygon fill="#000000" stroke="#000000" points="332.8436,-381.9855 329.1482,-372.0561 325.845,-382.1228 332.8436,-381.9855"/>
</g>
<!-- 45 -->
<g id="node46" class="node">
<title>45</title>
<text text-anchor="middle" x="370" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">)</text>
</g>
<!-- 17&#45;&gt;45 -->
<g id="edge45" class="edge">
<title>17&#45;&gt;45</title>
<path fill="none" stroke="#000000" d="M335.9021,-407.9748C342.5521,-399.4961 353.4328,-385.6232 361.1118,-375.8324"/>
<polygon fill="#000000" stroke="#000000" points="364.031,-377.7818 367.4484,-367.7533 358.523,-373.4618 364.031,-377.7818"/>
</g>
<!-- 20 -->
<g id="node21" class="node">
<title>20</title>
<text text-anchor="middle" x="238" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 19&#45;&gt;20 -->
<g id="edge20" class="edge">
<title>19&#45;&gt;20</title>
<path fill="none" stroke="#000000" d="M315.5726,-356.9748C301.0559,-348.839 277.6768,-335.7365 260.3747,-326.0397"/>
<polygon fill="#000000" stroke="#000000" points="261.917,-322.8919 251.4825,-321.0561 258.4947,-328.9983 261.917,-322.8919"/>
</g>
<!-- 31 -->
<g id="node32" class="node">
<title>31</title>
<text text-anchor="middle" x="324" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000"> &#45; </text>
</g>
<!-- 19&#45;&gt;31 -->
<g id="edge31" class="edge">
<title>19&#45;&gt;31</title>
<path fill="none" stroke="#000000" d="M328.2622,-356.9748C327.5975,-350.195 326.5947,-339.966 325.7287,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="329.1999,-330.6669 324.7408,-321.0561 322.2333,-331.3499 329.1999,-330.6669"/>
</g>
<!-- 32 -->
<g id="node33" class="node">
<title>32</title>
<text text-anchor="middle" x="369" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 19&#45;&gt;32 -->
<g id="edge32" class="edge">
<title>19&#45;&gt;32</title>
<path fill="none" stroke="#000000" d="M334.9021,-356.9748C340.6332,-349.6677 349.5067,-338.354 356.7649,-329.0997"/>
<polygon fill="#000000" stroke="#000000" points="359.6562,-331.0847 363.0736,-321.0561 354.1482,-326.7647 359.6562,-331.0847"/>
</g>
<!-- 21 -->
<g id="node22" class="node">
<title>21</title>
<text text-anchor="middle" x="165" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 20&#45;&gt;21 -->
<g id="edge21" class="edge">
<title>20&#45;&gt;21</title>
<path fill="none" stroke="#000000" d="M227.2286,-305.9748C215.9068,-298.065 197.8651,-285.4606 184.1166,-275.8554"/>
<polygon fill="#000000" stroke="#000000" points="186.0177,-272.9141 175.8156,-270.0561 182.0087,-278.6524 186.0177,-272.9141"/>
</g>
<!-- 25 -->
<g id="node26" class="node">
<title>25</title>
<text text-anchor="middle" x="215" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000"> * </text>
</g>
<!-- 20&#45;&gt;25 -->
<g id="edge25" class="edge">
<title>20&#45;&gt;25</title>
<path fill="none" stroke="#000000" d="M234.6063,-305.9748C231.4468,-298.969 226.6264,-288.2803 222.556,-279.2547"/>
<polygon fill="#000000" stroke="#000000" points="225.7093,-277.7331 218.4077,-270.0561 219.3282,-280.6109 225.7093,-277.7331"/>
</g>
<!-- 26 -->
<g id="node27" class="node">
<title>26</title>
<text text-anchor="middle" x="262" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 20&#45;&gt;26 -->
<g id="edge26" class="edge">
<title>20&#45;&gt;26</title>
<path fill="none" stroke="#000000" d="M241.5413,-305.9748C244.8381,-298.969 249.8681,-288.2803 254.1155,-279.2547"/>
<polygon fill="#000000" stroke="#000000" points="257.353,-280.5946 258.4442,-270.0561 251.0193,-277.614 257.353,-280.5946"/>
</g>
<!-- 22 -->
<g id="node23" class="node">
<title>22</title>
<text text-anchor="middle" x="165" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 21&#45;&gt;22 -->
<g id="edge22" class="edge">
<title>21&#45;&gt;22</title>
<path fill="none" stroke="#000000" d="M165,-254.9748C165,-248.195 165,-237.966 165,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="168.5001,-229.0561 165,-219.0561 161.5001,-229.0561 168.5001,-229.0561"/>
</g>
<!-- 23 -->
<g id="node24" class="node">
<title>23</title>
<text text-anchor="middle" x="165" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 22&#45;&gt;23 -->
<g id="edge23" class="edge">
<title>22&#45;&gt;23</title>
<path fill="none" stroke="#000000" d="M165,-203.9748C165,-197.195 165,-186.966 165,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="168.5001,-178.0561 165,-168.0561 161.5001,-178.0561 168.5001,-178.0561"/>
</g>
<!-- 24 -->
<g id="node25" class="node">
<title>24</title>
<text text-anchor="middle" x="165" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">8</text>
</g>
<!-- 23&#45;&gt;24 -->
<g id="edge24" class="edge">
<title>23&#45;&gt;24</title>
<path fill="none" stroke="#000000" d="M165,-152.9748C165,-146.195 165,-135.966 165,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="168.5001,-127.0561 165,-117.0561 161.5001,-127.0561 168.5001,-127.0561"/>
</g>
<!-- 27 -->
<g id="node28" class="node">
<title>27</title>
<text text-anchor="middle" x="258" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 26&#45;&gt;27 -->
<g id="edge27" class="edge">
<title>26&#45;&gt;27</title>
<path fill="none" stroke="#000000" d="M261.4098,-254.9748C260.878,-248.195 260.0758,-237.966 259.383,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="262.8639,-228.7518 258.5926,-219.0561 255.8854,-229.2992 262.8639,-228.7518"/>
</g>
<!-- 28 -->
<g id="node29" class="node">
<title>28</title>
<text text-anchor="middle" x="255" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 27&#45;&gt;28 -->
<g id="edge28" class="edge">
<title>27&#45;&gt;28</title>
<path fill="none" stroke="#000000" d="M257.5573,-203.9748C257.1585,-197.195 256.5568,-186.966 256.0372,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="259.5258,-177.8333 255.4445,-168.0561 252.5378,-178.2444 259.5258,-177.8333"/>
</g>
<!-- 29 -->
<g id="node30" class="node">
<title>29</title>
<text text-anchor="middle" x="255" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 28&#45;&gt;29 -->
<g id="edge29" class="edge">
<title>28&#45;&gt;29</title>
<path fill="none" stroke="#000000" d="M255,-152.9748C255,-146.195 255,-135.966 255,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="258.5001,-127.0561 255,-117.0561 251.5001,-127.0561 258.5001,-127.0561"/>
</g>
<!-- 30 -->
<g id="node31" class="node">
<title>30</title>
<text text-anchor="middle" x="255" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 29&#45;&gt;30 -->
<g id="edge30" class="edge">
<title>29&#45;&gt;30</title>
<path fill="none" stroke="#000000" d="M255,-101.9748C255,-95.195 255,-84.966 255,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="258.5001,-76.0561 255,-66.0561 251.5001,-76.0561 258.5001,-76.0561"/>
</g>
<!-- 33 -->
<g id="node34" class="node">
<title>33</title>
<text text-anchor="middle" x="322" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 32&#45;&gt;33 -->
<g id="edge33" class="edge">
<title>32&#45;&gt;33</title>
<path fill="none" stroke="#000000" d="M362.065,-305.9748C355.1921,-298.517 344.4731,-286.8857 335.8512,-277.53"/>
<polygon fill="#000000" stroke="#000000" points="338.3141,-275.0378 328.9635,-270.0561 333.1666,-279.7816 338.3141,-275.0378"/>
</g>
<!-- 38 -->
<g id="node39" class="node">
<title>38</title>
<text text-anchor="middle" x="369" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 32&#45;&gt;38 -->
<g id="edge38" class="edge">
<title>32&#45;&gt;38</title>
<path fill="none" stroke="#000000" d="M369,-305.9748C369,-299.195 369,-288.966 369,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="372.5001,-280.0561 369,-270.0561 365.5001,-280.0561 372.5001,-280.0561"/>
</g>
<!-- 39 -->
<g id="node40" class="node">
<title>39</title>
<text text-anchor="middle" x="415" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 32&#45;&gt;39 -->
<g id="edge39" class="edge">
<title>32&#45;&gt;39</title>
<path fill="none" stroke="#000000" d="M375.7875,-305.9748C382.5141,-298.517 393.005,-286.8857 401.4436,-277.53"/>
<polygon fill="#000000" stroke="#000000" points="404.086,-279.826 408.1847,-270.0561 398.888,-275.1376 404.086,-279.826"/>
</g>
<!-- 34 -->
<g id="node35" class="node">
<title>34</title>
<text text-anchor="middle" x="326" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 33&#45;&gt;34 -->
<g id="edge34" class="edge">
<title>33&#45;&gt;34</title>
<path fill="none" stroke="#000000" d="M322.5902,-254.9748C323.122,-248.195 323.9242,-237.966 324.617,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="328.1146,-229.2992 325.4074,-219.0561 321.1361,-228.7518 328.1146,-229.2992"/>
</g>
<!-- 35 -->
<g id="node36" class="node">
<title>35</title>
<text text-anchor="middle" x="328" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 34&#45;&gt;35 -->
<g id="edge35" class="edge">
<title>34&#45;&gt;35</title>
<path fill="none" stroke="#000000" d="M326.2951,-203.9748C326.561,-197.195 326.9621,-186.966 327.3085,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="330.809,-178.1856 327.7037,-168.0561 323.8144,-177.9112 330.809,-178.1856"/>
</g>
<!-- 36 -->
<g id="node37" class="node">
<title>36</title>
<text text-anchor="middle" x="328" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 35&#45;&gt;36 -->
<g id="edge36" class="edge">
<title>35&#45;&gt;36</title>
<path fill="none" stroke="#000000" d="M328,-152.9748C328,-146.195 328,-135.966 328,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="331.5001,-127.0561 328,-117.0561 324.5001,-127.0561 331.5001,-127.0561"/>
</g>
<!-- 37 -->
<g id="node38" class="node">
<title>37</title>
<text text-anchor="middle" x="328" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">4</text>
</g>
<!-- 36&#45;&gt;37 -->
<g id="edge37" class="edge">
<title>36&#45;&gt;37</title>
<path fill="none" stroke="#000000" d="M328,-101.9748C328,-95.195 328,-84.966 328,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="331.5001,-76.0561 328,-66.0561 324.5001,-76.0561 331.5001,-76.0561"/>
</g>
<!-- 40 -->
<g id="node41" class="node">
<title>40</title>
<text text-anchor="middle" x="415" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 39&#45;&gt;40 -->
<g id="edge40" class="edge">
<title>39&#45;&gt;40</title>
<path fill="none" stroke="#000000" d="M415,-254.9748C415,-248.195 415,-237.966 415,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="418.5001,-229.0561 415,-219.0561 411.5001,-229.0561 418.5001,-229.0561"/>
</g>
<!-- 41 -->
<g id="node42" class="node">
<title>41</title>
<text text-anchor="middle" x="415" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 40&#45;&gt;41 -->
<g id="edge41" class="edge">
<title>40&#45;&gt;41</title>
<path fill="none" stroke="#000000" d="M415,-203.9748C415,-197.195 415,-186.966 415,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="418.5001,-178.0561 415,-168.0561 411.5001,-178.0561 418.5001,-178.0561"/>
</g>
<!-- 42 -->
<g id="node43" class="node">
<title>42</title>
<text text-anchor="middle" x="415" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 41&#45;&gt;42 -->
<g id="edge42" class="edge">
<title>41&#45;&gt;42</title>
<path fill="none" stroke="#000000" d="M415,-152.9748C415,-146.195 415,-135.966 415,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="418.5001,-127.0561 415,-117.0561 411.5001,-127.0561 418.5001,-127.0561"/>
</g>
<!-- 43 -->
<g id="node44" class="node">
<title>43</title>
<text text-anchor="middle" x="415" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 42&#45;&gt;43 -->
<g id="edge43" class="edge">
<title>42&#45;&gt;43</title>
<path fill="none" stroke="#000000" d="M415,-101.9748C415,-95.195 415,-84.966 415,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="418.5001,-76.0561 415,-66.0561 411.5001,-76.0561 418.5001,-76.0561"/>
</g>
<!-- 44 -->
<g id="node45" class="node">
<title>44</title>
<text text-anchor="middle" x="415" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">1</text>
</g>
<!-- 43&#45;&gt;44 -->
<g id="edge44" class="edge">
<title>43&#45;&gt;44</title>
<path fill="none" stroke="#000000" d="M415,-50.9748C415,-44.195 415,-33.966 415,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="418.5001,-25.0561 415,-15.0561 411.5001,-25.0561 418.5001,-25.0561"/>
</g>
<!-- 48 -->
<g id="node49" class="node">
<title>48</title>
<text text-anchor="middle" x="458" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 47&#45;&gt;48 -->
<g id="edge48" class="edge">
<title>47&#45;&gt;48</title>
<path fill="none" stroke="#000000" d="M457.1476,-407.9748C457.2805,-401.195 457.4811,-390.966 457.6543,-382.1331"/>
<polygon fill="#000000" stroke="#000000" points="461.155,-382.1228 457.8518,-372.0561 454.1564,-381.9855 461.155,-382.1228"/>
</g>
<!-- 49 -->
<g id="node50" class="node">
<title>49</title>
<text text-anchor="middle" x="459" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 48&#45;&gt;49 -->
<g id="edge49" class="edge">
<title>48&#45;&gt;49</title>
<path fill="none" stroke="#000000" d="M458.1476,-356.9748C458.2805,-350.195 458.4811,-339.966 458.6543,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="462.155,-331.1228 458.8518,-321.0561 455.1564,-330.9855 462.155,-331.1228"/>
</g>
<!-- 50 -->
<g id="node51" class="node">
<title>50</title>
<text text-anchor="middle" x="475" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 49&#45;&gt;50 -->
<g id="edge50" class="edge">
<title>49&#45;&gt;50</title>
<path fill="none" stroke="#000000" d="M461.3609,-305.9748C463.5115,-299.1196 466.7684,-288.7383 469.5602,-279.8392"/>
<polygon fill="#000000" stroke="#000000" points="472.9755,-280.6453 472.6295,-270.0561 466.2965,-278.5499 472.9755,-280.6453"/>
</g>
<!-- 51 -->
<g id="node52" class="node">
<title>51</title>
<text text-anchor="middle" x="475" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">8</text>
</g>
<!-- 50&#45;&gt;51 -->
<g id="edge51" class="edge">
<title>50&#45;&gt;51</title>
<path fill="none" stroke="#000000" d="M475,-254.9748C475,-248.195 475,-237.966 475,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="478.5001,-229.0561 475,-219.0561 471.5001,-229.0561 478.5001,-229.0561"/>
</g>
<!-- 54 -->
<g id="node55" class="node">
<title>54</title>
<text text-anchor="middle" x="529" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 53&#45;&gt;54 -->
<g id="edge54" class="edge">
<title>53&#45;&gt;54</title>
<path fill="none" stroke="#000000" d="M502.5742,-458.9748C506.9242,-451.8183 513.6101,-440.8188 519.1683,-431.6747"/>
<polygon fill="#000000" stroke="#000000" points="522.2037,-433.4193 524.4071,-423.0561 516.222,-429.7834 522.2037,-433.4193"/>
</g>
<!-- 55 -->
<g id="node56" class="node">
<title>55</title>
<text text-anchor="middle" x="532" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 54&#45;&gt;55 -->
<g id="edge55" class="edge">
<title>54&#45;&gt;55</title>
<path fill="none" stroke="#000000" d="M529.4427,-407.9748C529.8415,-401.195 530.4432,-390.966 530.9628,-382.1331"/>
<polygon fill="#000000" stroke="#000000" points="534.4622,-382.2444 531.5555,-372.0561 527.4742,-381.8333 534.4622,-382.2444"/>
</g>
<!-- 56 -->
<g id="node57" class="node">
<title>56</title>
<text text-anchor="middle" x="535" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 55&#45;&gt;56 -->
<g id="edge56" class="edge">
<title>55&#45;&gt;56</title>
<path fill="none" stroke="#000000" d="M532.4427,-356.9748C532.8415,-350.195 533.4432,-339.966 533.9628,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="537.4622,-331.2444 534.5555,-321.0561 530.4742,-330.8333 537.4622,-331.2444"/>
</g>
<!-- 57 -->
<g id="node58" class="node">
<title>57</title>
<text text-anchor="middle" x="535" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 56&#45;&gt;57 -->
<g id="edge57" class="edge">
<title>56&#45;&gt;57</title>
<path fill="none" stroke="#000000" d="M535,-305.9748C535,-299.195 535,-288.966 535,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="538.5001,-280.0561 535,-270.0561 531.5001,-280.0561 538.5001,-280.0561"/>
</g>
<!-- 59 -->
<g id="node60" class="node">
<title>59</title>
<text text-anchor="middle" x="602" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 56&#45;&gt;59 -->
<g id="edge59" class="edge">
<title>56&#45;&gt;59</title>
<path fill="none" stroke="#000000" d="M544.8861,-305.9748C555.1784,-298.1403 571.5213,-285.7002 584.093,-276.1307"/>
<polygon fill="#000000" stroke="#000000" points="586.2362,-278.898 592.0734,-270.0561 581.9964,-273.328 586.2362,-278.898"/>
</g>
<!-- 58 -->
<g id="node59" class="node">
<title>58</title>
<text text-anchor="middle" x="535" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">1</text>
</g>
<!-- 57&#45;&gt;58 -->
<g id="edge58" class="edge">
<title>57&#45;&gt;58</title>
<path fill="none" stroke="#000000" d="M535,-254.9748C535,-248.195 535,-237.966 535,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="538.5001,-229.0561 535,-219.0561 531.5001,-229.0561 538.5001,-229.0561"/>
</g>
<!-- 60 -->
<g id="node61" class="node">
<title>60</title>
<text text-anchor="middle" x="602" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 59&#45;&gt;60 -->
<g id="edge60" class="edge">
<title>59&#45;&gt;60</title>
<path fill="none" stroke="#000000" d="M602,-254.9748C602,-248.195 602,-237.966 602,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="605.5001,-229.0561 602,-219.0561 598.5001,-229.0561 605.5001,-229.0561"/>
</g>
<!-- 61 -->
<g id="node62" class="node">
<title>61</title>
<text text-anchor="middle" x="602" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">0</text>
</g>
<!-- 60&#45;&gt;61 -->
<g id="edge61" class="edge">
<title>60&#45;&gt;61</title>
<path fill="none" stroke="#000000" d="M602,-203.9748C602,-197.195 602,-186.966 602,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="605.5001,-178.0561 602,-168.0561 598.5001,-178.0561 605.5001,-178.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us try out the grammar fuzzer (and its trees) on other grammar formats.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">URL_GRAMMAR</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;https://fuzzingbook.com:80/?def=abc&#39;
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display_tree</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="367pt" height="329pt"
 viewBox="0.00 0.00 366.50 329.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 325)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-325 362.5,-325 362.5,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="140" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="140" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;url&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M140,-305.9748C140,-299.195 140,-288.966 140,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="143.5001,-280.0561 140,-270.0561 136.5001,-280.0561 143.5001,-280.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="29" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;scheme&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M123.6216,-254.9748C105.4224,-246.613 75.8044,-233.0047 54.551,-223.2397"/>
<polygon fill="#000000" stroke="#000000" points="55.9937,-220.0508 45.4456,-219.0561 53.0711,-226.4115 55.9937,-220.0508"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="82" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">://</text>
</g>
<!-- 1&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>1&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M131.4419,-254.9748C122.093,-246.7542 106.9771,-233.4626 95.917,-223.7374"/>
<polygon fill="#000000" stroke="#000000" points="97.9251,-220.8425 88.1042,-216.8675 93.3028,-226.0993 97.9251,-220.8425"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="140" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;authority&gt;</text>
</g>
<!-- 1&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>1&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M140,-254.9748C140,-248.195 140,-237.966 140,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="143.5001,-229.0561 140,-219.0561 136.5001,-229.0561 143.5001,-229.0561"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="212" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;path&gt;</text>
</g>
<!-- 1&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>1&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M150.6238,-254.9748C161.7906,-247.065 179.5851,-234.4606 193.1453,-224.8554"/>
<polygon fill="#000000" stroke="#000000" points="195.1954,-227.6924 201.3326,-219.0561 191.1492,-221.9802 195.1954,-227.6924"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="274" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;query&gt;</text>
</g>
<!-- 1&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>1&#45;&gt;13</title>
<path fill="none" stroke="#000000" d="M156.1635,-256.3482C177.986,-248.0426 217.2634,-233.0938 244.4386,-222.751"/>
<polygon fill="#000000" stroke="#000000" points="245.7472,-225.9979 253.8482,-219.1697 243.2572,-219.4557 245.7472,-225.9979"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="29" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">https</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M29,-203.9748C29,-197.195 29,-186.966 29,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="32.5001,-178.0561 29,-168.0561 25.5001,-178.0561 32.5001,-178.0561"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="96" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;host&gt;</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M133.5076,-203.9748C127.1385,-196.5923 117.241,-185.1203 109.2122,-175.8142"/>
<polygon fill="#000000" stroke="#000000" points="111.7014,-173.3414 102.519,-168.0561 106.4013,-177.914 111.7014,-173.3414"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="136" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">:</text>
</g>
<!-- 5&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>5&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M139.4098,-203.9748C138.878,-197.195 138.0758,-186.966 137.383,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="140.8639,-177.7518 136.5926,-168.0561 133.8854,-178.2992 140.8639,-177.7518"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="176" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;port&gt;</text>
</g>
<!-- 5&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>5&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M145.3119,-203.9748C150.4167,-196.743 158.2916,-185.5868 164.7859,-176.3866"/>
<polygon fill="#000000" stroke="#000000" points="167.7588,-178.2442 170.6663,-168.0561 162.04,-174.2074 167.7588,-178.2442"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="96" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">fuzzingbook.com</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M96,-152.9748C96,-146.195 96,-135.966 96,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="99.5001,-127.0561 96,-117.0561 92.5001,-127.0561 99.5001,-127.0561"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="176" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">80</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M176,-152.9748C176,-146.195 176,-135.966 176,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="179.5001,-127.0561 176,-117.0561 172.5001,-127.0561 179.5001,-127.0561"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="216" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">/</text>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>11&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M212.5902,-203.9748C213.122,-197.195 213.9242,-186.966 214.617,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="218.1146,-178.2992 215.4074,-168.0561 211.1361,-177.7518 218.1146,-178.2992"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="259" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">?</text>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13&#45;&gt;14</title>
<path fill="none" stroke="#000000" d="M271.7867,-203.9748C269.7705,-197.1196 266.7171,-186.7383 264.0998,-177.8392"/>
<polygon fill="#000000" stroke="#000000" points="267.4019,-176.6622 261.2224,-168.0561 260.6863,-178.6374 267.4019,-176.6622"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="309" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;params&gt;</text>
</g>
<!-- 13&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>13&#45;&gt;15</title>
<path fill="none" stroke="#000000" d="M279.1644,-203.9748C284.1274,-196.743 291.7835,-185.5868 298.0974,-176.3866"/>
<polygon fill="#000000" stroke="#000000" points="301.0418,-178.2817 303.8144,-168.0561 295.2702,-174.3208 301.0418,-178.2817"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="309" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;param&gt;</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15&#45;&gt;16</title>
<path fill="none" stroke="#000000" d="M309,-152.9748C309,-146.195 309,-135.966 309,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="312.5001,-127.0561 309,-117.0561 305.5001,-127.0561 312.5001,-127.0561"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="273" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;id&gt;</text>
</g>
<!-- 16&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>16&#45;&gt;17</title>
<path fill="none" stroke="#000000" d="M303.6881,-101.9748C298.5833,-94.743 290.7084,-83.5868 284.2141,-74.3866"/>
<polygon fill="#000000" stroke="#000000" points="286.96,-72.2074 278.3337,-66.0561 281.2412,-76.2442 286.96,-72.2074"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="309" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">=</text>
</g>
<!-- 16&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>16&#45;&gt;19</title>
<path fill="none" stroke="#000000" d="M309,-101.9748C309,-95.195 309,-84.966 309,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="312.5001,-76.0561 309,-66.0561 305.5001,-76.0561 312.5001,-76.0561"/>
</g>
<!-- 20 -->
<g id="node21" class="node">
<title>20</title>
<text text-anchor="middle" x="345" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;id&gt;</text>
</g>
<!-- 16&#45;&gt;20 -->
<g id="edge20" class="edge">
<title>16&#45;&gt;20</title>
<path fill="none" stroke="#000000" d="M314.3119,-101.9748C319.4167,-94.743 327.2916,-83.5868 333.7859,-74.3866"/>
<polygon fill="#000000" stroke="#000000" points="336.7588,-76.2442 339.6663,-66.0561 331.04,-72.2074 336.7588,-76.2442"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="273" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">def</text>
</g>
<!-- 17&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>17&#45;&gt;18</title>
<path fill="none" stroke="#000000" d="M273,-50.9748C273,-44.195 273,-33.966 273,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="276.5001,-25.0561 273,-15.0561 269.5001,-25.0561 276.5001,-25.0561"/>
</g>
<!-- 21 -->
<g id="node22" class="node">
<title>21</title>
<text text-anchor="middle" x="345" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">abc</text>
</g>
<!-- 20&#45;&gt;21 -->
<g id="edge21" class="edge">
<title>20&#45;&gt;21</title>
<path fill="none" stroke="#000000" d="M345,-50.9748C345,-44.195 345,-33.966 345,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="348.5001,-25.0561 345,-15.0561 341.5001,-25.0561 348.5001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">CGI_GRAMMAR</span><span class="p">,</span> <span class="n">min_nonterminals</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;%27+&#39;
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display_tree</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="238pt" height="278pt"
 viewBox="0.00 0.00 238.00 278.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 274)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-274 234,-274 234,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="135" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="135" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;string&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M135,-254.9748C135,-248.195 135,-237.966 135,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="138.5001,-229.0561 135,-219.0561 131.5001,-229.0561 138.5001,-229.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="103" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;letter&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M130.2783,-203.9748C125.788,-196.8183 118.8863,-185.8188 113.1488,-176.6747"/>
<polygon fill="#000000" stroke="#000000" points="116.0208,-174.6665 107.7411,-168.0561 110.0913,-178.387 116.0208,-174.6665"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="169" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;string&gt;</text>
</g>
<!-- 1&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>1&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M140.0168,-203.9748C144.838,-196.743 152.2754,-185.5868 158.4089,-176.3866"/>
<polygon fill="#000000" stroke="#000000" points="161.3277,-178.3181 163.9626,-168.0561 155.5034,-174.4352 161.3277,-178.3181"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="101" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;percent&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M102.7049,-152.9748C102.439,-146.195 102.0379,-135.966 101.6915,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="105.1856,-126.9112 101.2963,-117.0561 98.191,-127.1856 105.1856,-126.9112"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="6" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">%</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M86.9824,-101.9748C69.2969,-92.4804 39.0118,-76.2221 20.9129,-66.5059"/>
<polygon fill="#000000" stroke="#000000" points="22.5261,-63.3995 12.06,-61.7533 19.2152,-69.567 22.5261,-63.3995"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="61" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;hexdigit&gt;</text>
</g>
<!-- 3&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>3&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M95.0979,-101.9748C89.3668,-94.6677 80.4933,-83.354 73.2351,-74.0997"/>
<polygon fill="#000000" stroke="#000000" points="75.8518,-71.7647 66.9264,-66.0561 70.3438,-76.0847 75.8518,-71.7647"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="141" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;hexdigit&gt;</text>
</g>
<!-- 3&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>3&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M106.9021,-101.9748C112.6332,-94.6677 121.5067,-83.354 128.7649,-74.0997"/>
<polygon fill="#000000" stroke="#000000" points="131.6562,-76.0847 135.0736,-66.0561 126.1482,-71.7647 131.6562,-76.0847"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="61" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M61,-50.9748C61,-44.195 61,-33.966 61,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="64.5001,-25.0561 61,-15.0561 57.5001,-25.0561 64.5001,-25.0561"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="141" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">7</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M141,-50.9748C141,-44.195 141,-33.966 141,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="144.5001,-25.0561 141,-15.0561 137.5001,-25.0561 144.5001,-25.0561"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="190" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;letter&gt;</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M172.0986,-152.9748C174.9523,-146.0443 179.2901,-135.5097 182.9809,-126.5464"/>
<polygon fill="#000000" stroke="#000000" points="186.3175,-127.6355 186.8887,-117.0561 179.8447,-124.9702 186.3175,-127.6355"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="210" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;plus&gt;</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M192.9511,-101.9748C195.6689,-95.0443 199.8001,-84.5097 203.3151,-75.5464"/>
<polygon fill="#000000" stroke="#000000" points="206.6443,-76.6437 207.0368,-66.0561 200.1275,-74.088 206.6443,-76.6437"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="210" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>11&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M210,-50.9748C210,-44.195 210,-33.966 210,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="213.5001,-25.0561 210,-15.0561 206.5001,-25.0561 213.5001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>How do we stack up against <code>simple_grammar_fuzzer()</code>?</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trials</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">xs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
    <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">average_time</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span> <span class="o">/</span> <span class="n">trials</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average time:&quot;</span><span class="p">,</span> <span class="n">average_time</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Average time: 0.1186443681200035
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/matplotlib.pyplot.html" class="import" target="_blank">matplotlib.pyplot</a></span> <span class="k">as</span> <span class="nn"><a href="https://docs.python.org/3/library/plt.html" class="import" target="_blank">plt</a></span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Time required for generating an output&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>Text(0.5,1,&#39;Time required for generating an output&#39;)
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXcAAAEICAYAAACktLTqAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADl0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uIDIuMi4zLCBodHRwOi8vbWF0cGxvdGxpYi5vcmcvIxREBQAAG+5JREFUeJzt3X+cXXV95/HXm8kAA7IMQlrJJIHYYhRFDE4hKz4UV20AlUQK5UdZ0bKmtmW3PqrZTaqtkWJBs7pbV7YULcsPWRAwxqjY1C2wbhWQScOvBEcjApkJQgQGlYwwCZ/945ybnLm5d+bcmTtzZ77zfj4e88jcc8859/O9Z/Ke73zP95yriMDMzNKyX6sLMDOz5nO4m5klyOFuZpYgh7uZWYIc7mZmCXK4m5klyOE+gST9haQvtbqOZmt2uyStlvTlEZ7/Y0lPSvqVpMOb9brTkaQrJf1lq+uwqU+e5z52kn5VeHgQ8AKwO3/8RxFxw+RXNf1IWg38dkRcUOO5duAXwOKIuH+ya2slSe8H/kNEvLnVtUwWSacAX46IuVNxf9PJrFYXMJ1FxMsq30t6lOw/4v9pXUV7apkVEbsSee3fBA4ENo+hFpF1YF5qYj1N0cpjZDODh2UmUHG4QdLRkkLSByRtk/SspA9J+h1JD0gakPSFqu3/UNLD+bobJB1V53Uq+75I0uPA7fnyxZK+n+/7/rwXU9lmgaT/K+mXkr4j6QuFWk+R1Ff1Go9KescI7RrzawNH1GnXq4De/OGApMq+3yTpXknP5f++qbDNnZI+Jel7wE7glTX2e4KkTfnr3yLpK5IuLTz/bkn35bV/X9Lrq96Hj+bH7Ll82wMb2Pa/SHoAeF7SLEkrJf0kr2WLpPfm674GuBL4t/lw1EC+/JpKrZXjJOkjkp6S9ISkDxRe73BJ35D0i/x9ulTSv9R6r/P1b5H0s7xd35X02sJz10i6QtK38lrvkfRbI+zrDEmb8/fhzrw9ledC0m9X7ftSSQcD3wbm5G3+laQ5+c/brfl7/UtJ/yrp+LHur17NyYkIfzXhC3gUeEfVstVkfxICHA0E2X/YA4HfBX4NrAN+A+gCngLemq+/DNgKvIbsL6yPA9+v89qVfV8HHAx05Pt7Gjid7Jf4O/PHs/Nt7gI+BxwAvAX4ZaHWU4C+eu2r066mvPYIbZuVP3458Czw7/P35bz88eH583cCjwOvzZ9vr9rf/sBjwJ8B7cCZwIvApfnzJ+TH4SSgDbgwb/sBhffhB8CcvJaHgQ81sO19wDygI192dr6v/YBzgOeBI/Pn3g/8S1X91xRqPQXYBVySt+V0sl9oh+XP35R/HQQcC2yr3l/Vvv8QOCQ/Lv8duK/qdZ8BTszf1xuAm+rs51V5O96Z1/WfyX6W98+fD7JhuHptqv7ZWw0MAWfl+/so8NPKsW10fzPlyz33yffXEfHriPgnsv8AN0bEUxHRD/w/YFG+3h8Bl0XEw5H9+f43wBtUp/eeWx0Rz0fEIHABcFtE3BYRL0XEd4Ae4HRJ84HfAf4yIl6IiO8C3xhnuybrtd8F/Dgiro+IXRFxI/BD4D2Fda6JiM3580NV2y8mC6fPR8RQRKwlC+uKDwJ/HxH3RMTuiLiW7FzK4sI6n4+I7RHxTF77Gxrcdlv+PhERt+T7eikivgL8mCxAyxoCLsnbchvwK2ChpDbg94BPRMTOiNgCXDvSjiLi6oj4ZUS8QBaox0s6tLDK2oj4Qf7zeEOh3dXOAb4VEd/J3///SvZL/0111i9jY0Tcmu/vc2QdpMWjbDOjOdwn35OF7wdrPK6M4x8F/G3+Z+0AWa9JZL3ierYVvj8KOLuyfb6PNwNHkvUUn42I5wvrPzam1kz+a8+psf5jDH9ftlHfHKA/8m5dndo/UlX7vHy7ip8Vvt/J8GM22rbDapP0vsIwzgDwOuoMU9XxdAwfu6/UM5vsl1jx9eq+L5LaJF2eDxH9guyvDKpqqdfuasOOUWTnPLYx8s/uaPbUnu+vj+Hvq1XxCdWpaxvwqWhsxk11YF0fER+sXinv/R8m6eBCyM4vbP882Z/ylfXbyMJiMl57NNvJQrRoPvCPdWqp9gTQJUmFgJ8H/KRQ+6ci4lMl6ykqs+2e2vL34ovA24G7ImK3pPvIfomP1o7R7CAbspkL/ChfNm+E9c8HlgLvIAv2Q8mGuzTCNvVsB46rPJCk/LX780U7Kfx8Aa8gC2uo3+Y9tUvaj6xd28exv+S55z51XQmsqpzUknSopLMb2P7LwHskLcl7ZQfmJ+DmRsRjZMMkn5S0v6Q3M3xY40fAgZLepWwq4sfJxmEn47VHcxvwKknn5yckzyEbT/5mye3vIpuuenG+/VKGD4N8EfiQpJOUOTh/Hw4pse9Gtz2YLHx2AOQnQ19XeP5JYK6k/Uu2bY+I2A2sBVZLOkjSq4H3jbDJIWRDSE+TBeXfNPqaBTcD75L09vzn5yP5vr+fP38fcH7+s3Eq8NbCtk8Ch1cNBwG8UdKZkmYBH873d/c49pc8h/sUFRFfAz4N3JT/mfwQcFoD228j64n9BVl4bANWsPeYn0924u8Z4BNkJ0Qr2z4H/AnwJbLe1vPs7QlN6GuX2PfTwLvJAuNpspN1746In5fc/kWyk6gXAQNk5we+SRYWREQP2dj5F8h6rlvJTmyW2XdD2+bj4J8l+4XzJFlv93uFVW4nmwL6M0ml2lflYrIe+M+A64EbydtZw3VkQyn9wBb2BmfDIqKX7H39H8DPyX55vyd/7yE7mf0esvf/D8gmFVS2/WFe5yP5UFVl6OXrZGP5lZPpZxbOp4xlf8nzRUwGjHwhUeok3QNcGRH/q9W1TCRJnwZeEREXtrqWRszkn83xcM/dZhxJb5X0inxY5kLg9Qwfs0+CpFdLen0+RHQi2V8rX2t1XTY5fELVZqKFZOPCLyM7kXpWRDzR2pImxCFkQxJzyObff5ZseMNmAA/LmJklyMMyZmYJatmwzBFHHBFHH310q17ezGxa2rhx488jYrTrTloX7kcffTQ9PT2tenkzs2lJUqkruj0sY2aWIIe7mVmCHO5mZglyuJuZJcjhbmaWIIe7mVmCHO5mZglyuJuZJcg3DjMzmyTrNvWzZkMv2wcGmdPZwYolC1m2aDyfPlifw93MbBKs29TPqrUPMji0G4D+gUFWrX0QYEIC3sMyZmaTYM2G3j3BXjE4tJs1G3on5PUc7mZmk2D7wGBDy8fL4W5mNgnmdHY0tHy8HO5mZpNgxZKFdLS3DVvW0d7GiiULJ+T1fELVzGwSVE6aeraMmVlili3qmrAwr+ZhGTOzBDnczcwS5HA3M0uQw93MLEEOdzOzBDnczcwS5HA3M0uQw93MLEEOdzOzBDnczcwS5HA3M0uQw93MLEGjhrukqyU9JemhOs9L0uclbZX0gKQTml+mmZk1okzP/Rrg1BGePw04Jv9aDvzd+MsyM7PxGDXcI+K7wDMjrLIUuC4ydwOdko5sVoFmZta4Zoy5dwHbCo/78mX7kLRcUo+knh07djThpc3MrJZmhLtqLItaK0bEVRHRHRHds2fPbsJLm5lZLc0I9z5gXuHxXGB7E/ZrZmZj1IxwXw+8L581sxh4LiKeaMJ+zcxsjEb9DFVJNwKnAEdI6gM+AbQDRMSVwG3A6cBWYCfwgYkq1szMyhk13CPivFGeD+BPm1aRmZmNm69QNTNLkMPdzCxBDnczswQ53M3MEuRwNzNLkMPdzCxBDnczswQ53M3MEuRwNzNLkMPdzCxBDnczswQ53M3MEuRwNzNLkMPdzCxBDnczswQ53M3MEuRwNzNLkMPdzCxBDnczswQ53M3MEuRwNzNLkMPdzCxBDnczswQ53M3MEuRwNzNLkMPdzCxBpcJd0qmSeiVtlbSyxvPzJd0haZOkBySd3vxSzcysrFHDXVIbcAVwGnAscJ6kY6tW+zhwc0QsAs4F/mezCzUzs/LK9NxPBLZGxCMR8SJwE7C0ap0A/k3+/aHA9uaVaGZmjSoT7l3AtsLjvnxZ0WrgAkl9wG3Af6y1I0nLJfVI6tmxY8cYyjUzszLKhLtqLIuqx+cB10TEXOB04HpJ++w7Iq6KiO6I6J49e3bj1ZqZWSllwr0PmFd4PJd9h10uAm4GiIi7gAOBI5pRoJmZNa5MuN8LHCNpgaT9yU6Yrq9a53Hg7QCSXkMW7h53MTNrkVHDPSJ2ARcDG4CHyWbFbJZ0iaQz8tU+AnxQ0v3AjcD7I6J66MbMzCbJrDIrRcRtZCdKi8v+qvD9FuDk5pZmZmZj5StUzcwS5HA3M0uQw93MLEEOdzOzBDnczcwS5HA3M0uQw93MLEEOdzOzBDnczcwS5HA3M0uQw93MLEEOdzOzBDnczcwS5HA3M0uQw93MLEEOdzOzBDnczcwS5HA3M0uQw93MLEEOdzOzBDnczcwSNKvVBZiZTYZ1m/pZs6GX7QODzOnsYMWShSxb1NXqsiaMw93MkrduUz+r1j7I4NBuAPoHBlm19kGAZAPewzJmlrw1G3r3BHvF4NBu1mzobVFFE8/hbmbJ2z4w2NDyFJQKd0mnSuqVtFXSyjrr/L6kLZI2S/rfzS3TzGzs5nR2NLQ8BaOGu6Q24ArgNOBY4DxJx1atcwywCjg5Il4LfHgCajUzG5MVSxbS0d42bFlHexsrlixsUUUTr8wJ1ROBrRHxCICkm4ClwJbCOh8EroiIZwEi4qlmF2pmNlaVk6aeLTNcF7Ct8LgPOKlqnVcBSPoe0Aasjoh/rN6RpOXAcoD58+ePpV4zszFZtqgr6TCvVmbMXTWWRdXjWcAxwCnAecCXJHXus1HEVRHRHRHds2fPbrRWMzMrqUy49wHzCo/nAttrrPP1iBiKiJ8CvWRhb2ZmLVAm3O8FjpG0QNL+wLnA+qp11gFvA5B0BNkwzSPNLNTMzMobNdwjYhdwMbABeBi4OSI2S7pE0hn5ahuApyVtAe4AVkTE0xNVtJmZjUwR1cPnk6O7uzt6enpa8tpmZtOVpI0R0T3aer5C1cwsQQ53M7MEOdzNzBLkcDczS5DD3cwsQQ53M7MEOdzNzBLkcDczS5DD3cwsQQ53M7MEOdzNzBLkcDczS5DD3cwsQQ53M7MEOdzNzBLkcDczS5DD3cwsQQ53M7MEOdzNzBLkcDczS5DD3cwsQQ53M7MEzWp1AWZmjVi3qZ81G3rZPjDInM4OVixZyLJFXa0ua8pxuJvZtLFuUz+r1j7I4NBuAPoHBlm19kEAB3wVh7vZDJFCj3fNht49wV4xOLSbNRt6p11bJlqpMXdJp0rqlbRV0soR1jtLUkjqbl6JZjZelR5v/8Agwd4e77pN/a0urSHbBwYbWj6TjRruktqAK4DTgGOB8yQdW2O9Q4D/BNzT7CLNbHxG6vFOJ3M6OxpaPpOV6bmfCGyNiEci4kXgJmBpjfX+GvgM8Osm1mdmTZBKj3fFkoV0tLcNW9bR3saKJQtbVNHUVSbcu4Bthcd9+bI9JC0C5kXEN5tYm5k1SSo93mWLurjszOPo6uxAQFdnB5edeZzH22soc0JVNZbFniel/YD/Brx/1B1Jy4HlAPPnzy9XoZmN24olC4fNMoHp2+NdtqjLYV5CmXDvA+YVHs8FthceHwK8DrhTEsArgPWSzoiInuKOIuIq4CqA7u7uwMwmRSUMmzVbJoWZN6krE+73AsdIWgD0A+cC51eejIjngCMqjyXdCXy0OtjNrLWa1eP1XPPpYdQx94jYBVwMbAAeBm6OiM2SLpF0xkQXaGZTSyozb1JX6iKmiLgNuK1q2V/VWfeU8ZdlZlNVKjNvUucbh5lZQ1KZeZM6h7uZNcRzzacH31vGzBrS7Jk3NjEc7mbWMM81n/o8LGNmliCHu5lZgjwsY2aArzpNjcPdzHzVaYI8LGNmvuo0QQ53M/NVpwlyuJuZrzpNkMPdzHzVaYJ8QtXMfNVpghzuZgb4qtPUeFjGzCxBDnczswQ53M3MEuRwNzNLkMPdzCxBDnczswQ53M3MEuRwNzNLkMPdzCxBDnczswQ53M3MEuRwNzNLUKlwl3SqpF5JWyWtrPH8n0vaIukBSf8s6ajml2pmZmWNeldISW3AFcA7gT7gXknrI2JLYbVNQHdE7JT0x8BngHMmomCzmcgfXm2NKtNzPxHYGhGPRMSLwE3A0uIKEXFHROzMH94NzG1umWYzV+XDq/sHBgn2fnj1uk39rS7NprAy93PvArYVHvcBJ42w/kXAt2s9IWk5sBxg/vz5JUs0m9nqfXj1J7+x2b15q6tMz101lkXNFaULgG5gTa3nI+KqiOiOiO7Zs2eXr9JsBqv3IdXP7hxyb97qKhPufcC8wuO5wPbqlSS9A/gYcEZEvNCc8sys7IdUDw7tZs2G3gmuxqaLMuF+L3CMpAWS9gfOBdYXV5C0CPh7smB/qvllms1ctT68up56vXybeUYdc4+IXZIuBjYAbcDVEbFZ0iVAT0SsJxuGeRlwiySAxyPijAms22zaKzsDptaHVz//wi4GBof2WbdsL9/Sp4iaw+cTrru7O3p6elry2matVpkBUzxR2tHexmVnHlfqpOh4t7fpS9LGiOgebb0ys2XMrEkqvfX+GsMnlTHzMuFcqzfv2TJW5HA3myS1etvVGhkzX7aoy2FudfneMmaTpNZ89WoeM7dmcbibTZLReuUd7W2sWLJwkqqx1DnczSbJSL3yrs4Onwy1pvKYu1mVibpJ14olCz3DxSaNw92soPqkZ+WyfmDcAewZLjaZHO5mBSPdpGvZoq5x9+o9w8Umi8PdrGCkm3R9fN2DfHVj/z69+p7HnuGOH+5wb9ymFIe7WcGczo6aFxgB3HjPNnZXXdE9OLSbG+5+fM9tUps5jGM2Hg53m1Gqh1Xe9urZw3rdb3v1bL589+M1t60O9orqpY1caWo2URzuNq2MZ8y71snSYpD3Dwzy1Y39dLTvx+DQS/ts3ybVDfhqvjujtZrD3aaNsc5kGel+LtUGh3Zz2EHtgPaZsvh7b+waNuYO2SfZ1Ip7X2lqreaLmGzaqDeTZaQPqCh+/mhZAzuHuOzM4+jq7EDsvcDo0mXH7bP8DxbP3+de677S1KYC99ytpcoOs6zb1F83oGsNgTTSW6/WeVB73SmLtZZ3H/Vyz123KcfhbpOuGLzFYY16wyyV3nc9xSGQdZv6+eQ3NvPszn0/yKKsRj/iwHPXbSpyuNuEqjU7pThuXWumyaq1DwB7r+Tcb4QTmcUhkDK31C3juRqfcGQ23TjcbcLUOgFanBNez+DQS/z5V+6jMl9lpBkqxfuylLmlbhk+GWopcLhbUxV76rV63GVHPPadiLiv/TT8cTOmH/pkqKXC4W5NsW5TP6vXbx72oc1l54SP1UsBK269H8jGvUe6urQylfGOH+6gf2Bwz5z1ww5qJyIbivHJUEuJw93GrVlj3WMxtDv2XA1a65a6AJ0d7aw+47UObZtRHO4GjO3Kz2bMTKlnP8oNzcDe4RjfUtdsL4d7k0zUBzxMhrFc+bluUz8rbr2fod3NH3q5YPH8feaO73xxV91fIsUToJ6WaJZxuDfBRH7Aw2QY6crPevWv2dBbKtjrXZ5fS/t+Ys3Zx+95zeq57ituuZ+hl4bvrb1NPgFqVoNvPzCCdZv6Ofny21mw8lucfPntrNvUX3O9sVwWP5XUm2Uy0uyTMjNTDjuove7l+Rcsnp/fwyXT2dE+LNirLVvUxZqzj6ezY+82hx3Uzpqz6m9jNpOV6rlLOhX4W6AN+FJEXF71/AHAdcAbgaeBcyLi0eaWOlxxGKSzMOPh0I52pOz+ILWGR8rc8rUyo6LM1ZMwtnCcSurNMhlpvvdIM1PaJD77+3tDt97l+ZcuO66hOj3kYlaeYpTpapLagB8B7wT6gHuB8yJiS2GdPwFeHxEfknQu8N6IOGek/XZ3d0dPT09DxY7lfiHFDyBuxqyOrs4Ovrfy3w1bdvLlt9esqda6U1Gt92W0D26uN+ZePbRiZs0laWNEdI+2XplhmROBrRHxSES8CNwELK1aZylwbf79rcDbJVVdYjI+Y7m7HwwfHmnGFYy1euMrliyc1ncGXLaoq+ZdEEcK6GWLulhz1vENDa2Y2eQpMyzTBWwrPO4DTqq3TkTskvQccDjw82YUCeML5kogN2OYpNZQRQpT8MYy5OFhErOpq0y41+qBV4/llFkHScuB5QDz588v8dJ7jSeYK4E80jhxGSP1xh10ZjaVlBmW6QPmFR7PBbbXW0fSLOBQ4JnqHUXEVRHRHRHds2fPbqjQsd7MqRjItYZPRlP5rVVmqMLMbKoo03O/FzhG0gKgHzgXOL9qnfXAhcBdwFnA7THamdoG1bu0vFrnCLNlag2f1JstM12HV8zMoES452PoFwMbyKZCXh0RmyVdAvRExHrgH4DrJW0l67Gf2+xCq4O5c4w3fPLwiZnNBKNOhZwoY5kKaWY20zVzKqSZmU0zDnczswQ53M3MEuRwNzNLkMPdzCxBDnczswQ53M3MEtSyee6SdgCPNbDJETTxRmTTxExr80xrL7jNM0Uz23xURIx6/5aWhXujJPWUmbifkpnW5pnWXnCbZ4pWtNnDMmZmCXK4m5klaDqF+1WtLqAFZlqbZ1p7wW2eKSa9zdNmzN3MzMqbTj13MzMryeFuZpagKR/ukk6V1Ctpq6SVra5nokh6VNKDku6T1JMve7mk70j6cf7vYa2uczwkXS3pKUkPFZbVbKMyn8+P+wOSTmhd5WNXp82rJfXnx/o+SacXnluVt7lX0pLWVD12kuZJukPSw5I2S/qzfHmyx3mENrf2OEfElP0i++SnnwCvBPYH7geObXVdE9TWR4EjqpZ9BliZf78S+HSr6xxnG98CnAA8NFobgdOBb5N9jO1i4J5W19/ENq8GPlpj3WPzn/EDgAX5z35bq9vQYHuPBE7Ivz8E+FHermSP8whtbulxnuo99xOBrRHxSES8CNwELG1xTZNpKXBt/v21wLIW1jJuEfFd9v3g9HptXApcF5m7gU5JR05Opc1Tp831LAVuiogXIuKnwFay/wPTRkQ8ERH/mn//S+BhoIuEj/MIba5nUo7zVA/3LmBb4XEfI79p01kA/yRpo6Tl+bLfjIgnIPsBAn6jZdVNnHptTP3YX5wPQ1xdGG5Lqs2SjgYWAfcwQ45zVZuhhcd5qoe7aixLde7myRFxAnAa8KeS3tLqglos5WP/d8BvAW8AngA+my9Pps2SXgZ8FfhwRPxipFVrLEulzS09zlM93PuAeYXHc4HtLaplQkXE9vzfp4Cvkf2Z9mTlT9T836daV+GEqdfGZI99RDwZEbsj4iXgi+z9kzyJNktqJwu5GyJibb446eNcq82tPs5TPdzvBY6RtEDS/sC5wPoW19R0kg6WdEjle+B3gYfI2nphvtqFwNdbU+GEqtfG9cD78tkUi4HnKn/WT3dVY8rvJTvWkLX5XEkHSFoAHAP8YLLrGw9JAv4BeDgiPld4KtnjXK/NLT/OrT7TXOJM9OlkZ59/Anys1fVMUBtfSXb2/H5gc6WdwOHAPwM/zv99eatrHWc7byT783SIrPdyUb02kv3pekV+3B8EultdfxPbfH3epgfy/+hHFtb/WN7mXuC0Vtc/hva+mWyI4QHgvvzr9JSP8whtbulx9u0HzMwSNNWHZczMbAwc7mZmCXK4m5klyOFuZpYgh7uZWYIc7mZmCXK4m5kl6P8D+lBm8dRKTN0AAAAASUVORK5CYII=
"
>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our test generation is much faster, but also our inputs are much smaller.  We see that with derivation trees, we can get much better control over grammar production.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Finally, how does <code>GrammarFuzzer</code> work with <code>expr_grammar</code>, where <code>simple_grammar_fuzzer()</code> failed?  It works without any issue:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">expr_grammar</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;(9 + 5) * (3 + 0) + 7 * 0 + (7) / 9 / 8&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With <code>GrammarFuzzer</code>, we now have a solid foundation on which to build further fuzzers and illustrate more exciting concepts from the world of generating software tests.  Many of these do not even require writing a grammar – instead, they <em>infer</em> a grammar from the domain at hand, and thus allow to use grammar-based fuzzing even without writing a grammar.  Stay tuned!</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned<a class="anchor-link" href="#Lessons-Learned">&#182;</a></h2><ul>
<li><em>Derivation trees</em> are important for expressing input structure</li>
<li><em>Grammar fuzzing based on derivation trees</em> <ol>
<li>is much more efficient than string-based grammar fuzzing,</li>
<li>gives much better control over input generation, and</li>
<li>effectively avoids running into infinite expansions.</li>
</ol>
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps<a class="anchor-link" href="#Next-Steps">&#182;</a></h2><p>Congratulations!  You have reached one of the central "hubs" of the book.  From here, there is a wide range of techniques that build on grammar fuzzing.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Extending-Grammars">Extending Grammars<a class="anchor-link" href="#Extending-Grammars">&#182;</a></h3><p>First, we have a number of techniques that all <em>extend</em> grammars in some form:</p>
<ul>
<li><a href="Parser.html">Parsing and recombining inputs</a> allows to make use of existing inputs, again using derivation trees</li>
<li><a href="GrammarCoverageFuzzer.html">Covering grammar expansions</a> allows for <em>combinatorial</em> coverage</li>
<li><a href="ProbabilisticGrammarFuzzer.html">Assigning <em>probabilities</em> to individual expansions</a> gives additional control over expansions</li>
<li><a href="ConstraintGrammarFuzzer.html">Assigning <em>constraints</em> to individual expansions</a> allows to express <em>semantic constraints</em> on individual rules.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Applying-Grammars">Applying Grammars<a class="anchor-link" href="#Applying-Grammars">&#182;</a></h3><p>Second, we can <em>apply</em> grammars in a variety of contexts that all involve some form of learning it automatically:</p>
<ul>
<li><a href="APIFuzzer.html">Fuzzing APIs</a>, learning a grammar from APIs</li>
<li><a href="GUIFuzzer.html">Fuzzing GUIs</a>, learning a grammar from user interfaces for subsequent fuzzing</li>
<li><a href="GrammarMiner.html">Mining Grammars</a>, learning a grammar for arbitrary input formats</li>
</ul>
<p>Keep on expanding!</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Background">Background<a class="anchor-link" href="#Background">&#182;</a></h2><p>\todo{Discuss derivation trees.}</p>
<p>The key idea in this chapter, namely expanding until a limit of symbols is reached, and then always choosing the shortest path, stems from Luke [<a href="https://doi.org/10.1109/4235.873237">Luke <em>et al</em>, 2000.</a>].</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises<a class="anchor-link" href="#Exercises">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1:-Caching-Method-Results">Exercise 1: Caching Method Results<a class="anchor-link" href="#Exercise-1:-Caching-Method-Results">&#182;</a></h3><p>Tracking <code>GrammarFuzzer</code> reveals that some methods are called again and again, always with the same values.</p>
<p>Set up a class <code>FasterGrammarFuzzer</code> with a <em>cache</em> that checks whether the method has been called before, and if so, return the previously computed "memoized" value.  Do this for <code>expansion_to_children()</code>.  Compare the number of invocations before and after the optimization.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Important</strong>: For <code>expansion_to_children()</code>, make sure that each list returned is an individual copy.  If you return the sane (cached) list, this will interfere with the in-place modification of <code>GrammarFuzzer</code>.  Use the Python <code>copy.deepcopy()</code> function for this purpose.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2:-Grammar-Pre-Compilation">Exercise 2: Grammar Pre-Compilation<a class="anchor-link" href="#Exercise-2:-Grammar-Pre-Compilation">&#182;</a></h3><p>Some methods such as <code>symbol_cost()</code> or <code>expansion_cost()</code> return a value that is dependent on the grammar only.  Set up a class <code>EvenFasterGrammarFuzzer()</code> that pre-computes these values once upon initialization, such that later invocations of <code>symbol_cost()</code> or <code>expansion_cost()</code> need only look up these values.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-3:-Maintaining-Trees-to-be-Expanded">Exercise 3: Maintaining Trees to be Expanded<a class="anchor-link" href="#Exercise-3:-Maintaining-Trees-to-be-Expanded">&#182;</a></h3><p>In <code>expand_tree_once()</code>, the algorithm traverses the tree again and again to find nonterminals that still can be extended.  Speed up the process by keeping a list of nonterminal symbols in the tree that still can be expanded.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-4:-Alternate-Random-Expansions">Exercise 4: Alternate Random Expansions<a class="anchor-link" href="#Exercise-4:-Alternate-Random-Expansions">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We could define <code>expand_node_randomly()</code> such that it simply invokes <code>expand_node_by_cost(node, random.choice)</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ExerciseGrammarFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expand_node_randomly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Expanding&quot;</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="s2">&quot;randomly by cost&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_by_cost</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What is the difference between the original implementation and this alternative?</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Grammar-Coverage">Grammar Coverage<a class="anchor-link" href="#Grammar-Coverage">&#182;</a></h1><p>In this chapter, we explore how to systematically cover elements of a grammar.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>You should have read the <a href="Grammars.html">chapter on grammars</a>.</li>
<li>You should have read the <a href="GrammarFuzzer.html">chapter on efficient grammar fuzzing</a>.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Covering-Grammar-Elements">Covering Grammar Elements<a class="anchor-link" href="#Covering-Grammar-Elements">&#182;</a></h2><p><a href="GrammarFuzzer.html">Producing inputs from grammars</a> gives all possible expansions of a rule the same likelihood.  For producing a comprehensive test suite, however, it makes more sense to maximize <em>variety</em> – for instance, by avoiding repeating the same expansions over and over again.  To achieve this, we can track the <em>coverage</em> of individual expansions: If we have seen some expansion already, we can prefer other possible expansions in the future.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As an example, consider the grammar</p>

<pre><code>grammar
&lt;start&gt; ::= &lt;digit&gt;&lt;digit&gt;
&lt;digit&gt; ::= 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9</code></pre>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us assume we have already produced a <code>0</code> in the first expansion of <code>&lt;digit&gt;</code>.  As it comes to expand the next digit, we would mark the <code>0</code> expansion as already covered, and choose one of the yet uncovered alternatives.  Only when we have covered all alternatives would we go back and consider expansions covered before.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Tracking-Grammar-Coverage">Tracking Grammar Coverage<a class="anchor-link" href="#Tracking-Grammar-Coverage">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This concept of coverage is very easy to implement.  We introduce a class <code>GrammarCoverageFuzzer</code> that keeps track of the current grammar coverage achieved:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="k">import</span> <span class="n">DIGIT_GRAMMAR</span><span class="p">,</span> <span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">CGI_GRAMMAR</span><span class="p">,</span> <span class="n">URL_GRAMMAR</span><span class="p">,</span> <span class="n">START_SYMBOL</span><span class="p">,</span> <span class="n">is_valid_grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="GrammarFuzzer.html" class="import" target="_blank">GrammarFuzzer</a></span> <span class="k">import</span> <span class="n">GrammarFuzzer</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">,</span> <span class="n">nonterminals</span><span class="p">,</span> <span class="n">display_tree</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/random.html" class="import" target="_blank">random</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TrackingGrammarCoverageFuzzer</span><span class="p">(</span><span class="n">GrammarFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># invoke superclass __init__(), passing all arguments</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_coverage</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reset_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covered_expansions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">expansion_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">covered_expansions</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In this set <code>covered_expansions</code>, we store individual expansions seen as pairs of (<em>symbol</em>, <em>expansion</em>), using the method <code>expansion_key()</code> to generate a string representation for the pair.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TrackingGrammarCoverageFuzzer</span><span class="p">(</span><span class="n">TrackingGrammarCoverageFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">expansion_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">expansion</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert (symbol, children) into a key.  `children` can be an expansion string or a derivation tree.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">children</span> <span class="o">=</span> <span class="n">expansion</span>
            <span class="n">expansion</span> <span class="o">=</span> <span class="n">all_terminals</span><span class="p">((</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">symbol</span> <span class="o">+</span> <span class="s2">&quot; -&gt; &quot;</span> <span class="o">+</span> <span class="n">expansion</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">TrackingGrammarCoverageFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">expansion_key</span><span class="p">(</span><span class="n">START_SYMBOL</span><span class="p">,</span> <span class="n">EXPR_GRAMMAR</span><span class="p">[</span><span class="n">START_SYMBOL</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;&lt;start&gt; -&gt; &lt;expr&gt;&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Instead of <em>expansion</em>, we can also pass a list of children as argument, which will then automatically be converted into a string.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">children</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot; + &quot;</span><span class="p">,</span> <span class="p">[]),</span> <span class="p">(</span><span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
<span class="n">f</span><span class="o">.</span><span class="n">expansion_key</span><span class="p">(</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;&lt;expr&gt; -&gt; &lt;expr&gt; + &lt;term&gt;&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can compute the set of possible expansions in a grammar by enumerating all expansions:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TrackingGrammarCoverageFuzzer</span><span class="p">(</span><span class="n">TrackingGrammarCoverageFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">max_expansion_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return set of all expansions in a grammar&quot;&quot;&quot;</span>
        <span class="n">expansions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">nonterminal</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">expansion</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">nonterminal</span><span class="p">]:</span>
                <span class="n">expansions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion_key</span><span class="p">(</span><span class="n">nonterminal</span><span class="p">,</span> <span class="n">expansion</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">expansions</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">TrackingGrammarCoverageFuzzer</span><span class="p">(</span><span class="n">DIGIT_GRAMMAR</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">max_expansion_coverage</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;start&gt; -&gt; 0&#39;,
 &#39;&lt;start&gt; -&gt; 1&#39;,
 &#39;&lt;start&gt; -&gt; 2&#39;,
 &#39;&lt;start&gt; -&gt; 3&#39;,
 &#39;&lt;start&gt; -&gt; 4&#39;,
 &#39;&lt;start&gt; -&gt; 5&#39;,
 &#39;&lt;start&gt; -&gt; 6&#39;,
 &#39;&lt;start&gt; -&gt; 7&#39;,
 &#39;&lt;start&gt; -&gt; 8&#39;,
 &#39;&lt;start&gt; -&gt; 9&#39;}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>During expansion, we can keep track of expansions seen.  To do so, we hook into the method <code>choose_node_expansion()</code>, expanding a single node in our <a href="GrammarFuzzer.html">Grammar fuzzer</a>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TrackingGrammarCoverageFuzzer</span><span class="p">(</span><span class="n">TrackingGrammarCoverageFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">add_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">new_children</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expansion_key</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">new_children</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">covered_expansions</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Now covered:&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covered_expansions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">choose_node_expansion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">possible_children</span><span class="p">):</span>
        <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">choose_node_expansion</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">possible_children</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_coverage</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">possible_children</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">index</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With this, we can now systematically check which expansions already have been covered – and which ones still have to be covered.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">TrackingGrammarCoverageFuzzer</span><span class="p">(</span><span class="n">DIGIT_GRAMMAR</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Tree: &lt;start&gt;
Expanding &lt;start&gt; randomly
Now covered: &lt;start&gt; -&gt; 9
Tree: 9
&#39;9&#39;
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;9&#39;
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Tree: &lt;start&gt;
Expanding &lt;start&gt; randomly
Now covered: &lt;start&gt; -&gt; 0
Tree: 0
&#39;0&#39;
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;0&#39;
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Tree: &lt;start&gt;
Expanding &lt;start&gt; randomly
Now covered: &lt;start&gt; -&gt; 5
Tree: 5
&#39;5&#39;
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;5&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's the set of covered expansions so far:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">expansion_coverage</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;start&gt; -&gt; 0&#39;, &#39;&lt;start&gt; -&gt; 5&#39;, &#39;&lt;start&gt; -&gt; 9&#39;}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>On average, how many characters do we have to produce until all expansions are covered?</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">average_length_until_full_coverage</span><span class="p">(</span><span class="n">fuzzer</span><span class="p">):</span>
    <span class="n">trials</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
        <span class="n">fuzzer</span><span class="o">.</span><span class="n">reset_coverage</span><span class="p">()</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">max_expansion_coverage</span><span class="p">()</span> 
                  <span class="o">-</span> <span class="n">fuzzer</span><span class="o">.</span><span class="n">expansion_coverage</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
            <span class="nb">sum</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">sum</span> <span class="o">/</span> <span class="n">trials</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">average_length_until_full_coverage</span><span class="p">(</span><span class="n">TrackingGrammarCoverageFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>130.82
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Covering-Grammar-Expansions">Covering Grammar Expansions<a class="anchor-link" href="#Covering-Grammar-Expansions">&#182;</a></h3><p>Let us now not only track coverage, but actually <em>produce</em> coverage.  The idea is as follows:</p>
<ol>
<li>We determine children yet uncovered (in <code>uncovered_children</code>)</li>
<li>If all children are covered, we fall back to the original method (i.e., choosing one expansion randomly)</li>
<li>Otherwise, we select a child from the uncovered children and mark it as covered.</li>
</ol>
<p>To this end, we introduce a new fuzzer <code>SimpleGrammarCoverageFuzzer</code> that implements this strategy in the <code>choose_node_expansion()</code> method.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">SimpleGrammarCoverageFuzzer</span><span class="p">(</span><span class="n">TrackingGrammarCoverageFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">choose_node_expansion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">possible_children</span><span class="p">):</span>
        <span class="c1"># Prefer uncovered expansions</span>
        <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
        <span class="n">uncovered_children</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">possible_children</span><span class="p">)</span>
                              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expansion_key</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">covered_expansions</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">uncovered_children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># All expansions covered - use superclass method</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All&quot;</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="s2">&quot;alternatives covered&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">choose_node_expansion</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">possible_children</span><span class="p">)</span>

        <span class="c1"># select a random expansion</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uncovered_children</span><span class="p">))</span>
        <span class="p">(</span><span class="n">new_children_index</span><span class="p">,</span> <span class="n">new_children</span><span class="p">)</span> <span class="o">=</span> <span class="n">uncovered_children</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="c1"># Save the expansion as covered</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_coverage</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">new_children</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_children_index</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>By returning the set of expansions covered so far, we can invoke the fuzzer multiple times, each time adding to the grammar coverage.  With the <code>DIGIT_GRAMMAR</code> grammar, for instance, this lets the grammar produce one digit after the other:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">SimpleGrammarCoverageFuzzer</span><span class="p">(</span><span class="n">DIGIT_GRAMMAR</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Tree: &lt;start&gt;
Expanding &lt;start&gt; randomly
Now covered: &lt;start&gt; -&gt; 4
Tree: 4
&#39;4&#39;
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;4&#39;
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Tree: &lt;start&gt;
Expanding &lt;start&gt; randomly
Now covered: &lt;start&gt; -&gt; 6
Tree: 6
&#39;6&#39;
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;6&#39;
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Tree: &lt;start&gt;
Expanding &lt;start&gt; randomly
Now covered: &lt;start&gt; -&gt; 0
Tree: 0
&#39;0&#39;
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;0&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's the set of covered expansions so far:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">expansion_coverage</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;start&gt; -&gt; 0&#39;, &#39;&lt;start&gt; -&gt; 4&#39;, &#39;&lt;start&gt; -&gt; 6&#39;}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us fuzz some more. We see that with each iteration, we cover another expansion:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
    <span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Tree: &lt;start&gt;
Expanding &lt;start&gt; randomly
Now covered: &lt;start&gt; -&gt; 2
Tree: 2
&#39;2&#39;
Tree: &lt;start&gt;
Expanding &lt;start&gt; randomly
Now covered: &lt;start&gt; -&gt; 9
Tree: 9
&#39;9&#39;
Tree: &lt;start&gt;
Expanding &lt;start&gt; randomly
Now covered: &lt;start&gt; -&gt; 5
Tree: 5
&#39;5&#39;
Tree: &lt;start&gt;
Expanding &lt;start&gt; randomly
Now covered: &lt;start&gt; -&gt; 1
Tree: 1
&#39;1&#39;
Tree: &lt;start&gt;
Expanding &lt;start&gt; randomly
Now covered: &lt;start&gt; -&gt; 8
Tree: 8
&#39;8&#39;
Tree: &lt;start&gt;
Expanding &lt;start&gt; randomly
Now covered: &lt;start&gt; -&gt; 7
Tree: 7
&#39;7&#39;
Tree: &lt;start&gt;
Expanding &lt;start&gt; randomly
Now covered: &lt;start&gt; -&gt; 3
Tree: 3
&#39;3&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>At the end, all expansions are covered:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">max_expansion_coverage</span><span class="p">()</span> <span class="o">-</span> <span class="n">f</span><span class="o">.</span><span class="n">expansion_coverage</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>set()
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us apply this on a more complex grammar – e.g., the expression grammar.  We see that after a few iterations, we cover each and every digit, operator, and expansion:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">SimpleGrammarCoverageFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>084.7
2 / 3 / 6 / 3 / 0 - -5 * 1 + 4 * 9 / 3
(+0 / 0 - 0 - 2) - +8.1 * 5 + 1 * 7 - 7
7477.0
66.0 * +6 / 2 + 4 / 4 - 6 * 4 + 2
(8 / 2 * 7) * (7 / 7) / 3 * 6 + 15.306
+2
39 / +-(3 * 7 * 4 - 2 + 0 / 4) / 41 / 3 / 2
(++(6) * 0 * 7 / 0 - 0 * 2 + 07 * 5 / 9)
-((63) + 1 + 1 + 1) * +8 * -+-2.4 - +(1.3 - 0 * 5)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Again, all expansions are covered:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">max_expansion_coverage</span><span class="p">()</span> <span class="o">-</span> <span class="n">f</span><span class="o">.</span><span class="n">expansion_coverage</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>set()
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that our strategy is much more effective than random in achieving coverage:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">average_length_until_full_coverage</span><span class="p">(</span><span class="n">SimpleGrammarCoverageFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>49.36
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Deep-Foresight">Deep Foresight<a class="anchor-link" href="#Deep-Foresight">&#182;</a></h2><p>Selecting expansions for individual rules is a good start; however, it is not sufficient, as the following example shows.  We apply our coverage fuzzer on the CGI grammar:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">SimpleGrammarCoverageFuzzer</span><span class="p">(</span><span class="n">CGI_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>%361
+%4f
c%a05
%d5
4+
%7b
0b-3
e
%2e
%81
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>After 10 iterations, we still have a number of expansions uncovered:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">max_expansion_coverage</span><span class="p">()</span> <span class="o">-</span> <span class="n">f</span><span class="o">.</span><span class="n">expansion_coverage</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;hexdigit&gt; -&gt; 9&#39;,
 &#39;&lt;hexdigit&gt; -&gt; c&#39;,
 &#39;&lt;other&gt; -&gt; 2&#39;,
 &#39;&lt;other&gt; -&gt; _&#39;,
 &#39;&lt;other&gt; -&gt; a&#39;,
 &#39;&lt;other&gt; -&gt; d&#39;}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Why is that so?  The problem is that in the CGI grammar, the largest number of variations to be covered occurs in the <code>hexdigit</code> rule.  However, we first need to <em>reach</em> this expansion.  When expanding a <code>&lt;letter&gt;</code> symbol, we have the choice between three possible expansions:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">CGI_GRAMMAR</span><span class="p">[</span><span class="s2">&quot;&lt;letter&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;&lt;plus&gt;&#39;, &#39;&lt;percent&gt;&#39;, &#39;&lt;other&gt;&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If all three expansions are covered already, then <code>choose_node_expansion()</code> above will choose one randomly – even if there may be more expansions to cover when choosing <code>&lt;percent&gt;</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What we need is a better strategy that will pick <code>&lt;percent&gt;</code> if there are more uncovered expansions following – even if <code>&lt;percent&gt;</code> is covered.  Such a strategy was first discussed by W. Burkhardt [<a href="https://doi.org/10.1007/BF02235512">Burkhardt <em>et al</em>, 1967.</a>] under the name of "Shortest Path Selection":</p>
<blockquote><p>This version selects, from several alternatives for development, that syntactic unit under which there is still an unused unit available, starting with the shortest path.</p>
</blockquote>
<p>This is what we will implement in the next steps.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Determining-Maximum-per-Symbol-Coverage">Determining Maximum per-Symbol Coverage<a class="anchor-link" href="#Determining-Maximum-per-Symbol-Coverage">&#182;</a></h3><p>To address this problem, we introduce a new class <code>GrammarCoverageFuzzer</code> that builds on <code>SimpleGrammarCoverageFuzzer</code>, but with a better strategy.  First, we need to compute the <em>maximum set of expansions</em> that can be reached from a particular symbol. The idea is to later compute the <em>intersection</em> of this set and the expansions already covered, such that we can favor those expansions with a non-empty intersection.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our method <code>max_symbol_expansion_coverage()</code> computes this maximum set of expansions.  The helper method <code>_max_symbol_expansion_coverage()</code> does the heavy lifting, iterating through the grammar up to a given depth and tracking which symbols (<code>symbols_seen</code>) and which coverage (<code>cov</code>) has already been seen:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">TrackingGrammarCoverageFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_max_symbol_expansion_coverage</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">symbols_seen</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return set of all expansions in a grammar starting with `symbol`&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_depth</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">cov</span><span class="p">,</span> <span class="n">symbols_seen</span><span class="p">)</span>

        <span class="n">symbols_seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">expansion</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">symbol</span><span class="p">]:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expansion_key</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">expansion</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cov</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">cov</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">nonterminals</span><span class="p">(</span><span class="n">expansion</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols_seen</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">new_cov</span><span class="p">,</span> <span class="n">new_symbols_seen</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_max_symbol_expansion_coverage</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">max_depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">symbols_seen</span><span class="p">))</span>
                <span class="n">cov</span> <span class="o">|=</span> <span class="n">new_cov</span>
                <span class="n">symbols_seen</span> <span class="o">|=</span> <span class="n">new_symbols_seen</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">cov</span><span class="p">,</span> <span class="n">symbols_seen</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The main method <code>max_symbol_expansion_coverage()</code> simply returns the coverage that can be achieved:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">GrammarCoverageFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">max_symbol_expansion_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)):</span>
        <span class="n">cov</span><span class="p">,</span> <span class="n">symbols_seen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_symbol_expansion_coverage</span><span class="p">(</span>
            <span class="n">symbol</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="nb">set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">cov</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With this, we can compute the possible expansions for every symbol</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">max_symbol_expansion_coverage</span><span class="p">(</span><span class="s1">&#39;&lt;integer&gt;&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;digit&gt; -&gt; 0&#39;,
 &#39;&lt;digit&gt; -&gt; 1&#39;,
 &#39;&lt;digit&gt; -&gt; 2&#39;,
 &#39;&lt;digit&gt; -&gt; 3&#39;,
 &#39;&lt;digit&gt; -&gt; 4&#39;,
 &#39;&lt;digit&gt; -&gt; 5&#39;,
 &#39;&lt;digit&gt; -&gt; 6&#39;,
 &#39;&lt;digit&gt; -&gt; 7&#39;,
 &#39;&lt;digit&gt; -&gt; 8&#39;,
 &#39;&lt;digit&gt; -&gt; 9&#39;,
 &#39;&lt;integer&gt; -&gt; &lt;digit&gt;&#39;,
 &#39;&lt;integer&gt; -&gt; &lt;digit&gt;&lt;integer&gt;&#39;}
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">max_symbol_expansion_coverage</span><span class="p">(</span><span class="s1">&#39;&lt;digit&gt;&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;digit&gt; -&gt; 0&#39;,
 &#39;&lt;digit&gt; -&gt; 1&#39;,
 &#39;&lt;digit&gt; -&gt; 2&#39;,
 &#39;&lt;digit&gt; -&gt; 3&#39;,
 &#39;&lt;digit&gt; -&gt; 4&#39;,
 &#39;&lt;digit&gt; -&gt; 5&#39;,
 &#39;&lt;digit&gt; -&gt; 6&#39;,
 &#39;&lt;digit&gt; -&gt; 7&#39;,
 &#39;&lt;digit&gt; -&gt; 8&#39;,
 &#39;&lt;digit&gt; -&gt; 9&#39;}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The maximum coverage achievable in a grammar is the same as starting with the start symbol:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">f</span><span class="o">.</span><span class="n">max_expansion_coverage</span><span class="p">()</span> <span class="o">==</span> <span class="n">f</span><span class="o">.</span><span class="n">max_symbol_expansion_coverage</span><span class="p">(</span><span class="n">START_SYMBOL</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Determining-Children-with-new-Coverage">Determining Children with new Coverage<a class="anchor-link" href="#Determining-Children-with-new-Coverage">&#182;</a></h3><p>The definition of <code>max_symbol_expansion_coverage()</code> allows us to determine the <em>new</em> coverage for each child.  To this end, we <em>subtract</em> the coverage already seen (<code>expansion_coverage()</code>) from the coverage that could be obtained.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">GrammarCoverageFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_new_child_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">children</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">):</span>
        <span class="n">new_cov</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">c_symbol</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c_symbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">:</span>
                <span class="n">new_cov</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_symbol_expansion_coverage</span><span class="p">(</span>
                    <span class="n">c_symbol</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_cov</span>

    <span class="k">def</span> <span class="nf">new_child_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;Return new coverage that would be obtained by expanding (symbol, children)&quot;&quot;&quot;</span>
        <span class="n">new_cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_child_coverage</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
            <span class="n">new_cov</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion_key</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">))</span>
        <span class="n">new_cov</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expansion_coverage</span><span class="p">()</span>   <span class="c1"># set subtraction</span>
        <span class="k">return</span> <span class="n">new_cov</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us illustrate <code>new_child_coverage()</code>.  We again start fuzzing, choosing expansions randomly.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">DIGIT_GRAMMAR</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Tree: &lt;start&gt;
Expanding &lt;start&gt; randomly
Now covered: &lt;start&gt; -&gt; 8
Tree: 8
&#39;8&#39;
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;8&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is our current coverage:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">expansion_coverage</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;start&gt; -&gt; 8&#39;}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>When we go through the individual expansion possibilities for <code>START_SYMBOL</code>, we see that all expansions offer additional coverage, <em>except</em> for the one we have just seen.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">expansion</span> <span class="ow">in</span> <span class="n">DIGIT_GRAMMAR</span><span class="p">[</span><span class="n">START_SYMBOL</span><span class="p">]:</span>
    <span class="n">children</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expansion_to_children</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">expansion</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">new_child_coverage</span><span class="p">(</span><span class="n">START_SYMBOL</span><span class="p">,</span> <span class="n">children</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0 {&#39;&lt;start&gt; -&gt; 0&#39;}
1 {&#39;&lt;start&gt; -&gt; 1&#39;}
2 {&#39;&lt;start&gt; -&gt; 2&#39;}
3 {&#39;&lt;start&gt; -&gt; 3&#39;}
4 {&#39;&lt;start&gt; -&gt; 4&#39;}
5 {&#39;&lt;start&gt; -&gt; 5&#39;}
6 {&#39;&lt;start&gt; -&gt; 6&#39;}
7 {&#39;&lt;start&gt; -&gt; 7&#39;}
8 set()
9 {&#39;&lt;start&gt; -&gt; 9&#39;}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This means that whenever choosing an expansion, we can make use of <code>new_child_coverage()</code> and choose among the expansions that offer the greatest new (unseen) coverage.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Adaptive-Lookahead">Adaptive Lookahead<a class="anchor-link" href="#Adaptive-Lookahead">&#182;</a></h3><p>When choosing a child, we do not look out for the maximum overall coverage to be obtained, as this would result in expansions with many uncovered possibilities totally dominate other expansions.  Instead, we aim for a <em>breadth-first</em> strategy, first covering all expansions up to a given depth, and only then looking for a greater depth.  The method <code>new_coverages()</code> is at the heart of this strategy: Starting with a maximum depth (<code>max_depth</code>) of zero, it increases the depth until it finds at least one uncovered expansion.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">GrammarCoverageFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">new_coverages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">possible_children</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return coverage to be obtained for each child at minimum depth&quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
        <span class="k">for</span> <span class="n">max_depth</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">)):</span>
            <span class="n">new_coverages</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">new_child_coverage</span><span class="p">(</span>
                    <span class="n">symbol</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">possible_children</span><span class="p">]</span>
            <span class="n">max_new_coverage</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_coverage</span><span class="p">)</span>
                                   <span class="k">for</span> <span class="n">new_coverage</span> <span class="ow">in</span> <span class="n">new_coverages</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">max_new_coverage</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Uncovered node found</span>
                <span class="k">return</span> <span class="n">new_coverages</span>

        <span class="c1"># All covered</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="All-Together">All Together<a class="anchor-link" href="#All-Together">&#182;</a></h3><p>We can now define <code>choose_node_expansion()</code> to make use of this strategy: First, we determine the possible coverages to be obtained (using <code>new_coverages()</code>); then we (randomly) select among the children which sport the maximum coverage.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">GrammarCoverageFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">choose_node_expansion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">possible_children</span><span class="p">):</span>
        <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">node</span>
        <span class="n">new_coverages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_coverages</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">possible_children</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">new_coverages</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># All expansions covered - use superclass method</span>
            <span class="k">return</span> <span class="n">GrammarFuzzer</span><span class="o">.</span><span class="n">choose_node_expansion</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">possible_children</span><span class="p">)</span>

        <span class="n">max_new_coverage</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span> <span class="k">for</span> <span class="n">cov</span> <span class="ow">in</span> <span class="n">new_coverages</span><span class="p">)</span>
        <span class="n">children_with_max_new_coverage</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">possible_children</span><span class="p">)</span>
                                          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_coverages</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="n">max_new_coverage</span><span class="p">]</span>

        <span class="c1"># select a random expansion</span>
        <span class="n">new_children_index</span><span class="p">,</span> <span class="n">new_children</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
            <span class="n">children_with_max_new_coverage</span><span class="p">)</span>

        <span class="c1"># Save the expansion as covered</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expansion_key</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">new_children</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Now covered:&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covered_expansions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_children_index</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our fuzzer is now complete.  Let us apply it on a series of examples.  On expressions, it quickly covers all digits and operators:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">min_nonterminals</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;(3 / 7 * 9 + 6) * -5.8 / +0 * 7 - 14.2&#39;
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">max_expansion_coverage</span><span class="p">()</span> <span class="o">-</span> <span class="n">f</span><span class="o">.</span><span class="n">expansion_coverage</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>set()
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>On average, it is again faster than the simple strategy:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">average_length_until_full_coverage</span><span class="p">(</span><span class="n">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>50.92
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>On the CGI grammar, it takes but a few iterations to cover all letters and digits:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">CGI_GRAMMAR</span><span class="p">,</span> <span class="n">min_nonterminals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">max_expansion_coverage</span><span class="p">()</span> <span class="o">-</span> <span class="n">f</span><span class="o">.</span><span class="n">expansion_coverage</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>%68+41
e%1ea25_
%c2%ab%97-c
%3fb0d
%d53%4024
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This improvement can also be seen in comparing the random, expansion-only, and deep foresight strategies on the CGI grammar:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">average_length_until_full_coverage</span><span class="p">(</span><span class="n">TrackingGrammarCoverageFuzzer</span><span class="p">(</span><span class="n">CGI_GRAMMAR</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>214.44
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">average_length_until_full_coverage</span><span class="p">(</span><span class="n">SimpleGrammarCoverageFuzzer</span><span class="p">(</span><span class="n">CGI_GRAMMAR</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>68.02
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">average_length_until_full_coverage</span><span class="p">(</span><span class="n">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">CGI_GRAMMAR</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>40.26
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Code-Coverage-via-Grammar-Coverage">Code Coverage via Grammar Coverage<a class="anchor-link" href="#Code-Coverage-via-Grammar-Coverage">&#182;</a></h2><p>By systematically covering all input elements, we get a larger variety in inputs – but does this translate into a wider variety of program behaviors?  After all, these behaviors are what we want to cover, including the unexpected behaviors.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In a grammar, there are elements that directly correspond to program features.  A program handling arithmetic expressions will have functionality that is directly triggered by individual elements - say, an addition feature triggered by the presence of <code>+</code>, subtraction triggered by the presence of <code>-</code>, and floating-point arithmetic triggered by the presence of floating-point numbers in the input.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Such a connection between input structure and functionality leads to a strong <em>correlation between grammar coverage and code coverage</em>.  In other words: If we can achieve a high grammar coverage, this also leads to a high code coverage.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="CGI-Grammars">CGI Grammars<a class="anchor-link" href="#CGI-Grammars">&#182;</a></h3><p>Let us explore this relationship on one of our grammars – say, the CGI decoder.  We compute a mapping <code>coverages</code> where in <code>coverages[x]</code> = <code>{y_1, y_2, ...}</code>, <code>x</code> is the grammar coverage obtained, and <code>y_n</code> is the code coverage obtained for the <code>n</code>-th run:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Coverage.html" class="import" target="_blank">Coverage</a></span> <span class="k">import</span> <span class="n">Coverage</span><span class="p">,</span> <span class="n">cgi_decode</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">CGI_GRAMMAR</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">coverages</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">trials</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
    <span class="n">f</span><span class="o">.</span><span class="n">reset_coverage</span><span class="p">()</span>
    <span class="n">overall_cov</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">Coverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
            <span class="n">cgi_decode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">overall_cov</span> <span class="o">|=</span> <span class="n">cov</span><span class="o">.</span><span class="n">coverage</span><span class="p">()</span>

        <span class="n">x</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">expansion_coverage</span><span class="p">())</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">overall_cov</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coverages</span><span class="p">:</span>
            <span class="n">coverages</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">coverages</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We compute the averages for the <code>y</code>-values:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">coverages</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">coverages</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">coverages</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">coverages</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>and create a scatter plot:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/matplotlib.pyplot.html" class="import" target="_blank">matplotlib.pyplot</a></span> <span class="k">as</span> <span class="nn"><a href="https://docs.python.org/3/library/plt.html" class="import" target="_blank">plt</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Coverage of cgi_decode() vs. grammar coverage&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;grammar coverage (expansions)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;code coverage (lines)&#39;</span><span class="p">);</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_png output_subarea ">
<img src="data:image/png;base64,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
"
>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that the higher the grammar coverage, the higher the code coverage.  This also translates into a correlation coefficient of about 0.8, indicating a strong correlation:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/numpy.html" class="import" target="_blank">numpy</a></span> <span class="k">as</span> <span class="nn"><a href="https://docs.python.org/3/library/np.html" class="import" target="_blank">np</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>array([[1.        , 0.80919156],
       [0.80919156, 1.        ]])
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="URL-Grammars">URL Grammars<a class="anchor-link" href="#URL-Grammars">&#182;</a></h3><p>Let us repeat this experiment on URL grammars.  We use the same code as above, except for exchanging the grammars and the function in place:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/urlparse.html" class="import" target="_blank">urlparse</a></span> <span class="k">import</span> <span class="n">urlparse</span>      <span class="c1"># Python 2</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/urllib.parse.html" class="import" target="_blank">urllib.parse</a></span> <span class="k">import</span> <span class="n">urlparse</span>  <span class="c1"># Python 3</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">URL_GRAMMAR</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">coverages</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">trials</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>
    <span class="n">f</span><span class="o">.</span><span class="n">reset_coverage</span><span class="p">()</span>
    <span class="n">overall_cov</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">Coverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
            <span class="n">urlparse</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">overall_cov</span> <span class="o">|=</span> <span class="n">cov</span><span class="o">.</span><span class="n">coverage</span><span class="p">()</span>

        <span class="n">x</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">expansion_coverage</span><span class="p">())</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">overall_cov</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coverages</span><span class="p">:</span>
            <span class="n">coverages</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">coverages</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">coverages</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">coverages</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">coverages</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">coverages</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Coverage of cgi_decode() vs. grammar coverage&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;grammar coverage (expansions)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;code coverage (lines)&#39;</span><span class="p">);</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_png output_subarea ">
<img src="data:image/png;base64,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
"
>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here, we have an even stronger correlation of almost .95:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>array([[1.        , 0.96051181],
       [0.96051181, 1.        ]])
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We conclude: If one wants to obtain high code coverage, it is a good idea to strive for high grammar coverage first.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Will-this-always-work?">Will this always work?<a class="anchor-link" href="#Will-this-always-work?">&#182;</a></h3><p>The correlation observed for the CGI and URL examples will not hold for every program and every structure.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Equivalent-Elements">Equivalent Elements<a class="anchor-link" href="#Equivalent-Elements">&#182;</a></h4><p>First, some grammar elements are treated uniformly by a program even though the grammar sees them as different symbols.  In the host name of a URL, for instance, we can have many different characters, although a URL-handling program treats them all the same.  Likewise, individual digits, once composed into a number, make less of a difference than the value of the number itself.  Hence, achieving variety in digits or characters will not yield a large difference in functionality.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Deep-Data-Processing">Deep Data Processing<a class="anchor-link" href="#Deep-Data-Processing">&#182;</a></h4><p>Second, the way the data is processed can make a large difference.  Consider the input to a <em>media player</em>, consisting of compressed media data.  While processing the media data, the media player will show differences in behavior (notably in its output), but these differences cannot be directly triggered through individual elements of the media data.  Likewise, a <em>machine learner</em> that is trained on a large set of inputs typically will not have its behavior controlled by a single syntactic element of the input.  (Well, it could, but then, we would not need a machine learner.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In these cases of "deep" data processing, achieving coverage in the grammar will not necessarily induce code coverage.  We still can make use of the grammar to produce <em>valid</em> inputs, but will have to rely on chance and patience to cover functionality and trigger bugs.  <em>Some</em> parts of the input, though, can still be covered: <em>Metadata</em> (such as author name or composer for the media player) or <em>configuration data</em> (such as settings for the machine learner) can and should be covered systematically; we will see how this is done <a href="ConfigurationFuzzer.html">in the chapter on "Configuration fuzzing"</a>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned<a class="anchor-link" href="#Lessons-Learned">&#182;</a></h2><ul>
<li>Achieving <em>grammar coverage</em> quickly results in a large variety of inputs.</li>
<li>Achieving grammar coverage can help in obtaining <em>code coverage</em>.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps<a class="anchor-link" href="#Next-Steps">&#182;</a></h2><p>From here, you can learn how to</p>
<ul>
<li><a href="ConfigurationFuzzer.html">use grammar coverage to systematically test cpnfigurations</a></li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Background">Background<a class="anchor-link" href="#Background">&#182;</a></h2><p>The idea of ensuring that each expansion in the grammar is used at least once goes back to Burkhardt [<a href="https://doi.org/10.1007/BF02235512">Burkhardt <em>et al</em>, 1967.</a>], to be later rediscovered by Paul Purdom [<a href="https://doi.org/10.1007/BF01932308">Purdom <em>et al</em>, 1972.</a>]. \todo{Add more.}</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises<a class="anchor-link" href="#Exercises">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1:-Testing-ls">Exercise 1: Testing ls<a class="anchor-link" href="#Exercise-1:-Testing-ls">&#182;</a></h3><p>Consider the Unix <code>ls</code> program, used to list the contents of a directory.  Create a grammar for invoking <code>ls</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">LS_EBNF_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;&lt;start&gt;&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;-&lt;options&gt;&#39;</span><span class="p">],</span>
    <span class="s1">&#39;&lt;options&gt;&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;&lt;option&gt;*&#39;</span><span class="p">],</span>
    <span class="s1">&#39;&lt;option&gt;&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;@&#39;</span><span class="p">,</span>
                 <span class="c1"># many more</span>
                 <span class="p">]</span>
<span class="p">}</span>

<span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">LS_EBNF_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Use <code>GrammarCoverageFuzzer</code> to test all options.  Be sure to invoke <code>ls</code> with each option set.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2:-Caching">Exercise 2: Caching<a class="anchor-link" href="#Exercise-2:-Caching">&#182;</a></h3><p>The value of <code>max_symbol_expansion_coverage()</code> depends on the grammar only.  Change the implementation such that the values are precomputed for each symbol upon initialization (<code>__init__()</code>); this way, <code>max_symbol_expansion_coverage()</code> can simply lookup the value in the table.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Testing-Configurations">Testing Configurations<a class="anchor-link" href="#Testing-Configurations">&#182;</a></h1><p>The behavior of a program is not only governed by its data.  The <em>configuration</em> of a program – that is, the settings that govern the execution of a program on its (regular) input data, as set by options or configuration files – just as well influences behavior, and thus can and should bne tested.  In this chapter, we explore how to systematically <em>test</em> and <em>cover</em> software configurations.  By <em>automatically inferring configuration options</em>, we can apply these techniques out of the box, with no need for writing a grammar.  Finally, we show how to systematically cover <em>combinations</em> of configuration options, quickly detecting unwanted interferences.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>You should have read the <a href="Grammars.html">chapter on grammars</a>.</li>
<li>You should have read the <a href="GrammarCoverageFuzzer.html">chapter on grammar coverage</a>.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Configuration-Options">Configuration Options<a class="anchor-link" href="#Configuration-Options">&#182;</a></h2><p>When we talk about the input to a program, we usually think of the <em>data</em> it processes. This is also what we have been fuzzing in the past chapters – be it with <a href="Fuzzer.html">random input</a>, <a href="MutationFuzzer.html">mutation-based fuzzing</a>, or <a href="GrammarFuzzer.html">grammar-based fuzzing</a>.  However, programs typically have several input sources, all of which can and should be tested – and included in test generation.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>One important source of input is the program's <em>configuration</em> – that is, a set of inputs that typically is set once when beginning to process data and then stays constant while processing data, while the program is running, or even while the program is deployed.  Such a configuration is frequently set in <em>configuration files</em> (for instance, as key/value pairs); the most ubiquitous method for command-line tools, though, are <em>configuration options</em> on the command line.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As an example, consider the <code>grep</code> utility to find textual patterns in files.  The exact mode by which <code>grep</code> works is governed by a multitude of options, which can be listed by providing a <code>--help</code> option:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>grep --help
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>usage: grep [-abcDEFGHhIiJLlmnOoqRSsUVvwxZ] [-A num] [-B num] [-C[num]]
	[-e pattern] [-f file] [--binary-files=value] [--color=when]
	[--context[=num]] [--directories=action] [--label] [--line-buffered]
	[--null] [pattern] [file ...]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>All these options need to be tested for whether they operate correctly.  In security testing, any such option may also trigger a yet unknown vulnerability.  Hence, such options can become <em>fuzz targets</em> on their own.  In this chapter, we analyze how to systematically test such options – and better yet, how to extract possible configurations right out of given program files, such that we do not have to specify anything.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Options-in-Python">Options in Python<a class="anchor-link" href="#Options-in-Python">&#182;</a></h2><p>Let us stick to our common programming language here and examine how options are processed in Python.  The <code>argparse</code> module provides an parser for command-line arguments (and options) with great functionality – and great complexity.  You start by defining a parser (<code>argparse.ArgumentParser()</code>) to which individual arguments with various features are added, one after another.  Additional parameters for each argument can specify the type (<code>type</code>) of the argument (say, integers or strings), or the number of arguments (<code>nargs</code>).</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>By default, arguments are stored under their name in the <code>args</code> object coming from <code>parse_args()</code> – thus, <code>args.integers</code> holds the <code>integers</code> arguments added earlier.  Special actions (<code>actions</code>) allow to store specific values in given variables; the <code>store_const</code> action stores the given <code>const</code> in the attribute named by <code>dest</code>.  The following example takes a number of integer arguments (<code>integers</code>) as well as an operator (<code>--sum</code>, <code>--min</code>, or <code>--max</code>) to be applied on these integers.  The operators all store a function reference in the <code>accumulate</code> attribute, which is finally invoked on the integers parsed:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/argparse.html" class="import" target="_blank">argparse</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">process_numbers</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Process some integers.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;integers&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;an integer for the accumulator&#39;</span><span class="p">)</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--sum&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;accumulate&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_const&#39;</span><span class="p">,</span>
                       <span class="n">const</span><span class="o">=</span><span class="nb">sum</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;sum the integers&#39;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--min&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;accumulate&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_const&#39;</span><span class="p">,</span>
                       <span class="n">const</span><span class="o">=</span><span class="nb">min</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;compute the minimum&#39;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--max&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;accumulate&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_const&#39;</span><span class="p">,</span>
                       <span class="n">const</span><span class="o">=</span><span class="nb">max</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;compute the maximum&#39;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">integers</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's how <code>process_numbers()</code> works.  We can, for instance, invoke the <code>--min</code> option on the given arguments to compute the minimum:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">process_numbers</span><span class="p">([</span><span class="s2">&quot;--min&quot;</span><span class="p">,</span> <span class="s2">&quot;100&quot;</span><span class="p">,</span> <span class="s2">&quot;200&quot;</span><span class="p">,</span> <span class="s2">&quot;300&quot;</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>100
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Or compute the sum of three numbers:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">process_numbers</span><span class="p">([</span><span class="s2">&quot;--sum&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>6
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>When defined via <code>add_mutually_exclusive_group()</code> (as above), options are mutually exclusive.  Consequently, we can have only one operator:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="ExpectError.html" class="import" target="_blank">ExpectError</a></span> <span class="k">import</span> <span class="n">ExpectError</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="n">print_traceback</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">process_numbers</span><span class="p">([</span><span class="s2">&quot;--sum&quot;</span><span class="p">,</span> <span class="s2">&quot;--max&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>usage: ipykernel_launcher.py [-h] (--sum | --min | --max) N [N ...]
ipykernel_launcher.py: error: argument --max: not allowed with argument --sum
SystemExit: 2 (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="A-Grammar-for-Configurations">A Grammar for Configurations<a class="anchor-link" href="#A-Grammar-for-Configurations">&#182;</a></h2><p>How can we test a system with several options?  The easiest answer is to write a grammar for it.  The grammar <code>PROCESS_NUMBERS_EBNF_GRAMMAR</code> reflects the possible combinations of options and arguments:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="k">import</span> <span class="n">crange</span><span class="p">,</span> <span class="n">srange</span><span class="p">,</span> <span class="n">convert_ebnf_grammar</span><span class="p">,</span> <span class="n">is_valid_grammar</span><span class="p">,</span> <span class="n">START_SYMBOL</span><span class="p">,</span> <span class="n">new_symbol</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">PROCESS_NUMBERS_EBNF_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;operator&gt; &lt;integers&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;operator&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;--sum&quot;</span><span class="p">,</span> <span class="s2">&quot;--min&quot;</span><span class="p">,</span> <span class="s2">&quot;--max&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;integers&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;integer&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;integers&gt; &lt;integer&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;integer&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;digit&gt;+&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">:</span> <span class="n">crange</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">PROCESS_NUMBERS_EBNF_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">PROCESS_NUMBERS_GRAMMAR</span> <span class="o">=</span> <span class="n">convert_ebnf_grammar</span><span class="p">(</span><span class="n">PROCESS_NUMBERS_EBNF_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can feed this grammar into our <a href="GrammarCoverageFuzzer.html">grammar coverage fuzzer</a> and have it cover one option after another:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="GrammarCoverageFuzzer.html" class="import" target="_blank">GrammarCoverageFuzzer</a></span> <span class="k">import</span> <span class="n">GrammarCoverageFuzzer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">PROCESS_NUMBERS_GRAMMAR</span><span class="p">,</span> <span class="n">min_nonterminals</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>--max 9 5 8 210 80 9756431
--sum 9 4 99 1245 612370
--min 2 3 0 46 15798 7570926
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Of course, we can also invoke <code>process_numbers()</code> with these very arguments. To this end, we need to convert the string produced by the grammar back into a list of individual arguments, using <code>split()</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">PROCESS_NUMBERS_GRAMMAR</span><span class="p">,</span> <span class="n">min_nonterminals</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">process_numbers</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;--max&#39;, &#39;8&#39;, &#39;9&#39;, &#39;3067&#39;, &#39;44&#39;, &#39;13852967057&#39;]
13852967057
[&#39;--sum&#39;, &#39;9&#39;, &#39;8&#39;, &#39;63&#39;, &#39;9278111&#39;, &#39;59206197798&#39;]
59215475989
[&#39;--min&#39;, &#39;4&#39;, &#39;1&#39;, &#39;4864&#39;, &#39;33342&#39;, &#39;7827970808951&#39;]
1
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In a similar way, we can define grammars for any program to be tested; as well as define grammars for, say, configuration files.  Yet, the grammar has to be updated with every change to the program, which creates a maintenance burden.  Given that the information required for the grammar is already all encoded in the program, the question arises: <em>Can't we go and extract configuration options right out of the program in the first place?</em></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Mining-Configuration-Options">Mining Configuration Options<a class="anchor-link" href="#Mining-Configuration-Options">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In this section, we try to extract option and argument information right out of a program, such that we do not have to specify a configuration grammar.  The aim is to have a configuration fuzzer that works on the options and arguments of an arbitrary program, as long as it follows specific conventions for processing its arguments.  In the case of Python programs, this means using the <code>argparse</code> module.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our idea is as follows: We execute the given program up to the point where the arguments are actually parsed – that is, <code>argparse.parse_args()</code> is invoked.  Up to this point, we track all calls into the argument parser, notably those calls that define arguments and options (<code>add_argument()</code>).  From these, we construct the grammar.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Tracking-Arguments">Tracking Arguments<a class="anchor-link" href="#Tracking-Arguments">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us illustrate this approach with a simple experiment: We define a trace function (see <a href="Coverage.html">our chapter on coverage</a> for details) that is active while <code>process_numbers</code> is invoked.  If we have a call to a method <code>add_argument</code>, we access and print out the local variables (which at this point are the arguments to the method).</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/sys.html" class="import" target="_blank">sys</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/string.html" class="import" target="_blank">string</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">traceit</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">event</span> <span class="o">!=</span> <span class="s2">&quot;call&quot;</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">method_name</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
    <span class="k">if</span> <span class="n">method_name</span> <span class="o">!=</span> <span class="s2">&quot;add_argument&quot;</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="nb">locals</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">method_name</span><span class="p">,</span> <span class="nb">locals</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What we get is a list of all calls to <code>add_argument()</code>, together with the method arguments passed:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="n">traceit</span><span class="p">)</span>
<span class="n">process_numbers</span><span class="p">([</span><span class="s2">&quot;--sum&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">])</span>
<span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>add_argument {&#39;kwargs&#39;: {&#39;action&#39;: &#39;help&#39;, &#39;default&#39;: &#39;==SUPPRESS==&#39;, &#39;help&#39;: &#39;show this help message and exit&#39;}, &#39;args&#39;: (&#39;-h&#39;, &#39;--help&#39;), &#39;self&#39;: ArgumentParser(prog=&#39;ipykernel_launcher.py&#39;, usage=None, description=&#39;Process some integers.&#39;, formatter_class=&lt;class &#39;argparse.HelpFormatter&#39;&gt;, conflict_handler=&#39;error&#39;, add_help=True)}
add_argument {&#39;kwargs&#39;: {&#39;metavar&#39;: &#39;N&#39;, &#39;type&#39;: &lt;class &#39;int&#39;&gt;, &#39;nargs&#39;: &#39;+&#39;, &#39;help&#39;: &#39;an integer for the accumulator&#39;}, &#39;args&#39;: (&#39;integers&#39;,), &#39;self&#39;: ArgumentParser(prog=&#39;ipykernel_launcher.py&#39;, usage=None, description=&#39;Process some integers.&#39;, formatter_class=&lt;class &#39;argparse.HelpFormatter&#39;&gt;, conflict_handler=&#39;error&#39;, add_help=True)}
add_argument {&#39;kwargs&#39;: {&#39;dest&#39;: &#39;accumulate&#39;, &#39;action&#39;: &#39;store_const&#39;, &#39;const&#39;: &lt;built-in function sum&gt;, &#39;help&#39;: &#39;sum the integers&#39;}, &#39;args&#39;: (&#39;--sum&#39;,), &#39;self&#39;: &lt;argparse._MutuallyExclusiveGroup object at 0x10eb189e8&gt;}
add_argument {&#39;kwargs&#39;: {&#39;dest&#39;: &#39;accumulate&#39;, &#39;action&#39;: &#39;store_const&#39;, &#39;const&#39;: &lt;built-in function min&gt;, &#39;help&#39;: &#39;compute the minimum&#39;}, &#39;args&#39;: (&#39;--min&#39;,), &#39;self&#39;: &lt;argparse._MutuallyExclusiveGroup object at 0x10eb189e8&gt;}
add_argument {&#39;kwargs&#39;: {&#39;dest&#39;: &#39;accumulate&#39;, &#39;action&#39;: &#39;store_const&#39;, &#39;const&#39;: &lt;built-in function max&gt;, &#39;help&#39;: &#39;compute the maximum&#39;}, &#39;args&#39;: (&#39;--max&#39;,), &#39;self&#39;: &lt;argparse._MutuallyExclusiveGroup object at 0x10eb189e8&gt;}
6
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>From the <code>args</code> argument, we can access the individual options and arguments to be defined:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">traceit</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">event</span> <span class="o">!=</span> <span class="s2">&quot;call&quot;</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">method_name</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
    <span class="k">if</span> <span class="n">method_name</span> <span class="o">!=</span> <span class="s2">&quot;add_argument&quot;</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="nb">locals</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">locals</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="n">traceit</span><span class="p">)</span>
<span class="n">process_numbers</span><span class="p">([</span><span class="s2">&quot;--sum&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">])</span>
<span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(&#39;-h&#39;, &#39;--help&#39;)
(&#39;integers&#39;,)
(&#39;--sum&#39;,)
(&#39;--min&#39;,)
(&#39;--max&#39;,)
6
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that each argument comes as a tuple with one (say, <code>integers</code> or <code>--sum</code>) or two members (<code>-h</code> and <code>--help</code>), which denote alternate forms for the same option.  Our job will be to go through the arguments of <code>add_arguments()</code> and detect not only the names of options and arguments, but also whether they accept additional parameters, as well as the type of the parameters.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="A-Grammar-Miner-for-Options-and-Arguments">A Grammar Miner for Options and Arguments<a class="anchor-link" href="#A-Grammar-Miner-for-Options-and-Arguments">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us now build a class that gathers all this information to create a grammar.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We use the <code>ParseInterrupt</code> exception to interrupt program execution after gathering all arguments and options:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ParseInterrupt</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The class <code>OptionGrammarMiner</code> takes an executable function for which the grammar of options and arguments is to be mined:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">OptionGrammarMiner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The method <code>mine_ebnf_grammar()</code> is where everything happens.  It creates a grammar of the form</p>

<pre><code>&lt;start&gt; ::= &lt;option&gt;* &lt;arguments&gt;
&lt;option&gt; ::= &lt;empty&gt;
&lt;arguments&gt; ::= &lt;empty&gt;</code></pre>
<p>in which the options and arguments will be collected.  It then sets a trace function (see <a href="Coverage.html">our chapter on coverage</a> for details) that is active while the previously defined <code>function</code> is invoked.  Raising <code>ParseInterrupt</code> (when <code>parse_args()</code> is invoked) ends execution.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">OptionGrammarMiner</span><span class="p">(</span><span class="n">OptionGrammarMiner</span><span class="p">):</span>
    <span class="n">OPTION_SYMBOL</span> <span class="o">=</span> <span class="s2">&quot;&lt;option&gt;&quot;</span>
    <span class="n">ARGUMENTS_SYMBOL</span> <span class="o">=</span> <span class="s2">&quot;&lt;arguments&gt;&quot;</span>

    <span class="k">def</span> <span class="nf">mine_ebnf_grammar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">START_SYMBOL</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">OPTION_SYMBOL</span> <span class="o">+</span> <span class="s2">&quot;)*&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARGUMENTS_SYMBOL</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OPTION_SYMBOL</span><span class="p">:</span> <span class="p">[],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ARGUMENTS_SYMBOL</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OPTION_SYMBOL</span>

        <span class="n">old_trace</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">traceit</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">ParseInterrupt</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="n">old_trace</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span>

    <span class="k">def</span> <span class="nf">mine_grammar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">convert_ebnf_grammar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mine_ebnf_grammar</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The trace function checks for four methods: <code>add_argument()</code> is the most important function, resulting in processing arguments; <code>frame.f_locals</code> again is the set of local variables, which at this point is mostly the arguments to <code>add_argument()</code>.  Since mutually exclusive groups also have a method <code>add_argument()</code>, we set the flag <code>in_group</code> to differentiate.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Note that we make no specific efforts to differentiate between multiple parsers or groups; we simply assume that there is one parser, and at any point at most one mutually exclusive group.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">OptionGrammarMiner</span><span class="p">(</span><span class="n">OptionGrammarMiner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">traceit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span> <span class="o">!=</span> <span class="s2">&quot;call&quot;</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="s2">&quot;self&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">self_var</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="s2">&quot;self&quot;</span><span class="p">]</span>

        <span class="n">method_name</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>

        <span class="k">if</span> <span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;add_argument&quot;</span><span class="p">:</span>
            <span class="n">in_group</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">self_var</span><span class="p">))</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Group&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_argument</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">,</span> <span class="n">in_group</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;add_mutually_exclusive_group&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_group</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">,</span> <span class="n">exclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;add_argument_group&quot;</span><span class="p">:</span>
            <span class="c1"># self.add_group(frame.f_locals, exclusive=False)</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">method_name</span> <span class="o">==</span> <span class="s2">&quot;parse_args&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParseInterrupt</span>

        <span class="k">return</span> <span class="kc">None</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>process_arguments()</code> now analyzes the arguments passed and adds them to the grammar:</p>
<ul>
<li>If the argument starts with <code>-</code>, it gets added as an optional element to the <code>&lt;option&gt;</code> list</li>
<li>Otherwise, it gets added to the <code>&lt;argument&gt;</code> list.</li>
</ul>
<p>The optional <code>nargs</code> argument specifies how many arguments can follow.  If it is a number, we add the appropriate number of elements to the grammar; if it is an abstract specifier (say, <code>+</code> or <code>*</code>), we use it directly as EBNF operator.</p>
<p>Given the large number of parameters and optional behavior, this is a somewhat messy function, but it does the job.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">OptionGrammarMiner</span><span class="p">(</span><span class="n">OptionGrammarMiner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">process_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">locals</span><span class="p">,</span> <span class="n">in_group</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">[</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_arg</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">in_group</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">OptionGrammarMiner</span><span class="p">(</span><span class="n">OptionGrammarMiner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">process_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">in_group</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">in_group</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OPTION_SYMBOL</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_group</span>
            <span class="n">metavar</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">arg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARGUMENTS_SYMBOL</span>
            <span class="n">metavar</span> <span class="o">=</span> <span class="n">arg</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;nargs&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">nargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;nargs&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nargs</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">metavar</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">nargs</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nargs</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nargs</span><span class="p">):</span>
                <span class="n">arg</span> <span class="o">+=</span> <span class="n">param</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">nargs</span> <span class="ow">in</span> <span class="s2">&quot;?+*&quot;</span>
            <span class="n">arg</span> <span class="o">+=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">param</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span> <span class="o">+</span> <span class="n">nargs</span>

        <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">OPTION_SYMBOL</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The method <code>add_parameter()</code> handles possible parameters of options.  If the argument has an <code>action</code> defined, it takes no parameter.  Otherwise, we identify the type of the parameter (as <code>int</code> or <code>str</code>) and augment the grammar with an appropriate rule.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/inspect.html" class="import" target="_blank">inspect</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">OptionGrammarMiner</span><span class="p">(</span><span class="n">OptionGrammarMiner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">add_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">metavar</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;action&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># No parameter</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="n">type_</span> <span class="o">=</span> <span class="s2">&quot;str&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">given_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
            <span class="c1"># int types come as &#39;&lt;class int&gt;&#39;</span>
            <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">given_type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">given_type</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">type_</span> <span class="o">=</span> <span class="s2">&quot;int&quot;</span>

        <span class="k">if</span> <span class="n">metavar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;metavar&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">metavar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;metavar&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">metavar</span> <span class="o">=</span> <span class="n">type_</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_type_rule</span><span class="p">(</span><span class="n">type_</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metavar</span> <span class="o">!=</span> <span class="n">type_</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_metavar_rule</span><span class="p">(</span><span class="n">metavar</span><span class="p">,</span> <span class="n">type_</span><span class="p">)</span>

        <span class="n">param</span> <span class="o">=</span> <span class="s2">&quot; &lt;&quot;</span> <span class="o">+</span> <span class="n">metavar</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span>

        <span class="k">return</span> <span class="n">param</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The method <code>add_type_rule()</code> adds a rule for parameter types to the grammar.  If the parameter is identified by a meta-variable (say, <code>N</code>), we add a rule for this as well to improve legibility.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">OptionGrammarMiner</span><span class="p">(</span><span class="n">OptionGrammarMiner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">add_type_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s2">&quot;int&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_int_rule</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_str_rule</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add_int_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="s2">&quot;&lt;int&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;(-)?&lt;digit&gt;+&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">crange</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_str_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="s2">&quot;&lt;str&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;char&gt;+&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="s2">&quot;&lt;char&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">srange</span><span class="p">(</span>
            <span class="n">string</span><span class="o">.</span><span class="n">digits</span>
            <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span>
            <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_metavar_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metavar</span><span class="p">,</span> <span class="n">type_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="n">metavar</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="n">type_</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The method <code>add_group()</code> adds a new mutually exclusive group to the grammar.  We define a new symbol (say, <code>&lt;group&gt;</code>) for the options added to the group, and use the <code>required</code> and <code>exclusive</code> flags to define an appropriate expansion operator.  The group is then prefixed to the grammar, as in</p>

<pre><code>&lt;start&gt; ::= &lt;group&gt;&lt;option&gt;* &lt;arguments&gt;
&lt;group&gt; ::= &lt;empty&gt;</code></pre>
<p>and filled with the next calls to <code>add_argument()</code> within the group.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">OptionGrammarMiner</span><span class="p">(</span><span class="n">OptionGrammarMiner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">add_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">locals</span><span class="p">,</span> <span class="n">exclusive</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">[</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">required</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">new_symbol</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">,</span> <span class="s2">&quot;&lt;group&gt;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">required</span> <span class="ow">and</span> <span class="n">exclusive</span><span class="p">:</span>
            <span class="n">group_expansion</span> <span class="o">=</span> <span class="n">group</span>
        <span class="k">if</span> <span class="n">required</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">exclusive</span><span class="p">:</span>
            <span class="n">group_expansion</span> <span class="o">=</span> <span class="n">group</span> <span class="o">+</span> <span class="s2">&quot;+&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">required</span> <span class="ow">and</span> <span class="n">exclusive</span><span class="p">:</span>
            <span class="n">group_expansion</span> <span class="o">=</span> <span class="n">group</span> <span class="o">+</span> <span class="s2">&quot;?&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">required</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">exclusive</span><span class="p">:</span>
            <span class="n">group_expansion</span> <span class="o">=</span> <span class="n">group</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">START_SYMBOL</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_expansion</span> <span class="o">+</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">START_SYMBOL</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_group</span> <span class="o">=</span> <span class="n">group</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>That's it!  With this, we can now extract the grammar from our <code>process_numbers()</code> program.  Turning on logging again reveals the variables we draw upon.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">miner</span> <span class="o">=</span> <span class="n">OptionGrammarMiner</span><span class="p">(</span><span class="n">process_numbers</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ebnf_grammar</span> <span class="o">=</span> <span class="n">miner</span><span class="o">.</span><span class="n">mine_ebnf_grammar</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(&#39;-h&#39;, &#39;--help&#39;)
{&#39;action&#39;: &#39;help&#39;, &#39;default&#39;: &#39;==SUPPRESS==&#39;, &#39;help&#39;: &#39;show this help message and exit&#39;}

(&#39;integers&#39;,)
{&#39;metavar&#39;: &#39;N&#39;, &#39;type&#39;: &lt;class &#39;int&#39;&gt;, &#39;nargs&#39;: &#39;+&#39;, &#39;help&#39;: &#39;an integer for the accumulator&#39;}

{&#39;required&#39;: True}
(&#39;--sum&#39;,)
{&#39;dest&#39;: &#39;accumulate&#39;, &#39;action&#39;: &#39;store_const&#39;, &#39;const&#39;: &lt;built-in function sum&gt;, &#39;help&#39;: &#39;sum the integers&#39;}

(&#39;--min&#39;,)
{&#39;dest&#39;: &#39;accumulate&#39;, &#39;action&#39;: &#39;store_const&#39;, &#39;const&#39;: &lt;built-in function min&gt;, &#39;help&#39;: &#39;compute the minimum&#39;}

(&#39;--max&#39;,)
{&#39;dest&#39;: &#39;accumulate&#39;, &#39;action&#39;: &#39;store_const&#39;, &#39;const&#39;: &lt;built-in function max&gt;, &#39;help&#39;: &#39;compute the maximum&#39;}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The grammar properly identifies the group found:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ebnf_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;&lt;group&gt;(&lt;option&gt;)*&lt;arguments&gt;&#39;]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ebnf_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;group&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39; --sum&#39;, &#39; --min&#39;, &#39; --max&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>It also identifies a <code>--help</code> option provided not by us, but by the <code>argparse</code> module:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ebnf_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;option&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39; -h&#39;, &#39; --help&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The grammar also correctly identifies the types of the arguments:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ebnf_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;arguments&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;( &lt;integers&gt;)+&#39;]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ebnf_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;integers&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;&lt;int&gt;&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The rules for <code>int</code> are set as defined by <code>add_int_rule()</code></p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ebnf_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;int&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;(-)?&lt;digit&gt;+&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can take this grammar and convert it to BNF, such that we can fuzz with it right away:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">ebnf_grammar</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">grammar</span> <span class="o">=</span> <span class="n">convert_ebnf_grammar</span><span class="p">(</span><span class="n">ebnf_grammar</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">grammar</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">grammar</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre> --sum 9
 --max -h --help --help -16 -0
 --min --help 2745341 8
 --min 1 27
 --sum --help --help -2
 --sum --help 0 3 -77
 --sum -3
 --sum --help 429 8 10 0295 -694 1
 --max -h 91 -1425 99
 --sum -795 -94 8 -44
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Each and every invocation adheres to the rules as set forth in the <code>argparse</code> calls.  By mining options and arguments from existing programs, we can now fuzz these options out of the box – without having to specify a grammar.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Testing-Autopep8">Testing Autopep8<a class="anchor-link" href="#Testing-Autopep8">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us try out the option grammar miner on real-world Python programs.  <code>autopep8</code> is a tool that automatically converts Python code to the <a href="https://www.python.org/dev/peps/pep-0008/">PEP 8 Style Guide for Python Code</a>.  (Actually, all Python code in this book runs through <code>autopep8</code> during production.)  <code>autopep8</code> offers a wide range of options, as can be seen by invoking it with <code>--help</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>autopep8 --help
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>usage: autopep8 [-h] [--version] [-v] [-d] [-i] [--global-config filename]
                [--ignore-local-config] [-r] [-j n] [-p n] [-a]
                [--experimental] [--exclude globs] [--list-fixes]
                [--ignore errors] [--select errors] [--max-line-length n]
                [--line-range line line] [--hang-closing]
                [files [files ...]]

Automatically formats Python code to conform to the PEP 8 style guide.

positional arguments:
  files                 files to format or &#39;-&#39; for standard in

optional arguments:
  -h, --help            show this help message and exit
  --version             show program&#39;s version number and exit
  -v, --verbose         print verbose messages; multiple -v result in more
                        verbose messages
  -d, --diff            print the diff for the fixed source
  -i, --in-place        make changes to files in place
  --global-config filename
                        path to a global pep8 config file; if this file does
                        not exist then this is ignored (default:
                        /Users/zeller/.config/pep8)
  --ignore-local-config
                        don&#39;t look for and apply local config files; if not
                        passed, defaults are updated with any config files in
                        the project&#39;s root directory
  -r, --recursive       run recursively over directories; must be used with
                        --in-place or --diff
  -j n, --jobs n        number of parallel jobs; match CPU count if value is
                        less than 1
  -p n, --pep8-passes n
                        maximum number of additional pep8 passes (default:
                        infinite)
  -a, --aggressive      enable non-whitespace changes; multiple -a result in
                        more aggressive changes
  --experimental        enable experimental fixes
  --exclude globs       exclude file/directory names that match these comma-
                        separated globs
  --list-fixes          list codes for fixes; used by --ignore and --select
  --ignore errors       do not fix these errors/warnings (default:
                        E226,E24,W503)
  --select errors       fix only these errors/warnings (e.g. E4,W)
  --max-line-length n   set maximum allowed line length (default: 79)
  --line-range line line, --range line line
                        only fix errors found within this inclusive range of
                        line numbers (e.g. 1 99); line numbers are indexed at
                        1
  --hang-closing        hang-closing option passed to pycodestyle
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Autopep8-Setup">Autopep8 Setup<a class="anchor-link" href="#Autopep8-Setup">&#182;</a></h3><p>We want to systematically test these options.  In order to deploy our configuration grammar miner, we need to find the source code of the executable:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/os.html" class="import" target="_blank">os</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">find_executable</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">get_exec_path</span><span class="p">():</span>
        <span class="n">qualified_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">qualified_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">qualified_name</span>
    <span class="k">return</span> <span class="kc">None</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">autopep8_executable</span> <span class="o">=</span> <span class="n">find_executable</span><span class="p">(</span><span class="s2">&quot;autopep8&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">autopep8_executable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="n">autopep8_executable</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;/Users/zeller/anaconda3/bin/autopep8&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Next, we build a function that reads the contents of the file and executes it.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">autopep8</span><span class="p">():</span>
    <span class="n">executable</span> <span class="o">=</span> <span class="n">find_executable</span><span class="p">(</span><span class="s2">&quot;autopep8&quot;</span><span class="p">)</span>

    <span class="c1"># First line has to contain &quot;/usr/bin/env python&quot; or like</span>
    <span class="n">first_line</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">executable</span><span class="p">)</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">first_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;python&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>

    <span class="n">contents</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">executable</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">exec</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Mining-an-Autopep8-Grammar">Mining an Autopep8 Grammar<a class="anchor-link" href="#Mining-an-Autopep8-Grammar">&#182;</a></h3><p>We can use the <code>autopep8()</code> function in our grammar miner:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">autopep8_miner</span> <span class="o">=</span> <span class="n">OptionGrammarMiner</span><span class="p">(</span><span class="n">autopep8</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>and extract a grammar for it:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">autopep8_ebnf_grammar</span> <span class="o">=</span> <span class="n">autopep8_miner</span><span class="o">.</span><span class="n">mine_ebnf_grammar</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This works because here, <code>autopep8</code> is not a separate process (and a separate Python interpreter), but we run the <code>autopep8()</code> function (and the <code>autopep8</code> code) in our current Python interpreter – up to the call to <code>parse_args()</code>, where we interrupt execution again.  At this point, the <code>autopep8</code> code has done nothing but setting up the argument parser – which is what we are interested in.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The grammar options mined reflect precisely the options seen when providing <code>--help</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">autopep8_ebnf_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;option&gt;&quot;</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39; -h&#39;, &#39; --help&#39;, &#39; --version&#39;, &#39; -v&#39;, &#39; --verbose&#39;, &#39; -d&#39;, &#39; --diff&#39;, &#39; -i&#39;, &#39; --in-place&#39;, &#39; --global-config &lt;filename&gt;&#39;, &#39; --ignore-local-config&#39;, &#39; -r&#39;, &#39; --recursive&#39;, &#39; -j &lt;n&gt;&#39;, &#39; --jobs &lt;n&gt;&#39;, &#39; -p &lt;n&gt;&#39;, &#39; --pep8-passes &lt;n&gt;&#39;, &#39; -a&#39;, &#39; --aggressive&#39;, &#39; --experimental&#39;, &#39; --exclude &lt;globs&gt;&#39;, &#39; --list-fixes&#39;, &#39; --ignore &lt;errors&gt;&#39;, &#39; --select &lt;errors&gt;&#39;, &#39; --max-line-length &lt;n&gt;&#39;, &#39; --line-range &lt;line&gt; &lt;line&gt;&#39;, &#39; --range &lt;line&gt; &lt;line&gt;&#39;, &#39; --indent-size &lt;int&gt;&#39;, &#39; --hang-closing&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Metavariables like <code>&lt;n&gt;</code> or <code>&lt;line&gt;</code> are placeholders for integers.  We assume all metavariables of the same name have the same type:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">autopep8_ebnf_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;line&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;&lt;int&gt;&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The grammar miner has inferred that the argument to <code>autopep8</code> is a list of files:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">autopep8_ebnf_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;arguments&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;( &lt;files&gt;)*&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>which in turn all are strings:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">autopep8_ebnf_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;files&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;&lt;str&gt;&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As we are only interested in testing options, not arguments, we fix the arguments to a single mandatory input.  (Otherwise, we'd have plenty of random file names generated.)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">autopep8_ebnf_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;arguments&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &lt;files&gt;&quot;</span><span class="p">]</span>
<span class="n">autopep8_ebnf_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;files&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;foo.py&quot;</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">autopep8_ebnf_grammar</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Creating-Autopep8-Options">Creating Autopep8 Options<a class="anchor-link" href="#Creating-Autopep8-Options">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us now use the inferred grammar for fuzzing.  Again, we convert the EBNF grammar into a regular BNF grammar:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">autopep8_grammar</span> <span class="o">=</span> <span class="n">convert_ebnf_grammar</span><span class="p">(</span><span class="n">autopep8_ebnf_grammar</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">autopep8_grammar</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>And we can use the grammar for fuzzing all options:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">autopep8_grammar</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre> -r foo.py
 --hang-closing --experimental --aggressive foo.py
 --ignore-local-config -d -h -p 9 --version --list-fixes foo.py
 -a --verbose foo.py
 -v --indent-size 7 --global-config { foo.py
 --in-place --help --select ~s --max-line-length 1 foo.py
 --pep8-passes 8 --diff foo.py
 -i --recursive foo.py
 -r --hang-closing foo.py
 --jobs 0 -i foo.py
 --exclude k --line-range 3 6 --verbose foo.py
 -v -i foo.py
 --version -a --list-fixes foo.py
 --ignore x -r foo.py
 -j 4 --in-place -a foo.py
 --range 5 2 --list-fixes foo.py
 --indent-size 5 --indent-size 3 foo.py
 --indent-size 0 --indent-size 8 foo.py
 --indent-size 7 --indent-size 3 foo.py
 --indent-size 9 --verbose foo.py
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us apply these options on the actual program.  We need a file <code>foo.py</code> that will serve as input:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">create_foo_py</span><span class="p">():</span>
    <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;foo.py&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">def twice(x = 2):</span>
<span class="s2">    return  x  +  x</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">create_foo_py</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;foo.py&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
def twice(x = 2):
    return  x  +  x
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see how <code>autopep8</code> fixes the spacing:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>autopep8 foo.py
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
def twice(x=2):
    return x + x
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us now put things together.  We define a <code>ProgramRunner</code> that will run the <code>autopep8</code> executable with arguments coming from the mined <code>autopep8</code> grammar.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Fuzzer.html" class="import" target="_blank">Fuzzer</a></span> <span class="k">import</span> <span class="n">ProgramRunner</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Running <code>autopep8</code> with the mined options reveals a surprising high number of passing runs.  (We see that some options depend on each other or are mutually exclusive, but this is handled by the program logic, not the argument parser, and hence out of our scope.)  The <code>GrammarCoverageFuzzer</code> ensures that each option is tested at least once.  (Digits and letters, too, by the way.)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">autopep8_grammar</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">invocation</span> <span class="o">=</span> <span class="s2">&quot;autopep8&quot;</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;$ &quot;</span> <span class="o">+</span> <span class="n">invocation</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">invocation</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">autopep8</span> <span class="o">=</span> <span class="n">ProgramRunner</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">result</span><span class="p">,</span> <span class="n">outcome</span> <span class="o">=</span> <span class="n">autopep8</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">stderr</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>$ autopep8 foo.py
$ autopep8 -a --max-line-length 2 --jobs 5 --help -r foo.py
$ autopep8 --version --indent-size 0 --ignore-local-config -h foo.py
$ autopep8 --ignore z --diff -j 7 --experimental --list-fixes --verbose -i --recursive foo.py
usage: autopep8 [-h] [--version] [-v] [-d] [-i] [--global-config filename]
                [--ignore-local-config] [-r] [-j n] [-p n] [-a]
                [--experimental] [--exclude globs] [--list-fixes]
                [--ignore errors] [--select errors] [--max-line-length n]
                [--line-range line line] [--hang-closing]
                [files [files ...]]
autopep8: error: --in-place and --diff are mutually exclusive
$ autopep8 --line-range 1 6 --in-place --select _ foo.py
$ autopep8 --exclude n --pep8-passes 3 --aggressive foo.py
$ autopep8 --global-config &amp;F -p 4 -d foo.py
$ autopep8 --hang-closing --range 8 9 -v foo.py
[file:foo.py]
---&gt;  5 issue(s) to fix {&#39;E251&#39;: {2}, &#39;E271&#39;: {3}, &#39;E221&#39;: {3}, &#39;E222&#39;: {3}}
$ autopep8 --indent-size 1 --version --hang-closing foo.py
$ autopep8 --indent-size 3 --hang-closing --aggressive foo.py
$ autopep8 --indent-size 8 -r --in-place foo.py
$ autopep8 --indent-size 9 --indent-size 7 --version foo.py
$ autopep8 -a --aggressive --help -v foo.py
$ autopep8 --indent-size 9 --indent-size 7 foo.py
$ autopep8 --indent-size 5 --indent-size 2 --verbose foo.py
[file:foo.py]
---&gt;  Applying global fix for E265
---&gt;  1 issue(s) to fix {&#39;E111&#39;: {3}}
$ autopep8 --indent-size 9 --in-place --recursive foo.py
$ autopep8 --indent-size 9 --indent-size 9 foo.py
$ autopep8 --indent-size 6 --indent-size 9 -v foo.py
[file:foo.py]
---&gt;  Applying global fix for E265
---&gt;  1 issue(s) to fix {&#39;E111&#39;: {3}}
$ autopep8 --indent-size 4 --indent-size -5 --list-fixes foo.py
$ autopep8 --indent-size 93 -a foo.py
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our <code>foo.py</code> file now has been formatted in place a number of times:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;foo.py&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
def twice(x=2):
         return x + x
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We don't need it anymore, so we clean up things:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/os.html" class="import" target="_blank">os</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;foo.py&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Classes-for-Fuzzing-Configuration-Options">Classes for Fuzzing Configuration Options<a class="anchor-link" href="#Classes-for-Fuzzing-Configuration-Options">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us now create reusable classes that we can use for testing arbitrary programs.  (Okay, make that "arbitrary programs that are written in Python and use the <code>argparse</code> module to process command-line arguments.")</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The class <code>OptionRunner</code> is a subclass of <code>ProgramRunner</code> that takes care of automatically determining the grammar, using the same steps we used for <code>autopep8</code>, above.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">OptionRunner</span><span class="p">(</span><span class="n">ProgramRunner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_executable</span> <span class="o">=</span> <span class="n">program</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_executable</span> <span class="o">=</span> <span class="n">program</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">find_contents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_grammar</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">arguments</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_arguments</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>First, we find the contents of the Python executable:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">OptionRunner</span><span class="p">(</span><span class="n">OptionRunner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">find_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_executable</span> <span class="o">=</span> <span class="n">find_executable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_executable</span><span class="p">)</span>
        <span class="n">first_line</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_executable</span><span class="p">)</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">first_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;python&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_executable</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">invoker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">exec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">executable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Next, we determine the grammar using the <code>OptionGrammarMiner</code> class:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">OptionRunner</span><span class="p">(</span><span class="n">OptionRunner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">find_grammar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">miner</span> <span class="o">=</span> <span class="n">OptionGrammarMiner</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invoker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ebnf_grammar</span> <span class="o">=</span> <span class="n">miner</span><span class="o">.</span><span class="n">mine_ebnf_grammar</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">ebnf_grammar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ebnf_grammar</span>

    <span class="k">def</span> <span class="nf">grammar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">convert_ebnf_grammar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ebnf_grammar</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The two service methods <code>set_arguments()</code> and <code>set_invocation()</code> help us to change the arguments and program, respectively.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">OptionRunner</span><span class="p">(</span><span class="n">OptionRunner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">set_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ebnf_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;arguments&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set_invocation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">program</span> <span class="o">=</span> <span class="n">program</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can instantiate the class on <code>autopep8</code> and immediately get the grammar:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">autopep8_runner</span> <span class="o">=</span> <span class="n">OptionRunner</span><span class="p">(</span><span class="s2">&quot;autopep8&quot;</span><span class="p">,</span> <span class="s2">&quot;foo.py&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">autopep8_runner</span><span class="o">.</span><span class="n">ebnf_grammar</span><span class="p">()[</span><span class="s2">&quot;&lt;option&gt;&quot;</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39; -h&#39;, &#39; --help&#39;, &#39; --version&#39;, &#39; -v&#39;, &#39; --verbose&#39;, &#39; -d&#39;, &#39; --diff&#39;, &#39; -i&#39;, &#39; --in-place&#39;, &#39; --global-config &lt;filename&gt;&#39;, &#39; --ignore-local-config&#39;, &#39; -r&#39;, &#39; --recursive&#39;, &#39; -j &lt;n&gt;&#39;, &#39; --jobs &lt;n&gt;&#39;, &#39; -p &lt;n&gt;&#39;, &#39; --pep8-passes &lt;n&gt;&#39;, &#39; -a&#39;, &#39; --aggressive&#39;, &#39; --experimental&#39;, &#39; --exclude &lt;globs&gt;&#39;, &#39; --list-fixes&#39;, &#39; --ignore &lt;errors&gt;&#39;, &#39; --select &lt;errors&gt;&#39;, &#39; --max-line-length &lt;n&gt;&#39;, &#39; --line-range &lt;line&gt; &lt;line&gt;&#39;, &#39; --range &lt;line&gt; &lt;line&gt;&#39;, &#39; --indent-size &lt;int&gt;&#39;, &#39; --hang-closing&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>An <code>OptionFuzzer</code> interacts with the given <code>OptionRunner</code> to obtain its grammar, which is then passed to its <code>GrammarCoverageFuzzer</code> superclass.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">OptionFuzzer</span><span class="p">(</span><span class="n">GrammarCoverageFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">runner</span><span class="p">),</span> <span class="n">OptionRunner</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runner</span> <span class="o">=</span> <span class="n">runner</span>
        <span class="n">grammar</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">grammar</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>When invoking <code>run()</code>, the <code>OptionFuzzer</code> creates a new invocation (using <code>fuzz()</code> from its grammar) and runs the now given (or previously set) runner with the arguments from the grammar.  Note that the runner specified in <code>run()</code> can differ from the one set during initialization; this allows for mining options from one program and applying it in another context.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">OptionFuzzer</span><span class="p">(</span><span class="n">OptionFuzzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inp</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">runner</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">runner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runner</span>
        <span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">runner</span><span class="p">),</span> <span class="n">OptionRunner</span><span class="p">)</span>
        <span class="n">invocation</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">executable</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
        <span class="n">runner</span><span class="o">.</span><span class="n">set_invocation</span><span class="p">(</span><span class="n">invocation</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Example:-Autopep8">Example: Autopep8<a class="anchor-link" href="#Example:-Autopep8">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us apply this on the <code>autopep8</code> runner:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">autopep8_fuzzer</span> <span class="o">=</span> <span class="n">OptionFuzzer</span><span class="p">(</span><span class="n">autopep8_runner</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">autopep8_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre> -j -8 foo.py
 --aggressive --global-config U} --version --verbose foo.py
 --help --experimental -p 01 --hang-closing -r -d --list-fixes foo.py
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now systematically test <code>autopep8</code> with these classes:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">autopep8_fuzzer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">autopep8_runner</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>(CompletedProcess(args=[&#39;/Users/zeller/anaconda3/bin/autopep8&#39;, &#39;-a&#39;, &#39;--recursive&#39;, &#39;-v&#39;, &#39;foo.py&#39;], returncode=2, stdout=&#39;&#39;, stderr=&#39;usage: autopep8 [-h] [--version] [-v] [-d] [-i] [--global-config filename]\n                [--ignore-local-config] [-r] [-j n] [-p n] [-a]\n                [--experimental] [--exclude globs] [--list-fixes]\n                [--ignore errors] [--select errors] [--max-line-length n]\n                [--line-range line line] [--hang-closing]\n                [files [files ...]]\nautopep8: error: --recursive must be used with --in-place or --diff\n&#39;),
 &#39;UNRESOLVED&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Example:-MyPy">Example: MyPy<a class="anchor-link" href="#Example:-MyPy">&#182;</a></h3><p>We can extract options for the <code>mypy</code> static type checker for Python:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">find_executable</span><span class="p">(</span><span class="s2">&quot;mypy&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mypy_runner</span> <span class="o">=</span> <span class="n">OptionRunner</span><span class="p">(</span><span class="s2">&quot;mypy&quot;</span><span class="p">,</span> <span class="s2">&quot;foo.py&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mypy_runner</span><span class="o">.</span><span class="n">ebnf_grammar</span><span class="p">()[</span><span class="s2">&quot;&lt;option&gt;&quot;</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39; -h&#39;, &#39; --help&#39;, &#39; -v&#39;, &#39; --verbose&#39;, &#39; -V&#39;, &#39; --version&#39;, &#39; --config-file &lt;str&gt;&#39;, &#39; --warn-unused-configs&#39;, &#39; --no-warn-unused-configs&#39;, &#39; --ignore-missing-imports&#39;, &#39; --follow-imports &lt;str&gt;&#39;, &#39; --python-executable&#39;, &#39; --no-site-packages&#39;, &#39; --no-silence-site-packages&#39;, &#39; --python-version &lt;x.y&gt;&#39;, &#39; -2&#39;, &#39; --py2&#39;, &#39; --platform&#39;, &#39; --always-true&#39;, &#39; --always-false&#39;, &#39; --disallow-any-unimported&#39;, &#39; --disallow-subclassing-any&#39;, &#39; --allow-subclassing-any&#39;, &#39; --disallow-any-expr&#39;, &#39; --disallow-any-decorated&#39;, &#39; --disallow-any-explicit&#39;, &#39; --disallow-any-generics&#39;, &#39; --disallow-untyped-calls&#39;, &#39; --allow-untyped-calls&#39;, &#39; --disallow-untyped-defs&#39;, &#39; --allow-untyped-defs&#39;, &#39; --disallow-incomplete-defs&#39;, &#39; --allow-incomplete-defs&#39;, &#39; --check-untyped-defs&#39;, &#39; --no-check-untyped-defs&#39;, &#39; --warn-incomplete-stub&#39;, &#39; --no-warn-incomplete-stub&#39;, &#39; --no-implicit-optional&#39;, &#39; --implicit-optional&#39;, &#39; --strict-optional&#39;, &#39; --no-strict-optional&#39;, &#39; --strict-optional-whitelist( &lt;GLOB&gt;)*&#39;, &#39; --warn-redundant-casts&#39;, &#39; --no-warn-redundant-casts&#39;, &#39; --no-warn-no-return&#39;, &#39; --warn-no-return&#39;, &#39; --warn-return-any&#39;, &#39; --no-warn-return-any&#39;, &#39; --warn-unused-ignores&#39;, &#39; --no-warn-unused-ignores&#39;, &#39; --disallow-untyped-decorators&#39;, &#39; --allow-untyped-decorators&#39;, &#39; -i&#39;, &#39; --incremental&#39;, &#39; --no-incremental&#39;, &#39; --cache-dir&#39;, &#39; --cache-fine-grained&#39;, &#39; --quick-and-dirty&#39;, &#39; --skip-version-check&#39;, &#39; --pdb&#39;, &#39; --show-traceback&#39;, &#39; --tb&#39;, &#39; --custom-typing &lt;MODULE&gt;&#39;, &#39; --custom-typeshed-dir &lt;DIR&gt;&#39;, &#39; --shadow-file&#39;, &#39; --show-error-context&#39;, &#39; --hide-error-context&#39;, &#39; --show-column-numbers&#39;, &#39; --hide-column-numbers&#39;, &#39; --stats&#39;, &#39; --inferstats&#39;, &#39; --find-occurrences &lt;CLASS.MEMBER&gt;&#39;, &#39; --strict&#39;, &#39; --any-exprs-report &lt;DIR&gt;&#39;, &#39; --cobertura-xml-report &lt;DIR&gt;&#39;, &#39; --html-report &lt;DIR&gt;&#39;, &#39; --linecount-report &lt;DIR&gt;&#39;, &#39; --linecoverage-report &lt;DIR&gt;&#39;, &#39; --memory-xml-report &lt;DIR&gt;&#39;, &#39; --txt-report &lt;DIR&gt;&#39;, &#39; --xml-report &lt;DIR&gt;&#39;, &#39; --xslt-html-report &lt;DIR&gt;&#39;, &#39; --xslt-txt-report &lt;DIR&gt;&#39;, &#39; --junit-xml &lt;str&gt;&#39;, &#39; --scripts-are-modules&#39;, &#39; --debug-cache&#39;, &#39; --dump-deps&#39;, &#39; --dump-graph&#39;, &#39; --semantic-analysis-only&#39;, &#39; --local-partial-types&#39;, &#39; --bazel&#39;, &#39; --package-root&#39;, &#39; --cache-map( &lt;str&gt;)+&#39;, &#39; --disallow-any &lt;str&gt;&#39;, &#39; --strict-boolean&#39;, &#39; --no-strict-boolean&#39;, &#39; -f&#39;, &#39; --dirty-stubs&#39;, &#39; --use-python-path&#39;, &#39; -s&#39;, &#39; --silent-imports&#39;, &#39; --almost-silent&#39;, &#39; --fast-parser&#39;, &#39; --no-fast-parser&#39;, &#39; -m&#39;, &#39; --module&#39;, &#39; -p&#39;, &#39; --package&#39;, &#39; -c&#39;, &#39; --command&#39;]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mypy_fuzzer</span> <span class="o">=</span> <span class="n">OptionFuzzer</span><span class="p">(</span><span class="n">mypy_runner</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mypy_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre> foo.py
 -m --no-warn-unused-configs --cache-dir --dirty-stubs --xml-report b --strict --always-false --no-warn-no-return --disallow-any-generics foo.py
 --linecoverage-report VF? --local-partial-types foo.py
 --python-executable --dump-graph --any-exprs-report j --warn-unused-ignores --bazel -2 foo.py
 --scripts-are-modules --warn-no-return --verbose -p --no-silence-site-packages --shadow-file --no-strict-optional --disallow-subclassing-any --strict-optional --almost-silent --package --help foo.py
 --check-untyped-defs --warn-incomplete-stub --no-check-untyped-defs --allow-untyped-calls --ignore-missing-imports foo.py
 --show-traceback --hide-column-numbers --disallow-any-decorated --disallow-untyped-decorators --xslt-html-report pm --warn-redundant-casts --fast-parser --package-root --html-report x --no-site-packages --hide-error-context --always-true foo.py
 --disallow-incomplete-defs --strict-optional-whitelist K -V foo.py
 --custom-typeshed-dir r^ --command -i --skip-version-check foo.py
 --config-file C --allow-incomplete-defs --no-warn-redundant-casts --find-occurrences v8 --warn-unused-configs --disallow-untyped-defs foo.py
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Example:-Notedown">Example: Notedown<a class="anchor-link" href="#Example:-Notedown">&#182;</a></h3><p>Here's the configuration options for the <code>notedown</code> Notebook to Markdown converter:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">find_executable</span><span class="p">(</span><span class="s2">&quot;notedown&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">notedown_runner</span> <span class="o">=</span> <span class="n">OptionRunner</span><span class="p">(</span><span class="s2">&quot;notedown&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">notedown_runner</span><span class="o">.</span><span class="n">ebnf_grammar</span><span class="p">()[</span><span class="s2">&quot;&lt;option&gt;&quot;</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39; -h&#39;, &#39; --help&#39;, &#39; -o( &lt;str&gt;)?&#39;, &#39; --output( &lt;str&gt;)?&#39;, &#39; --from &lt;str&gt;&#39;, &#39; --to &lt;str&gt;&#39;, &#39; --run&#39;, &#39; --execute&#39;, &#39; --timeout &lt;int&gt;&#39;, &#39; --strip&#39;, &#39; --precode( &lt;str&gt;)+&#39;, &#39; --knit( &lt;str&gt;)?&#39;, &#39; --rmagic&#39;, &#39; --nomagic&#39;, &#39; --render&#39;, &#39; --template &lt;str&gt;&#39;, &#39; --match &lt;str&gt;&#39;, &#39; --examples&#39;, &#39; --version&#39;, &#39; --debug&#39;]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">notedown_fuzzer</span> <span class="o">=</span> <span class="n">OptionFuzzer</span><span class="p">(</span><span class="n">notedown_runner</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">notedown_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre> --nomagic
 -o --examples --match 6? --timeout 93 --help --run &gt;
 --precode Y --rmagic --version 2
 --template &#39;* --strip s8p
 --output -h --debug ^
 --execute --render --debug v
 --knit --to q --from m --run -h --version +
 -o --rmagic --nomagic J
 --precode 4 f --version ]
 -o E --version HB
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Combinatorial-Testing">Combinatorial Testing<a class="anchor-link" href="#Combinatorial-Testing">&#182;</a></h2><p>Our <code>CoverageGrammarFuzzer</code> does a good job in covering each and every option at least once, which is great for systematic testing.  However, as we also can see in our examples above, some options require each other, while others interfere with each other.  What we should do as good testers is not only to cover every option individually, but also <em>combinations</em> of options.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The Python <code>itertools</code> module gives us means to create combinations from lists.  We can, for instance, take the <code>notedown</code> options and create a list of all pairs.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/itertools.html" class="import" target="_blank">itertools</a></span> <span class="k">import</span> <span class="n">combinations</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">option_list</span> <span class="o">=</span> <span class="n">notedown_runner</span><span class="o">.</span><span class="n">ebnf_grammar</span><span class="p">()[</span><span class="s2">&quot;&lt;option&gt;&quot;</span><span class="p">]</span>
<span class="n">pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">option_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>There's quite a number of pairs:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>190
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">pairs</span><span class="p">[:</span><span class="mi">20</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[(&#39; -h&#39;, &#39; --help&#39;), (&#39; -h&#39;, &#39; -o( &lt;str&gt;)?&#39;), (&#39; -h&#39;, &#39; --output( &lt;str&gt;)?&#39;), (&#39; -h&#39;, &#39; --from &lt;str&gt;&#39;), (&#39; -h&#39;, &#39; --to &lt;str&gt;&#39;), (&#39; -h&#39;, &#39; --run&#39;), (&#39; -h&#39;, &#39; --execute&#39;), (&#39; -h&#39;, &#39; --timeout &lt;int&gt;&#39;), (&#39; -h&#39;, &#39; --strip&#39;), (&#39; -h&#39;, &#39; --precode( &lt;str&gt;)+&#39;), (&#39; -h&#39;, &#39; --knit( &lt;str&gt;)?&#39;), (&#39; -h&#39;, &#39; --rmagic&#39;), (&#39; -h&#39;, &#39; --nomagic&#39;), (&#39; -h&#39;, &#39; --render&#39;), (&#39; -h&#39;, &#39; --template &lt;str&gt;&#39;), (&#39; -h&#39;, &#39; --match &lt;str&gt;&#39;), (&#39; -h&#39;, &#39; --examples&#39;), (&#39; -h&#39;, &#39; --version&#39;), (&#39; -h&#39;, &#39; --debug&#39;), (&#39; --help&#39;, &#39; -o( &lt;str&gt;)?&#39;)]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Testing every such pair of options frequently suffices to cover all interferences between options.  (Programs rarely have conditions involving three or more configuration settings.)  To this end, we <em>change</em> the grammar from having a list of options to having a list of <em>option pairs</em>, such that covering these will automatically cover all pairs.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We create a function <code>pairwise()</code> that takes a list of options as occurring in our grammar and returns a list of <em>pairwise options</em> – that is, our original options, but concatenated.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">pairwise</span><span class="p">(</span><span class="n">option_list</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">option_1</span> <span class="o">+</span> <span class="n">option_2</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">option_1</span><span class="p">,</span> <span class="n">option_2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">option_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's the first 20 pairs:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">pairwise</span><span class="p">(</span><span class="n">option_list</span><span class="p">)[:</span><span class="mi">20</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39; -h --help&#39;, &#39; -h -o( &lt;str&gt;)?&#39;, &#39; -h --output( &lt;str&gt;)?&#39;, &#39; -h --from &lt;str&gt;&#39;, &#39; -h --to &lt;str&gt;&#39;, &#39; -h --run&#39;, &#39; -h --execute&#39;, &#39; -h --timeout &lt;int&gt;&#39;, &#39; -h --strip&#39;, &#39; -h --precode( &lt;str&gt;)+&#39;, &#39; -h --knit( &lt;str&gt;)?&#39;, &#39; -h --rmagic&#39;, &#39; -h --nomagic&#39;, &#39; -h --render&#39;, &#39; -h --template &lt;str&gt;&#39;, &#39; -h --match &lt;str&gt;&#39;, &#39; -h --examples&#39;, &#39; -h --version&#39;, &#39; -h --debug&#39;, &#39; --help -o( &lt;str&gt;)?&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The new grammar <code>pairwise_notedown_grammar</code> is a copy of the <code>notedown</code> grammar, but with the list of options replaced with the above pairwise option list.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/copy.html" class="import" target="_blank">copy</a></span> <span class="k">import</span> <span class="n">deepcopy</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">notedown_grammar</span> <span class="o">=</span> <span class="n">notedown_runner</span><span class="o">.</span><span class="n">grammar</span><span class="p">()</span>
<span class="n">pairwise_notedown_grammar</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">notedown_grammar</span><span class="p">)</span>
<span class="n">pairwise_notedown_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;option&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pairwise</span><span class="p">(</span><span class="n">notedown_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;option&gt;&quot;</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">pairwise_notedown_grammar</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Using the "pairwise" grammar to fuzz now covers one pair after another:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">notedown_fuzzer</span> <span class="o">=</span> <span class="n">GrammarCoverageFuzzer</span><span class="p">(</span>
    <span class="n">pairwise_notedown_grammar</span><span class="p">,</span> <span class="n">max_nonterminals</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">notedown_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
 --run --debug --help --execute
 -o --timeout 8
 --precode : --render -h --run
 --help --debug --strip --nomagic G
 --render --debug --rmagic --nomagic r
 --help --version --execute --strip ^
 -h --execute --precode t --version ip
 --nomagic --debug --version --debug -h --render K
 --examples --version --help --examples
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Can we actually test all combinations of options?  Not in practice, as the number of combinations quickly grows as the length increases.  It decreases again as the the number of options reach the maximum (with 20 options, there is only 1 combination involving <em>all</em> options), but the absolute numbers are still staggering:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">combination_length</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">):</span>
    <span class="n">tuples</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">option_list</span><span class="p">,</span> <span class="n">combination_length</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">combination_length</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tuples</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>1 20
2 190
3 1140
4 4845
5 15504
6 38760
7 77520
8 125970
9 167960
10 184756
11 167960
12 125970
13 77520
14 38760
15 15504
16 4845
17 1140
18 190
19 20
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Formally, the number of combinations of length $k$ in a set of options of length $n$ is the binomial coefficient
$$
{n \choose k} = \frac{n!}{k!(n - k)!}
$$</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>which for $k = 2$ (all pairs) gives us</p>
<p>$$
{n \choose 2} = \frac{n!}{2(n - 2)!} = n \times (n - 1)
$$</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For <code>autopep8</code> with its 29 options...</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">autopep8_runner</span><span class="o">.</span><span class="n">ebnf_grammar</span><span class="p">()[</span><span class="s2">&quot;&lt;option&gt;&quot;</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>29
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>... we thus need 812 tests to cover all pairs:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">autopep8_runner</span><span class="o">.</span><span class="n">ebnf_grammar</span><span class="p">()[</span><span class="s2">&quot;&lt;option&gt;&quot;</span><span class="p">])</span> <span class="o">*</span> \
    <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">autopep8_runner</span><span class="o">.</span><span class="n">ebnf_grammar</span><span class="p">()[</span><span class="s2">&quot;&lt;option&gt;&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>812
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For <code>mypy</code> with its 110 options, though, we already end up with 11,990 tests to be conducted:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">mypy_runner</span><span class="o">.</span><span class="n">ebnf_grammar</span><span class="p">()[</span><span class="s2">&quot;&lt;option&gt;&quot;</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>110
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">mypy_runner</span><span class="o">.</span><span class="n">ebnf_grammar</span><span class="p">()[</span><span class="s2">&quot;&lt;option&gt;&quot;</span><span class="p">])</span> <span class="o">*</span> \
    <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mypy_runner</span><span class="o">.</span><span class="n">ebnf_grammar</span><span class="p">()[</span><span class="s2">&quot;&lt;option&gt;&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>11990
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Even if each pair takes a second to run, we'd still be done in three hours of testing, though.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If your program has more options that you all want to get covered in combinations, it is advisable that you limit the number of configurations further – for instance by limiting combinatorial testing to those combinations that possibly can interact with each other; and covering all other (presumably orthogonal) options individually.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This mechanism of creating configurations by extending grammars can be easily extended to other configuration targets.  One may want to explore a greater number of configurations, or expansions in specific contexts.  The exercises, below, have a number of options ready for you.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned<a class="anchor-link" href="#Lessons-Learned">&#182;</a></h2><ul>
<li>Besides regular input data, program <em>configurations</em> make an important testing target.</li>
<li>For a given program using a standard library to parse command-line options and arguments, one can automatically extract these and convert them into a grammar.</li>
<li>To cover not only single options, but combinations of options, one can expand the grammar to cover all pairs, or come up with even more ambitious targets.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps<a class="anchor-link" href="#Next-Steps">&#182;</a></h2><p>If you liked the idea of mining a grammar from a program, do not miss:</p>
<ul>
<li><a href="GrammarMiner.html">how to mine grammars for input data</a></li>
</ul>
<p>Our next steps in the book focus on:</p>
<ul>
<li><a href="Parser.html">how to parse and recombine inputs</a></li>
<li><a href="ProbabilisticGrammarFuzzer.html">how to assign weights and probabilities to specific productions</a></li>
<li><a href="Reducer.html">how to simply inputs that cause a failure</a></li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Background">Background<a class="anchor-link" href="#Background">&#182;</a></h2><p>Although configuration data is just as likely to cause failures as other input data, it has received relatively little attention in test generation – possibly because, unlike "regular" input data, configuration data is not so much under control of external parties, and because, again unlike regular data, there is little variance in configurations.  Creating models for software configurations and using these models for testing is commonplace, as is the idea of pairwise testing.  For an overview, see [<a href="http://ix.cs.uoregon.edu/~michal/book/">Pezzè <em>et al</em>, 2008.</a>]; for a discussion and comparison of state-of-the-art techniques, see [<a href="https://doi.org/10.1109/TSE.2015.2421279">J. Petke <em>et al</em>, 2015.</a>].</p>
<p>More specifically, [<a href="http://www.fuzzing.org/">Sutton <em>et al</em>, 2007.</a>] also discuss techniques to systematically cover command-line options.  Dai et al. [<a href="https://doi.org/10.4018/jsse.2010070103">Dai <em>et al</em>, 2010.</a>] apply configuration fuzzing by changing variables associated with configuration files.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1:-Configuration-Files">Exercise 1: Configuration Files<a class="anchor-link" href="#Exercise-1:-Configuration-Files">&#182;</a></h3><p>Besides command-line options, a second important source of configurations are <em>configuration files</em>.  In this exercise, we will consider the very simple configuration language provided by the Python <code>ConfigParser</code> module, which is very similar to what is found in Microsoft Windows <em>.ini</em> files.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The following example for a <code>ConfigParser</code> input file stems right from <a href="https://docs.python.org/3/library/configparser.html">the ConfigParser documentation</a>:</p>

<pre><code>[DEFAULT]
ServerAliveInterval = 45
Compression = yes
CompressionLevel = 9
ForwardX11 = yes

[bitbucket.org]
User = hg

[topsecret.server.com]
Port = 50022
ForwardX11 = no</code></pre>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The above <code>ConfigParser</code> file can be created programmatically:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/configparser.html" class="import" target="_blank">configparser</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
<span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ServerAliveInterval&#39;</span><span class="p">:</span> <span class="s1">&#39;45&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Compression&#39;</span><span class="p">:</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;CompressionLevel&#39;</span><span class="p">:</span> <span class="s1">&#39;9&#39;</span><span class="p">}</span>
<span class="n">config</span><span class="p">[</span><span class="s1">&#39;bitbucket.org&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">config</span><span class="p">[</span><span class="s1">&#39;bitbucket.org&#39;</span><span class="p">][</span><span class="s1">&#39;User&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;hg&#39;</span>
<span class="n">config</span><span class="p">[</span><span class="s1">&#39;topsecret.server.com&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">topsecret</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;topsecret.server.com&#39;</span><span class="p">]</span>
<span class="n">topsecret</span><span class="p">[</span><span class="s1">&#39;Port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;50022&#39;</span>     <span class="c1"># mutates the parser</span>
<span class="n">topsecret</span><span class="p">[</span><span class="s1">&#39;ForwardX11&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>  <span class="c1"># same here</span>
<span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEFAULT&#39;</span><span class="p">][</span><span class="s1">&#39;ForwardX11&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;example.ini&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">configfile</span><span class="p">:</span>
    <span class="n">config</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">configfile</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;example.ini&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">configfile</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">configfile</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[DEFAULT]
serveraliveinterval = 45
compression = yes
compressionlevel = 9
forwardx11 = yes

[bitbucket.org]
user = hg

[topsecret.server.com]
port = 50022
forwardx11 = no
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>and be read in again:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;example.ini&#39;</span><span class="p">)</span>
<span class="n">topsecret</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;topsecret.server.com&#39;</span><span class="p">]</span>
<span class="n">topsecret</span><span class="p">[</span><span class="s1">&#39;Port&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;50022&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-1:-Read-Configuration">Part 1: Read Configuration<a class="anchor-link" href="#Part-1:-Read-Configuration">&#182;</a></h4><p>Using <code>configparser</code>, create a program reading in the above configuration file and accessing the individual elements.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-2:-Create-a-Configuration-Grammar">Part 2: Create a Configuration Grammar<a class="anchor-link" href="#Part-2:-Create-a-Configuration-Grammar">&#182;</a></h4><p>Design a grammar that will automatically create configuration files suitable for your above program.  Fuzz your program with it.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-3:-Mine-a-Configuration-Grammar">Part 3: Mine a Configuration Grammar<a class="anchor-link" href="#Part-3:-Mine-a-Configuration-Grammar">&#182;</a></h4><p>By dynamically tracking the individual accesses to configuration elements, you can again extract a basic grammar from the execution.  To this end, create a subclass of <code>ConfigParser</code> with a special method <code>__getitem__</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TrackingConfigParser</span><span class="p">(</span><span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accessing&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</pre></div>

</div>
</div>
    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For a <code>TrackingConfigParser</code> object <code>p</code>, <code>p.__getitem__(key)</code> will be invoked whenever <code>p[key]</code> is accessed:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tracking_config_parser</span> <span class="o">=</span> <span class="n">TrackingConfigParser</span><span class="p">()</span>
<span class="n">tracking_config_parser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;example.ini&#39;</span><span class="p">)</span>
<span class="n">section</span> <span class="o">=</span> <span class="n">tracking_config_parser</span><span class="p">[</span><span class="s1">&#39;topsecret.server.com&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Accessing &#39;topsecret.server.com&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Using <code>__getitem__()</code>, as above, implement a tracking mechanism that, while your program accesses the read configuration, automatically saves options accessed and values read.  Create a prototype grammar from these values; use it for fuzzing.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>At the end, don't forget to clean up:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/os.html" class="import" target="_blank">os</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;example.ini&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2:-C-Option-Fuzzing">Exercise 2: C Option Fuzzing<a class="anchor-link" href="#Exercise-2:-C-Option-Fuzzing">&#182;</a></h3><p>In C programs, the <code>getopt()</code> function are frequently used to process configuration options.  A call</p>

<pre><code>getopt(argc, argv, "bf:")</code></pre>
<p>indicates that the program accepts two options <code>-b</code> and <code>-f</code>, with <code>-f</code> taking an argument (as indicated by the following colon).</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-1:-Getopt-Fuzzing">Part 1: Getopt Fuzzing<a class="anchor-link" href="#Part-1:-Getopt-Fuzzing">&#182;</a></h4><p>Write a framework which, for a given C program, automatically extracts the argument to <code>getopt()</code> and derives a fuzzing grammar for it.  There are multiple ways to achieve this:</p>
<ol>
<li>Scan the program source code for occurrences of <code>getopt()</code> and return the string passed.  (Crude, but should frequently work.)</li>
<li>Insert your own implementation of <code>getopt()</code> into the source code (effectively replacing <code>getopt()</code> from the runtime library), which outputs the <code>getopt()</code> argument and exits the program.  Recompile and run.</li>
<li>(Advanced.) As above, but instead of changing the source code, hook into the <em>dynamic linker</em> which at runtime links the program with the C runtime library.  Set the library loading path (on Linux and Unix, this is the <code>LD_LIBRARY_PATH</code> environment variable) such that your own version of <code>getopt()</code> is linked first, and the regular libraries later.  Executing the program (without recompiling) should yield the desired result.</li>
</ol>
<p>Apply this on <code>grep</code> and <code>ls</code>; report the resulting grammars and results.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-2:-Fuzzing-Long-Options-in-C">Part 2: Fuzzing Long Options in C<a class="anchor-link" href="#Part-2:-Fuzzing-Long-Options-in-C">&#182;</a></h4><p>Same as Part 1, but also hook into the GNU variant <code>getopt_long()</code>, which accepts "long" arguments with double dashes such as <code>--help</code>.  Note that method 1, above, will not work here, since the "long" options are defined in a separately defined structure.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-3:-Expansions-in-Context">Exercise 3: Expansions in Context<a class="anchor-link" href="#Exercise-3:-Expansions-in-Context">&#182;</a></h3><p>In our above option configurations, we have multiple symbols which all expand to the same integer.  For instance, the <code>--line-range</code> option of <code>autopep8</code> takes two <code>&lt;line&gt;</code> parameters which both expand into the same <code>&lt;int&gt;</code> symbol:</p>

<pre><code>&lt;option&gt; ::= ... | --line-range &lt;line&gt; &lt;line&gt; | ...
&lt;line&gt; ::= &lt;int&gt;
&lt;int&gt; ::= (-)?&lt;digit&gt;+
&lt;digit&gt; ::= 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9</code></pre>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">autopep8_runner</span><span class="o">.</span><span class="n">ebnf_grammar</span><span class="p">()[</span><span class="s2">&quot;&lt;line&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;&lt;int&gt;&#39;]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">autopep8_runner</span><span class="o">.</span><span class="n">ebnf_grammar</span><span class="p">()[</span><span class="s2">&quot;&lt;int&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;(-)?&lt;digit&gt;+&#39;]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">autopep8_runner</span><span class="o">.</span><span class="n">ebnf_grammar</span><span class="p">()[</span><span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Once the <code>GrammarCoverageFuzzer</code> has covered all variations of <code>&lt;int&gt;</code> (especially by covering all digits) for <em>one</em> option, though, it will no longer strive to achieve such coverage for the next option.  Yet, it could be desirable to achieve such coverage for each option separately.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>One way to achieve this with our existing <code>GrammarCoverageFuzzer</code> is again to change the grammar accordingly.  The idea is to <em>duplicate</em> expansions – that is, to replace an expansion of a symbol $s$ with a new symbol $s'$ whose definition is duplicated from $s$.  This way, $s'$ and $s$ are separate symbols from a coverage point of view and would be independently covered.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As an example, consider again the above <code>--line-range</code> option.  If we want our tests to independently cover all elements of the two <code>&lt;line&gt;</code> parameters, we can duplicate the second <code>&lt;line&gt;</code> expansion into a new symbol <code>&lt;line'&gt;</code> with subsequent duplicated expansions:</p>

<pre><code>&lt;option&gt; ::= ... | --line-range &lt;line&gt; &lt;line'&gt; | ...
&lt;line&gt; ::= &lt;int&gt;
&lt;line'&gt; ::= &lt;int'&gt;
&lt;int&gt; ::= (-)?&lt;digit&gt;+
&lt;int'&gt; ::= (-)?&lt;digit'&gt;+
&lt;digit&gt; ::= 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9
&lt;digit'&gt; ::= 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9</code></pre>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Design a function <code>inline(grammar, symbol)</code> that returns a duplicate of <code>grammar</code> in which every occurrence of <code>&lt;symbol&gt;</code> and its expansions become separate copies.  The above grammar could be a result of <code>inline(autopep8_runner.ebnf_grammar(), "&lt;line&gt;")</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>When copying, expansions in the copy should also refer to symbols in the copy.  Hence, when expanding <code>&lt;int&gt;</code> in</p>
<p><code>&lt;int&gt; ::= &lt;int&gt;&lt;digit&gt;</code></p>
<p>make that</p>
<p>```<int> ::= <int><digit></p>
<p>&lt;int'&gt; ::= &lt;int'&gt;&lt;digit'&gt;
```</p>
<p>(and not <code>&lt;int'&gt; ::= &lt;int&gt;&lt;digit'&gt;</code> or <code>&lt;int'&gt; ::= &lt;int&gt;&lt;digit&gt;</code>).</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Be sure to add precisely one new set of symbols for each occurrence in the original grammar, and not to expand further in the presence of recursion.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Parsing-and-Recombining-Inputs">Parsing and Recombining Inputs<a class="anchor-link" href="#Parsing-and-Recombining-Inputs">&#182;</a></h1><p>In the chapter on <a href="Grammars.html">Grammars</a>, we discussed how grammars can be
used to represent various languages. We also saw how grammars can be used to
generate strings of the corresponding language. Grammars can also perform the
reverse. That is, given a string, one can decompose the string into its
constituent parts that correspond to the parts grammar used to generate it
-- the derivation tree of that string. These parts (and parts from other similar
strings) can later be recombined using the same grammar to produce new strings.</p>
<p>In this chapter, we use grammars to parse and decompose inputs to
their corresponding derivation trees, allowing us to recombine them
arbitrarily.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>You should have read the <a href="Grammars.html">chapter on grammars</a>.</li>
<li>An understanding of derivation trees from the <a href="GrammarFuzzer.html">chapter on grammar fuzzer</a>
is also required.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
<span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="k">import</span> <span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">START_SYMBOL</span><span class="p">,</span> <span class="n">RE_NONTERMINAL</span>
<span class="kn">from</span> <span class="nn"><a href="GrammarFuzzer.html" class="import" target="_blank">GrammarFuzzer</a></span> <span class="k">import</span> <span class="n">display_tree</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">,</span> <span class="n">GrammarFuzzer</span>
<span class="kn">from</span> <span class="nn"><a href="ExpectError.html" class="import" target="_blank">ExpectError</a></span> <span class="k">import</span> <span class="n">ExpectError</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In order to parse a string, one needs to identify the language, and the
corresponding grammar. For example, here is a string that we would like to parse</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mystring</span> <span class="o">=</span> <span class="s1">&#39;1+2&#39;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This string is an arithmetic expression for addition, which may be specified using a grammar.</p>
<h2 id="Grammars">Grammars<a class="anchor-link" href="#Grammars">&#182;</a></h2><p>A grammar, as you have read from the <a href="Grammars.html">chapter on grammars</a> is a set of rules the explain how the start symbol can be expanded, and each rule has a name, also called a non-terminal, and a set of alternative choices in how it can be expanded.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">A1_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;expr&gt;+&lt;expr&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;expr&gt;-&lt;expr&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;integer&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;integer&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;digit&gt;&lt;integer&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span> <span class="s2">&quot;9&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In the above expression, the rule <code>&lt;expr&gt; : &lt;expr&gt;+&lt;expr&gt;|&lt;expr&gt;-&lt;expr&gt;|&lt;int&gt;</code> corresponds to how the non-terminal <code>&lt;expr&gt;</code> might be expanded. We expression <code>&lt;expr&gt;+&lt;expr&gt;</code> corresponds to one of the alternative choices. We call this an <em>alternative</em> expansion for the non-terminal <code>&lt;expr&gt;</code>. Finally, in an expression <code>&lt;expr&gt;+&lt;expr&gt;</code>, each of <code>&lt;expr&gt;</code>, <code>+</code>, and <code>&lt;expr&gt;</code> are <em>symbols</em> in that expansion. A symbol could be either a non-terminal or a terminal symbol based on whether its expansion is available in the grammar.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <em>derivation tree</em> for our expression from this grammar is given by:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&lt;start&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;expr&gt;&#39;</span><span class="p">,</span>
                     <span class="p">[(</span><span class="s1">&#39;&lt;expr&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;integer&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;digit&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">[])])])]),</span>
                      <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="p">[]),</span>
                      <span class="p">(</span><span class="s1">&#39;&lt;expr&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;integer&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;digit&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
                                                               <span class="p">[])])])])])])</span>
<span class="k">assert</span> <span class="n">mystring</span> <span class="o">==</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="149pt" height="278pt"
 viewBox="0.00 0.00 149.00 278.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 274)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-274 145,-274 145,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="70.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="70.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M70.5,-254.9748C70.5,-248.195 70.5,-237.966 70.5,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="74.0001,-229.0561 70.5,-219.0561 67.0001,-229.0561 74.0001,-229.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="27.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M64.1552,-203.9748C57.9308,-196.5923 48.2583,-185.1203 40.4119,-175.8142"/>
<polygon fill="#000000" stroke="#000000" points="42.9927,-173.4452 33.8708,-168.0561 37.641,-177.9574 42.9927,-173.4452"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="70.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- 1&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>1&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M70.5,-203.9748C70.5,-197.195 70.5,-186.966 70.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="74.0001,-178.0561 70.5,-168.0561 67.0001,-178.0561 74.0001,-178.0561"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="113.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>1&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M76.8448,-203.9748C83.0692,-196.5923 92.7417,-185.1203 100.5881,-175.8142"/>
<polygon fill="#000000" stroke="#000000" points="103.359,-177.9574 107.1292,-168.0561 98.0073,-173.4452 103.359,-177.9574"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="27.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M27.5,-152.9748C27.5,-146.195 27.5,-135.966 27.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-127.0561 27.5,-117.0561 24.0001,-127.0561 31.0001,-127.0561"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="27.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M27.5,-101.9748C27.5,-95.195 27.5,-84.966 27.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-76.0561 27.5,-66.0561 24.0001,-76.0561 31.0001,-76.0561"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="27.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">1</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M27.5,-50.9748C27.5,-44.195 27.5,-33.966 27.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-25.0561 27.5,-15.0561 24.0001,-25.0561 31.0001,-25.0561"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="113.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M113.5,-152.9748C113.5,-146.195 113.5,-135.966 113.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="117.0001,-127.0561 113.5,-117.0561 110.0001,-127.0561 117.0001,-127.0561"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="113.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M113.5,-101.9748C113.5,-95.195 113.5,-84.966 113.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="117.0001,-76.0561 113.5,-66.0561 110.0001,-76.0561 117.0001,-76.0561"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="113.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M113.5,-50.9748C113.5,-44.195 113.5,-33.966 113.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="117.0001,-25.0561 113.5,-15.0561 110.0001,-25.0561 117.0001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>While a grammar can be used to specify a given language, there could be multiple
grammars that correspond to the same language. For example, here is another 
grammar to describe the same addition expression.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">A2_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;integer&gt;&lt;expr_&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;expr_&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;+&lt;expr&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&lt;expr&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;integer&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;digit&gt;&lt;integer_&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;integer_&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;integer&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span> <span class="s2">&quot;9&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The corresponding derivation tree is given by:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&lt;start&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;expr&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;integer&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;digit&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">[])]),</span>
                                               <span class="p">(</span><span class="s1">&#39;&lt;integer_&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[])])]),</span>
                                <span class="p">(</span><span class="s1">&#39;&lt;expr_&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="p">[]),</span>
                                             <span class="p">(</span><span class="s1">&#39;&lt;expr&gt;&#39;</span><span class="p">,</span>
                                              <span class="p">[(</span><span class="s1">&#39;&lt;integer&gt;&#39;</span><span class="p">,</span>
                                                <span class="p">[(</span><span class="s1">&#39;&lt;digit&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="p">[])]),</span>
                                                 <span class="p">(</span><span class="s1">&#39;&lt;integer_&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[])])]),</span>
                                               <span class="p">(</span><span class="s1">&#39;&lt;expr_&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[])])])])])])</span>
<span class="k">assert</span> <span class="n">mystring</span> <span class="o">==</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="268pt" height="329pt"
 viewBox="0.00 0.00 268.00 329.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 325)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-325 264,-325 264,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="118" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="118" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M118,-305.9748C118,-299.195 118,-288.966 118,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="121.5001,-280.0561 118,-270.0561 114.5001,-280.0561 121.5001,-280.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="83" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M112.8356,-254.9748C107.8726,-247.743 100.2165,-236.5868 93.9026,-227.3866"/>
<polygon fill="#000000" stroke="#000000" points="96.7298,-225.3208 88.1856,-219.0561 90.9582,-229.2817 96.7298,-225.3208"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="153" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr_&gt;</text>
</g>
<!-- 1&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>1&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M123.1644,-254.9748C128.1274,-247.743 135.7835,-236.5868 142.0974,-227.3866"/>
<polygon fill="#000000" stroke="#000000" points="145.0418,-229.2817 147.8144,-219.0561 139.2702,-225.3208 145.0418,-229.2817"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="21" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M73.8517,-203.9748C64.5106,-196.291 49.7838,-184.177 38.2456,-174.6859"/>
<polygon fill="#000000" stroke="#000000" points="40.1322,-171.7058 30.1858,-168.0561 35.6853,-177.1119 40.1322,-171.7058"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="91" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer_&gt;</text>
</g>
<!-- 2&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>2&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M84.1804,-203.9748C85.2439,-197.195 86.8485,-186.966 88.234,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="91.7227,-178.4777 89.8147,-168.0561 84.8073,-177.3929 91.7227,-178.4777"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="21" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">1</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M21,-152.9748C21,-146.195 21,-135.966 21,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="24.5001,-127.0561 21,-117.0561 17.5001,-127.0561 24.5001,-127.0561"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M91,-152.9748C91,-152.9194 91,-152.8637 91,-152.8078"/>
<polygon fill="#000000" stroke="#000000" points="94.5059,-162.6375 91,-152.6395 87.5059,-162.6416 94.5059,-162.6375"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="149" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M152.4098,-203.9748C151.878,-197.195 151.0758,-186.966 150.383,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="153.8639,-177.7518 149.5926,-168.0561 146.8854,-178.2992 153.8639,-177.7518"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="192" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 7&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>7&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M158.7546,-203.9748C164.3424,-196.6677 172.994,-185.354 180.0708,-176.0997"/>
<polygon fill="#000000" stroke="#000000" points="182.9275,-178.1258 186.2218,-168.0561 177.367,-173.8736 182.9275,-178.1258"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="166" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M188.1636,-152.9748C184.592,-145.969 179.1429,-135.2803 174.5416,-126.2547"/>
<polygon fill="#000000" stroke="#000000" points="177.5122,-124.3755 169.8521,-117.0561 171.2759,-127.5548 177.5122,-124.3755"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="236" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr_&gt;</text>
</g>
<!-- 9&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>9&#45;&gt;15</title>
<path fill="none" stroke="#000000" d="M198.4924,-152.9748C204.8615,-145.5923 214.759,-134.1203 222.7878,-124.8142"/>
<polygon fill="#000000" stroke="#000000" points="225.5987,-126.914 229.481,-117.0561 220.2986,-122.3414 225.5987,-126.914"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="107" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M157.2943,-101.9748C148.4053,-94.291 134.391,-82.177 123.4111,-72.6859"/>
<polygon fill="#000000" stroke="#000000" points="125.5956,-69.9478 115.7414,-66.0561 121.0179,-75.2435 125.5956,-69.9478"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="177" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer_&gt;</text>
</g>
<!-- 10&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>10&#45;&gt;13</title>
<path fill="none" stroke="#000000" d="M167.6231,-101.9748C169.1016,-95.1196 171.3408,-84.7383 173.2602,-75.8392"/>
<polygon fill="#000000" stroke="#000000" points="176.6831,-76.5693 175.3703,-66.0561 169.8405,-75.0934 176.6831,-76.5693"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="107" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>11&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M107,-50.9748C107,-44.195 107,-33.966 107,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="110.5001,-25.0561 107,-15.0561 103.5001,-25.0561 110.5001,-25.0561"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13&#45;&gt;14</title>
<path fill="none" stroke="#000000" d="M177,-50.9748C177,-50.9194 177,-50.8637 177,-50.8078"/>
<polygon fill="#000000" stroke="#000000" points="180.5059,-60.6375 177,-50.6395 173.5059,-60.6416 180.5059,-60.6375"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15&#45;&gt;16</title>
<path fill="none" stroke="#000000" d="M236,-101.9748C236,-101.9194 236,-101.8637 236,-101.8078"/>
<polygon fill="#000000" stroke="#000000" points="239.5059,-111.6375 236,-101.6395 232.5059,-111.6416 239.5059,-111.6375"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Indeed, there could be different classes of grammars that
describe the same language. For example, the first grammar <code>A1_GRAMMAR</code>
is a grammar that sports both <em>right</em> and <em>left</em> recursion, while the
second grammar <code>A2_GRAMMAR</code> does not have left recursion in the
non-terminals in any of its productions, but contains <em>epsilon</em> productions.
(An epsilon production is a production that has empty string in its right
hand side.)</p>
<h4 id="Recursion">Recursion<a class="anchor-link" href="#Recursion">&#182;</a></h4><p>A grammar is <em>left recursive</em> if any of its non-terminals are left recursive,
and a non-terminal is directly left-recursive if the left-most symbol of
any of its productions is itself. It is indirectly left-recursive if any
of the left-most symbols can be expanded using their definitions to
produce the non-terminal as the left-most symbol of the expansion. The left
recursion is called a <em>hidden-left-recursion</em> if during the series of
expansions of  a non-terminal, one reaches a rule where the rule contains
the same non-terminal after a prefix of other symbols, and these symbols can
dervive the empty string. For example, in <code>A1_GRAMMAR</code>, <code>&lt;integer&gt;</code> will be
considered hidden-left recursive if <code>&lt;digit&gt;</code> could derive an empty string.</p>
<p>Right recursive grammars are defined similarly.</p>
<p>For example, in <code>A1_GRAMMAR</code>, the definition of <code>&lt;expr&gt;</code> is
left-recursive, and right recursive directly. However in <code>A2_GRAMMAR</code>,
<code>&lt;expr&gt;</code> is right recursive indirectly through the expansion of <code>&lt;expr_&gt;</code>.</p>
<h4 id="Ambiguity">Ambiguity<a class="anchor-link" href="#Ambiguity">&#182;</a></h4><p>To complicate matters further, there could be
multiple derivation trees -- also called <em>parses</em> -- corresponding to the
same string from the same grammar. For example, a string <code>1+2+3</code> can be parsed
in two ways as we see below using the <code>A1_GRAMMAR</code></p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mystring</span> <span class="o">=</span> <span class="s1">&#39;1+2+3&#39;</span>
<span class="n">tree</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&lt;start&gt;&#39;</span><span class="p">,</span>
        <span class="p">[(</span><span class="s1">&#39;&lt;expr&gt;&#39;</span><span class="p">,</span>
          <span class="p">[(</span><span class="s1">&#39;&lt;expr&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;expr&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;integer&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;digit&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">[])])])]),</span>
                       <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="p">[]),</span>
                       <span class="p">(</span><span class="s1">&#39;&lt;expr&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;integer&gt;&#39;</span><span class="p">,</span>
                                    <span class="p">[(</span><span class="s1">&#39;&lt;digit&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="p">[])])])])]),</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="p">[]),</span>
           <span class="p">(</span><span class="s1">&#39;&lt;expr&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;integer&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;digit&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="p">[])])])])])])</span>
<span class="k">assert</span> <span class="n">mystring</span> <span class="o">==</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="215pt" height="329pt"
 viewBox="0.00 0.00 215.00 329.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 325)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-325 211,-325 211,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="130.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="130.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M130.5,-305.9748C130.5,-299.195 130.5,-288.966 130.5,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="134.0001,-280.0561 130.5,-270.0561 127.0001,-280.0561 134.0001,-280.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="81.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M123.2699,-254.9748C116.1046,-247.517 104.9294,-235.8857 95.9406,-226.53"/>
<polygon fill="#000000" stroke="#000000" points="98.2119,-223.8423 88.7598,-219.0561 93.1642,-228.6921 98.2119,-223.8423"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="130.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- 1&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>1&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M130.5,-254.9748C130.5,-248.195 130.5,-237.966 130.5,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="134.0001,-229.0561 130.5,-219.0561 127.0001,-229.0561 134.0001,-229.0561"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="176.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>1&#45;&gt;13</title>
<path fill="none" stroke="#000000" d="M137.2875,-254.9748C144.0141,-247.517 154.505,-235.8857 162.9436,-226.53"/>
<polygon fill="#000000" stroke="#000000" points="165.586,-228.826 169.6847,-219.0561 160.388,-224.1376 165.586,-228.826"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="27.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M73.5321,-203.9748C65.4761,-196.3663 52.8208,-184.4141 42.8167,-174.9658"/>
<polygon fill="#000000" stroke="#000000" points="45.1739,-172.3778 35.5006,-168.0561 40.3675,-177.4669 45.1739,-172.3778"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="70.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- 2&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>2&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M79.8769,-203.9748C78.3984,-197.1196 76.1592,-186.7383 74.2398,-177.8392"/>
<polygon fill="#000000" stroke="#000000" points="77.6595,-177.0934 72.1297,-168.0561 70.8169,-178.5693 77.6595,-177.0934"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="113.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>2&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M86.2217,-203.9748C90.712,-196.8183 97.6137,-185.8188 103.3512,-176.6747"/>
<polygon fill="#000000" stroke="#000000" points="106.4087,-178.387 108.7589,-168.0561 100.4792,-174.6665 106.4087,-178.387"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="27.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M27.5,-152.9748C27.5,-146.195 27.5,-135.966 27.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-127.0561 27.5,-117.0561 24.0001,-127.0561 31.0001,-127.0561"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="27.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M27.5,-101.9748C27.5,-95.195 27.5,-84.966 27.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-76.0561 27.5,-66.0561 24.0001,-76.0561 31.0001,-76.0561"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="27.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">1</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M27.5,-50.9748C27.5,-44.195 27.5,-33.966 27.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-25.0561 27.5,-15.0561 24.0001,-25.0561 31.0001,-25.0561"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="112.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M113.3524,-152.9748C113.2195,-146.195 113.0189,-135.966 112.8457,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="116.3436,-126.9855 112.6482,-117.0561 109.345,-127.1228 116.3436,-126.9855"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="112.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M112.5,-101.9748C112.5,-95.195 112.5,-84.966 112.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="116.0001,-76.0561 112.5,-66.0561 109.0001,-76.0561 116.0001,-76.0561"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="112.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M112.5,-50.9748C112.5,-44.195 112.5,-33.966 112.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="116.0001,-25.0561 112.5,-15.0561 109.0001,-25.0561 116.0001,-25.0561"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="179.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13&#45;&gt;14</title>
<path fill="none" stroke="#000000" d="M176.9427,-203.9748C177.3415,-197.195 177.9432,-186.966 178.4628,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="181.9622,-178.2444 179.0555,-168.0561 174.9742,-177.8333 181.9622,-178.2444"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="179.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 14&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>14&#45;&gt;15</title>
<path fill="none" stroke="#000000" d="M179.5,-152.9748C179.5,-146.195 179.5,-135.966 179.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="183.0001,-127.0561 179.5,-117.0561 176.0001,-127.0561 183.0001,-127.0561"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="179.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">3</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15&#45;&gt;16</title>
<path fill="none" stroke="#000000" d="M179.5,-101.9748C179.5,-95.195 179.5,-84.966 179.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="183.0001,-76.0561 179.5,-66.0561 176.0001,-76.0561 183.0001,-76.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&lt;start&gt;&#39;</span><span class="p">,</span>
        <span class="p">[(</span><span class="s1">&#39;&lt;expr&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;expr&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;integer&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;digit&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">[])])])]),</span>
                     <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="p">[]),</span>
                     <span class="p">(</span><span class="s1">&#39;&lt;expr&gt;&#39;</span><span class="p">,</span>
                      <span class="p">[(</span><span class="s1">&#39;&lt;expr&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;integer&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;digit&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="p">[])])])]),</span>
                       <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="p">[]),</span>
                       <span class="p">(</span><span class="s1">&#39;&lt;expr&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;integer&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;&lt;digit&gt;&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;3&#39;</span><span class="p">,</span>
                                                                <span class="p">[])])])])])])])</span>
<span class="k">assert</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">==</span> <span class="n">mystring</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="215pt" height="329pt"
 viewBox="0.00 0.00 215.00 329.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 325)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-325 211,-325 211,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="87.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="87.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M87.5,-305.9748C87.5,-299.195 87.5,-288.966 87.5,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="91.0001,-280.0561 87.5,-270.0561 84.0001,-280.0561 91.0001,-280.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="38.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M80.2699,-254.9748C73.1046,-247.517 61.9294,-235.8857 52.9406,-226.53"/>
<polygon fill="#000000" stroke="#000000" points="55.2119,-223.8423 45.7598,-219.0561 50.1642,-228.6921 55.2119,-223.8423"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="87.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- 1&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>1&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M87.5,-254.9748C87.5,-248.195 87.5,-237.966 87.5,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="91.0001,-229.0561 87.5,-219.0561 84.0001,-229.0561 91.0001,-229.0561"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="133.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>1&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M94.2875,-254.9748C101.0141,-247.517 111.505,-235.8857 119.9436,-226.53"/>
<polygon fill="#000000" stroke="#000000" points="122.586,-228.826 126.6847,-219.0561 117.388,-224.1376 122.586,-228.826"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="27.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M36.8769,-203.9748C35.3984,-197.1196 33.1592,-186.7383 31.2398,-177.8392"/>
<polygon fill="#000000" stroke="#000000" points="34.6595,-177.0934 29.1297,-168.0561 27.8169,-178.5693 34.6595,-177.0934"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="27.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M27.5,-152.9748C27.5,-146.195 27.5,-135.966 27.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-127.0561 27.5,-117.0561 24.0001,-127.0561 31.0001,-127.0561"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="27.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">1</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M27.5,-101.9748C27.5,-95.195 27.5,-84.966 27.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-76.0561 27.5,-66.0561 24.0001,-76.0561 31.0001,-76.0561"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="93.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M127.5979,-203.9748C121.8668,-196.6677 112.9933,-185.354 105.7351,-176.0997"/>
<polygon fill="#000000" stroke="#000000" points="108.3518,-173.7647 99.4264,-168.0561 102.8438,-178.0847 108.3518,-173.7647"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="136.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- 7&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>7&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M133.9427,-203.9748C134.3415,-197.195 134.9432,-186.966 135.4628,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="138.9622,-178.2444 136.0555,-168.0561 131.9742,-177.8333 138.9622,-178.2444"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="179.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 7&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>7&#45;&gt;13</title>
<path fill="none" stroke="#000000" d="M140.2875,-203.9748C147.0141,-196.517 157.505,-184.8857 165.9436,-175.53"/>
<polygon fill="#000000" stroke="#000000" points="168.586,-177.826 172.6847,-168.0561 163.388,-173.1376 168.586,-177.826"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="94.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M93.6476,-152.9748C93.7805,-146.195 93.9811,-135.966 94.1543,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="97.655,-127.1228 94.3518,-117.0561 90.6564,-126.9855 97.655,-127.1228"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="94.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M94.5,-101.9748C94.5,-95.195 94.5,-84.966 94.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="98.0001,-76.0561 94.5,-66.0561 91.0001,-76.0561 98.0001,-76.0561"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="94.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M94.5,-50.9748C94.5,-44.195 94.5,-33.966 94.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="98.0001,-25.0561 94.5,-15.0561 91.0001,-25.0561 98.0001,-25.0561"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="179.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13&#45;&gt;14</title>
<path fill="none" stroke="#000000" d="M179.5,-152.9748C179.5,-146.195 179.5,-135.966 179.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="183.0001,-127.0561 179.5,-117.0561 176.0001,-127.0561 183.0001,-127.0561"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="179.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 14&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>14&#45;&gt;15</title>
<path fill="none" stroke="#000000" d="M179.5,-101.9748C179.5,-95.195 179.5,-84.966 179.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="183.0001,-76.0561 179.5,-66.0561 176.0001,-76.0561 183.0001,-76.0561"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="179.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">3</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15&#45;&gt;16</title>
<path fill="none" stroke="#000000" d="M179.5,-50.9748C179.5,-44.195 179.5,-33.966 179.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="183.0001,-25.0561 179.5,-15.0561 176.0001,-25.0561 183.0001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Numerous parsing techniques exist that can take a grammar and the given
string, and produce the corresponding derivation tree or trees. However,
some of these techniques work only on specific classes of grammars.
These classes of grammars are named after the specific kind of parser
that can accept grammars of that category. That is, the upper bound for
the capabilities of the parser defines the grammar class named after that
parser.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Different classes of grammars differ in the features that are available to
the user for writing a grammar of that class. That is, the corresponding
kind of parser will be unable to parse a grammar that makes use of more
features than is allowed. For example, the <code>A2_GRAMMAR</code> is an <em>LL</em>
grammar because it lacks left recursion, while <code>A1_GRAMMAR</code> is not an
<em>LL</em> grammar. This is because an <em>LL</em> parser is a parser that parses
its input from left to right, and constructs a leftmost derivation of its
input by expanding the non-terminals it encounters. If there is a left
recursion in one of these rules, an <em>LL</em> parser will enter an infinite loop.</p>
<p>We will examine a few classes of parsers next. First we define a few common
features required by all parsers we implement.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/functools.html" class="import" target="_blank">functools</a></span> <span class="k">import</span> <span class="n">reduce</span><span class="p">,</span> <span class="n">lru_cache</span>
<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/re.html" class="import" target="_blank">re</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The  <code>EXPR_GRAMMAR</code> we import from the <a href="Grammars.html">chapter on grammars</a> is oriented towards generation. In particular, the production rules are stored as strings. We need to massage this representation a little to conform to a canonical representation where each token in a rule is represented separately.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="n">rule</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">RE_NONTERMINAL</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span> <span class="k">if</span> <span class="n">token</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">canonical</span><span class="p">(</span><span class="n">grammar</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="n">key</span><span class="p">:</span> <span class="p">[</span><span class="n">split</span><span class="p">(</span><span class="n">choice</span><span class="p">)</span> <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">choices</span> <span class="ow">in</span> <span class="n">grammar</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">canonical</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;start&gt;&#39;: [[&#39;&lt;expr&gt;&#39;]],
 &#39;&lt;expr&gt;&#39;: [[&#39;&lt;term&gt;&#39;, &#39; + &#39;, &#39;&lt;expr&gt;&#39;],
  [&#39;&lt;term&gt;&#39;, &#39; - &#39;, &#39;&lt;expr&gt;&#39;],
  [&#39;&lt;term&gt;&#39;]],
 &#39;&lt;term&gt;&#39;: [[&#39;&lt;factor&gt;&#39;, &#39; * &#39;, &#39;&lt;term&gt;&#39;],
  [&#39;&lt;factor&gt;&#39;, &#39; / &#39;, &#39;&lt;term&gt;&#39;],
  [&#39;&lt;factor&gt;&#39;]],
 &#39;&lt;factor&gt;&#39;: [[&#39;+&#39;, &#39;&lt;factor&gt;&#39;],
  [&#39;-&#39;, &#39;&lt;factor&gt;&#39;],
  [&#39;(&#39;, &#39;&lt;expr&gt;&#39;, &#39;)&#39;],
  [&#39;&lt;integer&gt;&#39;, &#39;.&#39;, &#39;&lt;integer&gt;&#39;],
  [&#39;&lt;integer&gt;&#39;]],
 &#39;&lt;integer&gt;&#39;: [[&#39;&lt;digit&gt;&#39;, &#39;&lt;integer&gt;&#39;], [&#39;&lt;digit&gt;&#39;]],
 &#39;&lt;digit&gt;&#39;: [[&#39;0&#39;],
  [&#39;1&#39;],
  [&#39;2&#39;],
  [&#39;3&#39;],
  [&#39;4&#39;],
  [&#39;5&#39;],
  [&#39;6&#39;],
  [&#39;7&#39;],
  [&#39;8&#39;],
  [&#39;9&#39;]]}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We define a function to pretty print the grammars we define:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">pp_grammar</span><span class="p">(</span><span class="n">grammar</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">show_symbol</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">grammar</span> <span class="k">else</span> <span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">show_alternative</span><span class="p">(</span><span class="n">alt</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot; + &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">show_symbol</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span> <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">alt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_alternative_set</span><span class="p">(</span><span class="n">alts</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">| &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">show_alternative</span><span class="p">(</span><span class="n">alt</span><span class="p">)</span> <span class="k">for</span> <span class="n">alt</span> <span class="ow">in</span> <span class="n">alts</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">grammar</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">show_alternative_set</span><span class="p">(</span><span class="n">grammar</span><span class="p">[</span><span class="n">key</span><span class="p">])))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pp_grammar</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;start&gt; = &lt;expr&gt;
&lt;expr&gt; = &lt;term&gt; + &#39; + &#39; + &lt;expr&gt;
	| &lt;term&gt; + &#39; - &#39; + &lt;expr&gt;
	| &lt;term&gt;
&lt;term&gt; = &lt;factor&gt; + &#39; * &#39; + &lt;term&gt;
	| &lt;factor&gt; + &#39; / &#39; + &lt;term&gt;
	| &lt;factor&gt;
&lt;factor&gt; = &#39;+&#39; + &lt;factor&gt;
	| &#39;-&#39; + &lt;factor&gt;
	| &#39;(&#39; + &lt;expr&gt; + &#39;)&#39;
	| &lt;integer&gt; + &#39;.&#39; + &lt;integer&gt;
	| &lt;integer&gt;
&lt;integer&gt; = &lt;digit&gt; + &lt;integer&gt;
	| &lt;digit&gt;
&lt;digit&gt; = &#39;0&#39;
	| &#39;1&#39;
	| &#39;2&#39;
	| &#39;3&#39;
	| &#39;4&#39;
	| &#39;5&#39;
	| &#39;6&#39;
	| &#39;7&#39;
	| &#39;8&#39;
	| &#39;9&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Next, we develop different parsers. To do that, we define a minimal interface for parsing, that is obeyed by all parsers.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Parser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grammar</span><span class="p">,</span> <span class="n">start_symbol</span><span class="o">=</span><span class="n">START_SYMBOL</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_symbol</span> <span class="o">=</span> <span class="n">start_symbol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span> <span class="o">=</span> <span class="n">grammar</span>

    <span class="k">def</span> <span class="nf">parse_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return pair (cursor, forest) for longest prefix of text&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="bp">NotImplemented</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">cursor</span><span class="p">,</span> <span class="n">forest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_prefix</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cursor</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s2">&quot;at &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="n">cursor</span><span class="p">:]))</span>
        <span class="k">return</span> <span class="n">forest</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Parsing-Expression-Grammars">Parsing Expression Grammars<a class="anchor-link" href="#Parsing-Expression-Grammars">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>A <em><a href="http://bford.info/pub/lang/peg">Parsing Expression Grammar</a></em> (<em>PEG</em>)~[<a href="https://doi.org/10.1145/982962.964011">Ford <em>et al</em>, 2004.</a>] is a type of <em>recognition based formal grammar</em> that specifies the sequence of steps to take to parse a given string.
A <em>Parsing Expression Grammar</em> is very similar to a <em>Context Free Grammar</em>. As in a <em>Context Free Grammar</em>, the grammar is represented by a set of non-terminals and corresponding alternatives representing how to match each. For example, here is a PEG that matches <code>a</code> or <code>b</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">PEG1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;&lt;start&gt;&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">],[</span><span class="s1">&#39;b&#39;</span><span class="p">]]</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>However, unlike the <em>CFG</em>, the alternatives represent <strong>ordered choice</strong>. That is, rather than choosing all rules that can potentially match, we stop at the first match that succeed. For example, the below <em>PEG</em> can match <code>ab</code> but not <code>abc</code> unlike a <em>CFG</em> which will match both. (We call the sequence of ordered choice expressions <strong>choice expressions</strong>  rather than alternatives to make the distinction from <em>CFG</em> clear.)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">PEG2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;&lt;start&gt;&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="s1">&#39;ab&#39;</span><span class="p">],[</span><span class="s1">&#39;abc&#39;</span><span class="p">]]</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Each choice in a <em>choice expression</em> represents a rule on how to satisfy that particular choice. The choice is a sequence of symbols (terminals and non-terminals) that are matched against a given text as in a <em>CFG</em>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Beyond the syntax of grammar definitions we have seen so far, a <em>PEG</em> can can also contain a few additional elements. See the exercises at the end of the chapter for additional information.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The PEGs model the typical practice in handwritten recursive descent parsers, and hence it may be considered more intuitive to understand.</p>
<p>We look at parsers for PEGs next.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Packrat-Parser-for-PEGs">Packrat Parser for <em>PEGs</em><a class="anchor-link" href="#Packrat-Parser-for-PEGs">&#182;</a></h3><p>Short of hand rolling a parser, <em>Packrat</em> parsing is one of the simplest parsing techniques, and is one of the techniques for parsing PEGs.
The <em>Packrat</em> parser is so named because it tries to cache all results from simpler problems in the hope that these solutions can be used to avoid re-computation later. The following is the definition of a minimal <em>Packrat</em> parser.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="The-Parser">The Parser<a class="anchor-link" href="#The-Parser">&#182;</a></h4><p>We derive from the <code>Parser</code> base class first, and we accept the text to be parsed in the <code>parse</code> method, which in turn calls <code>unify_key</code> with the <code>start_symbol</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">PEGParser</span><span class="p">(</span><span class="n">Parser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">parse_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unify_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_symbol</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Unify-Key">Unify Key<a class="anchor-link" href="#Unify-Key">&#182;</a></h5><p>The <code>unify_key</code> algorithm is simple. If given a terminal symbol, it tries to match the symbol with the current position in the text. If the symbol and text match, it returns successfully with the new parse index <code>at</code>.</p>
<p>If on the other hand, it was given a non-terminal, it retrieves the choice expression corresponding to the key, and tries to match each choice in order using <code>unify_rule</code>. If <strong>any</strong> of the rules succeed in being unified with the given text, the parse is considered a success, and we return with the new parse index returned by <code>unify_rule</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">PEGParser</span><span class="p">(</span><span class="n">PEGParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">unify_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">text</span><span class="p">[</span><span class="n">at</span><span class="p">:]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">at</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">at</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
            <span class="n">to</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unify_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">at</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">res</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Unify-Rule">Unify Rule<a class="anchor-link" href="#Unify-Rule">&#182;</a></h5><p>The <code>unify_rule</code> is similar. It retrieves the tokens corresponding to the rule that it needs to unify with the text, and calls <code>unify_key</code> on them in sequence. If <strong>all</strong> tokens are successfully unified with the text, the parse is a success.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">PEGParser</span><span class="p">(</span><span class="n">PEGParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">unify_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">at</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">:</span>
            <span class="n">at</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unify_key</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">at</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">at</span><span class="p">,</span> <span class="kc">None</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">at</span><span class="p">,</span> <span class="n">results</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The two methods are mutually recursive, and given that <code>unify_key</code> tries each alternative until it succeeds, <code>unify_key</code> can be called multiple times with the same arguments. Hence, it is import to memoize the results of <code>unify_key</code>. Python provides a simple decorator <code>lru_cache</code> for memoizing any function call that has hashable arguments. We add that to our implementation so that repeated calls to <code>unify_key</code> with same arguments get cached results.</p>
<p>This memoization gives the algorithm its name -- <em>Packrat</em>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">PEGParser</span><span class="p">(</span><span class="n">PEGParser</span><span class="p">):</span>
    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unify_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">text</span><span class="p">[</span><span class="n">at</span><span class="p">:]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">key</span><span class="p">):</span> <span class="k">return</span> <span class="n">at</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">at</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
            <span class="n">to</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unify_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">at</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res</span><span class="p">:</span> <span class="k">return</span> <span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">res</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We wrap initialization and calling of <code>PEGParser</code> in a method <code>parse</code> that accepts the text to be parsed along with the grammar.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here are a few examples of our parser in action.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mystring</span> <span class="o">=</span> <span class="s2">&quot;1 + (2 * 3)&quot;</span>
<span class="n">peg</span> <span class="o">=</span> <span class="n">PEGParser</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">))</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">peg</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">mystring</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">==</span> <span class="n">mystring</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="203pt" height="584pt"
 viewBox="0.00 0.00 203.00 584.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 580)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-580 199,-580 199,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="74.5" y="-564.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="74.5" y="-513.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M74.5,-560.9748C74.5,-554.195 74.5,-543.966 74.5,-535.1331"/>
<polygon fill="#000000" stroke="#000000" points="78.0001,-535.0561 74.5,-525.0561 71.0001,-535.0561 78.0001,-535.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="27.5" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M67.565,-509.9748C60.6921,-502.517 49.9731,-490.8857 41.3512,-481.53"/>
<polygon fill="#000000" stroke="#000000" points="43.8141,-479.0378 34.4635,-474.0561 38.6666,-483.7816 43.8141,-479.0378"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="74.5" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 1&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>1&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M74.5,-509.9748C74.5,-503.195 74.5,-492.966 74.5,-484.1331"/>
<polygon fill="#000000" stroke="#000000" points="78.0001,-484.0561 74.5,-474.0561 71.0001,-484.0561 78.0001,-484.0561"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="120.5" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>1&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M81.2875,-509.9748C88.0141,-502.517 98.505,-490.8857 106.9436,-481.53"/>
<polygon fill="#000000" stroke="#000000" points="109.586,-483.826 113.6847,-474.0561 104.388,-479.1376 109.586,-483.826"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="27.5" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M27.5,-458.9748C27.5,-452.195 27.5,-441.966 27.5,-433.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-433.0561 27.5,-423.0561 24.0001,-433.0561 31.0001,-433.0561"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="27.5" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M27.5,-407.9748C27.5,-401.195 27.5,-390.966 27.5,-382.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-382.0561 27.5,-372.0561 24.0001,-382.0561 31.0001,-382.0561"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="27.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M27.5,-356.9748C27.5,-350.195 27.5,-339.966 27.5,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-331.0561 27.5,-321.0561 24.0001,-331.0561 31.0001,-331.0561"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="27.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">1</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M27.5,-305.9748C27.5,-299.195 27.5,-288.966 27.5,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-280.0561 27.5,-270.0561 24.0001,-280.0561 31.0001,-280.0561"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="120.5" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M120.5,-458.9748C120.5,-452.195 120.5,-441.966 120.5,-433.1331"/>
<polygon fill="#000000" stroke="#000000" points="124.0001,-433.0561 120.5,-423.0561 117.0001,-433.0561 124.0001,-433.0561"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="120.5" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M120.5,-407.9748C120.5,-401.195 120.5,-390.966 120.5,-382.1331"/>
<polygon fill="#000000" stroke="#000000" points="124.0001,-382.0561 120.5,-372.0561 117.0001,-382.0561 124.0001,-382.0561"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="79.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">(</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M114.4503,-356.9748C107.6341,-348.4961 96.4814,-334.6232 88.6104,-324.8324"/>
<polygon fill="#000000" stroke="#000000" points="91.1088,-322.3541 82.1154,-316.7533 85.6531,-326.74 91.1088,-322.3541"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="120.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 10&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>10&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M120.5,-356.9748C120.5,-350.195 120.5,-339.966 120.5,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="124.0001,-331.0561 120.5,-321.0561 117.0001,-331.0561 124.0001,-331.0561"/>
</g>
<!-- 24 -->
<g id="node25" class="node">
<title>24</title>
<text text-anchor="middle" x="161.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">)</text>
</g>
<!-- 10&#45;&gt;24 -->
<g id="edge24" class="edge">
<title>10&#45;&gt;24</title>
<path fill="none" stroke="#000000" d="M126.5497,-356.9748C133.3659,-348.4961 144.5186,-334.6232 152.3896,-324.8324"/>
<polygon fill="#000000" stroke="#000000" points="155.3469,-326.74 158.8846,-316.7533 149.8912,-322.3541 155.3469,-326.74"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="120.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12&#45;&gt;13</title>
<path fill="none" stroke="#000000" d="M120.5,-305.9748C120.5,-299.195 120.5,-288.966 120.5,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="124.0001,-280.0561 120.5,-270.0561 117.0001,-280.0561 124.0001,-280.0561"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="70.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13&#45;&gt;14</title>
<path fill="none" stroke="#000000" d="M113.1223,-254.9748C105.7369,-247.4417 94.1768,-235.6503 84.958,-226.2472"/>
<polygon fill="#000000" stroke="#000000" points="87.4079,-223.7466 77.9079,-219.0561 82.4094,-228.6471 87.4079,-223.7466"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="120.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000"> * </text>
</g>
<!-- 13&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>13&#45;&gt;18</title>
<path fill="none" stroke="#000000" d="M120.5,-254.9748C120.5,-248.195 120.5,-237.966 120.5,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="124.0001,-229.0561 120.5,-219.0561 117.0001,-229.0561 124.0001,-229.0561"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="167.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 13&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>13&#45;&gt;19</title>
<path fill="none" stroke="#000000" d="M127.435,-254.9748C134.3079,-247.517 145.0269,-235.8857 153.6488,-226.53"/>
<polygon fill="#000000" stroke="#000000" points="156.3334,-228.7816 160.5365,-219.0561 151.1859,-224.0378 156.3334,-228.7816"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="70.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 14&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>14&#45;&gt;15</title>
<path fill="none" stroke="#000000" d="M70.5,-203.9748C70.5,-197.195 70.5,-186.966 70.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="74.0001,-178.0561 70.5,-168.0561 67.0001,-178.0561 74.0001,-178.0561"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="70.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15&#45;&gt;16</title>
<path fill="none" stroke="#000000" d="M70.5,-152.9748C70.5,-146.195 70.5,-135.966 70.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="74.0001,-127.0561 70.5,-117.0561 67.0001,-127.0561 74.0001,-127.0561"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="70.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 16&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>16&#45;&gt;17</title>
<path fill="none" stroke="#000000" d="M70.5,-101.9748C70.5,-95.195 70.5,-84.966 70.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="74.0001,-76.0561 70.5,-66.0561 67.0001,-76.0561 74.0001,-76.0561"/>
</g>
<!-- 20 -->
<g id="node21" class="node">
<title>20</title>
<text text-anchor="middle" x="167.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 19&#45;&gt;20 -->
<g id="edge20" class="edge">
<title>19&#45;&gt;20</title>
<path fill="none" stroke="#000000" d="M167.5,-203.9748C167.5,-197.195 167.5,-186.966 167.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="171.0001,-178.0561 167.5,-168.0561 164.0001,-178.0561 171.0001,-178.0561"/>
</g>
<!-- 21 -->
<g id="node22" class="node">
<title>21</title>
<text text-anchor="middle" x="167.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 20&#45;&gt;21 -->
<g id="edge21" class="edge">
<title>20&#45;&gt;21</title>
<path fill="none" stroke="#000000" d="M167.5,-152.9748C167.5,-146.195 167.5,-135.966 167.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="171.0001,-127.0561 167.5,-117.0561 164.0001,-127.0561 171.0001,-127.0561"/>
</g>
<!-- 22 -->
<g id="node23" class="node">
<title>22</title>
<text text-anchor="middle" x="167.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 21&#45;&gt;22 -->
<g id="edge22" class="edge">
<title>21&#45;&gt;22</title>
<path fill="none" stroke="#000000" d="M167.5,-101.9748C167.5,-95.195 167.5,-84.966 167.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="171.0001,-76.0561 167.5,-66.0561 164.0001,-76.0561 171.0001,-76.0561"/>
</g>
<!-- 23 -->
<g id="node24" class="node">
<title>23</title>
<text text-anchor="middle" x="167.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">3</text>
</g>
<!-- 22&#45;&gt;23 -->
<g id="edge23" class="edge">
<title>22&#45;&gt;23</title>
<path fill="none" stroke="#000000" d="M167.5,-50.9748C167.5,-44.195 167.5,-33.966 167.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="171.0001,-25.0561 167.5,-15.0561 164.0001,-25.0561 171.0001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mystring</span> <span class="o">=</span> <span class="s2">&quot;1 * (2 + 3.35)&quot;</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">peg</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">mystring</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">==</span> <span class="n">mystring</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="308pt" height="635pt"
 viewBox="0.00 0.00 308.00 635.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 631)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-631 304,-631 304,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="77.5" y="-615.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="77.5" y="-564.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M77.5,-611.9748C77.5,-605.195 77.5,-594.966 77.5,-586.1331"/>
<polygon fill="#000000" stroke="#000000" points="81.0001,-586.0561 77.5,-576.0561 74.0001,-586.0561 81.0001,-586.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="77.5" y="-513.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M77.5,-560.9748C77.5,-554.195 77.5,-543.966 77.5,-535.1331"/>
<polygon fill="#000000" stroke="#000000" points="81.0001,-535.0561 77.5,-525.0561 74.0001,-535.0561 81.0001,-535.0561"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="27.5" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M70.1223,-509.9748C62.7369,-502.4417 51.1768,-490.6503 41.958,-481.2472"/>
<polygon fill="#000000" stroke="#000000" points="44.4079,-478.7466 34.9079,-474.0561 39.4094,-483.6471 44.4079,-478.7466"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="77.5" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#000000"> * </text>
</g>
<!-- 2&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>2&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M77.5,-509.9748C77.5,-503.195 77.5,-492.966 77.5,-484.1331"/>
<polygon fill="#000000" stroke="#000000" points="81.0001,-484.0561 77.5,-474.0561 74.0001,-484.0561 81.0001,-484.0561"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="124.5" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>2&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M84.435,-509.9748C91.3079,-502.517 102.0269,-490.8857 110.6488,-481.53"/>
<polygon fill="#000000" stroke="#000000" points="113.3334,-483.7816 117.5365,-474.0561 108.1859,-479.0378 113.3334,-483.7816"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="27.5" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M27.5,-458.9748C27.5,-452.195 27.5,-441.966 27.5,-433.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-433.0561 27.5,-423.0561 24.0001,-433.0561 31.0001,-433.0561"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="27.5" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M27.5,-407.9748C27.5,-401.195 27.5,-390.966 27.5,-382.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-382.0561 27.5,-372.0561 24.0001,-382.0561 31.0001,-382.0561"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="27.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">1</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M27.5,-356.9748C27.5,-350.195 27.5,-339.966 27.5,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-331.0561 27.5,-321.0561 24.0001,-331.0561 31.0001,-331.0561"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="124.5" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M124.5,-458.9748C124.5,-452.195 124.5,-441.966 124.5,-433.1331"/>
<polygon fill="#000000" stroke="#000000" points="128.0001,-433.0561 124.5,-423.0561 121.0001,-433.0561 128.0001,-433.0561"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="83.5" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">(</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M118.4503,-407.9748C111.6341,-399.4961 100.4814,-385.6232 92.6104,-375.8324"/>
<polygon fill="#000000" stroke="#000000" points="95.1088,-373.3541 86.1154,-367.7533 89.6531,-377.74 95.1088,-373.3541"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="124.5" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 9&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>9&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M124.5,-407.9748C124.5,-401.195 124.5,-390.966 124.5,-382.1331"/>
<polygon fill="#000000" stroke="#000000" points="128.0001,-382.0561 124.5,-372.0561 121.0001,-382.0561 128.0001,-382.0561"/>
</g>
<!-- 31 -->
<g id="node32" class="node">
<title>31</title>
<text text-anchor="middle" x="165.5" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">)</text>
</g>
<!-- 9&#45;&gt;31 -->
<g id="edge31" class="edge">
<title>9&#45;&gt;31</title>
<path fill="none" stroke="#000000" d="M130.5497,-407.9748C137.3659,-399.4961 148.5186,-385.6232 156.3896,-375.8324"/>
<polygon fill="#000000" stroke="#000000" points="159.3469,-377.74 162.8846,-367.7533 153.8912,-373.3541 159.3469,-377.74"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="76.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>11&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M117.4174,-356.9748C110.3983,-349.517 99.4513,-337.8857 90.6459,-328.53"/>
<polygon fill="#000000" stroke="#000000" points="93.014,-325.9393 83.6116,-321.0561 87.9166,-330.7369 93.014,-325.9393"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="124.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000"> + </text>
</g>
<!-- 11&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>11&#45;&gt;17</title>
<path fill="none" stroke="#000000" d="M124.5,-356.9748C124.5,-350.195 124.5,-339.966 124.5,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="128.0001,-331.0561 124.5,-321.0561 121.0001,-331.0561 128.0001,-331.0561"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="171.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 11&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>11&#45;&gt;18</title>
<path fill="none" stroke="#000000" d="M131.435,-356.9748C138.3079,-349.517 149.0269,-337.8857 157.6488,-328.53"/>
<polygon fill="#000000" stroke="#000000" points="160.3334,-330.7816 164.5365,-321.0561 155.1859,-326.0378 160.3334,-330.7816"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="76.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12&#45;&gt;13</title>
<path fill="none" stroke="#000000" d="M76.5,-305.9748C76.5,-299.195 76.5,-288.966 76.5,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="80.0001,-280.0561 76.5,-270.0561 73.0001,-280.0561 80.0001,-280.0561"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="71.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13&#45;&gt;14</title>
<path fill="none" stroke="#000000" d="M75.7622,-254.9748C75.0975,-248.195 74.0947,-237.966 73.2287,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="76.6999,-228.6669 72.2408,-219.0561 69.7333,-229.3499 76.6999,-228.6669"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="60.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 14&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>14&#45;&gt;15</title>
<path fill="none" stroke="#000000" d="M69.8769,-203.9748C68.3984,-197.1196 66.1592,-186.7383 64.2398,-177.8392"/>
<polygon fill="#000000" stroke="#000000" points="67.6595,-177.0934 62.1297,-168.0561 60.8169,-178.5693 67.6595,-177.0934"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="60.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15&#45;&gt;16</title>
<path fill="none" stroke="#000000" d="M60.5,-152.9748C60.5,-146.195 60.5,-135.966 60.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="64.0001,-127.0561 60.5,-117.0561 57.0001,-127.0561 64.0001,-127.0561"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="171.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 18&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>18&#45;&gt;19</title>
<path fill="none" stroke="#000000" d="M171.5,-305.9748C171.5,-299.195 171.5,-288.966 171.5,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="175.0001,-280.0561 171.5,-270.0561 168.0001,-280.0561 175.0001,-280.0561"/>
</g>
<!-- 20 -->
<g id="node21" class="node">
<title>20</title>
<text text-anchor="middle" x="174.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 19&#45;&gt;20 -->
<g id="edge20" class="edge">
<title>19&#45;&gt;20</title>
<path fill="none" stroke="#000000" d="M171.9427,-254.9748C172.3415,-248.195 172.9432,-237.966 173.4628,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="176.9622,-229.2444 174.0555,-219.0561 169.9742,-228.8333 176.9622,-229.2444"/>
</g>
<!-- 21 -->
<g id="node22" class="node">
<title>21</title>
<text text-anchor="middle" x="127.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 20&#45;&gt;21 -->
<g id="edge21" class="edge">
<title>20&#45;&gt;21</title>
<path fill="none" stroke="#000000" d="M167.565,-203.9748C160.6921,-196.517 149.9731,-184.8857 141.3512,-175.53"/>
<polygon fill="#000000" stroke="#000000" points="143.8141,-173.0378 134.4635,-168.0561 138.6666,-177.7816 143.8141,-173.0378"/>
</g>
<!-- 24 -->
<g id="node25" class="node">
<title>24</title>
<text text-anchor="middle" x="175.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">.</text>
</g>
<!-- 20&#45;&gt;24 -->
<g id="edge24" class="edge">
<title>20&#45;&gt;24</title>
<path fill="none" stroke="#000000" d="M174.6476,-203.9748C174.7805,-197.195 174.9811,-186.966 175.1543,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="178.655,-178.1228 175.3518,-168.0561 171.6564,-177.9855 178.655,-178.1228"/>
</g>
<!-- 25 -->
<g id="node26" class="node">
<title>25</title>
<text text-anchor="middle" x="223.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 20&#45;&gt;25 -->
<g id="edge25" class="edge">
<title>20&#45;&gt;25</title>
<path fill="none" stroke="#000000" d="M181.7301,-203.9748C188.8954,-196.517 200.0706,-184.8857 209.0594,-175.53"/>
<polygon fill="#000000" stroke="#000000" points="211.8358,-177.6921 216.2402,-168.0561 206.7881,-172.8423 211.8358,-177.6921"/>
</g>
<!-- 22 -->
<g id="node23" class="node">
<title>22</title>
<text text-anchor="middle" x="127.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 21&#45;&gt;22 -->
<g id="edge22" class="edge">
<title>21&#45;&gt;22</title>
<path fill="none" stroke="#000000" d="M127.5,-152.9748C127.5,-146.195 127.5,-135.966 127.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="131.0001,-127.0561 127.5,-117.0561 124.0001,-127.0561 131.0001,-127.0561"/>
</g>
<!-- 23 -->
<g id="node24" class="node">
<title>23</title>
<text text-anchor="middle" x="127.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">3</text>
</g>
<!-- 22&#45;&gt;23 -->
<g id="edge23" class="edge">
<title>22&#45;&gt;23</title>
<path fill="none" stroke="#000000" d="M127.5,-101.9748C127.5,-95.195 127.5,-84.966 127.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="131.0001,-76.0561 127.5,-66.0561 124.0001,-76.0561 131.0001,-76.0561"/>
</g>
<!-- 26 -->
<g id="node27" class="node">
<title>26</title>
<text text-anchor="middle" x="205.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 25&#45;&gt;26 -->
<g id="edge26" class="edge">
<title>25&#45;&gt;26</title>
<path fill="none" stroke="#000000" d="M220.844,-152.9748C218.398,-146.0443 214.6799,-135.5097 211.5164,-126.5464"/>
<polygon fill="#000000" stroke="#000000" points="214.7956,-125.3211 208.1669,-117.0561 208.1947,-127.6509 214.7956,-125.3211"/>
</g>
<!-- 28 -->
<g id="node29" class="node">
<title>28</title>
<text text-anchor="middle" x="272.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 25&#45;&gt;28 -->
<g id="edge28" class="edge">
<title>25&#45;&gt;28</title>
<path fill="none" stroke="#000000" d="M230.7301,-152.9748C237.8954,-145.517 249.0706,-133.8857 258.0594,-124.53"/>
<polygon fill="#000000" stroke="#000000" points="260.8358,-126.6921 265.2402,-117.0561 255.7881,-121.8423 260.8358,-126.6921"/>
</g>
<!-- 27 -->
<g id="node28" class="node">
<title>27</title>
<text text-anchor="middle" x="205.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">3</text>
</g>
<!-- 26&#45;&gt;27 -->
<g id="edge27" class="edge">
<title>26&#45;&gt;27</title>
<path fill="none" stroke="#000000" d="M205.5,-101.9748C205.5,-95.195 205.5,-84.966 205.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="209.0001,-76.0561 205.5,-66.0561 202.0001,-76.0561 209.0001,-76.0561"/>
</g>
<!-- 29 -->
<g id="node30" class="node">
<title>29</title>
<text text-anchor="middle" x="272.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 28&#45;&gt;29 -->
<g id="edge29" class="edge">
<title>28&#45;&gt;29</title>
<path fill="none" stroke="#000000" d="M272.5,-101.9748C272.5,-95.195 272.5,-84.966 272.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="276.0001,-76.0561 272.5,-66.0561 269.0001,-76.0561 276.0001,-76.0561"/>
</g>
<!-- 30 -->
<g id="node31" class="node">
<title>30</title>
<text text-anchor="middle" x="272.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">5</text>
</g>
<!-- 29&#45;&gt;30 -->
<g id="edge30" class="edge">
<title>29&#45;&gt;30</title>
<path fill="none" stroke="#000000" d="M272.5,-50.9748C272.5,-44.195 272.5,-33.966 272.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="276.0001,-25.0561 272.5,-15.0561 269.0001,-25.0561 276.0001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>One should be aware that while the grammar looks like a <em>Context Free Grammar</em>, the language described by a PEG may be different. Indeed, only <em>LL(1)</em> grammars are guaranteed to represent the same language for both PEGs and other parsers, while other behaviors could be surprising~[<a href="http://dl.acm.org/citation.cfm?id=2365896.2365924">Redziejowski <em>et al</em>, 2008.</a>].</p>
<p>While <em>PEGs</em> are simple at first sight, their behavior in some cases might be a bit unintuitive. For example, here is an example~[Unresolved citation: redziejowski.]:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">PEG_SURPRISE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;A&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&lt;A&gt;a&quot;</span><span class="p">,</span><span class="s2">&quot;aa&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>When interpreted as a context free grammar and used as a string generator, it will produce strings of the form <code>a, aa, aaaa, aaaaaa</code> that is, it produces strings where the number of <code>a</code> is $2*n$.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">PEG_SURPRISE</span><span class="p">,</span> <span class="s1">&#39;&lt;A&gt;&#39;</span><span class="p">)</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&lt;A&gt;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_once</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_tree_with_strategy</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">expand_node_min_cost</span><span class="p">)</span>
    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
    <span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">strings</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="34pt" height="74pt"
 viewBox="0.00 0.00 34.00 74.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 70)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-70 30,-70 30,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="13" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="13" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">aa</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M13,-50.9748C13,-44.195 13,-33.966 13,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="16.5001,-25.0561 13,-15.0561 9.5001,-25.0561 16.5001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="85pt" height="125pt"
 viewBox="0.00 0.00 85.00 125.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 121)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-121 81,-121 81,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="38.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="3.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M33.3356,-101.9748C27.9733,-94.1611 19.467,-81.7662 12.9067,-72.2069"/>
<polygon fill="#000000" stroke="#000000" points="15.7279,-70.1322 7.1836,-63.8675 9.9562,-74.0931 15.7279,-70.1322"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="38.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 0&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>0&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M38.5,-101.9748C38.5,-95.195 38.5,-84.966 38.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="42.0001,-76.0561 38.5,-66.0561 35.0001,-76.0561 42.0001,-76.0561"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="73.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 0&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>0&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M43.6644,-101.9748C49.0267,-94.1611 57.533,-81.7662 64.0933,-72.2069"/>
<polygon fill="#000000" stroke="#000000" points="67.0438,-74.0931 69.8164,-63.8675 61.2721,-70.1322 67.0438,-74.0931"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="38.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">aa</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M38.5,-50.9748C38.5,-44.195 38.5,-33.966 38.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="42.0001,-25.0561 38.5,-15.0561 35.0001,-25.0561 42.0001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="85pt" height="176pt"
 viewBox="0.00 0.00 85.00 176.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 172)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-172 81,-172 81,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="38.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="3.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M33.3356,-152.9748C27.9733,-145.1611 19.467,-132.7662 12.9067,-123.2069"/>
<polygon fill="#000000" stroke="#000000" points="15.7279,-121.1322 7.1836,-114.8675 9.9562,-125.0931 15.7279,-121.1322"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="38.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 0&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>0&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M38.5,-152.9748C38.5,-146.195 38.5,-135.966 38.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="42.0001,-127.0561 38.5,-117.0561 35.0001,-127.0561 42.0001,-127.0561"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="73.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 0&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>0&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M43.6644,-152.9748C49.0267,-145.1611 57.533,-132.7662 64.0933,-123.2069"/>
<polygon fill="#000000" stroke="#000000" points="67.0438,-125.0931 69.8164,-114.8675 61.2721,-121.1322 67.0438,-125.0931"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="3.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M33.3356,-101.9748C27.9733,-94.1611 19.467,-81.7662 12.9067,-72.2069"/>
<polygon fill="#000000" stroke="#000000" points="15.7279,-70.1322 7.1836,-63.8675 9.9562,-74.0931 15.7279,-70.1322"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="38.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 2&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>2&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M38.5,-101.9748C38.5,-95.195 38.5,-84.966 38.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="42.0001,-76.0561 38.5,-66.0561 35.0001,-76.0561 42.0001,-76.0561"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="73.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 2&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>2&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M43.6644,-101.9748C49.0267,-94.1611 57.533,-81.7662 64.0933,-72.2069"/>
<polygon fill="#000000" stroke="#000000" points="67.0438,-74.0931 69.8164,-63.8675 61.2721,-70.1322 67.0438,-74.0931"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="38.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">aa</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M38.5,-50.9748C38.5,-44.195 38.5,-33.966 38.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="42.0001,-25.0561 38.5,-15.0561 35.0001,-25.0561 42.0001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="85pt" height="227pt"
 viewBox="0.00 0.00 85.00 227.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 223)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-223 81,-223 81,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="38.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="3.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M33.3356,-203.9748C27.9733,-196.1611 19.467,-183.7662 12.9067,-174.2069"/>
<polygon fill="#000000" stroke="#000000" points="15.7279,-172.1322 7.1836,-165.8675 9.9562,-176.0931 15.7279,-172.1322"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="38.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 0&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>0&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M38.5,-203.9748C38.5,-197.195 38.5,-186.966 38.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="42.0001,-178.0561 38.5,-168.0561 35.0001,-178.0561 42.0001,-178.0561"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="73.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 0&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>0&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M43.6644,-203.9748C49.0267,-196.1611 57.533,-183.7662 64.0933,-174.2069"/>
<polygon fill="#000000" stroke="#000000" points="67.0438,-176.0931 69.8164,-165.8675 61.2721,-172.1322 67.0438,-176.0931"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="3.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M33.3356,-152.9748C27.9733,-145.1611 19.467,-132.7662 12.9067,-123.2069"/>
<polygon fill="#000000" stroke="#000000" points="15.7279,-121.1322 7.1836,-114.8675 9.9562,-125.0931 15.7279,-121.1322"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="38.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 2&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>2&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M38.5,-152.9748C38.5,-146.195 38.5,-135.966 38.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="42.0001,-127.0561 38.5,-117.0561 35.0001,-127.0561 42.0001,-127.0561"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="73.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 2&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>2&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M43.6644,-152.9748C49.0267,-145.1611 57.533,-132.7662 64.0933,-123.2069"/>
<polygon fill="#000000" stroke="#000000" points="67.0438,-125.0931 69.8164,-114.8675 61.2721,-121.1322 67.0438,-125.0931"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="3.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M33.3356,-101.9748C27.9733,-94.1611 19.467,-81.7662 12.9067,-72.2069"/>
<polygon fill="#000000" stroke="#000000" points="15.7279,-70.1322 7.1836,-63.8675 9.9562,-74.0931 15.7279,-70.1322"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="38.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 4&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>4&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M38.5,-101.9748C38.5,-95.195 38.5,-84.966 38.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="42.0001,-76.0561 38.5,-66.0561 35.0001,-76.0561 42.0001,-76.0561"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="73.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 4&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>4&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M43.6644,-101.9748C49.0267,-94.1611 57.533,-81.7662 64.0933,-72.2069"/>
<polygon fill="#000000" stroke="#000000" points="67.0438,-74.0931 69.8164,-63.8675 61.2721,-70.1322 67.0438,-74.0931"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="38.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">aa</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M38.5,-50.9748C38.5,-44.195 38.5,-33.966 38.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="42.0001,-25.0561 38.5,-15.0561 35.0001,-25.0561 42.0001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;aa&#39;, &#39;aaaa&#39;, &#39;aaaaaa&#39;, &#39;aaaaaaaa&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>However, the <em>PEG</em> parser can only recognize strings of the form $2^n$</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">peg</span> <span class="o">=</span> <span class="n">PEGParser</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">PEG_SURPRISE</span><span class="p">),</span> <span class="s1">&#39;&lt;A&gt;&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">peg</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="34pt" height="74pt"
 viewBox="0.00 0.00 34.00 74.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 70)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-70 30,-70 30,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="13" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="13" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">aa</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M13,-50.9748C13,-44.195 13,-33.966 13,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="16.5001,-25.0561 13,-15.0561 9.5001,-25.0561 16.5001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>aa
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="85pt" height="125pt"
 viewBox="0.00 0.00 85.00 125.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 121)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-121 81,-121 81,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="38.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="3.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M33.3356,-101.9748C27.9733,-94.1611 19.467,-81.7662 12.9067,-72.2069"/>
<polygon fill="#000000" stroke="#000000" points="15.7279,-70.1322 7.1836,-63.8675 9.9562,-74.0931 15.7279,-70.1322"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="38.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 0&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>0&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M38.5,-101.9748C38.5,-95.195 38.5,-84.966 38.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="42.0001,-76.0561 38.5,-66.0561 35.0001,-76.0561 42.0001,-76.0561"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="73.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 0&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>0&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M43.6644,-101.9748C49.0267,-94.1611 57.533,-81.7662 64.0933,-72.2069"/>
<polygon fill="#000000" stroke="#000000" points="67.0438,-74.0931 69.8164,-63.8675 61.2721,-70.1322 67.0438,-74.0931"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="38.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">aa</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M38.5,-50.9748C38.5,-44.195 38.5,-33.966 38.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="42.0001,-25.0561 38.5,-15.0561 35.0001,-25.0561 42.0001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>aaaa
</pre>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-25-ca40e06f7699&gt;&#34;, line 4, in &lt;module&gt;
    tree = peg.parse(s)
  File &#34;&lt;ipython-input-14-fef97f4f09fc&gt;&#34;, line 13, in parse
    raise SyntaxError(&#34;at &#34; + repr(text[cursor:]))
  File &#34;&lt;string&gt;&#34;, line None
SyntaxError: at &#39;aa&#39; (expected)
</pre>
</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="85pt" height="227pt"
 viewBox="0.00 0.00 85.00 227.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 223)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-223 81,-223 81,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="38.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="3.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M33.3356,-203.9748C27.9733,-196.1611 19.467,-183.7662 12.9067,-174.2069"/>
<polygon fill="#000000" stroke="#000000" points="15.7279,-172.1322 7.1836,-165.8675 9.9562,-176.0931 15.7279,-172.1322"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="38.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 0&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>0&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M38.5,-203.9748C38.5,-197.195 38.5,-186.966 38.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="42.0001,-178.0561 38.5,-168.0561 35.0001,-178.0561 42.0001,-178.0561"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="73.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 0&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>0&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M43.6644,-203.9748C49.0267,-196.1611 57.533,-183.7662 64.0933,-174.2069"/>
<polygon fill="#000000" stroke="#000000" points="67.0438,-176.0931 69.8164,-165.8675 61.2721,-172.1322 67.0438,-176.0931"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="3.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M33.3356,-152.9748C27.9733,-145.1611 19.467,-132.7662 12.9067,-123.2069"/>
<polygon fill="#000000" stroke="#000000" points="15.7279,-121.1322 7.1836,-114.8675 9.9562,-125.0931 15.7279,-121.1322"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="38.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 2&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>2&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M38.5,-152.9748C38.5,-146.195 38.5,-135.966 38.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="42.0001,-127.0561 38.5,-117.0561 35.0001,-127.0561 42.0001,-127.0561"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="73.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 2&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>2&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M43.6644,-152.9748C49.0267,-145.1611 57.533,-132.7662 64.0933,-123.2069"/>
<polygon fill="#000000" stroke="#000000" points="67.0438,-125.0931 69.8164,-114.8675 61.2721,-121.1322 67.0438,-125.0931"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="3.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M33.3356,-101.9748C27.9733,-94.1611 19.467,-81.7662 12.9067,-72.2069"/>
<polygon fill="#000000" stroke="#000000" points="15.7279,-70.1322 7.1836,-63.8675 9.9562,-74.0931 15.7279,-70.1322"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="38.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 4&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>4&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M38.5,-101.9748C38.5,-95.195 38.5,-84.966 38.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="42.0001,-76.0561 38.5,-66.0561 35.0001,-76.0561 42.0001,-76.0561"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="73.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 4&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>4&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M43.6644,-101.9748C49.0267,-94.1611 57.533,-81.7662 64.0933,-72.2069"/>
<polygon fill="#000000" stroke="#000000" points="67.0438,-74.0931 69.8164,-63.8675 61.2721,-70.1322 67.0438,-74.0931"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="38.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">aa</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M38.5,-50.9748C38.5,-44.195 38.5,-33.966 38.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="42.0001,-25.0561 38.5,-15.0561 35.0001,-25.0561 42.0001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>aaaaaaaa
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Context-Free-Grammars">Context Free Grammars<a class="anchor-link" href="#Context-Free-Grammars">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>While the <em>Parsing Expression Grammars</em> are expressive and the <em>packrat</em> parser for parsing them is simple and intuitive, PEGs suffer from a major deficiency for our purposes. PEGs are oriented towards language recognition, and it is not clear how to translate an arbitrary PEG to a <em>CFG</em>. As we mentioned earlier, a naive re-interpretation of a PEG as a CFG does not work very well. Further, it is not clear what is the exact relation between the class of languages represented by <em>PEG</em> and the the class of languages represented by <em>CFG</em>. Since our primary focus is <em>fuzzing</em> -- that is <em>generation</em> of strings, we next look at parsers that can accept <em>CFG</em>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>rules</code> method takes in a grammar and returns <code>(key,production)</code> pairs for each production in the grammar. This is an alternative representation of a grammar.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">rules</span><span class="p">(</span><span class="n">grammar</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">choice</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">choices</span> <span class="ow">in</span> <span class="n">grammar</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rules</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;&lt;start&gt;&#39;, [&#39;&lt;expr&gt;&#39;]),
 (&#39;&lt;expr&gt;&#39;, [&#39;&lt;term&gt;&#39;, &#39; + &#39;, &#39;&lt;expr&gt;&#39;]),
 (&#39;&lt;expr&gt;&#39;, [&#39;&lt;term&gt;&#39;, &#39; - &#39;, &#39;&lt;expr&gt;&#39;]),
 (&#39;&lt;expr&gt;&#39;, [&#39;&lt;term&gt;&#39;]),
 (&#39;&lt;term&gt;&#39;, [&#39;&lt;factor&gt;&#39;, &#39; * &#39;, &#39;&lt;term&gt;&#39;]),
 (&#39;&lt;term&gt;&#39;, [&#39;&lt;factor&gt;&#39;, &#39; / &#39;, &#39;&lt;term&gt;&#39;]),
 (&#39;&lt;term&gt;&#39;, [&#39;&lt;factor&gt;&#39;]),
 (&#39;&lt;factor&gt;&#39;, [&#39;+&#39;, &#39;&lt;factor&gt;&#39;]),
 (&#39;&lt;factor&gt;&#39;, [&#39;-&#39;, &#39;&lt;factor&gt;&#39;]),
 (&#39;&lt;factor&gt;&#39;, [&#39;(&#39;, &#39;&lt;expr&gt;&#39;, &#39;)&#39;]),
 (&#39;&lt;factor&gt;&#39;, [&#39;&lt;integer&gt;&#39;, &#39;.&#39;, &#39;&lt;integer&gt;&#39;]),
 (&#39;&lt;factor&gt;&#39;, [&#39;&lt;integer&gt;&#39;]),
 (&#39;&lt;integer&gt;&#39;, [&#39;&lt;digit&gt;&#39;, &#39;&lt;integer&gt;&#39;]),
 (&#39;&lt;integer&gt;&#39;, [&#39;&lt;digit&gt;&#39;]),
 (&#39;&lt;digit&gt;&#39;, [&#39;0&#39;]),
 (&#39;&lt;digit&gt;&#39;, [&#39;1&#39;]),
 (&#39;&lt;digit&gt;&#39;, [&#39;2&#39;]),
 (&#39;&lt;digit&gt;&#39;, [&#39;3&#39;]),
 (&#39;&lt;digit&gt;&#39;, [&#39;4&#39;]),
 (&#39;&lt;digit&gt;&#39;, [&#39;5&#39;]),
 (&#39;&lt;digit&gt;&#39;, [&#39;6&#39;]),
 (&#39;&lt;digit&gt;&#39;, [&#39;7&#39;]),
 (&#39;&lt;digit&gt;&#39;, [&#39;8&#39;]),
 (&#39;&lt;digit&gt;&#39;, [&#39;9&#39;])]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>terminals</code> method extracts all terminal symbols from a <code>canonical</code> grammar representation.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">terminals</span><span class="p">(</span><span class="n">grammar</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">token</span>
               <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">(</span><span class="n">grammar</span><span class="p">)</span>
               <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">choice</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grammar</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">terminals</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39; * &#39;,
 &#39; + &#39;,
 &#39; - &#39;,
 &#39; / &#39;,
 &#39;(&#39;,
 &#39;)&#39;,
 &#39;+&#39;,
 &#39;-&#39;,
 &#39;.&#39;,
 &#39;0&#39;,
 &#39;1&#39;,
 &#39;2&#39;,
 &#39;3&#39;,
 &#39;4&#39;,
 &#39;5&#39;,
 &#39;6&#39;,
 &#39;7&#39;,
 &#39;8&#39;,
 &#39;9&#39;}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We require an additional method to massage our <code>EXPR_GRAMMAR</code>. This method removes the extraneous spaces from the grammar definition. While the spaces are reasonable when one is generating strings, they make our parses needlessly complicated.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">shrink</span><span class="p">(</span><span class="n">rule</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">canonical</span><span class="p">(</span><span class="n">grammar</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="p">[</span><span class="n">shrink</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">l</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">rules</span> <span class="ow">in</span> <span class="n">grammar</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pp_grammar</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;start&gt; = &lt;expr&gt;
&lt;expr&gt; = &lt;term&gt; + &#39;+&#39; + &lt;expr&gt;
	| &lt;term&gt; + &#39;-&#39; + &lt;expr&gt;
	| &lt;term&gt;
&lt;term&gt; = &lt;factor&gt; + &#39;*&#39; + &lt;term&gt;
	| &lt;factor&gt; + &#39;/&#39; + &lt;term&gt;
	| &lt;factor&gt;
&lt;factor&gt; = &#39;+&#39; + &lt;factor&gt;
	| &#39;-&#39; + &lt;factor&gt;
	| &#39;(&#39; + &lt;expr&gt; + &#39;)&#39;
	| &lt;integer&gt; + &#39;.&#39; + &lt;integer&gt;
	| &lt;integer&gt;
&lt;integer&gt; = &lt;digit&gt; + &lt;integer&gt;
	| &lt;digit&gt;
&lt;digit&gt; = &#39;0&#39;
	| &#39;1&#39;
	| &#39;2&#39;
	| &#39;3&#39;
	| &#39;4&#39;
	| &#39;5&#39;
	| &#39;6&#39;
	| &#39;7&#39;
	| &#39;8&#39;
	| &#39;9&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Nearley-Parser">Nearley Parser<a class="anchor-link" href="#Nearley-Parser">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The Earley parser is a general parser that is able to parse arbitrary <em>Context Free Grammars</em>. It was invented by Jay Earley~[<a href="https://doi.org/10.1145/362007.362035">Earley <em>et al</em>, 1970.</a>] for use in computational linguistics. While its computational complexity is $O(n^3)$ for parsing strings with arbitrary grammars, it can parse strings with unambiguous grammars in $O(n^2)$ time, and all _<a href="https://en.wikipedia.org/wiki/LR_parser">LR(k)</a>_ grammars in linear time ($O(n)$~[<a href="https://doi.org/https://doi.org/10.1016/0304-3975(91)90180-A">Joop M.I.M. Leo, 1991.</a>]). Further improvements -- notably handling epsilon rules -- were invented by Aycock et al.~[John Aycock <em>et al</em>, 2002.].</p>
<p>Note that one restriction of our implementation is that the start symbol should have only one choice in its choice expression. This is not a restriction in practice because any grammar with multiple choices in its start symbol can be extended with a new start symbol that has the original start symbol as its only choice. That is, given a grammar as below to conform to the single choice rule:</p>

<pre><code>grammar = {
    '&lt;start&gt;': [['&lt;A&gt;'], ['&lt;B&gt;']],
    '&lt;A&gt;': [['a']],
    '&lt;B&gt;': [['b']],    
}</code></pre>
<p>One may rewrite it as</p>

<pre><code>grammar = {
    '&lt;start&gt;': [['&lt;start_&gt;']],
    '&lt;start_&gt;': [['&lt;A&gt;'], ['&lt;B&gt;']],
    '&lt;A&gt;': [['a']],
    '&lt;B&gt;': [['b']],    
}</code></pre>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We first implement a simpler parser that is nearly an <em>Earley</em> parser, but not quite. In particular, our parser does not understand epsilon rules -- rules that derive empty string. Further, it sacrifices some performance for simplicity in that it stores redundant information to make retrieving derivation trees easier.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The parser uses dynamic programming to generate a table containing a forest of possible parses at each letter index -- the table contains as many columns as there are letters in the input, and each column contains different parsing rules at various stages of the parse.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Columns">Columns<a class="anchor-link" href="#Columns">&#182;</a></h4><p>We define the <code>Column</code> first. The <code>Column</code> is initialized by its own <code>index</code> in the input string, and the <code>letter</code> at that index. Internally, we also keep track of the states that are added to the column as the parsing progresses.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Column</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">letter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">letter</span> <span class="o">=</span> <span class="n">index</span><span class="p">,</span> <span class="n">letter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">{}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>Column</code> only stores unique <code>states</code>. Hence, when a new <code>state</code> is <code>added</code> to our <code>Column</code>, we check whether it is already known.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Column</span><span class="p">(</span><span class="n">Column</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unique</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">e_col</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Item">Item<a class="anchor-link" href="#Item">&#182;</a></h4><p>An item represents a parse in progress for a specific rule. Hence the item contains the name of the non-terminal, and the corresponding alternative expression (<code>expr</code>) which together form the rule, and the current position of parsing in this expression -- <code>dot</code>.</p>
<p><strong>Note.</strong> If you are familiar with <a href="https://en.wikipedia.org/wiki/LR_parser">LR parsing</a>, you will notice that an item is simply an <code>LR0</code> item.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">dot</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">dot</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We also provide a few convenience methods. The method <code>finished</code> checks if the <code>dot</code> has moved beyond the last element in <code>expr</code>. The method <code>advance</code> produces a new <code>Item</code> with the <code>dot</code> advanced one token, and represents an advance of the parsing. and <code>at_dot</code> returns the current symbol being parsed.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="n">Item</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">finished</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">advance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">at_dot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dot</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="States">States<a class="anchor-link" href="#States">&#182;</a></h4><p>For <code>Earley</code> parsing, the state of the parsing is simply <code>Item</code> along with some meta information such as the starting <code>s_col</code>  and ending column <code>e_col</code> for each state. Hence we inherit from <code>Item</code> to create a <code>State</code>.
We also store a references to all the child states (that is, all states that originates from non-terminals in the <code>expr</code>). Since we are interested in comparing states, we define <code>hash</code> and <code>eq</code> with the corresponding methods.</p>
<p>Note that our hash and equality operators include comparison with <code>&lt;state&gt;.children</code>. This means that we store more states per column than strictly necessary by the canonical Earley algorithm -- The canonical Earley algorithm only stores states that differ by <code>name</code>, <code>expr</code> and <code>dot</code>. However, these also make retrieving the parse tree simpler as we will demonstrate later.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">State</span><span class="p">(</span><span class="n">Item</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">dot</span><span class="p">,</span> <span class="n">s_col</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="p">[]):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">dot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s_col</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e_col</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">s_col</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">children</span><span class="p">[:]</span>

    <span class="k">def</span> <span class="nf">_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_col</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_t</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">advance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">State</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_col</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="The-Parser">The Parser<a class="anchor-link" href="#The-Parser">&#182;</a></h4></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We use the following grammar in our examples below.</p>

<pre><code>grammar = {
    '&lt;start&gt;': [['&lt;A&gt;','&lt;B&gt;']],
    '&lt;A&gt;': [['a','&lt;B&gt;','c'], ['A','&lt;A&gt;']],
    '&lt;B&gt;': [['b','&lt;C&gt;'], ['&lt;D&gt;']],
    '&lt;C&gt;': [['c']],
    '&lt;D&gt;': [['d']]
}</code></pre>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <em>Earley</em> algorithm starts by initializing the chart with columns (as many as there are letters in the input). We also seed the first column with a state representing the expression corresponding to the start symbol. In our case, the state corresponds to the start symbol with the <code>dot</code> at <code>0</code> is represented as below. The <code>|</code> symbol represents the paring status. In this case, we have not parsed anything.</p>

<pre><code>&lt;start&gt;: | &lt;A&gt; &lt;B&gt;</code></pre>
<p>We pass this partial chart to a method for filling the rest of the parse chart.</p>
<p>We call it the <code>NearlyParser</code> because it is not yet an <code>Earley</code> parser. Before starting to parse, we seed the chart with the state representing the ongoing parse of the start symbol.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">NearleyParser</span><span class="p">(</span><span class="n">Parser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">chart_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">start</span><span class="p">):</span>
        <span class="n">alt</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">start</span><span class="p">])</span>
        <span class="n">chart</span> <span class="o">=</span> <span class="p">[</span><span class="n">Column</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">tok</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tok</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">words</span><span class="p">])]</span>
        <span class="n">chart</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">alt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">chart</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_chart</span><span class="p">(</span><span class="n">chart</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The main loop has three fundamental operations. <code>predict</code>, <code>scan</code>, and <code>complete</code>. We discuss <code>predict</code> next.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Predict">Predict<a class="anchor-link" href="#Predict">&#182;</a></h5><p>We have already seeded <code>chart[0]</code> with a state <code>[&lt;A&gt;,&lt;B&gt;]</code> with <code>dot</code> at <code>0</code>. Next, given that <code>&lt;A&gt;</code> is a non-terminal, we <code>predict</code> the possible parse continuations of this state. That is, it could be either <code>a &lt;B&gt; c</code> or <code>A &lt;A&gt;</code>.</p>
<p>The general idea of <code>predict</code> is as follows: Say you have a state with name <code>&lt;A&gt;</code> from the above grammar, and expression containing <code>[a,&lt;B&gt;,c]</code>. Imagine that you are have seen <code>a</code> already, which means that the <code>dot</code> will be on <code>&lt;B&gt;</code>. Below, is a representation of our parse status. The left hand side of <code>|</code> represents the portion already parsed (<code>a</code>), and the right hand side represents the portion yet to be parsed (<code>&lt;B&gt; c</code>).</p>

<pre><code>&lt;A&gt;: a | &lt;B&gt; c</code></pre>
<p>To recognize <code>&lt;B&gt;</code>, we look at the definition of <code>&lt;B&gt;</code>, which has different alternative expressions. The <code>predict</code> step adds each of these alternatives to the set of states, with <code>dot</code> at <code>0</code>.</p>

<pre><code>&lt;A&gt;: a | &lt;B&gt; c
&lt;B&gt;: | b c
&lt;B&gt;: | &lt;D&gt;</code></pre>
<p>In essence, the <code>predict</code> method, when called with the current non-terminal, fetches the choices expressions corresponding to this non-terminal, and adds these as predicted <em>child</em> states to the <em>current</em> column.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">NearleyParser</span><span class="p">(</span><span class="n">NearleyParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">sym</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">alt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">sym</span><span class="p">]:</span>
            <span class="n">col</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">State</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">alt</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Scan">Scan<a class="anchor-link" href="#Scan">&#182;</a></h5><p>What if rather than a non-terminal, the state contained a terminal symbol -- i.e a letter? In that case, we are ready to make some progress. For example, consider the second state above</p>

<pre><code>&lt;B&gt;: | b c</code></pre>
<p>We <code>scan</code> the next column's letter. Say the next token is <code>b</code>.
If the letter matches what we have, then create a new state by advancing the current state by one letter.</p>

<pre><code>&lt;B&gt;: b | c</code></pre>
<p>This new state is added to the next column (i.e the column that has the matched letter).</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">NearleyParser</span><span class="p">(</span><span class="n">NearleyParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">letter</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">letter</span> <span class="o">==</span> <span class="n">col</span><span class="o">.</span><span class="n">letter</span><span class="p">:</span>
            <span class="n">col</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">advance</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Complete">Complete<a class="anchor-link" href="#Complete">&#182;</a></h5><p>When we advance, what if we actually <code>complete</code> the processing of the current rule? If so, we want to update not just this state, but also all the <em>parent</em> states from which this state was derived.
For example, say we have states as below.</p>

<pre><code>&lt;A&gt;: a | &lt;B&gt; c
&lt;B&gt;: b c |</code></pre>
<p>The state <code>&lt;B&gt;: b c |</code> is now complete. So, we need to advance <code>&lt;A&gt;: a | &lt;B&gt; c</code> one step forward.</p>
<p>How do we determine the parent states? Note from <code>predict</code> that we added the predicted child states to the <em>same</em> column as that of the inspected state. Hence, we look at the starting column of the current state, with the same symbol <code>at_dot</code> as that of the name of the completed state.</p>
<p>For each such parent found, we advance that parent (because we have just finished parsing that non terminal for their <code>at_dot</code>) and add the new states to the current column. We also mark the current state as a child state for the advanced parent state.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">NearleyParser</span><span class="p">(</span><span class="n">NearleyParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nearley_complete</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">nearley_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">parent_states</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">st</span> <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">s_col</span><span class="o">.</span><span class="n">states</span> <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">at_dot</span><span class="p">()</span> <span class="o">==</span> <span class="n">state</span><span class="o">.</span><span class="n">name</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">parent_states</span><span class="p">:</span>
            <span class="n">col</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">advance</span><span class="p">())</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Fill-chart">Fill chart<a class="anchor-link" href="#Fill-chart">&#182;</a></h5><p>The main driving loop in <code>fill_chart</code> essentially calls these operations in order. We loop over each column in order. For each column, fetch one state in the column at a time, and check if the state is <code>finished</code>. If it is, then we <code>complete</code> all the parent states depending on this state. If the state was not finished, we check to see if the state's current symbol <code>at_dot</code> is a non-terminal. If it is a non-terminal, we <code>predict</code> possible continuations, and update the current column with these states. If it was not, we <code>scan</code> the next column and advance the current state if it matches the next letter.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">NearleyParser</span><span class="p">(</span><span class="n">NearleyParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">fill_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chart</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">finished</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">complete</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sym</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">at_dot</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">sym</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chart</span><span class="p">):</span>
                            <span class="k">continue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">chart</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">state</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chart</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Since <code>chart_parse</code> returns the completed table, we now need to extract the derivation trees. Fortunately, this is simple given that we have kept the list of children for each state. All that we need to do is to fetch the finished states corresponding to the <code>start_symbol</code>, and retrieve the derivation trees for each child.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Parse">Parse<a class="anchor-link" href="#Parse">&#182;</a></h5></div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">NearleyParser</span><span class="p">(</span><span class="n">NearleyParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">parse_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_parse</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_symbol</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
            <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="n">st</span> <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">states</span> <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_symbol</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">states</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">states</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">cursor</span><span class="p">,</span> <span class="n">states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_prefix</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cursor</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">finished</span><span class="p">():</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivation_tree</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">children</span><span class="p">):</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">([(</span><span class="n">i</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">expr</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">])</span>
        <span class="n">nts</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">derivation_tree</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">children</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="n">terms</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span> <span class="k">else</span> <span class="n">nts</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">expr</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">derivation_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_expr</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">children</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mystring</span> <span class="o">=</span> <span class="s1">&#39;12*(2+2)/31&#39;</span>
<span class="n">nearley</span> <span class="o">=</span> <span class="n">NearleyParser</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">))</span>
<span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">nearley</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">mystring</span><span class="p">)):</span>
    <span class="k">assert</span> <span class="n">mystring</span> <span class="o">==</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="393pt" height="584pt"
 viewBox="0.00 0.00 392.50 584.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 580)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-580 388.5,-580 388.5,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="168" y="-564.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="168" y="-513.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M168,-560.9748C168,-554.195 168,-543.966 168,-535.1331"/>
<polygon fill="#000000" stroke="#000000" points="171.5001,-535.0561 168,-525.0561 164.5001,-535.0561 171.5001,-535.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="168" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M168,-509.9748C168,-503.195 168,-492.966 168,-484.1331"/>
<polygon fill="#000000" stroke="#000000" points="171.5001,-484.0561 168,-474.0561 164.5001,-484.0561 171.5001,-484.0561"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="110" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M159.4419,-458.9748C150.7035,-451.291 136.9268,-439.177 126.133,-429.6859"/>
<polygon fill="#000000" stroke="#000000" points="128.4141,-427.0311 118.5932,-423.0561 123.7918,-432.2879 128.4141,-427.0311"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="168" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">*</text>
</g>
<!-- 2&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>2&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M168,-458.9748C168,-452.195 168,-441.966 168,-433.1331"/>
<polygon fill="#000000" stroke="#000000" points="171.5001,-433.0561 168,-423.0561 164.5001,-433.0561 171.5001,-433.0561"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="216" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 2&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>2&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M175.0826,-458.9748C182.1017,-451.517 193.0487,-439.8857 201.8541,-430.53"/>
<polygon fill="#000000" stroke="#000000" points="204.5834,-432.7369 208.8884,-423.0561 199.486,-427.9393 204.5834,-432.7369"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="88" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M106.7538,-407.9748C103.7317,-400.969 99.1209,-390.2803 95.2275,-381.2547"/>
<polygon fill="#000000" stroke="#000000" points="98.4342,-379.8519 91.2595,-372.0561 92.0067,-382.6246 98.4342,-379.8519"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="21" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M78.1139,-356.9748C67.8216,-349.1403 51.4787,-336.7002 38.907,-327.1307"/>
<polygon fill="#000000" stroke="#000000" points="41.0036,-324.328 30.9266,-321.0561 36.7638,-329.898 41.0036,-324.328"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="88" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 4&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>4&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M88,-356.9748C88,-350.195 88,-339.966 88,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="91.5001,-331.0561 88,-321.0561 84.5001,-331.0561 91.5001,-331.0561"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="21" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">1</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M21,-305.9748C21,-299.195 21,-288.966 21,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="24.5001,-280.0561 21,-270.0561 17.5001,-280.0561 24.5001,-280.0561"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="81" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M86.9671,-305.9748C86.0366,-299.195 84.6326,-288.966 83.4202,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="86.8645,-279.4873 82.0371,-270.0561 79.9295,-280.4392 86.8645,-279.4873"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="81" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M81,-254.9748C81,-248.195 81,-237.966 81,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="84.5001,-229.0561 81,-219.0561 77.5001,-229.0561 84.5001,-229.0561"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="184" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>11&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M211.2783,-407.9748C206.788,-400.8183 199.8863,-389.8188 194.1488,-380.6747"/>
<polygon fill="#000000" stroke="#000000" points="197.0208,-378.6665 188.7411,-372.0561 191.0913,-382.387 197.0208,-378.6665"/>
</g>
<!-- 28 -->
<g id="node29" class="node">
<title>28</title>
<text text-anchor="middle" x="229" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">/</text>
</g>
<!-- 11&#45;&gt;28 -->
<g id="edge28" class="edge">
<title>11&#45;&gt;28</title>
<path fill="none" stroke="#000000" d="M217.9182,-407.9748C219.6656,-401.1196 222.3118,-390.7383 224.5802,-381.8392"/>
<polygon fill="#000000" stroke="#000000" points="227.9954,-382.6108 227.0739,-372.0561 221.2123,-380.8817 227.9954,-382.6108"/>
</g>
<!-- 29 -->
<g id="node30" class="node">
<title>29</title>
<text text-anchor="middle" x="276" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 11&#45;&gt;29 -->
<g id="edge29" class="edge">
<title>11&#45;&gt;29</title>
<path fill="none" stroke="#000000" d="M224.8532,-407.9748C233.8929,-400.291 248.1447,-388.177 259.3107,-378.6859"/>
<polygon fill="#000000" stroke="#000000" points="261.7578,-381.1994 267.1105,-372.0561 257.2243,-375.8658 261.7578,-381.1994"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="143" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">(</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12&#45;&gt;13</title>
<path fill="none" stroke="#000000" d="M177.9503,-356.9748C171.1341,-348.4961 159.9814,-334.6232 152.1104,-324.8324"/>
<polygon fill="#000000" stroke="#000000" points="154.6088,-322.3541 145.6154,-316.7533 149.1531,-326.74 154.6088,-322.3541"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="184" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 12&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>12&#45;&gt;14</title>
<path fill="none" stroke="#000000" d="M184,-356.9748C184,-350.195 184,-339.966 184,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="187.5001,-331.0561 184,-321.0561 180.5001,-331.0561 187.5001,-331.0561"/>
</g>
<!-- 27 -->
<g id="node28" class="node">
<title>27</title>
<text text-anchor="middle" x="225" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">)</text>
</g>
<!-- 12&#45;&gt;27 -->
<g id="edge27" class="edge">
<title>12&#45;&gt;27</title>
<path fill="none" stroke="#000000" d="M190.0497,-356.9748C196.8659,-348.4961 208.0186,-334.6232 215.8896,-324.8324"/>
<polygon fill="#000000" stroke="#000000" points="218.8469,-326.74 222.3846,-316.7533 213.3912,-322.3541 218.8469,-326.74"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="141" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 14&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>14&#45;&gt;15</title>
<path fill="none" stroke="#000000" d="M177.6552,-305.9748C171.4308,-298.5923 161.7583,-287.1203 153.9119,-277.8142"/>
<polygon fill="#000000" stroke="#000000" points="156.4927,-275.4452 147.3708,-270.0561 151.141,-279.9574 156.4927,-275.4452"/>
</g>
<!-- 20 -->
<g id="node21" class="node">
<title>20</title>
<text text-anchor="middle" x="184" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- 14&#45;&gt;20 -->
<g id="edge20" class="edge">
<title>14&#45;&gt;20</title>
<path fill="none" stroke="#000000" d="M184,-305.9748C184,-299.195 184,-288.966 184,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="187.5001,-280.0561 184,-270.0561 180.5001,-280.0561 187.5001,-280.0561"/>
</g>
<!-- 21 -->
<g id="node22" class="node">
<title>21</title>
<text text-anchor="middle" x="227" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 14&#45;&gt;21 -->
<g id="edge21" class="edge">
<title>14&#45;&gt;21</title>
<path fill="none" stroke="#000000" d="M190.3448,-305.9748C196.5692,-298.5923 206.2417,-287.1203 214.0881,-277.8142"/>
<polygon fill="#000000" stroke="#000000" points="216.859,-279.9574 220.6292,-270.0561 211.5073,-275.4452 216.859,-279.9574"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="141" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15&#45;&gt;16</title>
<path fill="none" stroke="#000000" d="M141,-254.9748C141,-248.195 141,-237.966 141,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="144.5001,-229.0561 141,-219.0561 137.5001,-229.0561 144.5001,-229.0561"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="141" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 16&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>16&#45;&gt;17</title>
<path fill="none" stroke="#000000" d="M141,-203.9748C141,-197.195 141,-186.966 141,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="144.5001,-178.0561 141,-168.0561 137.5001,-178.0561 144.5001,-178.0561"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="141" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 17&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>17&#45;&gt;18</title>
<path fill="none" stroke="#000000" d="M141,-152.9748C141,-146.195 141,-135.966 141,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="144.5001,-127.0561 141,-117.0561 137.5001,-127.0561 144.5001,-127.0561"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="141" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 18&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>18&#45;&gt;19</title>
<path fill="none" stroke="#000000" d="M141,-101.9748C141,-95.195 141,-84.966 141,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="144.5001,-76.0561 141,-66.0561 137.5001,-76.0561 144.5001,-76.0561"/>
</g>
<!-- 22 -->
<g id="node23" class="node">
<title>22</title>
<text text-anchor="middle" x="227" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 21&#45;&gt;22 -->
<g id="edge22" class="edge">
<title>21&#45;&gt;22</title>
<path fill="none" stroke="#000000" d="M227,-254.9748C227,-248.195 227,-237.966 227,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="230.5001,-229.0561 227,-219.0561 223.5001,-229.0561 230.5001,-229.0561"/>
</g>
<!-- 23 -->
<g id="node24" class="node">
<title>23</title>
<text text-anchor="middle" x="227" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 22&#45;&gt;23 -->
<g id="edge23" class="edge">
<title>22&#45;&gt;23</title>
<path fill="none" stroke="#000000" d="M227,-203.9748C227,-197.195 227,-186.966 227,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="230.5001,-178.0561 227,-168.0561 223.5001,-178.0561 230.5001,-178.0561"/>
</g>
<!-- 24 -->
<g id="node25" class="node">
<title>24</title>
<text text-anchor="middle" x="227" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 23&#45;&gt;24 -->
<g id="edge24" class="edge">
<title>23&#45;&gt;24</title>
<path fill="none" stroke="#000000" d="M227,-152.9748C227,-146.195 227,-135.966 227,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="230.5001,-127.0561 227,-117.0561 223.5001,-127.0561 230.5001,-127.0561"/>
</g>
<!-- 25 -->
<g id="node26" class="node">
<title>25</title>
<text text-anchor="middle" x="227" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 24&#45;&gt;25 -->
<g id="edge25" class="edge">
<title>24&#45;&gt;25</title>
<path fill="none" stroke="#000000" d="M227,-101.9748C227,-95.195 227,-84.966 227,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="230.5001,-76.0561 227,-66.0561 223.5001,-76.0561 230.5001,-76.0561"/>
</g>
<!-- 26 -->
<g id="node27" class="node">
<title>26</title>
<text text-anchor="middle" x="227" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 25&#45;&gt;26 -->
<g id="edge26" class="edge">
<title>25&#45;&gt;26</title>
<path fill="none" stroke="#000000" d="M227,-50.9748C227,-44.195 227,-33.966 227,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="230.5001,-25.0561 227,-15.0561 223.5001,-25.0561 230.5001,-25.0561"/>
</g>
<!-- 30 -->
<g id="node31" class="node">
<title>30</title>
<text text-anchor="middle" x="287" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 29&#45;&gt;30 -->
<g id="edge30" class="edge">
<title>29&#45;&gt;30</title>
<path fill="none" stroke="#000000" d="M277.6231,-356.9748C279.1016,-350.1196 281.3408,-339.7383 283.2602,-330.8392"/>
<polygon fill="#000000" stroke="#000000" points="286.6831,-331.5693 285.3703,-321.0561 279.8405,-330.0934 286.6831,-331.5693"/>
</g>
<!-- 31 -->
<g id="node32" class="node">
<title>31</title>
<text text-anchor="middle" x="293" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 30&#45;&gt;31 -->
<g id="edge31" class="edge">
<title>30&#45;&gt;31</title>
<path fill="none" stroke="#000000" d="M287.8853,-305.9748C288.6829,-299.195 289.8864,-288.966 290.9255,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="294.4186,-280.3966 292.111,-270.0561 287.4665,-279.5786 294.4186,-280.3966"/>
</g>
<!-- 32 -->
<g id="node33" class="node">
<title>32</title>
<text text-anchor="middle" x="290" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 31&#45;&gt;32 -->
<g id="edge32" class="edge">
<title>31&#45;&gt;32</title>
<path fill="none" stroke="#000000" d="M292.5573,-254.9748C292.1585,-248.195 291.5568,-237.966 291.0372,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="294.5258,-228.8333 290.4445,-219.0561 287.5378,-229.2444 294.5258,-228.8333"/>
</g>
<!-- 34 -->
<g id="node35" class="node">
<title>34</title>
<text text-anchor="middle" x="357" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 31&#45;&gt;34 -->
<g id="edge34" class="edge">
<title>31&#45;&gt;34</title>
<path fill="none" stroke="#000000" d="M302.4434,-254.9748C312.1803,-247.2157 327.5863,-234.939 339.5474,-225.4075"/>
<polygon fill="#000000" stroke="#000000" points="341.8784,-228.0254 347.5178,-219.0561 337.516,-222.551 341.8784,-228.0254"/>
</g>
<!-- 33 -->
<g id="node34" class="node">
<title>33</title>
<text text-anchor="middle" x="290" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">3</text>
</g>
<!-- 32&#45;&gt;33 -->
<g id="edge33" class="edge">
<title>32&#45;&gt;33</title>
<path fill="none" stroke="#000000" d="M290,-203.9748C290,-197.195 290,-186.966 290,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="293.5001,-178.0561 290,-168.0561 286.5001,-178.0561 293.5001,-178.0561"/>
</g>
<!-- 35 -->
<g id="node36" class="node">
<title>35</title>
<text text-anchor="middle" x="357" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 34&#45;&gt;35 -->
<g id="edge35" class="edge">
<title>34&#45;&gt;35</title>
<path fill="none" stroke="#000000" d="M357,-203.9748C357,-197.195 357,-186.966 357,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="360.5001,-178.0561 357,-168.0561 353.5001,-178.0561 360.5001,-178.0561"/>
</g>
<!-- 36 -->
<g id="node37" class="node">
<title>36</title>
<text text-anchor="middle" x="357" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">1</text>
</g>
<!-- 35&#45;&gt;36 -->
<g id="edge36" class="edge">
<title>35&#45;&gt;36</title>
<path fill="none" stroke="#000000" d="M357,-152.9748C357,-146.195 357,-135.966 357,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="360.5001,-127.0561 357,-117.0561 353.5001,-127.0561 360.5001,-127.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Ambiguous-parsing">Ambiguous parsing<a class="anchor-link" href="#Ambiguous-parsing">&#182;</a></h4></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Ambiguous grammars are grammars that can produce multiple derivation trees for some given string. For example, the grammar below can parse <code>1+2+3</code> in two different ways -- <code>[1+2]+3</code> and <code>1+[2+3]</code>. Both the parse trees can be retrieved using the <code>Earley</code> parser.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mystring</span> <span class="o">=</span> <span class="s1">&#39;1+2+3&#39;</span>
<span class="n">nearley</span> <span class="o">=</span> <span class="n">NearleyParser</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">A1_GRAMMAR</span><span class="p">))</span>
<span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">nearley</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">mystring</span><span class="p">)):</span>
    <span class="k">assert</span> <span class="n">mystring</span> <span class="o">==</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="215pt" height="329pt"
 viewBox="0.00 0.00 215.00 329.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 325)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-325 211,-325 211,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="130.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="130.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M130.5,-305.9748C130.5,-299.195 130.5,-288.966 130.5,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="134.0001,-280.0561 130.5,-270.0561 127.0001,-280.0561 134.0001,-280.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="81.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M123.2699,-254.9748C116.1046,-247.517 104.9294,-235.8857 95.9406,-226.53"/>
<polygon fill="#000000" stroke="#000000" points="98.2119,-223.8423 88.7598,-219.0561 93.1642,-228.6921 98.2119,-223.8423"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="130.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- 1&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>1&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M130.5,-254.9748C130.5,-248.195 130.5,-237.966 130.5,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="134.0001,-229.0561 130.5,-219.0561 127.0001,-229.0561 134.0001,-229.0561"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="176.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>1&#45;&gt;13</title>
<path fill="none" stroke="#000000" d="M137.2875,-254.9748C144.0141,-247.517 154.505,-235.8857 162.9436,-226.53"/>
<polygon fill="#000000" stroke="#000000" points="165.586,-228.826 169.6847,-219.0561 160.388,-224.1376 165.586,-228.826"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="27.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M73.5321,-203.9748C65.4761,-196.3663 52.8208,-184.4141 42.8167,-174.9658"/>
<polygon fill="#000000" stroke="#000000" points="45.1739,-172.3778 35.5006,-168.0561 40.3675,-177.4669 45.1739,-172.3778"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="70.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- 2&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>2&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M79.8769,-203.9748C78.3984,-197.1196 76.1592,-186.7383 74.2398,-177.8392"/>
<polygon fill="#000000" stroke="#000000" points="77.6595,-177.0934 72.1297,-168.0561 70.8169,-178.5693 77.6595,-177.0934"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="113.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>2&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M86.2217,-203.9748C90.712,-196.8183 97.6137,-185.8188 103.3512,-176.6747"/>
<polygon fill="#000000" stroke="#000000" points="106.4087,-178.387 108.7589,-168.0561 100.4792,-174.6665 106.4087,-178.387"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="27.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M27.5,-152.9748C27.5,-146.195 27.5,-135.966 27.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-127.0561 27.5,-117.0561 24.0001,-127.0561 31.0001,-127.0561"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="27.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M27.5,-101.9748C27.5,-95.195 27.5,-84.966 27.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-76.0561 27.5,-66.0561 24.0001,-76.0561 31.0001,-76.0561"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="27.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">1</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M27.5,-50.9748C27.5,-44.195 27.5,-33.966 27.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-25.0561 27.5,-15.0561 24.0001,-25.0561 31.0001,-25.0561"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="112.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M113.3524,-152.9748C113.2195,-146.195 113.0189,-135.966 112.8457,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="116.3436,-126.9855 112.6482,-117.0561 109.345,-127.1228 116.3436,-126.9855"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="112.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M112.5,-101.9748C112.5,-95.195 112.5,-84.966 112.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="116.0001,-76.0561 112.5,-66.0561 109.0001,-76.0561 116.0001,-76.0561"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="112.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M112.5,-50.9748C112.5,-44.195 112.5,-33.966 112.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="116.0001,-25.0561 112.5,-15.0561 109.0001,-25.0561 116.0001,-25.0561"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="179.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13&#45;&gt;14</title>
<path fill="none" stroke="#000000" d="M176.9427,-203.9748C177.3415,-197.195 177.9432,-186.966 178.4628,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="181.9622,-178.2444 179.0555,-168.0561 174.9742,-177.8333 181.9622,-178.2444"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="179.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 14&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>14&#45;&gt;15</title>
<path fill="none" stroke="#000000" d="M179.5,-152.9748C179.5,-146.195 179.5,-135.966 179.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="183.0001,-127.0561 179.5,-117.0561 176.0001,-127.0561 183.0001,-127.0561"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="179.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">3</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15&#45;&gt;16</title>
<path fill="none" stroke="#000000" d="M179.5,-101.9748C179.5,-95.195 179.5,-84.966 179.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="183.0001,-76.0561 179.5,-66.0561 176.0001,-76.0561 183.0001,-76.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="215pt" height="329pt"
 viewBox="0.00 0.00 215.00 329.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 325)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-325 211,-325 211,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="87.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="87.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M87.5,-305.9748C87.5,-299.195 87.5,-288.966 87.5,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="91.0001,-280.0561 87.5,-270.0561 84.0001,-280.0561 91.0001,-280.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="38.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M80.2699,-254.9748C73.1046,-247.517 61.9294,-235.8857 52.9406,-226.53"/>
<polygon fill="#000000" stroke="#000000" points="55.2119,-223.8423 45.7598,-219.0561 50.1642,-228.6921 55.2119,-223.8423"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="87.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- 1&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>1&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M87.5,-254.9748C87.5,-248.195 87.5,-237.966 87.5,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="91.0001,-229.0561 87.5,-219.0561 84.0001,-229.0561 91.0001,-229.0561"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="133.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>1&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M94.2875,-254.9748C101.0141,-247.517 111.505,-235.8857 119.9436,-226.53"/>
<polygon fill="#000000" stroke="#000000" points="122.586,-228.826 126.6847,-219.0561 117.388,-224.1376 122.586,-228.826"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="27.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M36.8769,-203.9748C35.3984,-197.1196 33.1592,-186.7383 31.2398,-177.8392"/>
<polygon fill="#000000" stroke="#000000" points="34.6595,-177.0934 29.1297,-168.0561 27.8169,-178.5693 34.6595,-177.0934"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="27.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M27.5,-152.9748C27.5,-146.195 27.5,-135.966 27.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-127.0561 27.5,-117.0561 24.0001,-127.0561 31.0001,-127.0561"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="27.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">1</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M27.5,-101.9748C27.5,-95.195 27.5,-84.966 27.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-76.0561 27.5,-66.0561 24.0001,-76.0561 31.0001,-76.0561"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="93.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M127.5979,-203.9748C121.8668,-196.6677 112.9933,-185.354 105.7351,-176.0997"/>
<polygon fill="#000000" stroke="#000000" points="108.3518,-173.7647 99.4264,-168.0561 102.8438,-178.0847 108.3518,-173.7647"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="136.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- 7&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>7&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M133.9427,-203.9748C134.3415,-197.195 134.9432,-186.966 135.4628,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="138.9622,-178.2444 136.0555,-168.0561 131.9742,-177.8333 138.9622,-178.2444"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="179.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 7&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>7&#45;&gt;13</title>
<path fill="none" stroke="#000000" d="M140.2875,-203.9748C147.0141,-196.517 157.505,-184.8857 165.9436,-175.53"/>
<polygon fill="#000000" stroke="#000000" points="168.586,-177.826 172.6847,-168.0561 163.388,-173.1376 168.586,-177.826"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="94.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M93.6476,-152.9748C93.7805,-146.195 93.9811,-135.966 94.1543,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="97.655,-127.1228 94.3518,-117.0561 90.6564,-126.9855 97.655,-127.1228"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="94.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M94.5,-101.9748C94.5,-95.195 94.5,-84.966 94.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="98.0001,-76.0561 94.5,-66.0561 91.0001,-76.0561 98.0001,-76.0561"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="94.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M94.5,-50.9748C94.5,-44.195 94.5,-33.966 94.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="98.0001,-25.0561 94.5,-15.0561 91.0001,-25.0561 98.0001,-25.0561"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="179.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13&#45;&gt;14</title>
<path fill="none" stroke="#000000" d="M179.5,-152.9748C179.5,-146.195 179.5,-135.966 179.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="183.0001,-127.0561 179.5,-117.0561 176.0001,-127.0561 183.0001,-127.0561"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="179.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 14&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>14&#45;&gt;15</title>
<path fill="none" stroke="#000000" d="M179.5,-101.9748C179.5,-95.195 179.5,-84.966 179.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="183.0001,-76.0561 179.5,-66.0561 176.0001,-76.0561 183.0001,-76.0561"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="179.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">3</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15&#45;&gt;16</title>
<path fill="none" stroke="#000000" d="M179.5,-50.9748C179.5,-44.195 179.5,-33.966 179.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="183.0001,-25.0561 179.5,-15.0561 176.0001,-25.0561 183.0001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Earley-Parser">Earley Parser<a class="anchor-link" href="#Earley-Parser">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We mentioned previously that our implementation took certain liberties with how states are stored in the <code>NearleyParser</code>. We pay for that in the performance penalty incurred. What if we do not want to pay that penalty? We next modify our parser so that it is a true Earley parser.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="States">States<a class="anchor-link" href="#States">&#182;</a></h4><p>The first modification is how states are compared. We no longer want to distinguish states with different children. Instead, we will obtain a parse forest at the end of the parse, from which derivation trees can be obtained.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">State</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">dot</span><span class="p">,</span> <span class="n">s_col</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">dot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s_col</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e_col</span> <span class="o">=</span> <span class="n">s_col</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_col</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">advance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">State</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_col</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="The-Parser">The Parser<a class="anchor-link" href="#The-Parser">&#182;</a></h4></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Similarly, we no longer track the children during <code>complete</code>.</p>
<h5 id="Complete">Complete<a class="anchor-link" href="#Complete">&#182;</a></h5></div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">EarleyParser</span><span class="p">(</span><span class="n">NearleyParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">earley_complete</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">earley_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">parent_states</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">st</span> <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">s_col</span><span class="o">.</span><span class="n">states</span> <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">at_dot</span><span class="p">()</span> <span class="o">==</span> <span class="n">state</span><span class="o">.</span><span class="n">name</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">parent_states</span><span class="p">:</span>
            <span class="n">col</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">advance</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Parse">Parse<a class="anchor-link" href="#Parse">&#182;</a></h5><p>The following is adapted from the excellent reference on Earley parsing by <a href="http://loup-vaillant.fr/tutorials/earley-parsing/">Loup Vaillant</a>.</p>
<p>The new <code>parse</code> procedure has to construct the parsed forest. Our original chart is a table of states that contains production rules that end at that index. For easier parsing, we switch to a table that contains rules that begins at that index.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">EarleyParser</span><span class="p">(</span><span class="n">EarleyParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
        <span class="n">f_table</span> <span class="o">=</span> <span class="p">[</span><span class="n">Column</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">letter</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
            <span class="n">finished</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">states</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">finished</span><span class="p">()]</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">finished</span><span class="p">:</span>
                <span class="n">f_table</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">s_col</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f_table</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For now, we return the first available derivation tree. To do that, we need to extract the parse forest from the state corresponding to <code>start</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">EarleyParser</span><span class="p">(</span><span class="n">EarleyParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">extract_trees</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forest</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">extract_a_tree</span><span class="p">(</span><span class="n">forest</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">cursor</span><span class="p">,</span> <span class="n">states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_prefix</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cursor</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_parse</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_symbol</span><span class="p">)</span>
        <span class="n">f_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">states</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">finished</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_trees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_forest</span><span class="p">(</span><span class="n">f_table</span><span class="p">,</span> <span class="n">start</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Parse-Forests">Parse Forests<a class="anchor-link" href="#Parse-Forests">&#182;</a></h5><p>The <code>parse_forest</code> takes the state which represents the completed parse, and determines the possible ways that its expressions corresponded to the parsed expression. For example, say we are parsing <code>1+2+3</code>, and the state has <code>[&lt;expr&gt;,+,&lt;expr&gt;]</code> in <code>expr</code>. It could have been parsed either <code>[{&lt;expr&gt;:1+2},+,{&lt;expr&gt;:3}]</code> or <code>[{&lt;expr&gt;:1},+,{&lt;expr&gt;:2+3}]</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">EarleyParser</span><span class="p">(</span><span class="n">EarleyParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">parse_forest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="o">.</span><span class="n">expr</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">pathexprs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_paths</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">chart</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">s_col</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                     <span class="n">state</span><span class="o">.</span><span class="n">e_col</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">paths_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pathexpr</span> <span class="ow">in</span> <span class="n">pathexprs</span><span class="p">:</span>
            <span class="n">pathexpr_</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">varexpr</span> <span class="ow">in</span> <span class="n">pathexpr</span><span class="p">:</span>
                <span class="n">completion</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_forest</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">varexpr</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">varexpr</span><span class="p">,</span> <span class="n">State</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">varexpr</span><span class="p">,</span> <span class="p">[]))</span>
                <span class="n">pathexpr_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">completion</span><span class="p">)</span>
            <span class="n">paths_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathexpr_</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">paths_</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Parse-Paths">Parse Paths<a class="anchor-link" href="#Parse-Paths">&#182;</a></h5><p>The parse paths tries to unify the given expression in <code>expr_</code> with the parsed string. For that, it extracts the first symbol in <code>expr_</code> and checks if it is a terminal symbol. If it is, then it checks the chart to see if the letter corresponding to the position matches the terminal symbol. If it does, advance our start index by the length of the symbol.</p>
<p>If the symbol was a non-terminal symbol, then we retrieve the parsed states at the current start index that correspond to the non-terminal symbol, and collect the end index. These are the start indexes for the remaining expression.</p>
<p>Given our list of start index, we obtain the parse paths from the remaining expression. If we can obtain any, then we return the parse paths. If not, we had an error. We return <code>None</code> in that case.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">EarleyParser</span><span class="p">(</span><span class="n">EarleyParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">parse_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr_</span><span class="p">,</span> <span class="n">chart</span><span class="p">,</span> <span class="n">frm</span><span class="p">,</span> <span class="n">til</span><span class="p">):</span>
        <span class="n">var</span><span class="p">,</span> <span class="o">*</span><span class="n">expr</span> <span class="o">=</span> <span class="n">expr_</span>
        <span class="n">starts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">:</span>
            <span class="n">starts</span> <span class="o">=</span> <span class="p">([(</span><span class="n">var</span><span class="p">,</span> <span class="n">frm</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">))]</span>
                      <span class="k">if</span> <span class="n">frm</span> <span class="o">&lt;</span> <span class="n">til</span> <span class="ow">and</span> <span class="n">chart</span><span class="p">[</span><span class="n">frm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">letter</span> <span class="o">==</span> <span class="n">var</span> <span class="k">else</span> <span class="p">[])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">starts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">e_col</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">chart</span><span class="p">[</span><span class="n">frm</span><span class="p">]</span><span class="o">.</span><span class="n">states</span>
                      <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">var</span><span class="p">]</span>

        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">start</span> <span class="ow">in</span> <span class="n">starts</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">expr</span><span class="p">:</span>
                <span class="n">paths</span><span class="o">.</span><span class="n">extend</span><span class="p">([[</span><span class="n">state</span><span class="p">]]</span> <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">til</span> <span class="k">else</span> <span class="p">[])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_paths</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">chart</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">til</span><span class="p">)</span>
                <span class="n">paths</span><span class="o">.</span><span class="n">extend</span><span class="p">([[</span><span class="n">state</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">paths</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="extract_a_tree">extract_a_tree<a class="anchor-link" href="#extract_a_tree">&#182;</a></h5></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What we have from <code>parse_forest</code> is a forest of trees. We need to extract a single tree from that forest. That is accomplished as follows. (We adapt the solution given by <a href="http://loup-vaillant.fr/tutorials/earley-parsing/parser">Loup Vaillant</a>)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">EarleyParser</span><span class="p">(</span><span class="n">EarleyParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">extract_a_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forest_node</span><span class="p">):</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">paths</span> <span class="o">=</span> <span class="n">forest_node</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">paths</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">extract_a_tree</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We now verify that our modifications work.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">A3_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;expr&gt;+&lt;expr&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;expr&gt;-&lt;expr&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;(&lt;expr&gt;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;integer&gt;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;&lt;integer&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;digit&gt;&lt;integer&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">],</span>
        <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span> <span class="s2">&quot;9&quot;</span><span class="p">]</span>
        <span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mystring</span> <span class="o">=</span> <span class="s1">&#39;(1+24)-33&#39;</span>
<span class="n">earley</span> <span class="o">=</span> <span class="n">EarleyParser</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">A3_GRAMMAR</span><span class="p">))</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">earley</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">mystring</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">==</span> <span class="n">mystring</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="276pt" height="431pt"
 viewBox="0.00 0.00 276.00 431.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 427)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-427 272,-427 272,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="127.5" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="127.5" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M127.5,-407.9748C127.5,-401.195 127.5,-390.966 127.5,-382.1331"/>
<polygon fill="#000000" stroke="#000000" points="131.0001,-382.0561 127.5,-372.0561 124.0001,-382.0561 131.0001,-382.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="81.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M120.7125,-356.9748C113.9859,-349.517 103.495,-337.8857 95.0564,-328.53"/>
<polygon fill="#000000" stroke="#000000" points="97.612,-326.1376 88.3153,-321.0561 92.414,-330.826 97.612,-326.1376"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="127.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&#45;</text>
</g>
<!-- 1&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>1&#45;&gt;18</title>
<path fill="none" stroke="#000000" d="M127.5,-356.9748C127.5,-350.195 127.5,-339.966 127.5,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="131.0001,-331.0561 127.5,-321.0561 124.0001,-331.0561 131.0001,-331.0561"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="171.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>1&#45;&gt;19</title>
<path fill="none" stroke="#000000" d="M133.9924,-356.9748C140.3615,-349.5923 150.259,-338.1203 158.2878,-328.8142"/>
<polygon fill="#000000" stroke="#000000" points="161.0987,-330.914 164.981,-321.0561 155.7986,-326.3414 161.0987,-330.914"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="30.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">(</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M73.9748,-305.9748C65.1498,-297.1498 50.4808,-282.4808 40.6536,-272.6536"/>
<polygon fill="#000000" stroke="#000000" points="42.8424,-269.8926 33.2964,-265.2964 37.8926,-274.8424 42.8424,-269.8926"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="71.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>2&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M80.0245,-305.9748C78.6951,-299.195 76.6894,-288.966 74.9575,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="78.3404,-279.1958 72.9816,-270.0561 71.4712,-280.5427 78.3404,-279.1958"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="112.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">)</text>
</g>
<!-- 2&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>2&#45;&gt;17</title>
<path fill="none" stroke="#000000" d="M86.0742,-305.9748C90.9742,-297.9135 98.8382,-284.9759 104.7155,-275.3068"/>
<polygon fill="#000000" stroke="#000000" points="107.7102,-277.1183 109.9136,-266.7551 101.7286,-273.4823 107.7102,-277.1183"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="27.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M65.0076,-254.9748C58.6385,-247.5923 48.741,-236.1203 40.7122,-226.8142"/>
<polygon fill="#000000" stroke="#000000" points="43.2014,-224.3414 34.019,-219.0561 37.9013,-228.914 43.2014,-224.3414"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="70.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- 4&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>4&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M71.3524,-254.9748C71.2195,-248.195 71.0189,-237.966 70.8457,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="74.3436,-228.9855 70.6482,-219.0561 67.345,-229.1228 74.3436,-228.9855"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="113.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 4&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>4&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M77.6972,-254.9748C83.7769,-247.5923 93.2245,-236.1203 100.8883,-226.8142"/>
<polygon fill="#000000" stroke="#000000" points="103.622,-229.0004 107.2773,-219.0561 98.2185,-224.5504 103.622,-229.0004"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="27.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M27.5,-203.9748C27.5,-197.195 27.5,-186.966 27.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-178.0561 27.5,-168.0561 24.0001,-178.0561 31.0001,-178.0561"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="27.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M27.5,-152.9748C27.5,-146.195 27.5,-135.966 27.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-127.0561 27.5,-117.0561 24.0001,-127.0561 31.0001,-127.0561"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="27.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">1</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M27.5,-101.9748C27.5,-95.195 27.5,-84.966 27.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-76.0561 27.5,-66.0561 24.0001,-76.0561 31.0001,-76.0561"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="113.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M113.5,-203.9748C113.5,-197.195 113.5,-186.966 113.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="117.0001,-178.0561 113.5,-168.0561 110.0001,-178.0561 117.0001,-178.0561"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="100.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>11&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M111.5818,-152.9748C109.8344,-146.1196 107.1882,-135.7383 104.9198,-126.8392"/>
<polygon fill="#000000" stroke="#000000" points="108.2877,-125.8817 102.4261,-117.0561 101.5046,-127.6108 108.2877,-125.8817"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="167.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 11&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>11&#45;&gt;14</title>
<path fill="none" stroke="#000000" d="M121.4679,-152.9748C129.5239,-145.3663 142.1792,-133.4141 152.1833,-123.9658"/>
<polygon fill="#000000" stroke="#000000" points="154.6325,-126.4669 159.4994,-117.0561 149.8261,-121.3778 154.6325,-126.4669"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="100.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12&#45;&gt;13</title>
<path fill="none" stroke="#000000" d="M100.5,-101.9748C100.5,-95.195 100.5,-84.966 100.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="104.0001,-76.0561 100.5,-66.0561 97.0001,-76.0561 104.0001,-76.0561"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="167.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 14&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>14&#45;&gt;15</title>
<path fill="none" stroke="#000000" d="M167.5,-101.9748C167.5,-95.195 167.5,-84.966 167.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="171.0001,-76.0561 167.5,-66.0561 164.0001,-76.0561 171.0001,-76.0561"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="167.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">4</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15&#45;&gt;16</title>
<path fill="none" stroke="#000000" d="M167.5,-50.9748C167.5,-44.195 167.5,-33.966 167.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="171.0001,-25.0561 167.5,-15.0561 164.0001,-25.0561 171.0001,-25.0561"/>
</g>
<!-- 20 -->
<g id="node21" class="node">
<title>20</title>
<text text-anchor="middle" x="173.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 19&#45;&gt;20 -->
<g id="edge20" class="edge">
<title>19&#45;&gt;20</title>
<path fill="none" stroke="#000000" d="M171.7951,-305.9748C172.061,-299.195 172.4621,-288.966 172.8085,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="176.309,-280.1856 173.2037,-270.0561 169.3144,-279.9112 176.309,-280.1856"/>
</g>
<!-- 21 -->
<g id="node22" class="node">
<title>21</title>
<text text-anchor="middle" x="173.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 20&#45;&gt;21 -->
<g id="edge21" class="edge">
<title>20&#45;&gt;21</title>
<path fill="none" stroke="#000000" d="M173.5,-254.9748C173.5,-248.195 173.5,-237.966 173.5,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="177.0001,-229.0561 173.5,-219.0561 170.0001,-229.0561 177.0001,-229.0561"/>
</g>
<!-- 23 -->
<g id="node24" class="node">
<title>23</title>
<text text-anchor="middle" x="240.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 20&#45;&gt;23 -->
<g id="edge23" class="edge">
<title>20&#45;&gt;23</title>
<path fill="none" stroke="#000000" d="M183.3861,-254.9748C193.6784,-247.1403 210.0213,-234.7002 222.593,-225.1307"/>
<polygon fill="#000000" stroke="#000000" points="224.7362,-227.898 230.5734,-219.0561 220.4964,-222.328 224.7362,-227.898"/>
</g>
<!-- 22 -->
<g id="node23" class="node">
<title>22</title>
<text text-anchor="middle" x="173.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">3</text>
</g>
<!-- 21&#45;&gt;22 -->
<g id="edge22" class="edge">
<title>21&#45;&gt;22</title>
<path fill="none" stroke="#000000" d="M173.5,-203.9748C173.5,-197.195 173.5,-186.966 173.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="177.0001,-178.0561 173.5,-168.0561 170.0001,-178.0561 177.0001,-178.0561"/>
</g>
<!-- 24 -->
<g id="node25" class="node">
<title>24</title>
<text text-anchor="middle" x="240.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 23&#45;&gt;24 -->
<g id="edge24" class="edge">
<title>23&#45;&gt;24</title>
<path fill="none" stroke="#000000" d="M240.5,-203.9748C240.5,-197.195 240.5,-186.966 240.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="244.0001,-178.0561 240.5,-168.0561 237.0001,-178.0561 244.0001,-178.0561"/>
</g>
<!-- 25 -->
<g id="node26" class="node">
<title>25</title>
<text text-anchor="middle" x="240.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">3</text>
</g>
<!-- 24&#45;&gt;25 -->
<g id="edge25" class="edge">
<title>24&#45;&gt;25</title>
<path fill="none" stroke="#000000" d="M240.5,-152.9748C240.5,-146.195 240.5,-135.966 240.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="244.0001,-127.0561 240.5,-117.0561 237.0001,-127.0561 244.0001,-127.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="extract_trees">extract_trees<a class="anchor-link" href="#extract_trees">&#182;</a></h5></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Extracting a single tree might be reasonable for unambiguous parses. However, what if the given grammar produces amgiguity when given a string? We need to extract all derivation trees in that case. We enhance our <code>extract_trees</code> to extract multiple derivation trees.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">EarleyParser</span><span class="p">(</span><span class="n">EarleyParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">extract_trees</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forest_node</span><span class="p">):</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">paths</span> <span class="o">=</span> <span class="n">forest_node</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">paths</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="p">[])]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="n">ptrees</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">extract_trees</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">path</span><span class="p">])</span>
            <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ptrees</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">results</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As before, we verify that everything works.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mystring</span> <span class="o">=</span> <span class="s1">&#39;12+23-34&#39;</span>
<span class="n">earley</span> <span class="o">=</span> <span class="n">EarleyParser</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">A1_GRAMMAR</span><span class="p">))</span>
<span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">earley</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">mystring</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">mystring</span> <span class="o">==</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="363pt" height="380pt"
 viewBox="0.00 0.00 362.50 380.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 376)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-376 358.5,-376 358.5,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="210" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="210" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M210,-356.9748C210,-350.195 210,-339.966 210,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="213.5001,-331.0561 210,-321.0561 206.5001,-331.0561 213.5001,-331.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="162" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M202.9174,-305.9748C195.8983,-298.517 184.9513,-286.8857 176.1459,-277.53"/>
<polygon fill="#000000" stroke="#000000" points="178.514,-274.9393 169.1116,-270.0561 173.4166,-279.7369 178.514,-274.9393"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="210" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&#45;</text>
</g>
<!-- 1&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>1&#45;&gt;18</title>
<path fill="none" stroke="#000000" d="M210,-305.9748C210,-299.195 210,-288.966 210,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="213.5001,-280.0561 210,-270.0561 206.5001,-280.0561 213.5001,-280.0561"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="254" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>1&#45;&gt;19</title>
<path fill="none" stroke="#000000" d="M216.4924,-305.9748C222.8615,-298.5923 232.759,-287.1203 240.7878,-277.8142"/>
<polygon fill="#000000" stroke="#000000" points="243.5987,-279.914 247.481,-270.0561 238.2986,-275.3414 243.5987,-279.914"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="102" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M153.1468,-254.9748C144.1071,-247.291 129.8553,-235.177 118.6893,-225.6859"/>
<polygon fill="#000000" stroke="#000000" points="120.7757,-222.8658 110.8895,-219.0561 116.2422,-228.1994 120.7757,-222.8658"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="148" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- 2&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>2&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M159.9343,-254.9748C158.0524,-248.1196 155.2027,-237.7383 152.7598,-228.8392"/>
<polygon fill="#000000" stroke="#000000" points="156.0966,-227.7728 150.0742,-219.0561 149.3463,-229.6259 156.0966,-227.7728"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="191" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 2&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>2&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M166.279,-254.9748C170.3056,-247.8936 176.4716,-237.05 181.6381,-227.9641"/>
<polygon fill="#000000" stroke="#000000" points="184.8028,-229.4791 186.7034,-219.0561 178.7178,-226.0189 184.8028,-229.4791"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="88" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M99.9343,-203.9748C98.0524,-197.1196 95.2027,-186.7383 92.7598,-177.8392"/>
<polygon fill="#000000" stroke="#000000" points="96.0966,-176.7728 90.0742,-168.0561 89.3463,-178.6259 96.0966,-176.7728"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="21" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M78.1139,-152.9748C67.8216,-145.1403 51.4787,-132.7002 38.907,-123.1307"/>
<polygon fill="#000000" stroke="#000000" points="41.0036,-120.328 30.9266,-117.0561 36.7638,-125.898 41.0036,-120.328"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="88" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 4&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>4&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M88,-152.9748C88,-146.195 88,-135.966 88,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="91.5001,-127.0561 88,-117.0561 84.5001,-127.0561 91.5001,-127.0561"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="21" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">1</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M21,-101.9748C21,-95.195 21,-84.966 21,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="24.5001,-76.0561 21,-66.0561 17.5001,-76.0561 24.5001,-76.0561"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="88" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M88,-101.9748C88,-95.195 88,-84.966 88,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="91.5001,-76.0561 88,-66.0561 84.5001,-76.0561 91.5001,-76.0561"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="88" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M88,-50.9748C88,-44.195 88,-33.966 88,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="91.5001,-25.0561 88,-15.0561 84.5001,-25.0561 91.5001,-25.0561"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="191" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>11&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M191,-203.9748C191,-197.195 191,-186.966 191,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="194.5001,-178.0561 191,-168.0561 187.5001,-178.0561 194.5001,-178.0561"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="155" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12&#45;&gt;13</title>
<path fill="none" stroke="#000000" d="M185.6881,-152.9748C180.5833,-145.743 172.7084,-134.5868 166.2141,-125.3866"/>
<polygon fill="#000000" stroke="#000000" points="168.96,-123.2074 160.3337,-117.0561 163.2412,-127.2442 168.96,-123.2074"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="222" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 12&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>12&#45;&gt;15</title>
<path fill="none" stroke="#000000" d="M195.5742,-152.9748C199.9242,-145.8183 206.6101,-134.8188 212.1683,-125.6747"/>
<polygon fill="#000000" stroke="#000000" points="215.2037,-127.4193 217.4071,-117.0561 209.222,-123.7834 215.2037,-127.4193"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="155" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13&#45;&gt;14</title>
<path fill="none" stroke="#000000" d="M155,-101.9748C155,-95.195 155,-84.966 155,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="158.5001,-76.0561 155,-66.0561 151.5001,-76.0561 158.5001,-76.0561"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="222" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15&#45;&gt;16</title>
<path fill="none" stroke="#000000" d="M222,-101.9748C222,-95.195 222,-84.966 222,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="225.5001,-76.0561 222,-66.0561 218.5001,-76.0561 225.5001,-76.0561"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="222" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">3</text>
</g>
<!-- 16&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>16&#45;&gt;17</title>
<path fill="none" stroke="#000000" d="M222,-50.9748C222,-44.195 222,-33.966 222,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="225.5001,-25.0561 222,-15.0561 218.5001,-25.0561 225.5001,-25.0561"/>
</g>
<!-- 20 -->
<g id="node21" class="node">
<title>20</title>
<text text-anchor="middle" x="260" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 19&#45;&gt;20 -->
<g id="edge20" class="edge">
<title>19&#45;&gt;20</title>
<path fill="none" stroke="#000000" d="M254.8853,-254.9748C255.6829,-248.195 256.8864,-237.966 257.9255,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="261.4186,-229.3966 259.111,-219.0561 254.4665,-228.5786 261.4186,-229.3966"/>
</g>
<!-- 21 -->
<g id="node22" class="node">
<title>21</title>
<text text-anchor="middle" x="260" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 20&#45;&gt;21 -->
<g id="edge21" class="edge">
<title>20&#45;&gt;21</title>
<path fill="none" stroke="#000000" d="M260,-203.9748C260,-197.195 260,-186.966 260,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="263.5001,-178.0561 260,-168.0561 256.5001,-178.0561 263.5001,-178.0561"/>
</g>
<!-- 23 -->
<g id="node24" class="node">
<title>23</title>
<text text-anchor="middle" x="327" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 20&#45;&gt;23 -->
<g id="edge23" class="edge">
<title>20&#45;&gt;23</title>
<path fill="none" stroke="#000000" d="M269.8861,-203.9748C280.1784,-196.1403 296.5213,-183.7002 309.093,-174.1307"/>
<polygon fill="#000000" stroke="#000000" points="311.2362,-176.898 317.0734,-168.0561 306.9964,-171.328 311.2362,-176.898"/>
</g>
<!-- 22 -->
<g id="node23" class="node">
<title>22</title>
<text text-anchor="middle" x="272" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">3</text>
</g>
<!-- 21&#45;&gt;22 -->
<g id="edge22" class="edge">
<title>21&#45;&gt;22</title>
<path fill="none" stroke="#000000" d="M261.7706,-152.9748C263.3836,-146.1196 265.8263,-135.7383 267.9202,-126.8392"/>
<polygon fill="#000000" stroke="#000000" points="271.3386,-127.5919 270.2221,-117.0561 264.5247,-125.9886 271.3386,-127.5919"/>
</g>
<!-- 24 -->
<g id="node25" class="node">
<title>24</title>
<text text-anchor="middle" x="327" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 23&#45;&gt;24 -->
<g id="edge24" class="edge">
<title>23&#45;&gt;24</title>
<path fill="none" stroke="#000000" d="M327,-152.9748C327,-146.195 327,-135.966 327,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="330.5001,-127.0561 327,-117.0561 323.5001,-127.0561 330.5001,-127.0561"/>
</g>
<!-- 25 -->
<g id="node26" class="node">
<title>25</title>
<text text-anchor="middle" x="327" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">4</text>
</g>
<!-- 24&#45;&gt;25 -->
<g id="edge25" class="edge">
<title>24&#45;&gt;25</title>
<path fill="none" stroke="#000000" d="M327,-101.9748C327,-95.195 327,-84.966 327,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="330.5001,-76.0561 327,-66.0561 323.5001,-76.0561 330.5001,-76.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="373pt" height="380pt"
 viewBox="0.00 0.00 372.50 380.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 376)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-376 368.5,-376 368.5,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="152" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="152" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M152,-356.9748C152,-350.195 152,-339.966 152,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="155.5001,-331.0561 152,-321.0561 148.5001,-331.0561 155.5001,-331.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="102" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M144.6223,-305.9748C137.2369,-298.4417 125.6768,-286.6503 116.458,-277.2472"/>
<polygon fill="#000000" stroke="#000000" points="118.9079,-274.7466 109.4079,-270.0561 113.9094,-279.6471 118.9079,-274.7466"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="152" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- 1&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>1&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M152,-305.9748C152,-299.195 152,-288.966 152,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="155.5001,-280.0561 152,-270.0561 148.5001,-280.0561 155.5001,-280.0561"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="198" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>1&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M158.7875,-305.9748C165.5141,-298.517 176.005,-286.8857 184.4436,-277.53"/>
<polygon fill="#000000" stroke="#000000" points="187.086,-279.826 191.1847,-270.0561 181.888,-275.1376 187.086,-279.826"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="88" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M99.9343,-254.9748C98.0524,-248.1196 95.2027,-237.7383 92.7598,-228.8392"/>
<polygon fill="#000000" stroke="#000000" points="96.0966,-227.7728 90.0742,-219.0561 89.3463,-229.6259 96.0966,-227.7728"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="21" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M78.1139,-203.9748C67.8216,-196.1403 51.4787,-183.7002 38.907,-174.1307"/>
<polygon fill="#000000" stroke="#000000" points="41.0036,-171.328 30.9266,-168.0561 36.7638,-176.898 41.0036,-171.328"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="88" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 3&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>3&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M88,-203.9748C88,-197.195 88,-186.966 88,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="91.5001,-178.0561 88,-168.0561 84.5001,-178.0561 91.5001,-178.0561"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="21" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">1</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M21,-152.9748C21,-146.195 21,-135.966 21,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="24.5001,-127.0561 21,-117.0561 17.5001,-127.0561 24.5001,-127.0561"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="76" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M86.2294,-152.9748C84.6164,-146.1196 82.1737,-135.7383 80.0798,-126.8392"/>
<polygon fill="#000000" stroke="#000000" points="83.4753,-125.9886 77.7779,-117.0561 76.6614,-127.5919 83.4753,-125.9886"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="76" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 7&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>7&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M76,-101.9748C76,-95.195 76,-84.966 76,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="79.5001,-76.0561 76,-66.0561 72.5001,-76.0561 79.5001,-76.0561"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="165" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M193.1307,-254.9748C188.5001,-247.8183 181.3828,-236.8188 175.466,-227.6747"/>
<polygon fill="#000000" stroke="#000000" points="178.2603,-225.5504 169.8892,-219.0561 172.3833,-229.3532 178.2603,-225.5504"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="206" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&#45;</text>
</g>
<!-- 10&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>10&#45;&gt;18</title>
<path fill="none" stroke="#000000" d="M199.1804,-254.9748C200.2439,-248.195 201.8485,-237.966 203.234,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="206.7227,-229.4777 204.8147,-219.0561 199.8073,-228.3929 206.7227,-229.4777"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="254" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 10&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>10&#45;&gt;19</title>
<path fill="none" stroke="#000000" d="M206.263,-254.9748C214.6174,-247.3663 227.7414,-235.4141 238.116,-225.9658"/>
<polygon fill="#000000" stroke="#000000" points="240.6663,-228.3771 245.7031,-219.0561 235.953,-223.2017 240.6663,-228.3771"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="165" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 11&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>11&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M165,-203.9748C165,-197.195 165,-186.966 165,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="168.5001,-178.0561 165,-168.0561 161.5001,-178.0561 168.5001,-178.0561"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="136" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12&#45;&gt;13</title>
<path fill="none" stroke="#000000" d="M160.721,-152.9748C156.6944,-145.8936 150.5284,-135.05 145.3619,-125.9641"/>
<polygon fill="#000000" stroke="#000000" points="148.2822,-124.0189 140.2966,-117.0561 142.1972,-127.4791 148.2822,-124.0189"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="203" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 12&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>12&#45;&gt;15</title>
<path fill="none" stroke="#000000" d="M170.607,-152.9748C176.0516,-145.6677 184.4813,-134.354 191.3767,-125.0997"/>
<polygon fill="#000000" stroke="#000000" points="194.2017,-127.1661 197.37,-117.0561 188.5885,-122.9837 194.2017,-127.1661"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="136" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13&#45;&gt;14</title>
<path fill="none" stroke="#000000" d="M136,-101.9748C136,-95.195 136,-84.966 136,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="139.5001,-76.0561 136,-66.0561 132.5001,-76.0561 139.5001,-76.0561"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="203" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15&#45;&gt;16</title>
<path fill="none" stroke="#000000" d="M203,-101.9748C203,-95.195 203,-84.966 203,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="206.5001,-76.0561 203,-66.0561 199.5001,-76.0561 206.5001,-76.0561"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="203" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">3</text>
</g>
<!-- 16&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>16&#45;&gt;17</title>
<path fill="none" stroke="#000000" d="M203,-50.9748C203,-44.195 203,-33.966 203,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="206.5001,-25.0561 203,-15.0561 199.5001,-25.0561 206.5001,-25.0561"/>
</g>
<!-- 20 -->
<g id="node21" class="node">
<title>20</title>
<text text-anchor="middle" x="270" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 19&#45;&gt;20 -->
<g id="edge20" class="edge">
<title>19&#45;&gt;20</title>
<path fill="none" stroke="#000000" d="M256.3609,-203.9748C258.5115,-197.1196 261.7684,-186.7383 264.5602,-177.8392"/>
<polygon fill="#000000" stroke="#000000" points="267.9755,-178.6453 267.6295,-168.0561 261.2965,-176.5499 267.9755,-178.6453"/>
</g>
<!-- 21 -->
<g id="node22" class="node">
<title>21</title>
<text text-anchor="middle" x="270" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 20&#45;&gt;21 -->
<g id="edge21" class="edge">
<title>20&#45;&gt;21</title>
<path fill="none" stroke="#000000" d="M270,-152.9748C270,-146.195 270,-135.966 270,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="273.5001,-127.0561 270,-117.0561 266.5001,-127.0561 273.5001,-127.0561"/>
</g>
<!-- 23 -->
<g id="node24" class="node">
<title>23</title>
<text text-anchor="middle" x="337" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 20&#45;&gt;23 -->
<g id="edge23" class="edge">
<title>20&#45;&gt;23</title>
<path fill="none" stroke="#000000" d="M279.8861,-152.9748C290.1784,-145.1403 306.5213,-132.7002 319.093,-123.1307"/>
<polygon fill="#000000" stroke="#000000" points="321.2362,-125.898 327.0734,-117.0561 316.9964,-120.328 321.2362,-125.898"/>
</g>
<!-- 22 -->
<g id="node23" class="node">
<title>22</title>
<text text-anchor="middle" x="270" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">3</text>
</g>
<!-- 21&#45;&gt;22 -->
<g id="edge22" class="edge">
<title>21&#45;&gt;22</title>
<path fill="none" stroke="#000000" d="M270,-101.9748C270,-95.195 270,-84.966 270,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="273.5001,-76.0561 270,-66.0561 266.5001,-76.0561 273.5001,-76.0561"/>
</g>
<!-- 24 -->
<g id="node25" class="node">
<title>24</title>
<text text-anchor="middle" x="337" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 23&#45;&gt;24 -->
<g id="edge24" class="edge">
<title>23&#45;&gt;24</title>
<path fill="none" stroke="#000000" d="M337,-101.9748C337,-95.195 337,-84.966 337,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="340.5001,-76.0561 337,-66.0561 333.5001,-76.0561 340.5001,-76.0561"/>
</g>
<!-- 25 -->
<g id="node26" class="node">
<title>25</title>
<text text-anchor="middle" x="337" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">4</text>
</g>
<!-- 24&#45;&gt;25 -->
<g id="edge25" class="edge">
<title>24&#45;&gt;25</title>
<path fill="none" stroke="#000000" d="M337,-50.9748C337,-44.195 337,-33.966 337,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="340.5001,-25.0561 337,-15.0561 333.5001,-25.0561 340.5001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="The-Aycock-Epsilon-fix">The Aycock Epsilon fix<a class="anchor-link" href="#The-Aycock-Epsilon-fix">&#182;</a></h4></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>While parsing, one often requires to know whether a given non-terminal can derive an empty string. For example, in the following grammar A can derive an empty string, while B can not. The non-terminals that can derive an empty string is called a nullable non-terminal.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">my_grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;&lt;start&gt;&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="s1">&#39;&lt;A&gt;&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;&lt;B&gt;&#39;</span><span class="p">]],</span>
    <span class="s1">&#39;&lt;A&gt;&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">],[</span><span class="s1">&#39;&#39;</span><span class="p">]],</span>
    <span class="s1">&#39;&lt;B&gt;&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="s1">&#39;b&#39;</span><span class="p">]]</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>One of the problems with the original Earley implementation is that it does not handle rules that can derive empty strings very well. For example, the given grammar should match <code>a</code></p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">EPSILON</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">E_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;&lt;start&gt;&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;&lt;S&gt;&#39;</span><span class="p">],</span>
        <span class="s1">&#39;&lt;S&gt;&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;&lt;A&gt;&lt;A&gt;&lt;A&gt;&lt;A&gt;&#39;</span><span class="p">],</span>
        <span class="s1">&#39;&lt;A&gt;&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;E&gt;&#39;</span><span class="p">],</span>
        <span class="s1">&#39;&lt;E&gt;&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">EPSILON</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mystring</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
<span class="n">earley</span> <span class="o">=</span> <span class="n">EarleyParser</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">E_GRAMMAR</span><span class="p">))</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">earley</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">mystring</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Aycock et al. suggests a simple fix. Their idea is to pre-compute the <code>nullable</code> set and use it to advance the <code>nullable</code> states. However, before we do that, we need to compute the <code>nullable</code> set. The <code>nullable</code> set consists of all non-terminals that can derive an empty string.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Computing the <code>nullable</code> set requires expanding each production rule in the grammar iteratively and inspecting whether a given rule can derive the empty string. Each iteration needs to take into account new terminals that have been found to be <code>nullable</code>. The procedure stops when we obtain a stable result. This procedure can be abstracted into a more general method <code>fixpoint</code>.</p>
<h5 id="Fixpoint">Fixpoint<a class="anchor-link" href="#Fixpoint">&#182;</a></h5><p>A <code>fixpoint</code> of a function is an element in the function's domain such that it is mapped to itself. For example, 1 is a <code>fixpoint</code> of square root because <code>squareroot(1) == 1</code>.</p>
<p>(We use <code>str</code> rather than <code>hash</code> to check for equality in <code>fixpoint</code> because the data structure <code>set</code>, which we would like to use as an argument has a good string representation but is not hashable).</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">fixpoint</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">helper</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">sarg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="n">arg_</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg_</span><span class="p">)</span> <span class="o">==</span> <span class="n">sarg</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">arg</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">arg_</span>

    <span class="k">return</span> <span class="n">helper</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Remember <code>my_sqrt</code> from the first chapter? We can define my_sqrt using fixpoint.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">my_sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="nd">@fixpoint</span>
    <span class="k">def</span> <span class="nf">_my_sqrt</span><span class="p">(</span><span class="n">approx</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">approx</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="n">approx</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">return</span> <span class="n">_my_sqrt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">my_sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>1.414213562373095
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h5 id="Nullable">Nullable<a class="anchor-link" href="#Nullable">&#182;</a></h5><p>Similarly, we can define <code>nullable</code> using <code>fixpoint</code>. We essentially provide the definition of a single intermediate step. That is, assuming that <code>nullables</code> contain the current <code>nullable</code> non-terminals, we iterate over the grammar looking for productions which are <code>nullable</code> -- that is, productions where the entire sequence can yield an empty string on some expansion.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">nullable_expr</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">nullables</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">token</span> <span class="ow">in</span> <span class="n">nullables</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">expr</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">nullable</span><span class="p">(</span><span class="n">grammar</span><span class="p">):</span>
    <span class="n">productions</span> <span class="o">=</span> <span class="n">rules</span><span class="p">(</span><span class="n">grammar</span><span class="p">)</span>

    <span class="nd">@fixpoint</span>
    <span class="k">def</span> <span class="nf">nullable_</span><span class="p">(</span><span class="n">nullables</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">A</span><span class="p">,</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">productions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nullable_expr</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">nullables</span><span class="p">):</span>
                <span class="n">nullables</span> <span class="o">|=</span> <span class="p">{</span><span class="n">A</span><span class="p">}</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">nullables</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">nullable_</span><span class="p">({</span><span class="n">EPSILON</span><span class="p">})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nullable</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">E_GRAMMAR</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&#39;, &#39;&lt;A&gt;&#39;, &#39;&lt;E&gt;&#39;, &#39;&lt;S&gt;&#39;, &#39;&lt;start&gt;&#39;}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>So, once we have the <code>nullable</code> set, all that we need to do is, after we have called <code>predict</code> on a state corresponding to a non-terminal, check if it is <code>nullable</code> and if it is, advance and add the state to the current column.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">EarleyParser</span><span class="p">(</span><span class="n">EarleyParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">fill_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart</span><span class="p">):</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">nullable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chart</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">finished</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">complete</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sym</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">at_dot</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">sym</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">epsilon</span><span class="p">:</span>
                            <span class="n">col</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">advance</span><span class="p">())</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chart</span><span class="p">):</span>
                            <span class="k">continue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">chart</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">state</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chart</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mystring</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
<span class="n">earley</span> <span class="o">=</span> <span class="n">EarleyParser</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">E_GRAMMAR</span><span class="p">))</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">earley</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">mystring</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="166pt" height="176pt"
 viewBox="0.00 0.00 166.00 176.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 172)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-172 162,-172 162,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="79" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="79" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;S&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M79,-152.9748C79,-146.195 79,-135.966 79,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="82.5001,-127.0561 79,-117.0561 75.5001,-127.0561 82.5001,-127.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="13" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M69.2615,-101.9748C59.2203,-94.2157 43.3329,-81.939 30.998,-72.4075"/>
<polygon fill="#000000" stroke="#000000" points="32.8314,-69.4011 22.7785,-66.0561 28.5513,-74.9401 32.8314,-69.4011"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="57" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 1&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>1&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M75.7538,-101.9748C72.7317,-94.969 68.1209,-84.2803 64.2275,-75.2547"/>
<polygon fill="#000000" stroke="#000000" points="67.4342,-73.8519 60.2595,-66.0561 61.0067,-76.6246 67.4342,-73.8519"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="101" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 1&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>1&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M82.2462,-101.9748C85.2683,-94.969 89.8791,-84.2803 93.7725,-75.2547"/>
<polygon fill="#000000" stroke="#000000" points="96.9933,-76.6246 97.7405,-66.0561 90.5658,-73.8519 96.9933,-76.6246"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="145" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;A&gt;</text>
</g>
<!-- 1&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>1&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M88.7385,-101.9748C98.7797,-94.2157 114.6671,-81.939 127.002,-72.4075"/>
<polygon fill="#000000" stroke="#000000" points="129.4487,-74.9401 135.2215,-66.0561 125.1686,-69.4011 129.4487,-74.9401"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="13" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;E&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M13,-50.9748C13,-44.195 13,-33.966 13,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="16.5001,-25.0561 13,-15.0561 9.5001,-25.0561 16.5001,-25.0561"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="57" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;E&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M57,-50.9748C57,-44.195 57,-33.966 57,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="60.5001,-25.0561 57,-15.0561 53.5001,-25.0561 60.5001,-25.0561"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="101" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;E&gt;</text>
</g>
<!-- 6&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>6&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M101,-50.9748C101,-44.195 101,-33.966 101,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="104.5001,-25.0561 101,-15.0561 97.5001,-25.0561 104.5001,-25.0561"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="145" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">a</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M145,-50.9748C145,-44.195 145,-33.966 145,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="148.5001,-25.0561 145,-15.0561 141.5001,-25.0561 148.5001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Further-Information">Further Information<a class="anchor-link" href="#Further-Information">&#182;</a></h2><ul>
<li>Parsing with arbitrary context free grammars is reducible to boolean matrix multiplication~[<a href="https://doi.org/10.1016/S0022-0000(75)80046-8">Valiant <em>et al</em>, 1975.</a>] (and the reverse~[<a href="https://doi.org/10.1145/505241.505242">Lee <em>et al</em>, 2002.</a>]) which is at present bounded by $O(2^{23728639}$) ~[<a href="https://doi.org/10.1145/2608628.2608664">Le Gall <em>et al</em>, 2014.</a>]</li>
<li>The actual class of languages that is expressible in PEG is currently unknown. In particular, we know that PEGs can express certain languages such as $a^n b^n c^n$. However, we do not know if there exist Context-Free languages that are not expressible with PEGs.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned<a class="anchor-link" href="#Lessons-Learned">&#182;</a></h2><ul>
<li>Grammars can be used to generate derivation trees for a given string.</li>
<li>Parsing Expression Grammars are intuitive, and easy to implement, but require care to write.</li>
<li>Earley Parsers can parse arbitrary Context Free Grammars.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps<a class="anchor-link" href="#Next-Steps">&#182;</a></h2><ul>
<li><a href="GrammarMiner.html">Use the automatic grammar miner for obtaining grammar</a></li>
<li>[Mutate the strings using grammar]</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises<a class="anchor-link" href="#Exercises">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1-An-alternative-Packrat">Exercise 1 An alternative <em>Packrat</em><a class="anchor-link" href="#Exercise-1-An-alternative-Packrat">&#182;</a></h3><p>In the <em>Packrat</em> parser, we showed how one could implement a simple <em>PEG</em> parser. That parser kept track of the current location in the text using an index. Can you modify the parser so that it simply uses the current substring rather than tracking the index? That is, it should no longer have the <code>at</code> parameter.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">PackratParser</span><span class="p">(</span><span class="n">Parser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">parse_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unify_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_symbol</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">text</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_prefix</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s2">&quot;at &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">unify_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">:</span>
            <span class="n">text</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unify_key</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">text</span><span class="p">,</span> <span class="kc">None</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span><span class="p">,</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">unify_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">text</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">):],</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">text</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
            <span class="n">text_</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unify_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">text_</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">res</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">text</span><span class="p">,</span> <span class="kc">None</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mystring</span> <span class="o">=</span> <span class="s2">&quot;1+(2*3)&quot;</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">PackratParser</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">),</span> <span class="n">START_SYMBOL</span><span class="p">)</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">mystring</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">==</span> <span class="n">mystring</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="192pt" height="584pt"
 viewBox="0.00 0.00 192.00 584.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 580)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-580 188,-580 188,4 -4,4"/>
<!-- 0 -->
<g id="node1" class="node">
<title>0</title>
<text text-anchor="middle" x="70.5" y="-564.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;start&gt;</text>
</g>
<!-- 1 -->
<g id="node2" class="node">
<title>1</title>
<text text-anchor="middle" x="70.5" y="-513.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 0&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>0&#45;&gt;1</title>
<path fill="none" stroke="#000000" d="M70.5,-560.9748C70.5,-554.195 70.5,-543.966 70.5,-535.1331"/>
<polygon fill="#000000" stroke="#000000" points="74.0001,-535.0561 70.5,-525.0561 67.0001,-535.0561 74.0001,-535.0561"/>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<text text-anchor="middle" x="27.5" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1&#45;&gt;2</title>
<path fill="none" stroke="#000000" d="M64.1552,-509.9748C57.9308,-502.5923 48.2583,-491.1203 40.4119,-481.8142"/>
<polygon fill="#000000" stroke="#000000" points="42.9927,-479.4452 33.8708,-474.0561 37.641,-483.9574 42.9927,-479.4452"/>
</g>
<!-- 7 -->
<g id="node8" class="node">
<title>7</title>
<text text-anchor="middle" x="70.5" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#000000">+</text>
</g>
<!-- 1&#45;&gt;7 -->
<g id="edge7" class="edge">
<title>1&#45;&gt;7</title>
<path fill="none" stroke="#000000" d="M70.5,-509.9748C70.5,-503.195 70.5,-492.966 70.5,-484.1331"/>
<polygon fill="#000000" stroke="#000000" points="74.0001,-484.0561 70.5,-474.0561 67.0001,-484.0561 74.0001,-484.0561"/>
</g>
<!-- 8 -->
<g id="node9" class="node">
<title>8</title>
<text text-anchor="middle" x="113.5" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 1&#45;&gt;8 -->
<g id="edge8" class="edge">
<title>1&#45;&gt;8</title>
<path fill="none" stroke="#000000" d="M76.8448,-509.9748C83.0692,-502.5923 92.7417,-491.1203 100.5881,-481.8142"/>
<polygon fill="#000000" stroke="#000000" points="103.359,-483.9574 107.1292,-474.0561 98.0073,-479.4452 103.359,-483.9574"/>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<text text-anchor="middle" x="27.5" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2&#45;&gt;3</title>
<path fill="none" stroke="#000000" d="M27.5,-458.9748C27.5,-452.195 27.5,-441.966 27.5,-433.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-433.0561 27.5,-423.0561 24.0001,-433.0561 31.0001,-433.0561"/>
</g>
<!-- 4 -->
<g id="node5" class="node">
<title>4</title>
<text text-anchor="middle" x="27.5" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 3&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>3&#45;&gt;4</title>
<path fill="none" stroke="#000000" d="M27.5,-407.9748C27.5,-401.195 27.5,-390.966 27.5,-382.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-382.0561 27.5,-372.0561 24.0001,-382.0561 31.0001,-382.0561"/>
</g>
<!-- 5 -->
<g id="node6" class="node">
<title>5</title>
<text text-anchor="middle" x="27.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 4&#45;&gt;5 -->
<g id="edge5" class="edge">
<title>4&#45;&gt;5</title>
<path fill="none" stroke="#000000" d="M27.5,-356.9748C27.5,-350.195 27.5,-339.966 27.5,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-331.0561 27.5,-321.0561 24.0001,-331.0561 31.0001,-331.0561"/>
</g>
<!-- 6 -->
<g id="node7" class="node">
<title>6</title>
<text text-anchor="middle" x="27.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">1</text>
</g>
<!-- 5&#45;&gt;6 -->
<g id="edge6" class="edge">
<title>5&#45;&gt;6</title>
<path fill="none" stroke="#000000" d="M27.5,-305.9748C27.5,-299.195 27.5,-288.966 27.5,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="31.0001,-280.0561 27.5,-270.0561 24.0001,-280.0561 31.0001,-280.0561"/>
</g>
<!-- 9 -->
<g id="node10" class="node">
<title>9</title>
<text text-anchor="middle" x="113.5" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 8&#45;&gt;9 -->
<g id="edge9" class="edge">
<title>8&#45;&gt;9</title>
<path fill="none" stroke="#000000" d="M113.5,-458.9748C113.5,-452.195 113.5,-441.966 113.5,-433.1331"/>
<polygon fill="#000000" stroke="#000000" points="117.0001,-433.0561 113.5,-423.0561 110.0001,-433.0561 117.0001,-433.0561"/>
</g>
<!-- 10 -->
<g id="node11" class="node">
<title>10</title>
<text text-anchor="middle" x="113.5" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 9&#45;&gt;10 -->
<g id="edge10" class="edge">
<title>9&#45;&gt;10</title>
<path fill="none" stroke="#000000" d="M113.5,-407.9748C113.5,-401.195 113.5,-390.966 113.5,-382.1331"/>
<polygon fill="#000000" stroke="#000000" points="117.0001,-382.0561 113.5,-372.0561 110.0001,-382.0561 117.0001,-382.0561"/>
</g>
<!-- 11 -->
<g id="node12" class="node">
<title>11</title>
<text text-anchor="middle" x="72.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">(</text>
</g>
<!-- 10&#45;&gt;11 -->
<g id="edge11" class="edge">
<title>10&#45;&gt;11</title>
<path fill="none" stroke="#000000" d="M107.4503,-356.9748C100.6341,-348.4961 89.4814,-334.6232 81.6104,-324.8324"/>
<polygon fill="#000000" stroke="#000000" points="84.1088,-322.3541 75.1154,-316.7533 78.6531,-326.74 84.1088,-322.3541"/>
</g>
<!-- 12 -->
<g id="node13" class="node">
<title>12</title>
<text text-anchor="middle" x="113.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;expr&gt;</text>
</g>
<!-- 10&#45;&gt;12 -->
<g id="edge12" class="edge">
<title>10&#45;&gt;12</title>
<path fill="none" stroke="#000000" d="M113.5,-356.9748C113.5,-350.195 113.5,-339.966 113.5,-331.1331"/>
<polygon fill="#000000" stroke="#000000" points="117.0001,-331.0561 113.5,-321.0561 110.0001,-331.0561 117.0001,-331.0561"/>
</g>
<!-- 24 -->
<g id="node25" class="node">
<title>24</title>
<text text-anchor="middle" x="154.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#000000">)</text>
</g>
<!-- 10&#45;&gt;24 -->
<g id="edge24" class="edge">
<title>10&#45;&gt;24</title>
<path fill="none" stroke="#000000" d="M119.5497,-356.9748C126.3659,-348.4961 137.5186,-334.6232 145.3896,-324.8324"/>
<polygon fill="#000000" stroke="#000000" points="148.3469,-326.74 151.8846,-316.7533 142.8912,-322.3541 148.3469,-326.74"/>
</g>
<!-- 13 -->
<g id="node14" class="node">
<title>13</title>
<text text-anchor="middle" x="113.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 12&#45;&gt;13 -->
<g id="edge13" class="edge">
<title>12&#45;&gt;13</title>
<path fill="none" stroke="#000000" d="M113.5,-305.9748C113.5,-299.195 113.5,-288.966 113.5,-280.1331"/>
<polygon fill="#000000" stroke="#000000" points="117.0001,-280.0561 113.5,-270.0561 110.0001,-280.0561 117.0001,-280.0561"/>
</g>
<!-- 14 -->
<g id="node15" class="node">
<title>14</title>
<text text-anchor="middle" x="66.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 13&#45;&gt;14 -->
<g id="edge14" class="edge">
<title>13&#45;&gt;14</title>
<path fill="none" stroke="#000000" d="M106.565,-254.9748C99.6921,-247.517 88.9731,-235.8857 80.3512,-226.53"/>
<polygon fill="#000000" stroke="#000000" points="82.8141,-224.0378 73.4635,-219.0561 77.6666,-228.7816 82.8141,-224.0378"/>
</g>
<!-- 18 -->
<g id="node19" class="node">
<title>18</title>
<text text-anchor="middle" x="113.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">*</text>
</g>
<!-- 13&#45;&gt;18 -->
<g id="edge18" class="edge">
<title>13&#45;&gt;18</title>
<path fill="none" stroke="#000000" d="M113.5,-254.9748C113.5,-248.195 113.5,-237.966 113.5,-229.1331"/>
<polygon fill="#000000" stroke="#000000" points="117.0001,-229.0561 113.5,-219.0561 110.0001,-229.0561 117.0001,-229.0561"/>
</g>
<!-- 19 -->
<g id="node20" class="node">
<title>19</title>
<text text-anchor="middle" x="156.5" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;term&gt;</text>
</g>
<!-- 13&#45;&gt;19 -->
<g id="edge19" class="edge">
<title>13&#45;&gt;19</title>
<path fill="none" stroke="#000000" d="M119.8448,-254.9748C126.0692,-247.5923 135.7417,-236.1203 143.5881,-226.8142"/>
<polygon fill="#000000" stroke="#000000" points="146.359,-228.9574 150.1292,-219.0561 141.0073,-224.4452 146.359,-228.9574"/>
</g>
<!-- 15 -->
<g id="node16" class="node">
<title>15</title>
<text text-anchor="middle" x="66.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 14&#45;&gt;15 -->
<g id="edge15" class="edge">
<title>14&#45;&gt;15</title>
<path fill="none" stroke="#000000" d="M66.5,-203.9748C66.5,-197.195 66.5,-186.966 66.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="70.0001,-178.0561 66.5,-168.0561 63.0001,-178.0561 70.0001,-178.0561"/>
</g>
<!-- 16 -->
<g id="node17" class="node">
<title>16</title>
<text text-anchor="middle" x="66.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 15&#45;&gt;16 -->
<g id="edge16" class="edge">
<title>15&#45;&gt;16</title>
<path fill="none" stroke="#000000" d="M66.5,-152.9748C66.5,-146.195 66.5,-135.966 66.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="70.0001,-127.0561 66.5,-117.0561 63.0001,-127.0561 70.0001,-127.0561"/>
</g>
<!-- 17 -->
<g id="node18" class="node">
<title>17</title>
<text text-anchor="middle" x="66.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">2</text>
</g>
<!-- 16&#45;&gt;17 -->
<g id="edge17" class="edge">
<title>16&#45;&gt;17</title>
<path fill="none" stroke="#000000" d="M66.5,-101.9748C66.5,-95.195 66.5,-84.966 66.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="70.0001,-76.0561 66.5,-66.0561 63.0001,-76.0561 70.0001,-76.0561"/>
</g>
<!-- 20 -->
<g id="node21" class="node">
<title>20</title>
<text text-anchor="middle" x="156.5" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;factor&gt;</text>
</g>
<!-- 19&#45;&gt;20 -->
<g id="edge20" class="edge">
<title>19&#45;&gt;20</title>
<path fill="none" stroke="#000000" d="M156.5,-203.9748C156.5,-197.195 156.5,-186.966 156.5,-178.1331"/>
<polygon fill="#000000" stroke="#000000" points="160.0001,-178.0561 156.5,-168.0561 153.0001,-178.0561 160.0001,-178.0561"/>
</g>
<!-- 21 -->
<g id="node22" class="node">
<title>21</title>
<text text-anchor="middle" x="156.5" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;integer&gt;</text>
</g>
<!-- 20&#45;&gt;21 -->
<g id="edge21" class="edge">
<title>20&#45;&gt;21</title>
<path fill="none" stroke="#000000" d="M156.5,-152.9748C156.5,-146.195 156.5,-135.966 156.5,-127.1331"/>
<polygon fill="#000000" stroke="#000000" points="160.0001,-127.0561 156.5,-117.0561 153.0001,-127.0561 160.0001,-127.0561"/>
</g>
<!-- 22 -->
<g id="node23" class="node">
<title>22</title>
<text text-anchor="middle" x="156.5" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#000000">&lt;digit&gt;</text>
</g>
<!-- 21&#45;&gt;22 -->
<g id="edge22" class="edge">
<title>21&#45;&gt;22</title>
<path fill="none" stroke="#000000" d="M156.5,-101.9748C156.5,-95.195 156.5,-84.966 156.5,-76.1331"/>
<polygon fill="#000000" stroke="#000000" points="160.0001,-76.0561 156.5,-66.0561 153.0001,-76.0561 160.0001,-76.0561"/>
</g>
<!-- 23 -->
<g id="node24" class="node">
<title>23</title>
<text text-anchor="middle" x="156.5" y="-3.8" font-family="Times,serif" font-size="14.00" fill="#000000">3</text>
</g>
<!-- 22&#45;&gt;23 -->
<g id="edge23" class="edge">
<title>22&#45;&gt;23</title>
<path fill="none" stroke="#000000" d="M156.5,-50.9748C156.5,-44.195 156.5,-33.966 156.5,-25.1331"/>
<polygon fill="#000000" stroke="#000000" points="160.0001,-25.0561 156.5,-15.0561 153.0001,-25.0561 160.0001,-25.0561"/>
</g>
</g>
</svg>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2-More-PEG-Syntax">Exercise 2 <em>More PEG Syntax</em><a class="anchor-link" href="#Exercise-2-More-PEG-Syntax">&#182;</a></h3><p>The <em>PEG</em> syntax provides a few notational conveniences reminiscent of regular expressions. For example, it supports the following operators (letters <code>T</code> and <code>A</code> represents tokens that can be either terminal or non-terminal. <code>ε</code> is an empty string, and <code>/</code> is the ordered choice operator similar to the non-ordered choice operator <code>|</code>):</p>
<ul>
<li><code>T?</code> represents an optional greedy match of T and <code>A := T?</code> is equivalent to <code>A := T/ε</code>.</li>
<li><code>T*</code> represents zero or more greedy matches of <code>T</code> and <code>A := T*</code> is equivalent to <code>A := T A/ε</code>.</li>
<li><code>T+</code> represents one or more greedy matches -- equivalent to <code>TT*</code></li>
</ul>
<p>If you look at the three notations above, each can be represented in the grammar in terms of basic syntax.
Remember the exercise from <a href="Grammars.html">the chapter on grammars</a> that developed <code>define_ex_grammar</code> that can represent grammars as Python code? extend <code>define_ex_grammar</code> to <code>define_peg</code> to support the above notational conveniences. The decorator should rewrite a given grammar that contain these notations to an equivalent grammar in basic syntax.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-3-PEG-Predicates">Exercise 3 <em>PEG Predicates</em><a class="anchor-link" href="#Exercise-3-PEG-Predicates">&#182;</a></h3><p>Beyond these notational conveniences, it also supports two predicates that can provide a powerful lookahead facility that does not consume any input.</p>
<ul>
<li><code>T&amp;A</code> represents an <em>And-predicate</em> that matches <code>T</code> if <code>T</code> is matched, and it is immediately followed by <code>A</code></li>
<li><code>T!A</code> represents a <em>Not-predicate</em> that matches <code>T</code> if <code>T</code> is matched, and it is <em>not</em> immediately followed by <code>A</code></li>
</ul>
<p>Implement these predicates in our <em>PEG</em> parser.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-4-Earley-Fill-Chart">Exercise 4 <em>Earley Fill Chart</em><a class="anchor-link" href="#Exercise-4-Earley-Fill-Chart">&#182;</a></h3><p>In the <code>Earley Parser</code>, <code>Column</code> class, we keep the states both as a <code>list</code> and also as a <code>dict</code> even though <code>dict</code> is ordered. Can you explain why?</p>
<p><strong>Hint</strong>: see the <code>fill_chart</code> method.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-5-Leo-Parser">Exercise 5 <em>Leo Parser</em><a class="anchor-link" href="#Exercise-5-Leo-Parser">&#182;</a></h3><p>One of the problems with the original Earley parser is that while it can parse strings using arbitrary <em>Context Free Gramamrs</em>, its performance on right-recursive grammars is quadratic. That is, it takes $O(n^2)$ runtime and space for parsing with right-recursive grammars. For example, consider these grammars:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">LR_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;&lt;start&gt;&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;&lt;A&gt;&#39;</span><span class="p">],</span>
    <span class="s1">&#39;&lt;A&gt;&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;&lt;A&gt;a&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">RR_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;&lt;start&gt;&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;&lt;A&gt;&#39;</span><span class="p">],</span>
    <span class="s1">&#39;&lt;A&gt;&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&lt;A&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We enable logging to see the parse progress</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Column</span><span class="p">(</span><span class="n">Column</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> chart[</span><span class="si">%d</span><span class="s2">]</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">letter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">finished</span><span class="p">()))</span>

<span class="k">class</span> <span class="nc">State</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;:= &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">dot</span><span class="p">],</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dot</span><span class="p">:]]</span>
        <span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;(</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s_col</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e_col</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">LoggingParser</span><span class="p">(</span><span class="n">EarleyParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">fill_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart</span><span class="p">):</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">nullable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chart</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">finished</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">complete</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sym</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">at_dot</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">sym</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">epsilon</span><span class="p">:</span>
                            <span class="n">col</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">advance</span><span class="p">())</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chart</span><span class="p">):</span>
                            <span class="k">continue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">chart</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">state</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chart</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">LoggingParser</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">LR_GRAMMAR</span><span class="p">))</span><span class="o">.</span><span class="n">parse_prefix</span><span class="p">(</span><span class="s1">&#39;aaaaaa&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>None chart[0]
&lt;A&gt;:= |(0,0)
&lt;start&gt;:= &lt;A&gt; |(0,0) 

a chart[1]
&lt;A&gt;:= &lt;A&gt; a |(0,1)
&lt;start&gt;:= &lt;A&gt; |(0,1) 

a chart[2]
&lt;A&gt;:= &lt;A&gt; a |(0,2)
&lt;start&gt;:= &lt;A&gt; |(0,2) 

a chart[3]
&lt;A&gt;:= &lt;A&gt; a |(0,3)
&lt;start&gt;:= &lt;A&gt; |(0,3) 

a chart[4]
&lt;A&gt;:= &lt;A&gt; a |(0,4)
&lt;start&gt;:= &lt;A&gt; |(0,4) 

a chart[5]
&lt;A&gt;:= &lt;A&gt; a |(0,5)
&lt;start&gt;:= &lt;A&gt; |(0,5) 

a chart[6]
&lt;A&gt;:= &lt;A&gt; a |(0,6)
&lt;start&gt;:= &lt;A&gt; |(0,6) 
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">LoggingParser</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">RR_GRAMMAR</span><span class="p">))</span><span class="o">.</span><span class="n">parse_prefix</span><span class="p">(</span><span class="s1">&#39;aaaaaa&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>None chart[0]
&lt;A&gt;:= |(0,0)
&lt;start&gt;:= &lt;A&gt; |(0,0) 

a chart[1]
&lt;A&gt;:= |(1,1)
&lt;A&gt;:= a &lt;A&gt; |(0,1)
&lt;start&gt;:= &lt;A&gt; |(0,1) 

a chart[2]
&lt;A&gt;:= |(2,2)
&lt;A&gt;:= a &lt;A&gt; |(1,2)
&lt;A&gt;:= a &lt;A&gt; |(0,2)
&lt;start&gt;:= &lt;A&gt; |(0,2) 

a chart[3]
&lt;A&gt;:= |(3,3)
&lt;A&gt;:= a &lt;A&gt; |(2,3)
&lt;A&gt;:= a &lt;A&gt; |(1,3)
&lt;A&gt;:= a &lt;A&gt; |(0,3)
&lt;start&gt;:= &lt;A&gt; |(0,3) 

a chart[4]
&lt;A&gt;:= |(4,4)
&lt;A&gt;:= a &lt;A&gt; |(3,4)
&lt;A&gt;:= a &lt;A&gt; |(2,4)
&lt;A&gt;:= a &lt;A&gt; |(1,4)
&lt;A&gt;:= a &lt;A&gt; |(0,4)
&lt;start&gt;:= &lt;A&gt; |(0,4) 

a chart[5]
&lt;A&gt;:= |(5,5)
&lt;A&gt;:= a &lt;A&gt; |(4,5)
&lt;A&gt;:= a &lt;A&gt; |(3,5)
&lt;A&gt;:= a &lt;A&gt; |(2,5)
&lt;A&gt;:= a &lt;A&gt; |(1,5)
&lt;A&gt;:= a &lt;A&gt; |(0,5)
&lt;start&gt;:= &lt;A&gt; |(0,5) 

a chart[6]
&lt;A&gt;:= |(6,6)
&lt;A&gt;:= a &lt;A&gt; |(5,6)
&lt;A&gt;:= a &lt;A&gt; |(4,6)
&lt;A&gt;:= a &lt;A&gt; |(3,6)
&lt;A&gt;:= a &lt;A&gt; |(2,6)
&lt;A&gt;:= a &lt;A&gt; |(1,6)
&lt;A&gt;:= a &lt;A&gt; |(0,6)
&lt;start&gt;:= &lt;A&gt; |(0,6) 
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>As can be seen from the parsing log for each letter, the number of states with representation <code>&lt;A&gt;:= a &lt;A&gt; | (i, j)</code> increases at each stage, and these are simply a left over from the previous letter. They do not contribute anything more to the parse other than to simply complete these entries. However, they take up space, and require resources for inspection, contributing a factor of <code>n</code> in analysis.</p>
<p>Joop Leo~[<a href="https://doi.org/https://doi.org/10.1016/0304-3975(91)90180-A">Joop M.I.M. Leo, 1991.</a>] found that this inefficiency can be avoided by detecting right recursion. The idea is that before starting the <code>completion</code> step, check whether the current item has a <em>deterministic reduction path</em>. If such a path exists, add a copy of the topmost element of the <em>deteministic reduction path</em> to the current column, and return. If not, perform the original <code>completion</code> step.</p>
<p>Finding a <em>deterministic reduction path</em> is as follows:</p>
<p>Given a complete state, represented by <code>&lt;A&gt; := ... | (i)</code> where <code>(i)</code> is the starting column, there is a <em>deterministic reduction path</em> above it if two criteria are satisfied.</p>
<ul>
<li>There exist an item <code>&lt;B&gt; := ... &lt;A&gt; | (k)</code> in the current column.</li>
<li>It should have a <em>single</em> predecessor of the form <code>&lt;B&gt; := ... | &lt;A&gt; (k)</code> in the current column.
Following this chain (looking for the link above <code>&lt;B&gt; := ... &lt;A&gt; | (k)</code>), the topmost item is the item that does not have a parent.</li>
</ul>
<p>See <a href="http://loup-vaillant.fr/tutorials/earley-parsing/right-recursion">Loup Vaillant</a> for further information.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">State</span><span class="p">(</span><span class="n">State</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">dot</span><span class="p">,</span> <span class="n">s_col</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">dot</span><span class="p">,</span> <span class="n">s_col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">State</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_col</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">LeoParser</span><span class="p">(</span><span class="n">LoggingParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">leo_complete</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">leo_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">detred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deterministic_reduction</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">detred</span><span class="p">:</span>
            <span class="n">col</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">detred</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">earley_complete</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Can you implement the <code>deterministic_reduction</code> method to obtain the top most element?</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Advanced:</strong> We have fixed the complexity bounds. However, because we are saving only the top most item of a right recursion, we need to fix our <code>parse_forest</code> and <code>extract_a_tree</code> to be aware of our fix. Can you fix both?</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-6-First-set-of-a-non-terminal">Exercise 6 <em>First set of a non-terminal</em><a class="anchor-link" href="#Exercise-6-First-set-of-a-non-terminal">&#182;</a></h3><p>We previously gave a way to extract a the <code>nullable</code> (epsilon) set, which is often used for parsing.
Along with <code>nullable</code>, parsing algorithms often use two other sets <a href="https://en.wikipedia.org/wiki/Canonical_LR_parser#FIRST_and_FOLLOW_sets"><code>first</code> and <code>follow</code></a>.
The first set of a terminal symbol is itself, and the first set of a non-terminal is composed of terminal symbols that can come at the beginning of any derivation
of that non-terminal. The first set of any non-terminal that can derive the empty string should contain <code>EPSILON</code>. For example, using our <code>A1_GRAMMAR</code>, the first set of both <code>&lt;expr&gt;</code> and <code>&lt;start&gt;</code> is <code>{0,1,2,3,4,5,6,7,8,9}</code>. The extraction first set for any self-recursive non-terminal is simple enough. One simply has to recursively compute the first set of the first element of its choice expressions. The computation of <code>first</code> set for a self-recursive non-terminal is tricky. One has to recursively compute the first set until one is sure that no more terminals can be added to the first set.</p>
<p>Can you implement the <code>first</code> set using our <code>fixpoint</code>?</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-7-Follow-set-of-a-non-terminal">Exercise 7 <em>Follow set of a non-terminal</em><a class="anchor-link" href="#Exercise-7-Follow-set-of-a-non-terminal">&#182;</a></h3><p>The follow set definition is similar to the first set. The follow set of a non-terminal is the set of terminals that can occur just after that non-terminal is used in any derivation. The follow set of the start symbol is <code>EOF</code>, and the follow set of any non-terminal is the super set of first sets of all symbols that come after it in any choice expression.</p>
<p>For example, the follow set of <code>&lt;expr&gt;</code> in <code>A1_GRAMMAR</code> is the set <code>{EOF, +, -}</code>.</p>
<p>As in the previous exercise, implement the <code>followset</code> using <code>fixpoint</code>.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-8-LL(1)-parse-table">Exercise 8 <em>LL(1) parse table</em><a class="anchor-link" href="#Exercise-8-LL(1)-parse-table">&#182;</a></h3><p>As we mentioned previously, there exist other kinds of parsers that operate left-to-right with right most derivation (<em>LR(k)</em>) or left-to-right with left most derivation (<em>LL(k)</em>) with <em>k</em> signifying the amount of lookahead the parser is permitted to use.</p>
<p>What should one do with the lookahead? That lookahead can be used to determine which rule to apply. In the case of an <em>LL(1)</em> parser, the rule to apply is determined by looking at the <em>first</em> set of the different rules. We previously implemented <code>first_expr</code> that takes a an expression, the set of  <code>nullables</code>, and computes the first set of that rule.</p>
<p>If a rule can derive an empty set, then that rule may also be applicable if of sees the <code>follow</code> set of the corresponding non-terminal.</p>
<p>Can you implement the parse table that describes what action to take for an <em>LL(1)</em> parser on seeing a terminal symbol on lookahead? The table should be in the form of a dictionary such that the keys represent the non-terminal symbol, and the value should contain another dict with keys as terminal symbols and the particular rule to continue parsing as the value.</p>
<p>The <code>parse_table</code> method populate a <code>self.table</code> data structure that should conform to the following requirements:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">LL1Parser</span><span class="p">(</span><span class="n">Parser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">parse_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_rules</span> <span class="o">=</span> <span class="n">rules</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">)</span>
        <span class="c1"># .. fill in here to produce</span>
        <span class="c1"># self.table = ...</span>

    <span class="k">def</span> <span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">my_rules</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">terminals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rule Name</span><span class="se">\t</span><span class="s1">| </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">:</span>
            <span class="n">pr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">actions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pr</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">pr</span> <span class="k">else</span> <span class="s1">&#39; &#39;</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">  </span><span class="se">\t</span><span class="s1">| </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">actions</span><span class="p">)))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>On invocation of <code>LL1Parser(grammar).show_table()</code>
It should result in the following table:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rules</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">A2_GRAMMAR</span><span class="p">))):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\t</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> := </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0	 &lt;start&gt; := [&#39;&lt;expr&gt;&#39;]
1	 &lt;expr&gt; := [&#39;&lt;integer&gt;&#39;, &#39;&lt;expr_&gt;&#39;]
2	 &lt;expr_&gt; := [&#39;+&#39;, &#39;&lt;expr&gt;&#39;]
3	 &lt;expr_&gt; := [&#39;-&#39;, &#39;&lt;expr&gt;&#39;]
4	 &lt;expr_&gt; := []
5	 &lt;integer&gt; := [&#39;&lt;digit&gt;&#39;, &#39;&lt;integer_&gt;&#39;]
6	 &lt;integer_&gt; := [&#39;&lt;integer&gt;&#39;]
7	 &lt;integer_&gt; := []
8	 &lt;digit&gt; := [&#39;0&#39;]
9	 &lt;digit&gt; := [&#39;1&#39;]
10	 &lt;digit&gt; := [&#39;2&#39;]
11	 &lt;digit&gt; := [&#39;3&#39;]
12	 &lt;digit&gt; := [&#39;4&#39;]
13	 &lt;digit&gt; := [&#39;5&#39;]
14	 &lt;digit&gt; := [&#39;6&#39;]
15	 &lt;digit&gt; := [&#39;7&#39;]
16	 &lt;digit&gt; := [&#39;8&#39;]
17	 &lt;digit&gt; := [&#39;9&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><table>
<thead><tr>
<th>Rule Name</th>
<th></th>
<th>+</th>
<th>-</th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr>
<td>start</td>
<td></td>
<td></td>
<td></td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>expr</td>
<td></td>
<td></td>
<td></td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>expr_</td>
<td></td>
<td>2</td>
<td>3</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>integer</td>
<td></td>
<td></td>
<td></td>
<td>5</td>
<td>5</td>
<td>5</td>
<td>5</td>
<td>5</td>
<td>5</td>
<td>5</td>
<td>5</td>
<td>5</td>
<td>5</td>
</tr>
<tr>
<td>integer_</td>
<td></td>
<td>7</td>
<td>7</td>
<td>6</td>
<td>6</td>
<td>6</td>
<td>6</td>
<td>6</td>
<td>6</td>
<td>6</td>
<td>6</td>
<td>6</td>
<td>6</td>
</tr>
<tr>
<td>digit</td>
<td></td>
<td></td>
<td></td>
<td>8</td>
<td>9</td>
<td>10</td>
<td>11</td>
<td>12</td>
<td>13</td>
<td>14</td>
<td>15</td>
<td>16</td>
<td>17</td>
</tr>
</tbody>
</table>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-9-LL(1)-parser">Exercise 9 <em>LL(1) parser</em><a class="anchor-link" href="#Exercise-9-LL(1)-parser">&#182;</a></h3><p>Once we have the parse table, implementing the parser is as follows: Consider the first item from the sequence of tokens to parse, and seed the stack with the start symbol.</p>
<p>While the stack is not empty, extract the first symbol from the stack, and if the symbol is a terminal, verify that the symbol matches the item from the input stream. If the symbol is a non-terminal, use the symbol and input item to lookup the next rule from the parse table. Insert the rule thus found to the top of the stack. Keep track of the expressions being parsed to build up the parse table.</p>
<p>Use the parse table defined previously to implement the complete LL(1) parser.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Probabilistic-Grammar-Fuzzing">Probabilistic Grammar Fuzzing<a class="anchor-link" href="#Probabilistic-Grammar-Fuzzing">&#182;</a></h1><p>Let us give grammars even more power by assigning probabilities to individual expansions.  This allows us to control how many of each element should be produced.  \todo{Work in progress.}</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>You should have read the <a href="Grammars.html">chapter on grammars</a>.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="GrammarFuzzer.html" class="import" target="_blank">GrammarFuzzer</a></span> <span class="k">import</span> <span class="n">GrammarFuzzer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="k">import</span> <span class="n">is_valid_grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We introduce a little helper function that will allow us to add arbitrary options to an expansion.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">opts</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">kwargs</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">PROBABILISTIC_EXPR_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">:</span>
        <span class="p">[(</span><span class="s2">&quot;&lt;term&gt; + &lt;expr&gt;&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)),</span>
         <span class="p">(</span><span class="s2">&quot;&lt;term&gt; - &lt;expr&gt;&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)),</span>
         <span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">:</span>
        <span class="p">[(</span><span class="s2">&quot;&lt;factor&gt; * &lt;term&gt;&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)),</span>
         <span class="p">(</span><span class="s2">&quot;&lt;factor&gt; / &lt;term&gt;&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)),</span>
         <span class="s2">&quot;&lt;factor&gt;&quot;</span>
         <span class="p">],</span>

    <span class="s2">&quot;&lt;factor&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;+&lt;factor&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&lt;factor&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;(&lt;expr&gt;)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&lt;leadinteger&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;leadinteger&gt;.&lt;integer&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;leadinteger&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;leaddigit&gt;&lt;integer&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;leaddigit&gt;&quot;</span><span class="p">],</span>

    <span class="c1"># Benford&#39;s law: frequency distribution of leading digits</span>
    <span class="s2">&quot;&lt;leaddigit&gt;&quot;</span><span class="p">:</span>
        <span class="p">[(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.301</span><span class="p">)),</span>
         <span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.176</span><span class="p">)),</span>
         <span class="p">(</span><span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.125</span><span class="p">)),</span>
         <span class="p">(</span><span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.097</span><span class="p">)),</span>
         <span class="p">(</span><span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.079</span><span class="p">)),</span>
         <span class="p">(</span><span class="s2">&quot;6&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.067</span><span class="p">)),</span>
         <span class="p">(</span><span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.058</span><span class="p">)),</span>
         <span class="p">(</span><span class="s2">&quot;8&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.051</span><span class="p">)),</span>
         <span class="p">(</span><span class="s2">&quot;9&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.046</span><span class="p">)),</span>
         <span class="p">],</span>

    <span class="c1"># Remaining digits are equally distributed</span>
    <span class="s2">&quot;&lt;integer&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;&lt;digit&gt;&lt;integer&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">],</span>

    <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span> <span class="s2">&quot;9&quot;</span><span class="p">],</span>
<span class="p">}</span>

<span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">PROBABILISTIC_EXPR_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">PROBABILISTIC_EXPR_GRAMMAR</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;4 + ++--7.0 - -7 - +++7.3 * (1 * 3 + 5 / 3 / 5 + 2) * 38 * (2 + 8)&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Section-4"><em>Section 4</em><a class="anchor-link" href="#Section-4">&#182;</a></h2><p>\todo{Add}</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned<a class="anchor-link" href="#Lessons-Learned">&#182;</a></h2><ul>
<li><em>Lesson one</em></li>
<li><em>Lesson two</em></li>
<li><em>Lesson three</em></li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps<a class="anchor-link" href="#Next-Steps">&#182;</a></h2><p><em>Link to subsequent chapters (notebooks) here, as in:</em></p>
<ul>
<li><a href="MutationFuzzer.html">use <em>mutations</em> on existing inputs to get more valid inputs</a></li>
<li><a href="Grammars.html">use <em>grammars</em> (i.e., a specification of the input format) to get even more valid inputs</a></li>
<li><a href="Reducer.html">reduce <em>failing inputs</em> for efficient debugging</a></li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises<a class="anchor-link" href="#Exercises">&#182;</a></h2><p>Close the chapter with a few exercises such that people have things to do.  In Jupyter Notebook, use the <code>exercise2</code> nbextension to add solutions that can be interactively viewed or hidden:</p>
<ul>
<li>Mark the <em>last</em> cell of the exercise (this should be a <em>text</em> cell) as well as <em>all</em> cells of the solution.  (Use the <code>rubberband</code> nbextension and use Shift+Drag to mark multiple cells.)</li>
<li>Click on the <code>solution</code> button at the top.</li>
</ul>
<p>(Alternatively, just copy the exercise and solution cells below with their metadata.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1">Exercise 1<a class="anchor-link" href="#Exercise-1">&#182;</a></h3><p><em>Text of the exercise</em></p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Some code that is part of the exercise</span>
<span class="k">pass</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><em>Some more text for the exercise</em></p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2">Exercise 2<a class="anchor-link" href="#Exercise-2">&#182;</a></h3><p><em>Text of the exercise</em></p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Reducing-Failure-Inducing-Inputs">Reducing Failure-Inducing Inputs<a class="anchor-link" href="#Reducing-Failure-Inducing-Inputs">&#182;</a></h1><p>By construction, fuzzers create inputs that may be hard to read.  This causes issues during <em>debugging</em>, when a human has to analyze the exact cause of the failure.  In this chapter, we present techniques that <em>automatically reduce and simplify failure-inducing inputs to a minimum</em> in order to ease debugging.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>As reduction is typically used together with fuzzing, reading the <a href="Fuzzer.html">chapter on basic fuzzing</a> is a good idea.</li>
<li>The simple "delta debugging" technique for reduction has no specific prerequisites.</li>
<li>The later grammar-based techniques require knowledge on <a href="GrammarFuzzer.html">derivation trees</a> and <a href="Parser.html">parsing</a>.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Why-Reducing?">Why Reducing?<a class="anchor-link" href="#Why-Reducing?">&#182;</a></h2><p>At this point, we have seen a number of test generation techniques that all in some form produce input in order to trigger failures.  If they are successful – that is, the program actually fails – we must find out why the failure occurred and how to fix it.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's an example of such a situation.  We have a class <code>MysteryRunner</code> class with a <code>run()</code> method that – given its code – can occasionally fail.  But under which circumstances does this actually happen?  We have deliberately obscured the exact condition in order to make this non-obvious.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Fuzzer.html" class="import" target="_blank">Fuzzer</a></span> <span class="k">import</span> <span class="n">RandomFuzzer</span><span class="p">,</span> <span class="n">Runner</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">MysteryRunner</span><span class="p">(</span><span class="n">Runner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mo">0o17</span> <span class="o">+</span> <span class="mo">0o31</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mo">0o27</span> <span class="o">+</span> <span class="mo">0o22</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">Runner</span><span class="o">.</span><span class="n">FAIL</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">Runner</span><span class="o">.</span><span class="n">PASS</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us fuzz the function until we find a failing input.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mystery</span> <span class="o">=</span> <span class="n">MysteryRunner</span><span class="p">()</span>
<span class="n">random_fuzzer</span> <span class="o">=</span> <span class="n">RandomFuzzer</span><span class="p">()</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">inp</span> <span class="o">=</span> <span class="n">random_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
    <span class="n">result</span><span class="p">,</span> <span class="n">outcome</span> <span class="o">=</span> <span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">outcome</span> <span class="o">==</span> <span class="n">mystery</span><span class="o">.</span><span class="n">FAIL</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">failing_input</span> <span class="o">=</span> <span class="n">result</span>
<span class="n">failing_input</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39; 7:,&gt;((/$$-/-&gt;.;.=;(.%!:50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\&#39;:\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&#34;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Something in this input causes <code>MysteryRunner</code> to fail.  But what is it?</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Manual-Input-Reduction">Manual Input Reduction<a class="anchor-link" href="#Manual-Input-Reduction">&#182;</a></h2><p>One important step in the debugging process is <em>reduction</em> – that is, to identify those circumstances of a failure that are relevant for the failure to occur, and to <em>omit</em> (if possible) those parts that are not.  As Kernighan and Pike [Kernighan <em>et al</em>, 1999.] put it:</p>
<blockquote><p>For every circumstance of the problem, check whether it is relevant for the problem to occur.  If it is not, remove it from the problem report or the test case in question.</p>
</blockquote>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Specifically for inputs, they suggest a <em>divide and conquer</em> process:</p>
<blockquote><p>Proceed by binary search.  Throw away half the input and see if the output is still wrong; if not, go back to the previous state and discard the other half of the input.</p>
</blockquote>
<p>This is something we can easily try out.  For instance, we can see whether the error still occurs if we only feed in the first half:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">half_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>   <span class="c1"># // is integer division</span>
<span class="n">first_half</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[:</span><span class="n">half_length</span><span class="p">]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">first_half</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>(&#34; 7:,&gt;((/$$-/-&gt;.;.=;(.%!:50#7*8=$&amp;&amp;=$9!%6(4=&amp;69&#39;:&#34;, &#39;PASS&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Nope – the first half alone does not suffice.  Maybe the second half?</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">second_half</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">half_length</span><span class="p">:]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">second_half</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>(&#39;\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&#34;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39;, &#39;PASS&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This did not go so well either.  We may still proceed by cutting away <em>smaller chunks</em> – say, one character after another.  If our test is deterministic and easily repeated, it is clear that this process eventually will yield a reduced input.  But still, it is a rather inefficient process, especially for long inputs.  What we need is a <em>strategy</em> that effectively minimizes a failure-inducing input – a strategy that can be automated.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Delta-Debugging">Delta Debugging<a class="anchor-link" href="#Delta-Debugging">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>One strategy to effectively reduce failure-inducing inputs is <em>delta debugging</em> [<a href="https://doi.org/10.1109/32.988498">Zeller <em>et al</em>, 2002.</a>].  Delta Debugging implements the "binary search" strategy, as listed above, but with a twist: If neither half fails (also as above), it keeps on cutting away smaller and smaller chunks from the input, until it eliminates individual characters.  Thus, after cutting away the first half, we cut away
the first quarter, the second quarter, and so on.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us illustrate this on our example, and see what happens if we cut away the first quarter.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">quarter_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span>
<span class="n">input_without_first_quarter</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span><span class="p">:]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">input_without_first_quarter</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>(&#39;50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\&#39;:\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&#34;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39;,
 &#39;FAIL&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Ah! This has failed, and reduced our failing input by 25%.  Let's remove another quarter.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">input_without_first_and_second_quarter</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">input_without_first_and_second_quarter</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>(&#39;\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&#34;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39;, &#39;PASS&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is not too surprising, as we had that one before:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">second_half</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&#34;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39;
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">input_without_first_and_second_quarter</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&#34;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>How about removing the third quarter, then?</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">input_without_first_and_third_quarter</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span><span class="p">:</span>
                                                      <span class="n">quarter_length</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span> <span class="o">*</span> <span class="mi">3</span><span class="p">:]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">input_without_first_and_third_quarter</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>(&#34;50#7*8=$&amp;&amp;=$9!%6(4=&amp;69&#39;:&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5&#39;&#39;&gt;#&#34;, &#39;PASS&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>How about removing the third quarter, then?</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">input_without_first_and_fourth_quarter</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span><span class="p">:</span><span class="n">quarter_length</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">input_without_first_and_fourth_quarter</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>(&#39;50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\&#39;:\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&#34;;+&#39;, &#39;FAIL&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Yes!  This has succeeded.  Our input is now 50% smaller.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We have now tried to remove pieces that make up $\frac{1}{2}$ and $\frac{1}{4}$ of the original failing string.  In the next iteration, we would go and remove even smaller pieces – $\frac{1}{8}$, $\frac{1}{16}$ and so on.  We continue until we are down to $\frac{1}{97}$ – that is, individual characters.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>However, this is comething we happily let a computer do for us.  We first introduce a <code>Reducer</code> class as an abstract superclass for all kinds of reducers.  The <code>test()</code> methods runs a single test (with logging, if so wanted); the <code>reduce()</code> method will eventually reduce an input to the minimum.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Reducer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Attach reducer to the given `runner`&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runner</span> <span class="o">=</span> <span class="n">runner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tests</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tests</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test #</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">tests</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">inp</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)),</span> <span class="n">outcome</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outcome</span>

    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="c1"># Default: Don&#39;t reduce</span>
        <span class="k">return</span> <span class="n">inp</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>CachingReducer</code> variant saves test results, such that we don't have to run the same tests again and again:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">CachingReducer</span><span class="p">(</span><span class="n">Reducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">inp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">inp</span><span class="p">]</span>

        <span class="n">outcome</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">inp</span><span class="p">]</span> <span class="o">=</span> <span class="n">outcome</span>
        <span class="k">return</span> <span class="n">outcome</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here comes the <em>Delta Debugging</em> reducer.  Delta Debugging implements the strategy sketched above: It first removes larger chunks of size $\frac{1}{2}$; if this does not fail, then we proceed to chunks of size $\frac{1}{4}$, then $\frac{1}{8}$ and so on.</p>
<p>Our implementation uses almost the same Python code as Zeller in [Unresolved citation: Zeller2011.]; the only difference is that it has been adapted to work on Python 3 and our <code>Runner</code> framework.    The variable <code>n</code> (initially 2) indicates the granularity – in each step, chunks of size $\frac{1}{n}$ are cut away.  If none of the test fails (<code>some_complement_is_failing</code> is False), then <code>n</code> is doubled – until it reaches the length of the input.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">DeltaDebuggingReducer</span><span class="p">(</span><span class="n">CachingReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span> <span class="o">==</span> <span class="n">Runner</span><span class="o">.</span><span class="n">FAIL</span>

        <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>     <span class="c1"># Initial granularity</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">subset_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
            <span class="n">some_complement_is_failing</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">while</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">):</span>
                <span class="n">complement</span> <span class="o">=</span> <span class="n">inp</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)]</span> <span class="o">+</span> \
                    <span class="n">inp</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">subset_length</span><span class="p">):]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">complement</span><span class="p">)</span> <span class="o">==</span> <span class="n">Runner</span><span class="o">.</span><span class="n">FAIL</span><span class="p">:</span>
                    <span class="n">inp</span> <span class="o">=</span> <span class="n">complement</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">some_complement_is_failing</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

                <span class="n">start</span> <span class="o">+=</span> <span class="n">subset_length</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">some_complement_is_failing</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">):</span>
                    <span class="k">break</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">inp</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To see how the <code>DeltaDebuggingReducer</code> works, let us run it on our failing input.  With each step, we see how the remaining input gets smaller and smaller, until only two characters remain:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dd_reducer</span> <span class="o">=</span> <span class="n">DeltaDebuggingReducer</span><span class="p">(</span><span class="n">mystery</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dd_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test #1 &#39; 7:,&gt;((/$$-/-&gt;.;.=;(.%!:50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\&#39;:\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&#34;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39; 97 FAIL
Test #2 &#39;\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&#34;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39; 49 PASS
Test #3 &#34; 7:,&gt;((/$$-/-&gt;.;.=;(.%!:50#7*8=$&amp;&amp;=$9!%6(4=&amp;69&#39;:&#34; 48 PASS
Test #4 &#39;50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\&#39;:\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&#34;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39; 73 FAIL
Test #5 &#34;50#7*8=$&amp;&amp;=$9!%6(4=&amp;69&#39;:&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5&#39;&#39;&gt;#&#34; 49 PASS
Test #6 &#39;50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\&#39;:\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&#34;;+&#39; 48 FAIL
Test #7 &#39;\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&#34;;+&#39; 24 PASS
Test #8 &#34;50#7*8=$&amp;&amp;=$9!%6(4=&amp;69&#39;:&#34; 24 PASS
Test #9 &#39;9!%6(4=&amp;69\&#39;:\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&#34;;+&#39; 36 FAIL
Test #10 &#39;9!%6(4=&amp;69\&#39;:=!&amp;60)2/+&#34;;+&#39; 24 FAIL
Test #11 &#39;=!&amp;60)2/+&#34;;+&#39; 12 PASS
Test #12 &#34;9!%6(4=&amp;69&#39;:&#34; 12 PASS
Test #13 &#39;=&amp;69\&#39;:=!&amp;60)2/+&#34;;+&#39; 18 PASS
Test #14 &#39;9!%6(4=!&amp;60)2/+&#34;;+&#39; 18 FAIL
Test #15 &#39;9!%6(42/+&#34;;+&#39; 12 PASS
Test #16 &#39;9!%6(4=!&amp;60)&#39; 12 FAIL
Test #17 &#39;=!&amp;60)&#39; 6 PASS
Test #18 &#39;9!%6(4&#39; 6 PASS
Test #19 &#39;6(4=!&amp;60)&#39; 9 FAIL
Test #20 &#39;6(460)&#39; 6 FAIL
Test #21 &#39;60)&#39; 3 PASS
Test #22 &#39;6(4&#39; 3 PASS
Test #23 &#39;(460)&#39; 5 FAIL
Test #24 &#39;460)&#39; 4 PASS
Test #25 &#39;(0)&#39; 3 FAIL
Test #26 &#39;0)&#39; 2 PASS
Test #27 &#39;(&#39; 1 PASS
Test #28 &#39;()&#39; 2 FAIL
Test #29 &#39;)&#39; 1 PASS
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;()&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Now we know why <code>MysteryRunner</code> fails – it suffices that the input contains two matching parentheses.  Delta Debugging determines this is 29 steps.  Its result is <em>1-minimal</em>, meaning that every character contained is required to produce the error; removing any (as seen in tests <code>#27</code> and <code>#28</code>, above) no longer makes the test fail.  This property is guaranteed by the delta debugging algorithm, which in its last stage always tries to delete characters one by one.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>A reduced test case such as the one above has many advantages:</p>
<ul>
<li><p>A reduced test case <strong>reduces the <em>cognitive load</em> of the programmer</strong>.  The test case is shorter and focused, and thus does not burden the programmer with irrelevant details.  A reduced input typically leads to shorter executions and smaller program states, both of which reduce the search space as it comes to understanding the bug.  In our case, we have eliminated lots of irrelevant input – only the two characters the reduced input contains are relevant.</p>
</li>
<li><p>A reduced test case <strong>is easier to communicate</strong>.  All one needs here is the summary: <code>MysteryRunner fails on "()"</code>, which is much better than <code>MysteryRunner fails on a 4100-character input (attached)</code>.</p>
</li>
<li><p>A reduced test case helps in <strong>identifying duplicates</strong>.  If similar bugs have been reported already, and all of them have been reduced to the same cause (namely that the input contains matching parentheses), then it becomes obvious that all these bugs are different symptoms of the same underlying cause – and would all be resolved at once with one code fix.</p>
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>How effective is delta debugging?  In the best case (wither the left half or the right half fails), the number of tests is logarithmic proportional to the length $n$ of an input (i.e., $O(\log_2 n)$); this is the same complexity as binary search.  In the worst case, though, delta debugging can require a number of tests proportional to $n^2$  (i.e., $O(n^2)$) – this happens in the case when we are down to character granularity, and we have to repeatedly tried to delete all characters, only to find that deleting the last character results in a failure [<a href="https://doi.org/10.1109/32.988498">Zeller <em>et al</em>, 2002.</a>].  (This is a pretty pathological situation, though.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>In general, delta debugging is a very robust algorithm that is easy to implement, easy to deploy, and easy to use – provided that the underlying test case is deterministic and runs quickly enough to warrant a number of experiments.  As these are the same prerequisites that make fuzzing effective, delta debugging makes an excellent companion to fuzzing.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Grammar-Based-Input-Reduction">Grammar-Based Input Reduction<a class="anchor-link" href="#Grammar-Based-Input-Reduction">&#182;</a></h2><p>\todo{Add}</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Parser.html" class="import" target="_blank">Parser</a></span> <span class="k">import</span> <span class="n">PEGParser</span><span class="p">,</span> <span class="n">canonical</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="GrammarFuzzer.html" class="import" target="_blank">GrammarFuzzer</a></span> <span class="k">import</span> <span class="n">all_terminals</span><span class="p">,</span> <span class="n">expansion_to_children</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># For logging the queue</span>
<span class="k">def</span> <span class="nf">queue_to_string</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">q</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">derivation_tree</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">,</span>
                   <span class="p">[(</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">,</span>
                     <span class="p">[(</span><span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                      <span class="p">(</span><span class="s2">&quot; + &quot;</span><span class="p">,</span> <span class="p">[]),</span>
                         <span class="p">(</span><span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
                     <span class="p">)])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">queue_to_string</span><span class="p">([</span><span class="n">derivation_tree</span><span class="p">,</span> <span class="n">derivation_tree</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;[&lt;expr&gt; + &lt;term&gt;, &lt;expr&gt; + &lt;term&gt;]&#39;
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="k">import</span> <span class="n">START_SYMBOL</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">Reducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="p">,</span> <span class="n">grammar</span><span class="p">,</span> <span class="n">start_symbol</span><span class="o">=</span><span class="n">START_SYMBOL</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span> <span class="o">=</span> <span class="n">grammar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_symbol</span> <span class="o">=</span> <span class="n">start_symbol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">PEGParser</span><span class="p">(</span><span class="n">canonical</span><span class="p">(</span><span class="n">grammar</span><span class="p">),</span> <span class="n">start_symbol</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">derivation_reductions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>  <span class="c1"># Terminal symbol</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trying alternative expansions for &quot;</span> <span class="o">+</span> <span class="n">symbol</span><span class="p">)</span>

        <span class="c1"># Possible expansions for this symbol</span>
        <span class="n">expansions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Expansions: &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">expansions</span><span class="p">))</span>

        <span class="n">alternatives</span> <span class="o">=</span> \
            <span class="p">[</span><span class="n">expansion_to_children</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span> <span class="k">for</span> <span class="n">expansion</span> <span class="ow">in</span> <span class="n">expansions</span><span class="p">]</span>

        <span class="n">reductions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">alternative</span> <span class="ow">in</span> <span class="n">alternatives</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">alternative</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">):</span>
                <span class="k">continue</span>  <span class="c1"># New alternative has more children</span>

            <span class="n">match</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">new_children_reductions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># print(&quot;Trying alternative expansion &quot; + queue_to_string(alternative))</span>
            <span class="k">for</span> <span class="n">alt_child</span> <span class="ow">in</span> <span class="n">alternative</span><span class="p">:</span>
                <span class="p">(</span><span class="n">alt_symbol</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">alt_child</span>
                <span class="n">child_reductions</span> <span class="o">=</span> <span class="n">subtrees_with_symbol</span><span class="p">(</span><span class="n">alt_symbol</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child_reductions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Child not found; cannot apply rule</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>

                <span class="c1"># print(&quot;Found alternatives &quot; + queue_to_string(child_reductions))</span>
                <span class="n">new_children_reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child_reductions</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># Try next alternative</span>

            <span class="c1"># Go through the possible combinations</span>
            <span class="k">for</span> <span class="n">new_children</span> <span class="ow">in</span> <span class="n">possible_combinations</span><span class="p">(</span><span class="n">new_children_reductions</span><span class="p">):</span>
                <span class="n">new_tree</span> <span class="o">=</span> <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">new_children</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">number_of_nodes</span><span class="p">(</span><span class="n">new_tree</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">number_of_nodes</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
                    <span class="k">continue</span>  <span class="c1"># No reduction</span>

                <span class="n">reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_tree</span><span class="p">)</span>

        <span class="c1"># Apply this recursively</span>
        <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)):</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">child_reductions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivation_reductions</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">reduced_child</span> <span class="ow">in</span> <span class="n">child_reductions</span><span class="p">:</span>
                    <span class="n">new_children</span> <span class="o">=</span> <span class="p">(</span><span class="n">children</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="n">reduced_child</span><span class="p">]</span>
                                    <span class="o">+</span> <span class="n">children</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>
                    <span class="n">reductions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">symbol</span><span class="p">,</span> <span class="n">new_children</span><span class="p">))</span>

        <span class="c1"># Filter duplicates</span>
        <span class="n">unique_reductions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reductions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_reductions</span><span class="p">:</span>
                <span class="n">unique_reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">reductions</span> <span class="o">=</span> <span class="n">unique_reductions</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reductions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># We have a new expansion</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Can reduce &quot;</span> <span class="o">+</span> <span class="n">symbol</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
                  <span class="o">+</span> <span class="s2">&quot; to reduced subtrees &quot;</span> <span class="o">+</span> <span class="n">queue_to_string</span><span class="p">(</span><span class="n">reductions</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">reductions</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reductions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivation_reductions</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="c1"># Reduce with respect to a given test</span>
    <span class="k">def</span> <span class="nf">reduce_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="c1"># Find possible reductions</span>
        <span class="n">smallest_tree</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="n">tree_reductions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reductions</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Alternatives: &quot;</span> <span class="o">+</span> <span class="n">queue_to_string</span><span class="p">(</span><span class="n">tree_reductions</span><span class="p">))</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree_reductions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">tree_reductions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tree_reductions</span> <span class="o">=</span> <span class="n">tree_reductions</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="n">Runner</span><span class="o">.</span><span class="n">FAIL</span><span class="p">:</span>
                <span class="c1"># Found new smallest tree; try to reduce that one further</span>
                <span class="n">smallest_tree</span> <span class="o">=</span> <span class="n">t</span>
                <span class="n">tree_reductions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reductions</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="n">tree_reductions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">tree</span><span class="p">:</span> <span class="o">-</span><span class="n">number_of_nodes</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;New smallest tree: &quot;</span> <span class="o">+</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">smallest_tree</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">smallest_tree</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tree</span>

    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="n">smallest_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">smallest_tree</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Find all subtrees in TREE whose root is SEARCH_SYMBOL.</span>
<span class="c1"># If IGNORE_ROOT is true, ignore the root note of TREE.</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">subtrees_with_symbol</span><span class="p">(</span><span class="n">search_symbol</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">ignore_root</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">tree</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_root</span> <span class="ow">and</span> <span class="n">symbol</span> <span class="o">==</span> <span class="n">search_symbol</span><span class="p">:</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

    <span class="c1"># Search across all children</span>
    <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="n">subtrees_with_symbol</span><span class="p">(</span><span class="n">search_symbol</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># convert a list [[X1, X2], [Y1, Y2], ...]</span>
<span class="c1"># into [X1, Y1], [X1, Y2], [X2, Y1], [X2, Y2], ...</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">possible_combinations</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># print(list_of_lists)</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_lists</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">e</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">possible_combinations</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                <span class="n">new_combo</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span>
                <span class="c1"># print(&quot;New combo: &quot;, repr(new_combo))</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_combo</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Return the number of nodes</span>
<span class="k">def</span> <span class="nf">number_of_nodes</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">tree</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="n">number_of_nodes</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="k">import</span> <span class="n">EXPR_GRAMMAR</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inp</span> <span class="o">=</span> <span class="s2">&quot;1+(2*3)&quot;</span>
<span class="n">grammar_reducer</span> <span class="o">=</span> <span class="n">GrammarReducer</span><span class="p">(</span><span class="n">mystery</span><span class="p">,</span> <span class="n">EXPR_GRAMMAR</span><span class="p">)</span>
<span class="n">grammar_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>1+(2*3)
Trying alternative expansions for &lt;start&gt;
Expansions: [&#39;&lt;expr&gt;&#39;]
Trying alternative expansions for &lt;expr&gt;
Expansions: [&#39;&lt;term&gt; + &lt;expr&gt;&#39;, &#39;&lt;term&gt; - &lt;expr&gt;&#39;, &#39;&lt;term&gt;&#39;]
Trying alternative expansions for &lt;term&gt;
Expansions: [&#39;&lt;factor&gt; * &lt;term&gt;&#39;, &#39;&lt;factor&gt; / &lt;term&gt;&#39;, &#39;&lt;factor&gt;&#39;]
Trying alternative expansions for &lt;factor&gt;
Expansions: [&#39;+&lt;factor&gt;&#39;, &#39;-&lt;factor&gt;&#39;, &#39;(&lt;expr&gt;)&#39;, &#39;&lt;integer&gt;.&lt;integer&gt;&#39;, &#39;&lt;integer&gt;&#39;]
Trying alternative expansions for &lt;integer&gt;
Expansions: [&#39;&lt;digit&gt;&lt;integer&gt;&#39;, &#39;&lt;digit&gt;&#39;]
Trying alternative expansions for &lt;digit&gt;
Expansions: [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;]
Trying alternative expansions for &lt;expr&gt;
Expansions: [&#39;&lt;term&gt; + &lt;expr&gt;&#39;, &#39;&lt;term&gt; - &lt;expr&gt;&#39;, &#39;&lt;term&gt;&#39;]
Trying alternative expansions for &lt;term&gt;
Expansions: [&#39;&lt;factor&gt; * &lt;term&gt;&#39;, &#39;&lt;factor&gt; / &lt;term&gt;&#39;, &#39;&lt;factor&gt;&#39;]
Trying alternative expansions for &lt;factor&gt;
Expansions: [&#39;+&lt;factor&gt;&#39;, &#39;-&lt;factor&gt;&#39;, &#39;(&lt;expr&gt;)&#39;, &#39;&lt;integer&gt;.&lt;integer&gt;&#39;, &#39;&lt;integer&gt;&#39;]
Trying alternative expansions for &lt;expr&gt;
Expansions: [&#39;&lt;term&gt; + &lt;expr&gt;&#39;, &#39;&lt;term&gt; - &lt;expr&gt;&#39;, &#39;&lt;term&gt;&#39;]
Trying alternative expansions for &lt;term&gt;
Expansions: [&#39;&lt;factor&gt; * &lt;term&gt;&#39;, &#39;&lt;factor&gt; / &lt;term&gt;&#39;, &#39;&lt;factor&gt;&#39;]
Trying alternative expansions for &lt;factor&gt;
Expansions: [&#39;+&lt;factor&gt;&#39;, &#39;-&lt;factor&gt;&#39;, &#39;(&lt;expr&gt;)&#39;, &#39;&lt;integer&gt;.&lt;integer&gt;&#39;, &#39;&lt;integer&gt;&#39;]
Trying alternative expansions for &lt;integer&gt;
Expansions: [&#39;&lt;digit&gt;&lt;integer&gt;&#39;, &#39;&lt;digit&gt;&#39;]
Trying alternative expansions for &lt;digit&gt;
Expansions: [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;]
Trying alternative expansions for &lt;term&gt;
Expansions: [&#39;&lt;factor&gt; * &lt;term&gt;&#39;, &#39;&lt;factor&gt; / &lt;term&gt;&#39;, &#39;&lt;factor&gt;&#39;]
Trying alternative expansions for &lt;factor&gt;
Expansions: [&#39;+&lt;factor&gt;&#39;, &#39;-&lt;factor&gt;&#39;, &#39;(&lt;expr&gt;)&#39;, &#39;&lt;integer&gt;.&lt;integer&gt;&#39;, &#39;&lt;integer&gt;&#39;]
Trying alternative expansions for &lt;integer&gt;
Expansions: [&#39;&lt;digit&gt;&lt;integer&gt;&#39;, &#39;&lt;digit&gt;&#39;]
Trying alternative expansions for &lt;digit&gt;
Expansions: [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;]
Can reduce &lt;term&gt; 2*3 to reduced subtrees [2, 3]
Can reduce &lt;expr&gt; 2*3 to reduced subtrees [3, 2]
Can reduce &lt;factor&gt; (2*3) to reduced subtrees [2, 3, (3), (2)]
Can reduce &lt;term&gt; (2*3) to reduced subtrees [2, 3, (3), (2)]
Can reduce &lt;expr&gt; (2*3) to reduced subtrees [2*3, 3, 2, (3), (2)]
Can reduce &lt;expr&gt; 1+(2*3) to reduced subtrees [1, (2*3), 2*3, 3, 1+2*3, 1+3, 1+2, 1+(3), 1+(2)]
Can reduce &lt;start&gt; 1+(2*3) to reduced subtrees [(2*3), 2*3, 1, 3, 1+2*3, 1+3, 1+2, 1+(3), 1+(2)]
Alternatives: [(2*3), 2*3, 1, 3, 1+2*3, 1+3, 1+2, 1+(3), 1+(2)]
Trying alternative expansions for &lt;start&gt;
Expansions: [&#39;&lt;expr&gt;&#39;]
Trying alternative expansions for &lt;expr&gt;
Expansions: [&#39;&lt;term&gt; + &lt;expr&gt;&#39;, &#39;&lt;term&gt; - &lt;expr&gt;&#39;, &#39;&lt;term&gt;&#39;]
Trying alternative expansions for &lt;term&gt;
Expansions: [&#39;&lt;factor&gt; * &lt;term&gt;&#39;, &#39;&lt;factor&gt; / &lt;term&gt;&#39;, &#39;&lt;factor&gt;&#39;]
Trying alternative expansions for &lt;factor&gt;
Expansions: [&#39;+&lt;factor&gt;&#39;, &#39;-&lt;factor&gt;&#39;, &#39;(&lt;expr&gt;)&#39;, &#39;&lt;integer&gt;.&lt;integer&gt;&#39;, &#39;&lt;integer&gt;&#39;]
Trying alternative expansions for &lt;expr&gt;
Expansions: [&#39;&lt;term&gt; + &lt;expr&gt;&#39;, &#39;&lt;term&gt; - &lt;expr&gt;&#39;, &#39;&lt;term&gt;&#39;]
Trying alternative expansions for &lt;term&gt;
Expansions: [&#39;&lt;factor&gt; * &lt;term&gt;&#39;, &#39;&lt;factor&gt; / &lt;term&gt;&#39;, &#39;&lt;factor&gt;&#39;]
Trying alternative expansions for &lt;factor&gt;
Expansions: [&#39;+&lt;factor&gt;&#39;, &#39;-&lt;factor&gt;&#39;, &#39;(&lt;expr&gt;)&#39;, &#39;&lt;integer&gt;.&lt;integer&gt;&#39;, &#39;&lt;integer&gt;&#39;]
Trying alternative expansions for &lt;integer&gt;
Expansions: [&#39;&lt;digit&gt;&lt;integer&gt;&#39;, &#39;&lt;digit&gt;&#39;]
Trying alternative expansions for &lt;digit&gt;
Expansions: [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;]
Trying alternative expansions for &lt;term&gt;
Expansions: [&#39;&lt;factor&gt; * &lt;term&gt;&#39;, &#39;&lt;factor&gt; / &lt;term&gt;&#39;, &#39;&lt;factor&gt;&#39;]
Trying alternative expansions for &lt;factor&gt;
Expansions: [&#39;+&lt;factor&gt;&#39;, &#39;-&lt;factor&gt;&#39;, &#39;(&lt;expr&gt;)&#39;, &#39;&lt;integer&gt;.&lt;integer&gt;&#39;, &#39;&lt;integer&gt;&#39;]
Trying alternative expansions for &lt;integer&gt;
Expansions: [&#39;&lt;digit&gt;&lt;integer&gt;&#39;, &#39;&lt;digit&gt;&#39;]
Trying alternative expansions for &lt;digit&gt;
Expansions: [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;]
Can reduce &lt;term&gt; 2*3 to reduced subtrees [2, 3]
Can reduce &lt;expr&gt; 2*3 to reduced subtrees [3, 2]
Can reduce &lt;factor&gt; (2*3) to reduced subtrees [2, 3, (3), (2)]
Can reduce &lt;term&gt; (2*3) to reduced subtrees [2, 3, (3), (2)]
Can reduce &lt;expr&gt; (2*3) to reduced subtrees [2*3, 3, 2, (3), (2)]
Can reduce &lt;start&gt; (2*3) to reduced subtrees [2*3, 3, 2, (3), (2)]
New smallest tree: (2*3)
Trying alternative expansions for &lt;start&gt;
Expansions: [&#39;&lt;expr&gt;&#39;]
Trying alternative expansions for &lt;expr&gt;
Expansions: [&#39;&lt;term&gt; + &lt;expr&gt;&#39;, &#39;&lt;term&gt; - &lt;expr&gt;&#39;, &#39;&lt;term&gt;&#39;]
Trying alternative expansions for &lt;term&gt;
Expansions: [&#39;&lt;factor&gt; * &lt;term&gt;&#39;, &#39;&lt;factor&gt; / &lt;term&gt;&#39;, &#39;&lt;factor&gt;&#39;]
Trying alternative expansions for &lt;factor&gt;
Expansions: [&#39;+&lt;factor&gt;&#39;, &#39;-&lt;factor&gt;&#39;, &#39;(&lt;expr&gt;)&#39;, &#39;&lt;integer&gt;.&lt;integer&gt;&#39;, &#39;&lt;integer&gt;&#39;]
Trying alternative expansions for &lt;expr&gt;
Expansions: [&#39;&lt;term&gt; + &lt;expr&gt;&#39;, &#39;&lt;term&gt; - &lt;expr&gt;&#39;, &#39;&lt;term&gt;&#39;]
Trying alternative expansions for &lt;term&gt;
Expansions: [&#39;&lt;factor&gt; * &lt;term&gt;&#39;, &#39;&lt;factor&gt; / &lt;term&gt;&#39;, &#39;&lt;factor&gt;&#39;]
Trying alternative expansions for &lt;factor&gt;
Expansions: [&#39;+&lt;factor&gt;&#39;, &#39;-&lt;factor&gt;&#39;, &#39;(&lt;expr&gt;)&#39;, &#39;&lt;integer&gt;.&lt;integer&gt;&#39;, &#39;&lt;integer&gt;&#39;]
Trying alternative expansions for &lt;integer&gt;
Expansions: [&#39;&lt;digit&gt;&lt;integer&gt;&#39;, &#39;&lt;digit&gt;&#39;]
Trying alternative expansions for &lt;digit&gt;
Expansions: [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;]
Can reduce &lt;factor&gt; (3) to reduced subtrees [3]
Can reduce &lt;term&gt; (3) to reduced subtrees [3]
Can reduce &lt;expr&gt; (3) to reduced subtrees [3]
Can reduce &lt;start&gt; (3) to reduced subtrees [3]
New smallest tree: (3)
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;(3)&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Section-4"><em>Section 4</em><a class="anchor-link" href="#Section-4">&#182;</a></h2><p>\todo{Add}</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned<a class="anchor-link" href="#Lessons-Learned">&#182;</a></h2><ul>
<li><em>Lesson one</em></li>
<li><em>Lesson two</em></li>
<li><em>Lesson three</em></li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps<a class="anchor-link" href="#Next-Steps">&#182;</a></h2><p><em>Link to subsequent chapters (notebooks) here, as in:</em></p>
<ul>
<li><a href="MutationFuzzer.html">use <em>mutations</em> on existing inputs to get more valid inputs</a></li>
<li><a href="Grammars.html">use <em>grammars</em> (i.e., a specification of the input format) to get even more valid inputs</a></li>
<li><a href="Reducer.html">reduce <em>failing inputs</em> for efficient debugging</a></li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Background">Background<a class="anchor-link" href="#Background">&#182;</a></h2><p>The delta debugging algorithm discussed here stems from [<a href="https://doi.org/10.1109/32.988498">Zeller <em>et al</em>, 2002.</a>]; actually, this is the exact Python implementation as used by Zeller in 2002.  The idea of systematically reducing inputs has been discovered a number of times, although not as  automatic and generic as delta debugging. [<a href="https://www.microsoft.com/en-us/research/publication/massive-stochastic-testing-of-sql/">Slutz <em>et al</em>, 1998.</a>], for instance, discusses systematic reduction of SQL statements for SQL databases; the general process as manual work is well described by [Kernighan <em>et al</em>, 1999.].</p>
<p>[<a href="http://dl.acm.org/citation.cfm?id=3155562.3155669">Herfert <em>et al</em>, 2017.</a>]</p>
<p>\todo{Add more: hierarchical DD, Csmith / C-reduce}</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises<a class="anchor-link" href="#Exercises">&#182;</a></h2><p>Close the chapter with a few exercises such that people have things to do.  To make the solutions hidden (to be revealed by the user), have them start with</p>

<pre><code>markdown
**Solution.**</code></pre>
<p>Your solution can then extend up to the next title (i.e., any markdown cell starting with <code>#</code>).</p>
<p>Running <code>make metadata</code> will automatically add metadata to the cells such that the cells will be hidden by default, and can be uncovered by the user.  The button will be introduced above the solution.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1:-Title">Exercise 1: <em>Title</em><a class="anchor-link" href="#Exercise-1:-Title">&#182;</a></h3><p><em>Text of the exercise</em></p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Some code that is part of the exercise</span>
<span class="k">pass</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><em>Some more text for the exercise</em></p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2:-Title">Exercise 2: <em>Title</em><a class="anchor-link" href="#Exercise-2:-Title">&#182;</a></h3><p><em>Text of the exercise</em></p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Carving-Unit-Tests">Carving Unit Tests<a class="anchor-link" href="#Carving-Unit-Tests">&#182;</a></h1><p>So far, we have always generated <em>system input</em>, i.e. data that the program as a whole obtains via its input channels.  If we are interested in testing only a small set of functions, having to go through the system can be very inefficient.  This chapter introduces a technique known as <em>carving</em>, which, given a system test, automatically extracts a set of <em>unit tests</em> that replicate the calls seen during the unit test.  The key idea is to <em>record</em> such calls such that we can <em>replay</em> them later – as a whole or selectively.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>Carving makes use of dynamic traces of function calls and variables, as introduced in the <a href="ConfigurationFuzzer.html">chapter on configuration fuzzing</a>.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="System-Tests-vs-Unit-Tests">System Tests vs Unit Tests<a class="anchor-link" href="#System-Tests-vs-Unit-Tests">&#182;</a></h2><p>Remember the URL grammar introduced for <a href="Grammars.html">grammar fuzzing</a>?  With such a grammar, we can happily test a Web browser again and again, checking how it reacts to arbitrary page requests.</p>
<p>Let us define a very simple "web browser" that goes and downloads the content given by the URL.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/urllib.parse.html" class="import" target="_blank">urllib.parse</a></span>
<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/urllib.request.html" class="import" target="_blank">urllib.request</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">webbrowser</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Download the http/https resource given by the URL&quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">getcode</span><span class="p">()</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">contents</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us apply this on <a href="https://www.fuzzingbook.org/">fuzzingboook.org</a> and measure the time, using the <a href="Timer.html">Timer class</a>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Timer.html" class="import" target="_blank">Timer</a></span> <span class="k">import</span> <span class="n">Timer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">webbrowser_timer</span><span class="p">:</span>
    <span class="n">fuzzingbook_contents</span> <span class="o">=</span> <span class="n">webbrowser</span><span class="p">(</span>
        <span class="s2">&quot;http://www.fuzzingbook.org/html/Fuzzer.html&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloaded </span><span class="si">%d</span><span class="s2"> bytes in </span><span class="si">%.2f</span><span class="s2"> seconds&quot;</span> <span class="o">%</span>
      <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fuzzingbook_contents</span><span class="p">),</span> <span class="n">webbrowser_timer</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Downloaded 394188 bytes in 0.38 seconds
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fuzzingbook_contents</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>b&#39;\n&lt;!-- A html document --&gt;\n&lt;!-- \nwith standard nbconvert css layout\nwith standard nbconvert input/out&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Having to start a whole browser (or having it render a Web page) again and again means lots of overhead, though – in particular if we want to test only a subset of its functionality.  In particular, after a change in the code, we would prefer to test only the subset of functions that is affected by the change, rather than running the well-tested functions again and again.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us assume we change the function that takes care of parsing the given URL and decomposing it into the individual elements – the scheme ("http"), the network location (<code>"www.fuzzingbook.com"</code>), or the path (<code>"/html/Fuzzer.html"</code>).  This function is named <code>urlparse()</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/urllib.parse.html" class="import" target="_blank">urllib.parse</a></span> <span class="k">import</span> <span class="n">urlparse</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">urlparse</span><span class="p">(</span><span class="s1">&#39;https://www.fuzzingbook.com/html/Carver.html&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>ParseResult(scheme=&#39;https&#39;, netloc=&#39;www.fuzzingbook.com&#39;, path=&#39;/html/Carver.html&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>You see how the individual elements of the URL – the <em>scheme</em> (<code>"http"</code>), the <em>network location</em> (<code>"www.fuzzingbook.com"</code>), or the path (<code>"//html/Carver.html"</code>) are all properly identified.  Other elements (like <code>params</code>, <code>query</code>, or <code>fragment</code>) are empty, because they were not part of our input.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The interesting thing is that executing only <code>urlparse()</code> is orders of magnitude faster than running all of <code>webbrowser()</code>.  Let us measure the factor:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">runs</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">urlparse_timer</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
        <span class="n">urlparse</span><span class="p">(</span><span class="s1">&#39;https://www.fuzzingbook.com/html/Carver.html&#39;</span><span class="p">)</span>

<span class="n">avg_urlparse_time</span> <span class="o">=</span> <span class="n">urlparse_timer</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
<span class="n">avg_urlparse_time</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>2.9732690018136053e-06
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Compare this to the time required by the webbrowser</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">webbrowser_timer</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>0.37655679100134876
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The difference in time is huge:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">webbrowser_timer</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span> <span class="o">/</span> <span class="n">avg_urlparse_time</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>126647.40081427559
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Hence, in the time it takes to run <code>webbrowser()</code> once, we can have <em>tens of thousands</em> of executions of <code>urlparse()</code> – and this does not even take into account the time it takes the browser to render the downloaded HTML, to run the included scripts, and whatever else happens when a Web page is loaded.  Hence, strategies that allow us to test at the <em>unit</em> level are very promising as they can save lots of overhead.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Carving-Unit-Tests">Carving Unit Tests<a class="anchor-link" href="#Carving-Unit-Tests">&#182;</a></h2><p>Testing methods and functions at the unit level requires a very good understanding of the individual units to be tested as well as their interplay with other units.  Setting up an appropriate infrastructure and writing unit tests by hand thus is demanding, yet rewarding.  There is, however, an interesting alternative to writing unit tests by hand.  The technique of <em>carving</em> automatically <em>converts system tests into unit tests</em> by means of recording and replaying function calls:</p>
<ol>
<li>During a system test (given or generated), we <em>record</em> all calls into a function, including all arguments and other variables the function reads.</li>
<li>From these, we synthesize a self-contained <em>unit test</em> that reconstructs the function call with all arguments.</li>
<li>This unit test can be executed (replayed) at any time with high efficiency.</li>
</ol>
<p>In the remainder of this chapter, let us explore these steps.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Recording-Calls">Recording Calls<a class="anchor-link" href="#Recording-Calls">&#182;</a></h2><p>Our first challenge is to record function calls together with their arguments.  (In the interest of simplicity, we restrict ourself to arguments, ignoring any global variables or other non-arguments that are read by the function.)  To record calls and arguments, we use the mechanism <a href="Coverage.html">we introduced for coverage</a>: By setting up a tracer function, we track all calls into individual functions, also saving their arguments.  Just like <code>Coverage</code> objects, we want to use <code>Carver</code> objects to be able to be used in conjunction with the <code>with</code> statement, such that we can trace a particular code block:</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Carver</span><span class="p">()</span> <span class="k">as</span> <span class="n">carver</span><span class="p">:</span>
    <span class="n">function_to_be_traced</span><span class="p">()</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">carver</span><span class="o">.</span><span class="n">calls</span><span class="p">()</span>
</pre></div>
<p>The initial definition supports this construct:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/sys.html" class="import" target="_blank">sys</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Carver</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="n">log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calls</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Start of `with` block</span>
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_trace_function</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">gettrace</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">traceit</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># End of `with` block</span>
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_trace_function</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The actual work takes place in the <code>traceit()</code> method, which records all calls in the <code>_calls</code> attribute.  First, we define two helper functions:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/inspect.html" class="import" target="_blank">inspect</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_qualified_name</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the fully qualified name of the current function&quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">co_name</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmodule</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">name</span>
    <span class="k">return</span> <span class="n">name</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_arguments</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return call arguments in the given frame&quot;&quot;&quot;</span>
    <span class="c1"># When called, all arguments are local variables</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[(</span><span class="n">var</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="n">var</span><span class="p">])</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">]</span>
    <span class="n">arguments</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>  <span class="c1"># Want same order as call</span>
    <span class="k">return</span> <span class="n">arguments</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">CallCarver</span><span class="p">(</span><span class="n">Carver</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">add_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add given call to list of calls&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">function_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calls</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calls</span><span class="p">[</span><span class="n">function_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">arguments</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calls</span><span class="p">[</span><span class="n">function_name</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calls</span><span class="p">[</span><span class="n">function_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>

    <span class="c1"># Tracking function: Record all calls and all args</span>
    <span class="k">def</span> <span class="nf">traceit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span> <span class="o">!=</span> <span class="s2">&quot;call&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">code</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_code</span>
        <span class="n">function_name</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">co_name</span>
        <span class="n">qualified_name</span> <span class="o">=</span> <span class="n">get_qualified_name</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="n">get_arguments</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_call</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">qualified_name</span> <span class="o">!=</span> <span class="n">function_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_call</span><span class="p">(</span><span class="n">qualified_name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">simple_call_string</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">))</span>

        <span class="k">return</span> <span class="kc">None</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Finally, we need some convenience functions to access the calls:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">CallCarver</span><span class="p">(</span><span class="n">CallCarver</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">calls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dictionary of all calls traced.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calls</span>

    <span class="k">def</span> <span class="nf">arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of all arguments of the given function</span>
<span class="sd">        as (VAR, VALUE) pairs.</span>
<span class="sd">        Raises an exception if the function was not traced.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calls</span><span class="p">[</span><span class="n">function_name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">called_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qualified</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return all functions called.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">qualified</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">function_name</span> <span class="k">for</span> <span class="n">function_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calls</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">function_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">function_name</span> <span class="k">for</span> <span class="n">function_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calls</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">function_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Recording-my_sqrt()">Recording my_sqrt()<a class="anchor-link" href="#Recording-my_sqrt()">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let's try out our new <code>Carver</code> class – first on a very simple function:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Intro_Testing.html" class="import" target="_blank">Intro_Testing</a></span> <span class="k">import</span> <span class="n">my_sqrt</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">CallCarver</span><span class="p">()</span> <span class="k">as</span> <span class="n">sqrt_carver</span><span class="p">:</span>
    <span class="n">my_sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">my_sqrt</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can retrieve all calls seen...</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sqrt_carver</span><span class="o">.</span><span class="n">calls</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;my_sqrt&#39;: [[(&#39;x&#39;, 2)], [(&#39;x&#39;, 4)]],
 &#39;__exit__&#39;: [[(&#39;self&#39;, &lt;__main__.CallCarver at 0x10f890a58&gt;),
   (&#39;exc_type&#39;, None),
   (&#39;exc_value&#39;, None),
   (&#39;tb&#39;, None)]]}
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sqrt_carver</span><span class="o">.</span><span class="n">called_functions</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;my_sqrt&#39;, &#39;__exit__&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>... as well as the arguments of a particular function:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sqrt_carver</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span><span class="s2">&quot;my_sqrt&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[[(&#39;x&#39;, 2)], [(&#39;x&#39;, 4)]]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We define a convenience function for nicer printing of these lists:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">simple_call_string</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="n">argument_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return function_name(arg[0], arg[1], ...) as a string&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">function_name</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> \
        <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">var</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                   <span class="k">for</span> <span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">argument_list</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">function_name</span> <span class="ow">in</span> <span class="n">sqrt_carver</span><span class="o">.</span><span class="n">called_functions</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">argument_list</span> <span class="ow">in</span> <span class="n">sqrt_carver</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span><span class="n">function_name</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">simple_call_string</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="n">argument_list</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>my_sqrt(x=2)
my_sqrt(x=4)
__exit__(self=&lt;__main__.CallCarver object at 0x10f890a58&gt;, exc_type=None, exc_value=None, tb=None)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is a syntax we can directly use to invoke <code>my_sqrt()</code> again:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;my_sqrt(x=2)&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>1.414213562373095
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Carving-urlparse()">Carving urlparse()<a class="anchor-link" href="#Carving-urlparse()">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What happens if we apply this to <code>webbrowser()</code>?</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">CallCarver</span><span class="p">()</span> <span class="k">as</span> <span class="n">webbrowser_carver</span><span class="p">:</span>
    <span class="n">webbrowser</span><span class="p">(</span><span class="s2">&quot;http://www.example.com&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that retrieving a URL from the Web requires quite some functionality:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">webbrowser_carver</span><span class="o">.</span><span class="n">called_functions</span><span class="p">(</span><span class="n">qualified</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;urllib.request.urlopen&#39;, &#39;urllib.request.open&#39;, &#39;urllib.request.__init__&#39;, &#39;urllib.request.full_url&#39;, &#39;urllib.parse.unwrap&#39;, &#39;urllib.parse.splittag&#39;, &#39;urllib.request._parse&#39;, &#39;urllib.parse.splittype&#39;, &#39;urllib.parse.splithost&#39;, &#39;urllib.parse.unquote&#39;, &#39;urllib.request.data&#39;, &#39;urllib.request.request_host&#39;, &#39;urllib.parse.urlparse&#39;, &#39;urllib.parse._coerce_args&#39;, &#39;urllib.parse.urlsplit&#39;, &#39;urllib.parse._splitnetloc&#39;, &#39;urllib.parse._noop&#39;, &#39;urllib.request.do_request_&#39;, &#39;urllib.request.has_proxy&#39;, &#39;urllib.request.has_header&#39;, &#39;urllib.request.add_unredirected_header&#39;, &#39;urllib.request._open&#39;, &#39;urllib.request._call_chain&#39;, &#39;urllib.request.http_open&#39;, &#39;urllib.request.do_open&#39;, &#39;http.client.__init__&#39;, &#39;http.client._get_hostport&#39;, &#39;http.client.set_debuglevel&#39;, &#39;urllib.request.&lt;genexpr&gt;&#39;, &#39;urllib.request.get_method&#39;, &#39;http.client.request&#39;, &#39;http.client._send_request&#39;, &#39;http.client.&lt;genexpr&gt;&#39;, &#39;http.client.putrequest&#39;, &#39;http.client._output&#39;, &#39;http.client.putheader&#39;, &#39;http.client._get_content_length&#39;, &#39;http.client.endheaders&#39;, &#39;http.client._send_output&#39;, &#39;http.client.send&#39;, &#39;http.client.connect&#39;, &#39;socket.create_connection&#39;, &#39;socket.getaddrinfo&#39;, &#39;encodings.idna.encode&#39;, &#39;socket._intenum_converter&#39;, &#39;enum.__call__&#39;, &#39;enum.__new__&#39;, &#39;socket.__init__&#39;, &#39;http.client.getresponse&#39;, &#39;socket.makefile&#39;, &#39;socket.readable&#39;, &#39;http.client.begin&#39;, &#39;http.client._read_status&#39;, &#39;socket.readinto&#39;, &#39;http.client.parse_headers&#39;, &#39;email.parser.__init__&#39;, &#39;email.parser.parsestr&#39;, &#39;email.parser.parse&#39;, &#39;email.feedparser.__init__&#39;, &#39;email.message.__init__&#39;, &#39;email.feedparser.feed&#39;, &#39;email.feedparser.push&#39;, &#39;email.feedparser.pushlines&#39;, &#39;email.feedparser._call_parse&#39;, &#39;email.feedparser._parsegen&#39;, &#39;email.feedparser._new_message&#39;, &#39;email.feedparser.__iter__&#39;, &#39;email.feedparser.__next__&#39;, &#39;email.feedparser.readline&#39;, &#39;email.feedparser._parse_headers&#39;, &#39;email._policybase.header_source_parse&#39;, &#39;email.message.set_raw&#39;, &#39;email.message.get_content_type&#39;, &#39;email.message.get&#39;, &#39;email._policybase.header_fetch_parse&#39;, &#39;email._policybase._sanitize_header&#39;, &#39;email.utils._has_surrogates&#39;, &#39;email.message._splitparam&#39;, &#39;email.message.get_content_maintype&#39;, &#39;email.feedparser.close&#39;, &#39;email.message.set_payload&#39;, &#39;email.feedparser._pop_message&#39;, &#39;http.client._check_close&#39;, &#39;http.client.close&#39;, &#39;socket.close&#39;, &#39;urllib.request.get_full_url&#39;, &#39;urllib.request.http_response&#39;, &#39;http.client.info&#39;, &#39;http.client.getcode&#39;, &#39;http.client.read&#39;, &#39;http.client._safe_read&#39;, &#39;http.client._close_conn&#39;, &#39;socket._decref_socketios&#39;, &#39;socket._real_close&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Among several other functions, we also have a call to <code>urlparse()</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">urlparse_argument_list</span> <span class="o">=</span> <span class="n">webbrowser_carver</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span><span class="s2">&quot;urllib.parse.urlparse&quot;</span><span class="p">)</span>
<span class="n">urlparse_argument_list</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[[(&#39;url&#39;, &#39;http://www.example.com&#39;),
  (&#39;scheme&#39;, &#39;&#39;),
  (&#39;allow_fragments&#39;, True)]]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Again, we can convert this into a well-formatted call:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">urlparse_call</span> <span class="o">=</span> <span class="n">simple_call_string</span><span class="p">(</span><span class="s2">&quot;urlparse&quot;</span><span class="p">,</span> <span class="n">urlparse_argument_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">urlparse_call</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#34;urlparse(url=&#39;http://www.example.com&#39;, scheme=&#39;&#39;, allow_fragments=True)&#34;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Again, we can re-execute this call:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">eval</span><span class="p">(</span><span class="n">urlparse_call</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>ParseResult(scheme=&#39;http&#39;, netloc=&#39;www.example.com&#39;, path=&#39;&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We now have successfully carved the call to <code>urlparse()</code> out of the <code>webbrowser()</code> execution.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Replaying-Calls">Replaying Calls<a class="anchor-link" href="#Replaying-Calls">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Replaying calls in their entirety and in all generality is tricky, as there are several challenges to be addressed.  These include:</p>
<ol>
<li><p>We need to be able to <em>access</em> individual functions.  If we access a function by name, the name must be in scope.  If the name is not visible (for instance, because it is a name internal to the module), we must make it visible.</p>
</li>
<li><p>Any <em>resources</em> accessed outside of arguments must be recorded and reconstructed for replay as well.  This can be difficult if variables refer to external resources such as files or network resources.</p>
</li>
<li><p><em>Complex objects</em> must be reconstructed as well.</p>
</li>
</ol>
<p>These constraints make carving hard or even impossible if the function to be tested interacts heavily with its environment.  To illustrate these issues, consider the <code>email.parser.parse()</code> method that is invoked in <code>webbrowser()</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">email_parse_argument_list</span> <span class="o">=</span> <span class="n">webbrowser_carver</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span><span class="s2">&quot;email.parser.parse&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Calls to this method look like this:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">email_parse_call</span> <span class="o">=</span> <span class="n">simple_call_string</span><span class="p">(</span>
    <span class="s2">&quot;email.parser.parse&quot;</span><span class="p">,</span>
    <span class="n">email_parse_argument_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">email_parse_call</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;email.parser.parse(self=&lt;email.parser.Parser object at 0x10f890128&gt;, fp=&lt;_io.StringIO object at 0x10f8df828&gt;, headersonly=False)&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that <code>email.parser.parse()</code> is part of a <code>email.parser.Parser</code> object and it gets a <code>StringIO</code> object.  Both are non-primitive values.  How could we possibly reconstruct them?</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Serializing-Objects">Serializing Objects<a class="anchor-link" href="#Serializing-Objects">&#182;</a></h3><p>The answer to the problem of complex objects lies in creating a <em>persistent</em> representation that can be <em>reconstructed</em> at later points in time.  This process is known as <em>serialization</em>; in Python, it is also known as <em>pickling</em>.  The <code>pickle</code> module provides means to create a serialized representation of an object.  Let us apply this on the <code>email.parser.Parser</code> object we just found:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/pickle.html" class="import" target="_blank">pickle</a></span>    
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">parser_object</span> <span class="o">=</span> <span class="n">email_parse_argument_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">parser_object</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&lt;email.parser.Parser at 0x10f890128&gt;
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pickled</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">parser_object</span><span class="p">)</span>
<span class="n">pickled</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>b&#39;\x80\x03cemail.parser\nParser\nq\x00)\x81q\x01}q\x02(X\x06\x00\x00\x00_classq\x03chttp.client\nHTTPMessage\nq\x04X\x06\x00\x00\x00policyq\x05cemail._policybase\nCompat32\nq\x06)\x81q\x07ub.&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>From this string representing the serialized <code>email.parser.Parser</code> object, we can recreate the Parser object at any time:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">unpickled_parser_object</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickled</span><span class="p">)</span>
<span class="n">unpickled_parser_object</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&lt;email.parser.Parser at 0x10f8e3320&gt;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The serialization mechanism allows us to produce a representation for all objects passed as parameters (assuming they can be pickled, that is).  We can now extend the <code>simple_call_string()</code> function such that it automatically pickles objects.  Additionally, we set it up such that if the first parameter is named <code>self</code> (i.e., it is a class method), we make it a method of the <code>self</code> object.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">call_value</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="n">value_as_string</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value_as_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Complex object</span>
        <span class="n">value_as_string</span> <span class="o">=</span> <span class="s2">&quot;pickle.loads(&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
    <span class="k">return</span> <span class="n">value_as_string</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">call_string</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="n">argument_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return function_name(arg[0], arg[1], ...) as a string, pickling complex objects&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">argument_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="p">(</span><span class="n">first_var</span><span class="p">,</span> <span class="n">first_value</span><span class="p">)</span> <span class="o">=</span> <span class="n">argument_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">first_var</span> <span class="o">==</span> <span class="s2">&quot;self&quot;</span><span class="p">:</span>
            <span class="c1"># Make this a method call</span>
            <span class="n">method_name</span> <span class="o">=</span> <span class="n">function_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">function_name</span> <span class="o">=</span> <span class="n">call_value</span><span class="p">(</span><span class="n">first_value</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">method_name</span>
            <span class="n">argument_list</span> <span class="o">=</span> <span class="n">argument_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">return</span> <span class="n">function_name</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> \
        <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">var</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="n">call_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                   <span class="k">for</span> <span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">argument_list</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us apply the extended <code>call_string()</code> method to create a call for <code>email.parser.parse()</code>, including pickled objects:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">call</span> <span class="o">=</span> <span class="n">call_string</span><span class="p">(</span><span class="s2">&quot;email.parser.parse&quot;</span><span class="p">,</span> <span class="n">email_parse_argument_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>pickle.loads(b&#39;\x80\x03cemail.parser\nParser\nq\x00)\x81q\x01}q\x02(X\x06\x00\x00\x00_classq\x03chttp.client\nHTTPMessage\nq\x04X\x06\x00\x00\x00policyq\x05cemail._policybase\nCompat32\nq\x06)\x81q\x07ub.&#39;).parse(fp=pickle.loads(b&#39;\x80\x03c_io\nStringIO\nq\x00)\x81q\x01(XD\x01\x00\x00Cache-Control: max-age=604800\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Mon, 05 Nov 2018 16:02:33 GMT\r\nEtag: &#34;1541025663+ident&#34;\r\nExpires: Mon, 12 Nov 2018 16:02:33 GMT\r\nLast-Modified: Fri, 09 Aug 2013 23:54:35 GMT\r\nServer: ECS (dca/2470)\r\nVary: Accept-Encoding\r\nX-Cache: HIT\r\nContent-Length: 1270\r\nConnection: close\r\n\r\nq\x02X\x01\x00\x00\x00\nq\x03MD\x01Ntq\x04b.&#39;), headersonly=False)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With this call involvimng the pickled object, we can now re-run the original call and obtain a valid result:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">eval</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&lt;http.client.HTTPMessage at 0x10f8e36a0&gt;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="All-Calls">All Calls<a class="anchor-link" href="#All-Calls">&#182;</a></h3><p>So far, we have seen only one call of <code>webbrowser()</code>.  How many of the calls within <code>webbrowser()</code> can we actually carve and replay?  Let us try this out and compute the numbers.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/traceback.html" class="import" target="_blank">traceback</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/enum.html" class="import" target="_blank">enum</a></span>
<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/socket.html" class="import" target="_blank">socket</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_functions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">webbrowser_carver</span><span class="o">.</span><span class="n">called_functions</span><span class="p">(</span><span class="n">qualified</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">call_success</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="n">run_success</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exceptions_seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<span class="k">for</span> <span class="n">function_name</span> <span class="ow">in</span> <span class="n">webbrowser_carver</span><span class="o">.</span><span class="n">called_functions</span><span class="p">(</span><span class="n">qualified</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">argument_list</span> <span class="ow">in</span> <span class="n">webbrowser_carver</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span><span class="n">function_name</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">call</span> <span class="o">=</span> <span class="n">call_string</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="n">argument_list</span><span class="p">)</span>
            <span class="n">call_success</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">function_name</span><span class="p">)</span>

            <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
            <span class="n">run_success</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">function_name</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">exceptions_seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
            <span class="c1"># print(&quot;-&gt;&quot;, call, file=sys.stderr)</span>
            <span class="c1"># traceback.print_exc()</span>
            <span class="c1"># print(&quot;&quot;, file=sys.stderr)</span>
            <span class="k">continue</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2"> calls (</span><span class="si">%.2f%%</span><span class="s2">) successfully created and </span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2"> calls (</span><span class="si">%.2f%%</span><span class="s2">) successfully ran&quot;</span> <span class="o">%</span> <span class="p">(</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">call_success</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_functions</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span>
        <span class="n">call_success</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_functions</span><span class="p">),</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">run_success</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_functions</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">run_success</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_functions</span><span class="p">)))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>82/94 calls (87.23%) successfully created and 46/94 calls (48.94%) successfully ran
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>About half of the calls succeed.  Let us take a look into some of the error messages we get:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">exceptions_seen</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SyntaxError(&#39;invalid syntax&#39;, (&#39;&lt;string&gt;&#39;, 1, 16, &#34;urllib.request.&lt;genexpr&gt;(headers={&#39;Host&#39;: &#39;www.example.com&#39;, &#39;User-agent&#39;: &#39;Python-urllib/3.6&#39;, &#39;Connection&#39;: &#39;close&#39;}, .0=pickle.loads(b&#39;\\x80\\x03cbuiltins\\niter\\nq\\x00]q\\x01\\x85q\\x02Rq\\x03.&#39;))&#34;))
AttributeError(&#34;module &#39;enum&#39; has no attribute &#39;__call__&#39;&#34;,)
NameError(&#34;name &#39;ParseResult&#39; is not defined&#34;,)
SyntaxError(&#39;invalid syntax&#39;, (&#39;&lt;string&gt;&#39;, 1, 16, &#34;urllib.request.&lt;genexpr&gt;(name=&#39;User-agent&#39;, val=&#39;Python-urllib/3.6&#39;, .0=pickle.loads(b&#39;\\x80\\x03cbuiltins\\niter\\nq\\x00]q\\x01\\x85q\\x02Rq\\x03.&#39;))&#34;))
TypeError(&#34;can&#39;t pickle generator objects&#34;,)
SyntaxError(&#39;invalid syntax&#39;, (&#39;&lt;string&gt;&#39;, 1, 13, &#34;http.client.&lt;genexpr&gt;(.0=pickle.loads(b&#39;\\x80\\x03cbuiltins\\niter\\nq\\x00]q\\x01\\x85q\\x02Rq\\x03.&#39;))&#34;))
SyntaxError(&#39;invalid syntax&#39;, (&#39;&lt;string&gt;&#39;, 1, 13, &#34;http.client.&lt;genexpr&gt;(k=&#39;User-Agent&#39;, .0=pickle.loads(b&#39;\\x80\\x03cbuiltins\\niter\\nq\\x00]q\\x01\\x85q\\x02Rq\\x03.&#39;))&#34;))
TypeError(&#34;cannot serialize &#39;_io.BufferedReader&#39; object&#34;,)
TypeError(&#34;&#39;NoneType&#39; object is not callable&#34;,)
TypeError(&#34;_call_chain() got an unexpected keyword argument &#39;args&#39;&#34;,)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We see that:</p>
<ul>
<li><strong>A large majority of calls could be converted into call strings.</strong>  If this is not the case, this is mostly due to having unserialized objects being passed.</li>
<li><strong>About half of the calls could be executed.</strong>  The error messages for the failing runs are varied; the most frequent being that some internal name is invoked that is not in scope.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our carving mechanism should be taken with a grain of salt: We still do not cover the situation where external variables and values (such as global variables) are being accessed, and the serialization mechanism cannot recreate external resources.  Still, if the function of interest falls among those that <em>can</em> be carved and replayed, we can very effectively re-run its calls with their original arguments.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned<a class="anchor-link" href="#Lessons-Learned">&#182;</a></h2><ul>
<li><em>Carving</em> allows for effective replay of function calls recorded during a system test</li>
<li>A function call can be <em>orders of magnitude faster</em> than a system invocation.</li>
<li><em>Serialization</em> allows to create persistent representations of complex objects.</li>
<li>Functions that heavily interact with their environment and/or access external resources are difficult to carve.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps<a class="anchor-link" href="#Next-Steps">&#182;</a></h2><p>The following chapters make use of the concepts defined here:</p>
<ul>
<li>In the chapter on <a href="APIFuzzer.html">fuzzing APIs</a>, we discuss how to use carving to <em>fuzz functions with combinations of carved and newly generated values</em>.  This effectively joins the strengths of carving and fuzzing.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Background">Background<a class="anchor-link" href="#Background">&#182;</a></h2><p>Carving was invented by Elbaum et al. [<a href="https://doi.org/10.1145/1181775.1181806">Elbaum <em>et al</em>, 2006.</a>] and originally implemented for Java.  In this chapter, we follow several of their design choices (including recording and serializing method arguments only).</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises<a class="anchor-link" href="#Exercises">&#182;</a></h2><h3 id="Exercise-1:-Carving-for-Regression-Testing">Exercise 1: Carving for Regression Testing<a class="anchor-link" href="#Exercise-1:-Carving-for-Regression-Testing">&#182;</a></h3><p>So far, during carving, we only have looked into reproducing <em>calls</em>, but not into actually checking the <em>results</em> of these calls.  This is important for <em>regression testing</em> – i.e. checking whether a change to code does not impede existing functionality.  We can build this by recording not only <em>calls</em>, but also <em>return values</em> – and then later compare whether the same calls result in the same values.  This may not work on all occasions; values that depend on time, randomness, or other external factors may be different.  Still, for functionality that abstracts from these details, checking that nothing has changed is an important part of testing.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Our aim is to design a class <code>ResultCarver</code> that extends <code>CallCarver</code> by recording both calls and return values.</p>
<p>In a first step, create a <code>traceit()</code> method that also tracks return values by extending the <code>traceit()</code> method.  The <code>traceit()</code> event type is <code>"return"</code> and the <code>arg</code> parameter is the returned value.  Here is a prototype that only prints out the returned values:</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ResultCarver</span><span class="p">(</span><span class="n">CallCarver</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">traceit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s2">&quot;return&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Result:&quot;</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">traceit</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
        <span class="c1"># Need to return traceit function such that it is invoked for return</span>
        <span class="c1"># events</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">traceit</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ResultCarver</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">result_carver</span><span class="p">:</span>
    <span class="n">my_sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>my_sqrt(x=2)
Result: 1.414213562373095
__exit__(self=&lt;__main__.ResultCarver object at 0x10f8e3940&gt;, exc_type=None, exc_value=None, tb=None)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-1:-Store-function-results">Part 1: Store function results<a class="anchor-link" href="#Part-1:-Store-function-results">&#182;</a></h4><p>Extend the above code such that results are <em>stored</em> in a way that associates them with the currently returning function (or method).  To this end, you need to keep track of the <em>current stack of called functions</em>.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-2:-Access-results">Part 2: Access results<a class="anchor-link" href="#Part-2:-Access-results">&#182;</a></h4><p>Give it a method <code>result()</code> that returns the value recorded for that particular function name and result:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ResultCarver</span><span class="p">(</span><span class="n">CallCarver</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the result recorded for function_name(argument&quot;&quot;&quot;</span>
</pre></div>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Part-3:-Produce-assertions">Part 3: Produce assertions<a class="anchor-link" href="#Part-3:-Produce-assertions">&#182;</a></h4><p>For the functions called during <code>webbrowser()</code> execution, create a set of <em>assertions</em> that check whether the result returned is still the same.  Test this for <code>urllib.parse.urlparse()</code> and <code>urllib.parse.urlsplit()</code>.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Fuzzing-APIs">Fuzzing APIs<a class="anchor-link" href="#Fuzzing-APIs">&#182;</a></h1><p>So far, we have always generated <em>system input</em>, i.e. data that the program as a whole obtains via its input channels.  However, we can also generate input that goes directly into individual functions, gaining flexibility and speed in the process.  In this chapter, we explore the use of grammars to synthesize code for function calls, which allows you to generate <em>program code that very efficiently invokes functions directly.</em>  On top, we also explore how such API grammars can be synthesized from existing executions; this means that we can <em>synthesize API tests without having to write a grammar at all.</em></p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fuzzingbook_utils</span> <span class="k">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s2">&quot;w4u5gCgPlmg&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="640"
            height="360"
            src="https://www.youtube.com/embed/w4u5gCgPlmg"
            frameborder="0"
            allowfullscreen
        ></iframe>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>You have to know how grammar fuzzing work, e.g. from the <a href="Grammars.html">chapter on grammars</a>.</li>
<li>To synthesize API grammars, we make use of <a href="Carver.html">recorded ("carved") function calls</a>.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Fuzzing-a-Function">Fuzzing a Function<a class="anchor-link" href="#Fuzzing-a-Function">&#182;</a></h2><p>Let us start with our first problem: How do we fuzz a given function?  For an interpreted language like Python, this pretty straight-forward.  All we need to do is to generate <em>calls</em> to the function(s) we want to test.  This is something we can easily do with a grammar.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Testing-a-URL-Parser">Testing a URL Parser<a class="anchor-link" href="#Testing-a-URL-Parser">&#182;</a></h3><p>As an example, consider the <code>urlparse()</code> function from the Python library.  <code>urlparse()</code> takes a URL and decomposes it into its individual components.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/urllib.parse.html" class="import" target="_blank">urllib.parse</a></span> <span class="k">import</span> <span class="n">urlparse</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">urlparse</span><span class="p">(</span><span class="s1">&#39;https://www.fuzzingbook.com/html/APIFuzzer.html&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>ParseResult(scheme=&#39;https&#39;, netloc=&#39;www.fuzzingbook.com&#39;, path=&#39;/html/APIFuzzer.html&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>You see how the individual elements of the URL – the <em>scheme</em> (<code>"http"</code>), the <em>network location</em> (<code>"www.fuzzingbook.com"</code>), or the path (<code>"//html/APIFuzzer.html"</code>) are all properly identified.  Other elements (like <code>params</code>, <code>query</code>, or <code>fragment</code>) are empty, because they were not part of our input.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To test <code>urlparse()</code>, we'd want to feed it a large set of different URLs.  We can obtain these from the URL grammar we had defined in the <a href="Grammars.html">"Grammars"</a> chapter.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Grammars.html" class="import" target="_blank">Grammars</a></span> <span class="k">import</span> <span class="n">URL_GRAMMAR</span><span class="p">,</span> <span class="n">is_valid_grammar</span><span class="p">,</span> <span class="n">START_SYMBOL</span><span class="p">,</span> <span class="n">new_symbol</span>
<span class="kn">from</span> <span class="nn"><a href="GrammarFuzzer.html" class="import" target="_blank">GrammarFuzzer</a></span> <span class="k">import</span> <span class="n">GrammarFuzzer</span><span class="p">,</span> <span class="n">display_tree</span><span class="p">,</span> <span class="n">all_terminals</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">url_fuzzer</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">URL_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">url_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>ParseResult(scheme=&#39;https&#39;, netloc=&#39;user:password@cispa.saarland:8080&#39;, path=&#39;/&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;http&#39;, netloc=&#39;cispa.saarland:1&#39;, path=&#39;/&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;https&#39;, netloc=&#39;fuzzingbook.com:7&#39;, path=&#39;&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;https&#39;, netloc=&#39;user:password@cispa.saarland:80&#39;, path=&#39;&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;ftps&#39;, netloc=&#39;user:password@fuzzingbook.com&#39;, path=&#39;&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;ftp&#39;, netloc=&#39;fuzzingbook.com&#39;, path=&#39;/abc&#39;, params=&#39;&#39;, query=&#39;abc=x31&amp;def=x20&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;ftp&#39;, netloc=&#39;user:password@fuzzingbook.com&#39;, path=&#39;&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;https&#39;, netloc=&#39;www.google.com:80&#39;, path=&#39;/&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;http&#39;, netloc=&#39;fuzzingbook.com:52&#39;, path=&#39;/&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;ftps&#39;, netloc=&#39;user:password@cispa.saarland&#39;, path=&#39;&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This way, we can easily test any Python function – by setting up a scaffold that runs it.  How would we proceed, though, if we wanted to have a test that can be re-run again and again, without having to generate new calls every time?</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Synthesizing-Code">Synthesizing Code<a class="anchor-link" href="#Synthesizing-Code">&#182;</a></h3></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The "scaffolding" method, as sketched above, has an important downside: It couples test generation and test execution into a single unit, disallowing running both at different times, or for different languages.  To decouple the two, we take another approach: Rather than generating inputs and immediately feeding this input into a function, we <em>synthesize code</em> instead that invokes functions with a given input.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>For instance, if we generate the string</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">call</span> <span class="o">=</span> <span class="s2">&quot;urlparse(&#39;http://www.example.com/&#39;)&quot;</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>we can execute this string as a whole (and thus run the test) at any time:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">eval</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>ParseResult(scheme=&#39;http&#39;, netloc=&#39;www.example.com&#39;, path=&#39;/&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>To systematically generate such calls, we can again use a grammar:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">URLPARSE_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;call&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s1">&#39;urlparse(&quot;&lt;url&gt;&quot;)&#39;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This grammar creates calls in the form <code>urlparse(&lt;url&gt;)</code>, where <code>&lt;url&gt;</code> is yet to be defined; the idea is to create many of these calls and to feed them into the Python interpreter.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us add definitions for <code>&lt;url&gt;</code> from the previously defined URL grammar:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">URLPARSE_GRAMMAR</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">URL_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">URLPARSE_GRAMMAR</span><span class="p">[</span><span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;call&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">URLPARSE_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">URLPARSE_GRAMMAR</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;call&gt;&#39;: [&#39;urlparse(&#34;&lt;url&gt;&#34;)&#39;],
 &#39;&lt;start&gt;&#39;: [&#39;&lt;call&gt;&#39;],
 &#39;&lt;url&gt;&#39;: [&#39;&lt;scheme&gt;://&lt;authority&gt;&lt;path&gt;&lt;query&gt;&#39;],
 &#39;&lt;scheme&gt;&#39;: [&#39;http&#39;, &#39;https&#39;, &#39;ftp&#39;, &#39;ftps&#39;],
 &#39;&lt;authority&gt;&#39;: [&#39;&lt;host&gt;&#39;,
  &#39;&lt;host&gt;:&lt;port&gt;&#39;,
  &#39;&lt;userinfo&gt;@&lt;host&gt;&#39;,
  &#39;&lt;userinfo&gt;@&lt;host&gt;:&lt;port&gt;&#39;],
 &#39;&lt;host&gt;&#39;: [&#39;cispa.saarland&#39;, &#39;www.google.com&#39;, &#39;fuzzingbook.com&#39;],
 &#39;&lt;port&gt;&#39;: [&#39;80&#39;, &#39;8080&#39;, &#39;&lt;nat&gt;&#39;],
 &#39;&lt;nat&gt;&#39;: [&#39;&lt;digit&gt;&#39;, &#39;&lt;digit&gt;&lt;digit&gt;&#39;],
 &#39;&lt;digit&gt;&#39;: [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;],
 &#39;&lt;userinfo&gt;&#39;: [&#39;user:password&#39;],
 &#39;&lt;path&gt;&#39;: [&#39;&#39;, &#39;/&#39;, &#39;/&lt;id&gt;&#39;],
 &#39;&lt;id&gt;&#39;: [&#39;abc&#39;, &#39;def&#39;, &#39;x&lt;digit&gt;&lt;digit&gt;&#39;],
 &#39;&lt;query&gt;&#39;: [&#39;&#39;, &#39;?&lt;params&gt;&#39;],
 &#39;&lt;params&gt;&#39;: [&#39;&lt;param&gt;&#39;, &#39;&lt;param&gt;&amp;&lt;params&gt;&#39;],
 &#39;&lt;param&gt;&#39;: [&#39;&lt;id&gt;=&lt;id&gt;&#39;, &#39;&lt;id&gt;=&lt;nat&gt;&#39;]}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can now use this grammar for fuzzing and synthesizing calls to <code>urlparse)</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">urlparse_fuzzer</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">URLPARSE_GRAMMAR</span><span class="p">)</span>
<span class="n">urlparse_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;urlparse(&#34;http://user:password@fuzzingbook.com:8080?abc=x29&#34;)&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Just as above, we can immediately execute these calls.  To better see what is happening, we define a small helper function:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Call function_name(arg[0], arg[1], ...) as a string</span>
<span class="k">def</span> <span class="nf">do_call</span><span class="p">(</span><span class="n">call_string</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">call_string</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">call_string</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">= &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">call</span> <span class="o">=</span> <span class="n">urlparse_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
<span class="n">do_call</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>urlparse(&#34;http://www.google.com?abc=def&#34;)
	= ParseResult(scheme=&#39;http&#39;, netloc=&#39;www.google.com&#39;, path=&#39;&#39;, params=&#39;&#39;, query=&#39;abc=def&#39;, fragment=&#39;&#39;)
</pre>
</div>

</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>ParseResult(scheme=&#39;http&#39;, netloc=&#39;www.google.com&#39;, path=&#39;&#39;, params=&#39;&#39;, query=&#39;abc=def&#39;, fragment=&#39;&#39;)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If <code>urlparse()</code> were a C function, for instance, we could embed its call into some (also generated) C function:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">URLPARSE_C_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;cfile&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;cheader&gt;&lt;cfunction&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;cheader&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#include &quot;urlparse.h&quot;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;cfunction&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;void test() {</span><span class="se">\n</span><span class="s2">&lt;calls&gt;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;calls&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;call&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;calls&gt;&lt;call&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;call&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;    urlparse(&quot;&lt;url&gt;&quot;);</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">URLPARSE_C_GRAMMAR</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">URL_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">URLPARSE_C_GRAMMAR</span><span class="p">[</span><span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;cfile&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">URLPARSE_C_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">urlparse_fuzzer</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">URLPARSE_C_GRAMMAR</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">urlparse_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>#include &#34;urlparse.h&#34;

void test() {
    urlparse(&#34;http://user:password@cispa.saarland:99/x69?x57=abc&#34;);
}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Note that both the Python as well as the C variant only check for <em>generic</em> errors in <code>urlparse()</code>; that is, they only detect fatal errors and exceptions.  To also check the <em>result</em> of <code>urlparse()</code>, see the <a href="#Exercise-1:-Synthesizing-Oracles">exercise on synthesizing oracles</a>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Mining-API-Grammars">Mining API Grammars<a class="anchor-link" href="#Mining-API-Grammars">&#182;</a></h2><p>While it is relatively straightforward to write a grammar that produces a sequence of function calls, we can again try to automate this further by automatically <em>mining</em> function calls from a given execution of a program.  To this end, we make use of <a href="Carver.html">our <em>carving</em> infrastructure introduced in the previous chapter</a> to <em>record</em> function calls and their arguments, from which we can create a grammar that can then combine arbitrary arguments into new calls.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The general idea is as follows:</p>
<ol>
<li>First, we record all calls of a specific function from a given execution of the program.</li>
<li>Second, we create a grammar that incorporates all these calls, with separate rules for each argument and alternatives for each value found; this allows us to produce calls that arbitrarily <em>recombine</em> these arguments.</li>
</ol>
<p>Let us explore these steps in the following sections.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="From-Calls-to-Grammars">From Calls to Grammars<a class="anchor-link" href="#From-Calls-to-Grammars">&#182;</a></h3><p>Let us start with an example.  The <code>power(x, y)</code> function returns $x^y$; it is but a wrapper around the equivalent <code>math.pow()</code> function.  (Since <code>power()</code> is defined in Python, we can trace it – in contrast to <code>math.pow()</code>, which is implemented in C.)</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/math.html" class="import" target="_blank">math</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Let us invoke <code>power()</code> while recording its arguments:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Carver.html" class="import" target="_blank">Carver</a></span> <span class="k">import</span> <span class="n">CallCarver</span><span class="p">,</span> <span class="n">call_value</span><span class="p">,</span> <span class="n">call_string</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">CallCarver</span><span class="p">()</span> <span class="k">as</span> <span class="n">power_carver</span><span class="p">:</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">power</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">power</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">power_carver</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[[(&#39;x&#39;, 1), (&#39;y&#39;, 2)], [(&#39;x&#39;, 3), (&#39;y&#39;, 4)]]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>From this list of recorded arguments, we could now create a grammar for the <code>power()</code> call, with <code>x</code> and <code>y</code> expanding into the values seen:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">POWER_GRAMMAR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;power(&lt;x&gt;, &lt;y&gt;)&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;&lt;x&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;y&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">]</span>
<span class="p">}</span>
<span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">URLPARSE_GRAMMAR</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>When fuzzing with this grammar, we then get arbitrary combinations of <code>x</code> and <code>y</code>; aiming for coverage will ensure that all values are actually tested at least once:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="GrammarCoverageFuzzer.html" class="import" target="_blank">GrammarCoverageFuzzer</a></span> <span class="k">import</span> <span class="n">GrammarCoverageFuzzer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">power_fuzzer</span> <span class="o">=</span> <span class="n">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">POWER_GRAMMAR</span><span class="p">)</span>
<span class="p">[</span><span class="n">power_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;power(1, 4)&#39;, &#39;power(3, 2)&#39;, &#39;power(3, 2)&#39;, &#39;power(3, 2)&#39;, &#39;power(3, 2)&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>What we need is a method to automatically convert the arguments as seen in <code>power_carver</code> to the grammar as seen in <code>POWER_GRAMMAR</code>.  This is what we define in the next section.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="A-Grammar-Miner-for-Calls">A Grammar Miner for Calls<a class="anchor-link" href="#A-Grammar-Miner-for-Calls">&#182;</a></h3><p>We introduce a class <code>CallGrammarMiner</code>, which, given a <code>Carver</code>, automatically produces a grammar from the calls seen.  To initialize, we pass the carver object:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">CallGrammarMiner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">carver</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">carver</span> <span class="o">=</span> <span class="n">carver</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="Initial-Grammar">Initial Grammar<a class="anchor-link" href="#Initial-Grammar">&#182;</a></h4><p>The initial grammar produces a single call.  The possible <code>&lt;call&gt;</code> expansions are to be constructed later:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/copy.html" class="import" target="_blank">copy</a></span> 
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">CallGrammarMiner</span><span class="p">(</span><span class="n">CallGrammarMiner</span><span class="p">):</span>
    <span class="n">CALL_SYMBOL</span> <span class="o">=</span> <span class="s2">&quot;&lt;call&gt;&quot;</span>

    <span class="k">def</span> <span class="nf">initial_grammar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
               <span class="p">{</span> <span class="n">START_SYMBOL</span><span class="p">:</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">CALL_SYMBOL</span><span class="p">],</span> 
                 <span class="bp">self</span><span class="o">.</span><span class="n">CALL_SYMBOL</span><span class="p">:</span> <span class="p">[]</span>
               <span class="p">})</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">CallGrammarMiner</span><span class="p">(</span><span class="n">power_carver</span><span class="p">)</span>
<span class="n">initial_grammar</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">initial_grammar</span><span class="p">()</span>
<span class="n">initial_grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;start&gt;&#39;: [&#39;&lt;call&gt;&#39;], &#39;&lt;call&gt;&#39;: []}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="A-Grammar-from-Arguments">A Grammar from Arguments<a class="anchor-link" href="#A-Grammar-from-Arguments">&#182;</a></h4><p>Let us start by creating a grammar from a list of arguments.  The method <code>mine_arguments_grammar()</code> creates a grammar for the arguments seen during carving, such as these:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">arguments</span> <span class="o">=</span> <span class="n">power_carver</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">)</span>
<span class="n">arguments</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[[(&#39;x&#39;, 1), (&#39;y&#39;, 2)], [(&#39;x&#39;, 3), (&#39;y&#39;, 4)]]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The <code>mine_arguments_grammar()</code> method iterates through the variables seen and creates a mapping <code>variables</code> of variable names to a set of values seen (as strings, going through <code>call_value()</code>).  In a second step, it then creates a grammar with a rule for each variable name, expanding into the values seen.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">CallGrammarMiner</span><span class="p">(</span><span class="n">CallGrammarMiner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">var_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">grammar</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">new_symbol</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="n">function_name</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">var</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mine_arguments_grammar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">grammar</span><span class="p">):</span>
        <span class="n">var_grammar</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">variables</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">argument_list</span> <span class="ow">in</span> <span class="n">arguments</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">argument_list</span><span class="p">:</span>
                <span class="n">value_string</span> <span class="o">=</span> <span class="n">call_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="n">value_string</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">value_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">var_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;langle&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;&quot;</span><span class="p">]</span>
                    <span class="n">value_string</span> <span class="o">=</span> <span class="n">value_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;langle&gt;&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
                    <span class="n">variables</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="n">variables</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value_string</span><span class="p">)</span>

        <span class="n">var_symbols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
            <span class="n">var_symbol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_symbol</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">grammar</span><span class="p">)</span>
            <span class="n">var_symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var_symbol</span><span class="p">)</span>
            <span class="n">var_grammar</span><span class="p">[</span><span class="n">var_symbol</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">variables</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">var_grammar</span><span class="p">,</span> <span class="n">var_symbols</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">CallGrammarMiner</span><span class="p">(</span><span class="n">power_carver</span><span class="p">)</span>
<span class="n">var_grammar</span><span class="p">,</span> <span class="n">var_symbols</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">mine_arguments_grammar</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">initial_grammar</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">var_grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;power-x&gt;&#39;: [&#39;1&#39;, &#39;3&#39;], &#39;&lt;power-y&gt;&#39;: [&#39;4&#39;, &#39;2&#39;]}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The additional return value <code>var_symbols</code> is a list of argument symbols in the call:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">var_symbols</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;&lt;power-x&gt;&#39;, &#39;&lt;power-y&gt;&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="A-Grammar-from-Calls">A Grammar from Calls<a class="anchor-link" href="#A-Grammar-from-Calls">&#182;</a></h4><p>To get the grammar for a single function (<code>mine_function_grammar()</code>), we add a call to the function:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">CallGrammarMiner</span><span class="p">(</span><span class="n">CallGrammarMiner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">function_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">,</span> <span class="n">grammar</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">new_symbol</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="n">function_name</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mine_function_grammar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">,</span> <span class="n">grammar</span><span class="p">):</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">carver</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span><span class="n">function_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>

        <span class="n">var_grammar</span><span class="p">,</span> <span class="n">var_symbols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mine_arguments_grammar</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">grammar</span><span class="p">)</span>

        <span class="n">function_grammar</span> <span class="o">=</span> <span class="n">var_grammar</span>
        <span class="n">function_symbol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_symbol</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="n">grammar</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_symbols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">var_symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;-self&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Method call</span>
            <span class="n">function_grammar</span><span class="p">[</span><span class="n">function_symbol</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">var_symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">function_name</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">var_symbols</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">function_grammar</span><span class="p">[</span><span class="n">function_symbol</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">function_name</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">var_symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">function_symbol</span><span class="p">,</span> <span class="s2">&quot;::=&quot;</span><span class="p">,</span> <span class="n">function_grammar</span><span class="p">[</span><span class="n">function_symbol</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">function_grammar</span><span class="p">,</span> <span class="n">function_symbol</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">CallGrammarMiner</span><span class="p">(</span><span class="n">power_carver</span><span class="p">)</span>
<span class="n">function_grammar</span><span class="p">,</span> <span class="n">function_symbol</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">mine_function_grammar</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="n">initial_grammar</span><span class="p">)</span>
<span class="n">function_grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;power-x&gt;&#39;: [&#39;1&#39;, &#39;3&#39;],
 &#39;&lt;power-y&gt;&#39;: [&#39;4&#39;, &#39;2&#39;],
 &#39;&lt;power&gt;&#39;: [&#39;power(&lt;power-x&gt;, &lt;power-y&gt;)&#39;]}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The additionally returned <code>function_symbol</code> holds the name of the function call just added:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">function_symbol</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;&lt;power&gt;&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="A-Grammar-from-all-Calls">A Grammar from all Calls<a class="anchor-link" href="#A-Grammar-from-all-Calls">&#182;</a></h4><p>Let us now repeat the above for all function calls seen during carving.  To this end, we simply iterate over all function calls seen:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">power_carver</span><span class="o">.</span><span class="n">called_functions</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;power&#39;, &#39;__exit__&#39;]
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">CallGrammarMiner</span><span class="p">(</span><span class="n">CallGrammarMiner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">mine_call_grammar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qualified</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">grammar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_grammar</span><span class="p">()</span>
        <span class="n">fn_list</span> <span class="o">=</span> <span class="n">function_list</span>
        <span class="k">if</span> <span class="n">function_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fn_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">carver</span><span class="o">.</span><span class="n">called_functions</span><span class="p">(</span><span class="n">qualified</span><span class="o">=</span><span class="n">qualified</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">function_name</span> <span class="ow">in</span> <span class="n">fn_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">function_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">function_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">function_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)):</span>
                <span class="k">continue</span> <span class="c1"># Internal function</span>

            <span class="c1"># Ignore errors with mined functions</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">function_grammar</span><span class="p">,</span> <span class="n">function_symbol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mine_function_grammar</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="n">grammar</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">function_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span>

            <span class="k">if</span> <span class="n">function_symbol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grammar</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">CALL_SYMBOL</span><span class="p">]:</span>
                <span class="n">grammar</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">CALL_SYMBOL</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">function_symbol</span><span class="p">)</span>
            <span class="n">grammar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">function_grammar</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">grammar</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The method <code>mine_call_grammar()</code> is the one that clients can and should use – first for mining...</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">CallGrammarMiner</span><span class="p">(</span><span class="n">power_carver</span><span class="p">)</span>
<span class="n">power_grammar</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">mine_call_grammar</span><span class="p">()</span>
<span class="n">power_grammar</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>{&#39;&lt;start&gt;&#39;: [&#39;&lt;call&gt;&#39;],
 &#39;&lt;call&gt;&#39;: [&#39;&lt;power&gt;&#39;],
 &#39;&lt;power-x&gt;&#39;: [&#39;1&#39;, &#39;3&#39;],
 &#39;&lt;power-y&gt;&#39;: [&#39;4&#39;, &#39;2&#39;],
 &#39;&lt;power&gt;&#39;: [&#39;power(&lt;power-x&gt;, &lt;power-y&gt;)&#39;]}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>...and then for fuzzing:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">power_fuzzer</span> <span class="o">=</span> <span class="n">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">power_grammar</span><span class="p">)</span>
<span class="p">[</span><span class="n">power_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;power(1, 4)&#39;, &#39;power(3, 2)&#39;, &#39;power(1, 2)&#39;, &#39;power(1, 2)&#39;, &#39;power(1, 4)&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>With this, we have successfully extracted a grammar from a recorded execution; in contrast to "simple" carving, our grammar allows us to <em>recombine</em> arguments and thus to fuzz at the API level.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Fuzzing-Web-Functions">Fuzzing Web Functions<a class="anchor-link" href="#Fuzzing-Web-Functions">&#182;</a></h3><p>Let us now apply our grammar miner on a larger API – the <code>urlparse</code> API we already encountered during carving.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Carver.html" class="import" target="_blank">Carver</a></span> <span class="k">import</span> <span class="n">webbrowser</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">CallCarver</span><span class="p">()</span> <span class="k">as</span> <span class="n">webbrowser_carver</span><span class="p">:</span>
    <span class="n">webbrowser</span><span class="p">(</span><span class="s2">&quot;http://www.fuzzingbook.org&quot;</span><span class="p">)</span>
    <span class="n">webbrowser</span><span class="p">(</span><span class="s2">&quot;https://www.example.com&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We can mine a grammar from the calls encountered:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">CallGrammarMiner</span><span class="p">(</span><span class="n">webbrowser_carver</span><span class="p">)</span>
<span class="n">webbrowser_grammar</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">mine_call_grammar</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is a rather large grammar:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">webbrowser_grammar</span><span class="p">[</span><span class="s1">&#39;&lt;call&gt;&#39;</span><span class="p">])</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;&lt;webbrowser&gt;&#39;, &#39;&lt;urlopen&gt;&#39;, &#39;&lt;open&gt;&#39;, &#39;&lt;full_url&gt;&#39;, &#39;&lt;unwrap&gt;&#39;, &#39;&lt;splittag&gt;&#39;, &#39;&lt;splittype&gt;&#39;, &#39;&lt;splithost&gt;&#39;, &#39;&lt;unquote&gt;&#39;, &#39;&lt;data&gt;&#39;, &#39;&lt;request_host&gt;&#39;, &#39;&lt;urlparse&gt;&#39;, &#39;&lt;urlsplit&gt;&#39;, &#39;&lt;do_request_&gt;&#39;, &#39;&lt;has_proxy&gt;&#39;, &#39;&lt;has_header&gt;&#39;, &#39;&lt;add_unredirected_header&gt;&#39;, &#39;&lt;http_open&gt;&#39;, &#39;&lt;do_open&gt;&#39;, &#39;&lt;get_method&gt;&#39;, &#39;&lt;create_connection&gt;&#39;, &#39;&lt;getaddrinfo&gt;&#39;, &#39;&lt;encode&gt;&#39;, &#39;&lt;readable&gt;&#39;, &#39;&lt;begin&gt;&#39;, &#39;&lt;parsestr&gt;&#39;, &#39;&lt;parse&gt;&#39;, &#39;&lt;push&gt;&#39;, &#39;&lt;pushlines&gt;&#39;, &#39;&lt;readline&gt;&#39;, &#39;&lt;header_source_parse&gt;&#39;, &#39;&lt;set_raw&gt;&#39;, &#39;&lt;get_content_type&gt;&#39;, &#39;&lt;get&gt;&#39;, &#39;&lt;header_fetch_parse&gt;&#39;, &#39;&lt;get_content_maintype&gt;&#39;, &#39;&lt;set_payload&gt;&#39;, &#39;&lt;get_full_url&gt;&#39;, &#39;&lt;http_response&gt;&#39;, &#39;&lt;info&gt;&#39;, &#39;&lt;error&gt;&#39;, &#39;&lt;http_error_302&gt;&#39;, &#39;&lt;urlunparse&gt;&#39;, &#39;&lt;urlunsplit&gt;&#39;, &#39;&lt;quote&gt;&#39;, &#39;&lt;quote_from_bytes&gt;&#39;, &#39;&lt;urljoin&gt;&#39;, &#39;&lt;redirect_request&gt;&#39;, &#39;&lt;flush&gt;&#39;, &#39;&lt;https_open&gt;&#39;, &#39;&lt;match_hostname&gt;&#39;, &#39;&lt;ip_address&gt;&#39;, &#39;&lt;getcode&gt;&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's the rule for the <code>urlsplit()</code> function:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">webbrowser_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;urlsplit&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#39;urlsplit(&lt;urlsplit-url&gt;, &lt;urlsplit-scheme&gt;, &lt;urlsplit-allow_fragments&gt;)&#39;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here are the arguments.  Note that although we only passed <code>http://www.fuzzingbook.org</code> as a parameter, we also see the <code>https:</code> variant.  That is because opening the <code>http:</code> URL automatically redirects to the <code>https:</code> URL, which is then also processed by <code>urlsplit()</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">webbrowser_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;urlsplit-url&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#34;&#39;https://www.fuzzingbook.org/&#39;&#34;,
 &#34;&#39;https://www.example.com&#39;&#34;,
 &#34;&#39;http://www.fuzzingbook.org&#39;&#34;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>There also is some variation in the <code>scheme</code> argument:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">webbrowser_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;urlsplit-scheme&gt;&quot;</span><span class="p">]</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>[&#34;&#39;http&#39;&#34;, &#34;&#39;&#39;&#34;]
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If we now apply a fuzzer on these rules, we systematically cover all variations of arguments seen, including, of course, combinations not seen during carving.  Again, we are fuzzing at the API level here.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">urlsplit_fuzzer</span> <span class="o">=</span> <span class="n">GrammarCoverageFuzzer</span><span class="p">(</span><span class="n">webbrowser_grammar</span><span class="p">,</span> <span class="n">start_symbol</span><span class="o">=</span><span class="s2">&quot;&lt;urlsplit&gt;&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">urlsplit_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>urlsplit(&#39;https://www.fuzzingbook.org/&#39;, &#39;&#39;, True)
urlsplit(&#39;https://www.example.com&#39;, &#39;http&#39;, True)
urlsplit(&#39;http://www.fuzzingbook.org&#39;, &#39;&#39;, True)
urlsplit(&#39;https://www.example.com&#39;, &#39;&#39;, True)
urlsplit(&#39;http://www.fuzzingbook.org&#39;, &#39;&#39;, True)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Just <a href="Carver.html">as seen with carving</a>, running tests at the API level is orders of magnitude faster than executing system tests.  Hence, this calls for means to fuzz at the method level:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/urllib.parse.html" class="import" target="_blank">urllib.parse</a></span> <span class="k">import</span> <span class="n">urlsplit</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Timer.html" class="import" target="_blank">Timer</a></span> <span class="k">import</span> <span class="n">Timer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">urlsplit_timer</span><span class="p">:</span>
    <span class="n">urlsplit</span><span class="p">(</span><span class="s1">&#39;http://www.fuzzingbook.org/&#39;</span><span class="p">,</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">urlsplit_timer</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>2.2690001060254872e-05
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">webbrowser_timer</span><span class="p">:</span>
    <span class="n">webbrowser</span><span class="p">(</span><span class="s2">&quot;http://www.fuzzingbook.org&quot;</span><span class="p">)</span>
<span class="n">webbrowser_timer</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>0.11015510099969106
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">webbrowser_timer</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span> <span class="o">/</span> <span class="n">urlsplit_timer</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>4854.786066654054
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>But then again, the caveats encountered during carving apply, notably the requirement to recreate the original function environment.  If we also alter or recombine arguments, we get the additional risk of <em>violating an implicit precondition</em> – that is, invoking a function with arguments the function was never designed for.  Such <em>false alarms</em>, resulting from incorrect invocations rather than incorrect implementations, must then be identified (typically manually) and wed out (for instance, by altering or constraining the grammar).  The huge speed gains at the API level, however, may well justify this additional investment.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned<a class="anchor-link" href="#Lessons-Learned">&#182;</a></h2><ul>
<li>To fuzz individual functions, one can easily set up grammars that produce function calls.</li>
<li>Such grammars can also be mined (carved) from given executions.</li>
<li>Fuzzing at the API level can be much faster than fuzzing at the system level, but brings the risk of false alarms by violating implicit preconditions.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps<a class="anchor-link" href="#Next-Steps">&#182;</a></h2><p>To extend the techniques just introduced, you can</p>
<ul>
<li><a href="SearchBasedFuzzer.html">use <em>search-based testing</em> to guide test generation towards specific goals</a></li>
<li><a href="ConstraintGrammarFuzzer.html">use <em>constraints</em> (i.e., a specification of the input format) to get even more valid inputs</a></li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Background">Background<a class="anchor-link" href="#Background">&#182;</a></h2><p>The combination of carving and fuzzing at the API level was first conducted by Alexander Kampmann in his PhD work.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises<a class="anchor-link" href="#Exercises">&#182;</a></h2><p>The exercises for this chapter combine the above techniques with fuzzing techniques introduced earlier.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1:-Covering-Argument-Combinations">Exercise 1: Covering Argument Combinations<a class="anchor-link" href="#Exercise-1:-Covering-Argument-Combinations">&#182;</a></h3><p>In the chapter on <a href="ConfigurationFuzzer.html">configuration testing</a>, we also discussed <em>combinatorial testing</em> – that is, systematic coverage of <em>sets</em> of configuration elements.  Implement a scheme that by changing the grammar, allows all <em>pairs</em> of argument values to be covered.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2:-Mutating-Arguments">Exercise 2: Mutating Arguments<a class="anchor-link" href="#Exercise-2:-Mutating-Arguments">&#182;</a></h3><p>To widen the range of arguments to be used during testing, apply the <em>mutation schemes</em> introduced in <a href="MutationFuzzer.html">mutation fuzzing</a> – for instance, flip individual bytes or delete characters from strings.  Apply this either during grammar inference or as a separate step when invoking functions.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-3:-Abstracting-Arguments">Exercise 3: Abstracting Arguments<a class="anchor-link" href="#Exercise-3:-Abstracting-Arguments">&#182;</a></h3><p>Set up an abstraction scheme to widen the range of arguments to be used during testing.  If the values for an argument, all conform to some type <code>T</code>. abstract it into <code>&lt;T&gt;</code>.  For instance, if calls to <code>foo(1)</code>, <code>foo(2)</code>, <code>foo(3)</code> have been seen, the grammar should abstract its calls into <code>foo(&lt;int&gt;)</code>, with <code>&lt;int&gt;</code> being appropriately defined.</p>
<p>Do this for a number of common types: integers, positive numbers, floating-point numbers, host names, URLs, mail addresses, and more.</p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Error-Handling">Error Handling<a class="anchor-link" href="#Error-Handling">&#182;</a></h1><p>The code in this notebook helps with handling errors.  Normally, an error in  notebook code causes the execution of the code to stop; while an infinite loop in notebook code causes the notebook to run without end.  This notebook provides two classes to help address these concerns.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>This notebook needs some understanding on advanced concepts in Python, notably <ul>
<li>classes</li>
<li>the Python <code>with</code> statement</li>
<li>tracing</li>
<li>measuring time</li>
<li>exceptions</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Catching-Errors">Catching Errors<a class="anchor-link" href="#Catching-Errors">&#182;</a></h2><p>The class <code>ExpectError</code> allows to express that some code produces an exception.  A typical usage looks as follows:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="ExpectError.html" class="import" target="_blank">ExpectError</a></span> <span class="kn">import</span> <span class="n">ExpectError</span>

<span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">function_that_is_supposed_to_fail</span><span class="p">()</span>
</pre></div>
<p>If an exception occurs, it is printed on standard error; yet, execution continues.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/traceback.html" class="import" target="_blank">traceback</a></span>
<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/sys.html" class="import" target="_blank">sys</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ExpectError</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">print_traceback</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_traceback</span> <span class="o">=</span> <span class="n">print_traceback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mute</span> <span class="o">=</span> <span class="n">mute</span>

    <span class="c1"># Begin of `with` block</span>
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># End of `with` block</span>
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># No exception</span>
            <span class="k">return</span>

        <span class="c1"># An exception occurred</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_traceback</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span>
                    <span class="n">exc_type</span><span class="p">,</span>
                    <span class="n">exc_value</span><span class="p">,</span>
                    <span class="n">tb</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exception_only</span><span class="p">(</span>
                <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mute</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="s2">&quot;(expected)&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Ignore it</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's an example:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">fail_test</span><span class="p">():</span>
    <span class="c1"># Trigger an exception</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">fail_test</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-5-67c629a2a842&gt;&#34;, line 2, in &lt;module&gt;
    fail_test()
  File &#34;&lt;ipython-input-4-2e8a6dbc7b2c&gt;&#34;, line 3, in fail_test
    x = 1 / 0
ZeroDivisionError: division by zero (expected)
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">(</span><span class="n">print_traceback</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">fail_test</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>ZeroDivisionError: division by zero (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Catching-Timeouts">Catching Timeouts<a class="anchor-link" href="#Catching-Timeouts">&#182;</a></h2><p>The class <code>ExpectTimeout(seconds)</code> allows to express that some code may run for a long or infinite time; execution is thus interrupted after <code>seconds</code> seconds.  A typical usage looks as follows:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="ExpectError.html" class="import" target="_blank">ExpectError</a></span> <span class="kn">import</span> <span class="n">ExpectTimeout</span>

<span class="k">with</span> <span class="n">ExpectTimeout</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">function_that_is_supposed_to_hang</span><span class="p">()</span>
</pre></div>
<p>If an exception occurs, it is printed on standard error (as with <code>ExpectError</code>); yet, execution continues.</p>
<p>Should there be a need to cancel the timeout within the <code>with</code> block, <code>t.cancel()</code> will do the trick.</p>
<p>The implementation uses <code>sys.settrace()</code>, as this seems to be the most portable way to implement timeouts.  It is not very efficient, though.  Also, it only works on individual lines of Python code and will not interrupt a long-running system function.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/sys.html" class="import" target="_blank">sys</a></span>
<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/time.html" class="import" target="_blank">time</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="c1"># Should be defined in Python 3</span>
    <span class="n">x</span> <span class="o">=</span> <span class="ne">TimeoutError</span>
<span class="k">except</span><span class="p">:</span>
    <span class="c1"># For Python 2</span>
    <span class="k">class</span> <span class="nc">TimeoutError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Timeout&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ExpectTimeout</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seconds</span><span class="p">,</span> <span class="n">print_traceback</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seconds_before_timeout</span> <span class="o">=</span> <span class="n">seconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_trace_function</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_traceback</span> <span class="o">=</span> <span class="n">print_traceback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mute</span> <span class="o">=</span> <span class="n">mute</span>

    <span class="c1"># Tracing function</span>
    <span class="k">def</span> <span class="nf">check_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_trace_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">original_trace_function</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>

        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">current_time</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TimeoutError</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_time</span>

    <span class="c1"># Begin of `with` block</span>
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds_before_timeout</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">original_trace_function</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">gettrace</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># End of `with` block</span>
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># An exception occurred</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_traceback</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span>
                    <span class="n">exc_type</span><span class="p">,</span>
                    <span class="n">exc_value</span><span class="p">,</span>
                    <span class="n">tb</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exception_only</span><span class="p">(</span>
                <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mute</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="s2">&quot;(expected)&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Ignore it</span>

    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_trace_function</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's an example:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">long_running_test</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;seconds have passed&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;End&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectTimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">print_traceback</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">long_running_test</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Start
0 seconds have passed
1 seconds have passed
2 seconds have passed
3 seconds have passed
</pre>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>TimeoutError (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Note that it is possible to nest multiple timeouts.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectTimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">ExpectTimeout</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">long_running_test</span><span class="p">()</span>
    <span class="n">long_running_test</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Start
0 seconds have passed
1 seconds have passed
</pre>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-12-d87d5d50b60e&gt;&#34;, line 3, in &lt;module&gt;
    long_running_test()
  File &#34;&lt;ipython-input-10-8d0f8e53f106&gt;&#34;, line 5, in long_running_test
    print(i, &#34;seconds have passed&#34;)
  File &#34;&lt;ipython-input-10-8d0f8e53f106&gt;&#34;, line 5, in long_running_test
    print(i, &#34;seconds have passed&#34;)
  File &#34;&lt;ipython-input-9-a28a583f0630&gt;&#34;, line 16, in check_time
    raise TimeoutError
TimeoutError (expected)
</pre>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Start
0 seconds have passed
</pre>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-12-d87d5d50b60e&gt;&#34;, line 4, in &lt;module&gt;
    long_running_test()
  File &#34;&lt;ipython-input-10-8d0f8e53f106&gt;&#34;, line 5, in long_running_test
    print(i, &#34;seconds have passed&#34;)
  File &#34;&lt;ipython-input-10-8d0f8e53f106&gt;&#34;, line 5, in long_running_test
    print(i, &#34;seconds have passed&#34;)
  File &#34;&lt;ipython-input-9-a28a583f0630&gt;&#34;, line 16, in check_time
    raise TimeoutError
TimeoutError (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>That's it, folks – enjoy!</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Timer">Timer<a class="anchor-link" href="#Timer">&#182;</a></h1><p>The code in this notebook helps with measuring time.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li>This notebook needs some understanding on advanced concepts in Python, notably <ul>
<li>classes</li>
<li>the Python <code>with</code> statement</li>
<li>measuring time</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Measuring-Time">Measuring Time<a class="anchor-link" href="#Measuring-Time">&#182;</a></h2><p>The class <code>Timer</code> allows to measure the elapsed time during some code execution.  A typical usage looks as follows:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Timer.html" class="import" target="_blank">Timer</a></span> <span class="kn">import</span> <span class="n">Timer</span>

<span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">function_that_is_supposed_to_be_timed</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/time.html" class="import" target="_blank">time</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">clock</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>  <span class="c1"># Python 3</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>         <span class="c1"># Python 2</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Timer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1"># Begin of `with` block</span>
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">clock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># End of `with` block</span>
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">clock</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">elapsed_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return elapsed time in seconds&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># still running</span>
            <span class="k">return</span> <span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's an example:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">some_long_running_function</span><span class="p">():</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1000000</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stopping total time:&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">some_long_running_function</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Stopping total time:
0.04760282000643201
</pre>
</div>

</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stopping time in between:&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">())</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Stopping time in between:
2.9570073820650578e-06
3.7550998968072236e-05
5.566500476561487e-05
7.056500180624425e-05
8.437600627075881e-05
9.826800669543445e-05
0.00011237099533900619
0.0003771110059460625
0.00039566500345245004
0.0004098089993931353
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>That's it, folks – enjoy!</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Guide-for-Authors">Guide for Authors<a class="anchor-link" href="#Guide-for-Authors">&#182;</a></h1></div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Welcome to &quot;Generating Software Tests&quot;!&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Welcome to &#34;Generating Software Tests&#34;!
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This notebook compiles the most important conventions for all chapters (notebooks) of "Generating Software Tests".</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Organization-of-this-Book">Organization of this Book<a class="anchor-link" href="#Organization-of-this-Book">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Chapters--as-Notebooks">Chapters  as Notebooks<a class="anchor-link" href="#Chapters--as-Notebooks">&#182;</a></h3><p>Each chapter comes in its own <em>Jupyter notebook</em>.  A single notebook (= a chapter) should cover the material (text and code, possibly slides) for a 90-minute lecture.</p>
<p>A chapter notebook should be named <code>Topic.ipynb</code>, where <code>Topic</code> is the topic.  <code>Topic</code> must be usable as a Python module and should characterize the main contribution.  If the main contribution of your chapter is a class <code>FooFuzzer</code>, for instance, then your topic (and notebook name) should be <code>FooFuzzer</code>, such that users can state</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="FooFuzzer.html" class="import" target="_blank">FooFuzzer</a></span> <span class="kn">import</span> <span class="n">FooFuzzer</span>
</pre></div>
<p>Since class and module names should start with uppercase letters, all non-notebook files and folders start with lowercase letters. this may make it easier to differentiate them.  The special notebook <code>index.ipynb</code> gets converted into the home pages <code>index.html</code> (on fuzzingbook.org) and <code>README.md</code> (on GitHub).</p>
<p>Notebooks are stored in the <code>notebooks</code> folder.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Output-Formats">Output Formats<a class="anchor-link" href="#Output-Formats">&#182;</a></h3><p>The notebooks by themselves can be used by instructors and students to toy around with.  They can edit code (and text) as they like and even run them as a slide show.</p>
<p>The notebook can be <em>exported</em> to multiple (non-interactive) formats:</p>
<ul>
<li>HTML – for placing this material online.</li>
<li>PDF – for printing</li>
<li>Python – for coding</li>
<li>Slides – for presenting</li>
</ul>
<p>The included Makefile can generate all of these automatically.</p>
<p>At this point, we mostly focus on HTML and Python, as we want to get these out quickly; but you should also occasionally ensure that your notebooks can (still) be exported into PDF.  Other formats (Word, Markdown) are experimental.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Sites">Sites<a class="anchor-link" href="#Sites">&#182;</a></h2><p>All sources for the book end up on the <a href="https://github.com/uds-se/fuzzingbook">Github project page</a>.  This holds the sources (notebooks), utilities (Makefiles), as well as an issue tracker.</p>
<p>The derived material for the book ends up in the <code>docs/</code> folder, from where it is eventually pushed to the <a href="http://www.fuzzingbook.org/">fuzzingbook website</a>.  This site allows to read the chapters online, can launch Jupyter notebooks using the binder service, and provides access to code and slide formats.  Use <code>make publish</code> to create and update the site.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="The-Book-PDF">The Book PDF<a class="anchor-link" href="#The-Book-PDF">&#182;</a></h3><p>The book PDF is compiled automatically from the individual notebooks.  Each notebook becomes a chapter; references are compiled in the final chapter.  Use <code>make book</code> to create the book.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Creating-and-Building">Creating and Building<a class="anchor-link" href="#Creating-and-Building">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Tools-you-will-need">Tools you will need<a class="anchor-link" href="#Tools-you-will-need">&#182;</a></h3><p>To work on the notebook files, you need the following:</p>
<ol>
<li><p>Jupyter notebook.  The easiest way to install this is via the <a href="https://www.anaconda.com/download/">Anaconda distribution</a>.</p>
</li>
<li><p>Once you have the Jupyter notebook installed, you can start editing and coding right away by starting <code>jupyter notebook</code> (or <code>jupyter lab</code>) in the topmost project folder.</p>
</li>
<li><p>If (like me) you don't like the Jupyter Notebook interface, I recommend <a href="https://jupyterlab.readthedocs.io/en/stable/">Jupyter Lab</a>, the designated successor to Jupyter Notebook.  Invoke it as <code>jupyter lab</code>.  It comes with a much more modern interface, but misses autocompletion and a couple of extensions.  I am running it <a href="http://christopherroach.com/articles/jupyterlab-desktop-app/">as a Desktop application</a> which gets rid of all the browser toolbars.
On the Mac, there is also the <a href="https://nwhitehead.github.io/pineapple/">Pineapple app</a>, which integrates a nice editor with a local server.  This is easy to use, but misses a few features; also, it hasn't seen updates since 2015.</p>
</li>
<li><p>To create the entire book (with citations, references, and all), you also need the <a href="https://github.com/chrisjsewell/ipypublish">ipybublish</a> package.  This allows you to create the HTML files, merge multiple chapters into a single PDF or HTML file, create slides, and more.  The Makefile provides the essential tools for creation.</p>
</li>
</ol>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Version-Control">Version Control<a class="anchor-link" href="#Version-Control">&#182;</a></h3><p>We use git in a single strand of revisions.  Feel free branch for features, but eventually merge back into the main "master" branch. Sync early; sync often.  Only push if everything ("make all") builds and passes.</p>
<p>The Github repo thus will typically reflect work in progress.  If you reach a stable milestone, you can push things on the fuzzingbook.org web site, using <code>make publish</code>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="nbdime">nbdime<a class="anchor-link" href="#nbdime">&#182;</a></h4><p>The <a href="https://github.com/jupyter/nbdime">nbdime</a> package gives you tools such as <code>nbdiff</code> (and even better, <code>nbdiff-web</code>) to compare notebooks against each other; this ensures that cell <em>contents</em> are compared rather than the binary format.</p>
<p><code>nbdime config-git --enable</code> integrates nbdime with git such that <code>git diff</code> runs the above tools; merging should also be notebook-specific.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h4 id="nbstripout">nbstripout<a class="anchor-link" href="#nbstripout">&#182;</a></h4><p>Notebooks in version control <em>should not contain output cells,</em> as these tend to change a lot.  (Hey, we're talking random output generation here!)  To have output cells automatically stripped during commit, install the <a href="https://github.com/kynan/nbstripout">nbstripout</a> package and use</p>

<pre><code>nbstripout --install --attributes .gitattributes</code></pre>
<p>in the <code>notebooks</code> folder to set it up as a git filter.  As an example, the following cell should not have its output included in the git repo:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/random.html" class="import" target="_blank">random</a></span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>0.34647433255370563
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Inkscape-and-GraphViz">Inkscape and GraphViz<a class="anchor-link" href="#Inkscape-and-GraphViz">&#182;</a></h3><p>Creating derived files uses  <a href="https://inkscape.org/en/">Inkscape</a> and <a href="https://www.graphviz.org/">Graphviz</a> - through its <a href="https://pypi.org/project/graphviz/">Python wrapper</a> - to process  SVG images. These tools are not automatically installed, but are available on pip, <em>brew</em> and <em>apt-get</em> for all major distributions.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="LaTeX-Fonts">LaTeX Fonts<a class="anchor-link" href="#LaTeX-Fonts">&#182;</a></h3><p>By default, creating PDF uses XeLaTeX with a couple of special fonts, which you can find in the <code>fonts/</code> folder; install these fonts system-wide to make them accessible to XeLaTeX.</p>
<p>You can also run <code>make LATEX=pdflatex</code> to use <code>pdflatex</code> and standard LaTeX fonts instead.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Creating-Derived-Formats-(HTML,-PDF,-code,-...)">Creating Derived Formats (HTML, PDF, code, ...)<a class="anchor-link" href="#Creating-Derived-Formats-(HTML,-PDF,-code,-...)">&#182;</a></h3><p>The <a href="../Makefile">Makefile</a> provides rules for all targets.  Type <code>make help</code> for instructions.</p>
<p>The Makefile should work with GNU make and a standard Jupyter Notebook installation.  To create the multi-chapter book and BibTeX citation support, you need to install the  <a href="https://github.com/chrisjsewell/ipypublish">iPyPublish</a> package (which includes the <code>nbpublish</code> command).</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Creating-a-New-Chapter">Creating a New Chapter<a class="anchor-link" href="#Creating-a-New-Chapter">&#182;</a></h3><p>To create a new chapter for the book,</p>
<ol>
<li>Set up a new <code>.ipynb</code> notebook file as copy of <a href="Template.html">Template.ipynb</a>.</li>
<li>Include it in the <code>CHAPTERS</code> list in the <code>Makefile</code>.</li>
<li>Add it to the git repository.</li>
</ol>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Teaching-a-Topic">Teaching a Topic<a class="anchor-link" href="#Teaching-a-Topic">&#182;</a></h2><p>Each chapter should be devoted to a central concept and a small set of lessons to be learned.  I recommend the following structure:</p>
<ul>
<li>Introduce the problem ("We want to parse inputs")</li>
<li>Illustrate it with some code examples ("Here's some input I'd like to parse")</li>
<li>Develop a first (possibly quick and dirty) solution ("A PEG parser is short and often does the job"_</li>
<li>Show that it works and how it works ("Here's a neat derivation tree.  Look how we can use this to mutate and combine expressions!")</li>
<li>Develop a second, more elaborated solution, which should then become the main contribution.  ("Here's a general LR(1) parser that does not require a special grammar format.  (You can skip it if you're not interested)")</li>
<li>Offload non-essential extensions to later sections or to exercises.  ("Implement a universal parser, using the Dragon Book")</li>
</ul>
<p>The key idea is that readers should be able to grasp the essentials of the problem and the solution in the beginning of the chapter, and get further into details as they progress through it.  Make it easy for readers to be drawn in, providing insights of value quickly.  If they are interested to understand how things work, they will get deeper into the topic.  If they just want to use the technique (because they may be more interested in later chapters), having them read only the first few examples should be fine for them, too.</p>
<p>Whatever you introduce should be motivated first, and illustrated after.  Motivate the code you'll be writing, and use plenty of examples to show what the code just introduced is doing.  Remember that readers should have fun interacting with your code and your examples.  Show and tell again and again and again.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Coding">Coding<a class="anchor-link" href="#Coding">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Set-up">Set up<a class="anchor-link" href="#Set-up">&#182;</a></h3><p>The first code block in each notebook should be</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This sets up stuff such that notebooks can import each other's code (see below). This import statement is removed in the exported Python code, as the .py files would import each other directly.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Importing <code>fuzzingbook_utils</code> also sets a fixed <em>seed</em> for random number generation.  This way, whenever you execute a notebook from scratch (restarting the kernel), you get the exact same results; these results will also end up in the derived HTML and PDF files.  (If you run a notebook or a cell for the second time, you will get more random results.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Coding-Style-and-Consistency">Coding Style and Consistency<a class="anchor-link" href="#Coding-Style-and-Consistency">&#182;</a></h3><p>We use Python 3 (specifically, Python 3.6) for all code.  If you can, try to write code that can be easily backported to Python 2.</p>
<p>We use standard Python coding conventions according to <a href="https://www.python.org/dev/peps/pep-0008/">PEP 8</a>.</p>
<p>Use one cell for each definition or example.  During importing, this makes it easier to decide which cells to import (see below).</p>
<p>Your code must pass the <code>pycodestyle</code> style checks which you get by invoking <code>make style</code>.  A very easy way to meet this goal is to invoke <code>make reformat</code>, which reformats all code accordingly.  The <code>code prettify</code> notebook extension also allows you to automatically make your code adhere to PEP 8.</p>
<p>In the book, this is how we denote <code>variables</code>, <code>functions()</code> and <code>methods()</code>, <code>Classes</code>, <code>Notebooks</code>, <code>variables_and_constants</code>, <code>EXPORTED_CONSTANTS</code>, <code>'characters'</code>, <code>"strings"</code>, <code>files</code>, <code>folders/</code>, and <code>&lt;grammar-elements&gt;</code>.</p>
<p>Beyond simple syntactical things, here's a <a href="https://docs.python-guide.org/writing/style/">very nice guide</a> to get you started writing "pythonic" code.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Importing-Code-from-Notebooks">Importing Code from Notebooks<a class="anchor-link" href="#Importing-Code-from-Notebooks">&#182;</a></h3><p>To import the code of individual notebooks, you can import directly from .ipynb notebook files.</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="Fuzzer.html" class="import" target="_blank">Fuzzer</a></span> <span class="k">import</span> <span class="n">fuzzer</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fuzzer</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_text output_subarea output_execute_result">
<pre>&#39;050199092904721615267546627640773972382632848750065259698551700448752187153&#39;
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Important</strong>: When importing a notebook, the module loader will <strong>only</strong> load cells that start with</p>
<ul>
<li>a function definition (<code>def</code>)</li>
<li>a class definition (<code>class</code>)</li>
<li>a variable definition if all uppercase (<code>ABC = 123</code>)</li>
<li><code>import</code> and <code>from</code> statements</li>
</ul>
<p>All other cells are <em>ignored</em> to avoid recomputation of notebooks and clutter of <code>print()</code> output.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>The exported Python code will import from the respective .py file instead.  (There's no filtering here as with notebooks, so you'll see plenty of output when importing.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Import modules only as you need them, such that you can motivate them well in the text.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Design-and-Architecture">Design and Architecture<a class="anchor-link" href="#Design-and-Architecture">&#182;</a></h3><p>Stick to simple functions and data types.  We want our readers to focus on functionality, not Python.  You are encouraged to write in a "pythonic" style, making use of elegant Python features such as list comprehensions, sets, and more; however, if you do so, be sure to explain the code such that readers familiar with, say, C or Java can still understand things.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Introducing-Classes">Introducing Classes<a class="anchor-link" href="#Introducing-Classes">&#182;</a></h3><p>Defining <em>classes</em> can be a bit tricky, since all of a class must fit into a single cell.  This defeats the incremental style preferred for notebooks.  By defining a class <em>as a subclass of itself</em>, though, you can avoid this problem.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Here's an example.  We introduce a class <code>Foo</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Now we could discuss what <code>__init__()</code> and <code>bar()</code> do, or give an example of how to use them:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>We now can introduce a new <code>Foo</code> method by subclassing from <code>Foo</code> into a class which is <em>also</em> called <code>Foo</code>:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">Foo</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">baz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>This is the same as if we had subclassed <code>Foo</code> into <code>Foo_1</code> with <code>Foo</code> then becoming an alias for <code>Foo_1</code>.  The original <code>Foo</code> class is overshadowed by the new one:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">new_f</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="n">new_f</span><span class="o">.</span><span class="n">baz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Note, though, that <em>existing</em> objects keep their original class:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="ExpectError.html" class="import" target="_blank">ExpectError</a></span> <span class="k">import</span> <span class="n">ExpectError</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">f</span><span class="o">.</span><span class="n">baz</span><span class="p">()</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-12-19c0eadbd4d4&gt;&#34;, line 2, in &lt;module&gt;
    f.baz()
AttributeError: &#39;Foo&#39; object has no attribute &#39;baz&#39; (expected)
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Helpers">Helpers<a class="anchor-link" href="#Helpers">&#182;</a></h2><p>There's a couple of notebooks with helpful functions, including <a href="Timer.html">Timer</a>, <a href="ExpectError.html">ExpectError and ExpectTimeout</a>.  Also check out the <a href="Coverage.html">Coverage</a> class.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Quality-Assurance">Quality Assurance<a class="anchor-link" href="#Quality-Assurance">&#182;</a></h3><p>In your code, make use of plenty of assertions that allow to catch errors quickly.  These assertions also help your readers understand the code.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Issue-Tracker">Issue Tracker<a class="anchor-link" href="#Issue-Tracker">&#182;</a></h3><p>The <a href="https://github.com/uds-se/fuzzingbook">Github project page</a> allows to enter and track issues.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Writing-Text">Writing Text<a class="anchor-link" href="#Writing-Text">&#182;</a></h2><p>Text blocks use Markdown syntax.  <a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet">Here is a handy guide</a>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Sections">Sections<a class="anchor-link" href="#Sections">&#182;</a></h3><p>Any chapter notebook must begin with <code># TITLE</code>, and sections and subsections should then follow by <code>## SECTION</code> and <code>### SUBSECTION</code>.</p>
<p>Sections should start with their own block, to facilitate cross-referencing.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Highlighting">Highlighting<a class="anchor-link" href="#Highlighting">&#182;</a></h3><p>Use</p>
<ul>
<li><em>emphasis</em> (<code>_emphasis_</code>) for highlighting,</li>
<li><code>backticks</code> for code and other verbatim elements.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Hyphens-and-Dashes">Hyphens and Dashes<a class="anchor-link" href="#Hyphens-and-Dashes">&#182;</a></h3><p>Use "–" for em-dashes, "-" for hyphens, and "$-$" for minus.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Quotes">Quotes<a class="anchor-link" href="#Quotes">&#182;</a></h3><p>Use standard typewriter quotes (<code>"quoted string"</code>) for quoted text.  The PDF version will automatically convert these to "smart" (e.g. left and right) quotes.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Lists-and-Enumerations">Lists and Enumerations<a class="anchor-link" href="#Lists-and-Enumerations">&#182;</a></h3><p>You can use bulleted lists:</p>
<ul>
<li>Item A</li>
<li>Item B</li>
</ul>
<p>and enumerations:</p>
<ol>
<li>item 1</li>
<li>item 2</li>
</ol>
<p>For description lists, use a combination of bulleted lists and highlights:</p>
<ul>
<li><strong>PDF</strong> is great for reading offline</li>
<li><strong>HTML</strong> is great for reading online</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Math">Math<a class="anchor-link" href="#Math">&#182;</a></h3><p>LaTeX math formatting works, too.</p>
<p><code>$x = \sum_{n = 1}^{\infty}\frac{1}{n}$</code> gets you
$x = \sum_{n = 1}^{\infty}\frac{1}{n}$.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Inline-Code">Inline Code<a class="anchor-link" href="#Inline-Code">&#182;</a></h3><p>Python code normally goes into its own cells, but you can also have it in the text:</p>
<div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Python syntax highlighting&quot;</span>
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Images">Images<a class="anchor-link" href="#Images">&#182;</a></h2><p>To insert images, use Markdown syntax <code>![Word cloud](PICS/wordcloud.png){width=100%}</code> inserts a picture from the <code>PICS</code> folder.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><img src="PICS/wordcloud.png" alt="Word cloud">{width=100%}</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>All pictures go to <code>PICS/</code>, both in source as well as derived formats; both are stored in git, too.  (Not all of us have all tools to recreate diagrams, etc.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Floating-Elements-and-References">Floating Elements and References<a class="anchor-link" href="#Floating-Elements-and-References">&#182;</a></h2><p>\todo[inline]{I haven't gotten this to work yet -- AZ}</p>
<p>To produce floating elements in LaTeX and PDF, edit the metadata of the cell which contains it. (In the Jupyter Notebook Toolbar go to View -&gt; Cell Toolbar -&gt; Edit Metadata and a button will appear above each cell.) This allows you to control placement and create labels.</p>
<h3 id="Floating-Figures">Floating Figures<a class="anchor-link" href="#Floating-Figures">&#182;</a></h3><p>Edit metadata as follows:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
<span class="nt">&quot;ipub&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="nt">&quot;figure&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;caption&quot;</span><span class="p">:</span> <span class="s2">&quot;Figure caption.&quot;</span><span class="p">,</span>
    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;fig:flabel&quot;</span><span class="p">,</span>
    <span class="nt">&quot;placement&quot;</span><span class="p">:</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span>
    <span class="nt">&quot;height&quot;</span><span class="p">:</span><span class="mf">0.4</span><span class="p">,</span>
    <span class="nt">&quot;widefigure&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<ul>
<li>all tags are optional</li>
<li>height/width correspond to the fraction of the page height/width, only one should be used (aspect ratio will be maintained automatically)</li>
<li><code>placement</code> is optional and constitutes using a placement arguments for the figure (e.g. \begin{figure}[H]). See <a href="https://www.sharelatex.com/learn/Positioning_images_and_tables">Positioning_images_and_tables</a>.</li>
<li><code>widefigure</code> is optional and constitutes expanding the figure to the page width (i.e. \begin{figure*}) (placement arguments will then be ignored)</li>
</ul>
<h3 id="Floating-Tables">Floating Tables<a class="anchor-link" href="#Floating-Tables">&#182;</a></h3><p>For  <strong>tables</strong> (e.g. those output by <code>pandas</code>), enter in cell metadata:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
<span class="nt">&quot;ipub&quot;</span><span class="p">:</span> <span class="p">{</span>
     <span class="nt">&quot;table&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;caption&quot;</span><span class="p">:</span> <span class="s2">&quot;Table caption.&quot;</span><span class="p">,</span>
        <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;tbl:tlabel&quot;</span><span class="p">,</span>
        <span class="nt">&quot;placement&quot;</span><span class="p">:</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span>
            <span class="nt">&quot;alternate&quot;</span><span class="p">:</span> <span class="s2">&quot;gray!20&quot;</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<ul>
<li><code>caption</code> and <code>label</code> are optional</li>
<li><code>placement</code> is optional and constitutes using a placement arguments for the table (e.g. \begin{table}[H]). See <a href="https://www.sharelatex.com/learn/Positioning_images_and_tables">Positioning_images_and_tables</a>.</li>
<li><code>alternate</code> is optional and constitutes using alternating colors for the table rows (e.g. \rowcolors{2}{gray!25}{white}). See (<a href="https://tex.stackexchange.com/a/5365/107738)[https://tex.stackexchange.com/a/5365/107738">https://tex.stackexchange.com/a/5365/107738)[https://tex.stackexchange.com/a/5365/107738</a>].</li>
<li>if tables exceed the text width, in latex, they will be shrunk to fit </li>
</ul>
<h3 id="Floating-Equations">Floating Equations<a class="anchor-link" href="#Floating-Equations">&#182;</a></h3><p>For  <strong>equations</strong> (e.g. those output by <code>sympy</code>), enter in cell metadata:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;ipub&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;equation&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;environment&quot;</span><span class="p">:</span> <span class="s2">&quot;equation&quot;</span><span class="p">,</span>
        <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;eqn:elabel&quot;</span>
      <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<ul>
<li>environment is optional and can be 'none' or any of those available in <a href="https://www.sharelatex.com/learn/Aligning_equations_with_amsmath">amsmath</a>; 'equation', 'align','multline','gather', or their * variants. Additionaly, 'breqn' or 'breqn*' will select the experimental <a href="https://ctan.org/pkg/breqn">breqn</a> environment to <em>smart</em> wrap long equations. </li>
<li>label is optional and will only be used if the equation is in an environment</li>
</ul>
<h3 id="References">References<a class="anchor-link" href="#References">&#182;</a></h3><p>To reference to a floating object, use <code>\cref</code>, e.g. <a href="#eq:texdemo">eq. 1</a></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Cross-Referencing">Cross-Referencing<a class="anchor-link" href="#Cross-Referencing">&#182;</a></h2><h3 id="Section-References">Section References<a class="anchor-link" href="#Section-References">&#182;</a></h3><ul>
<li><p>To refer to sections in the same notebook, use the header name as anchor, e.g. 
<code>[Code](#Code)</code> gives you <a href="#Code">Code</a>.  For multi-word titles, replace spaces by hyphens (<code>-</code>), as in <a href="#Using-Notebooks-as-Modules">Using Notebooks as Modules</a>.</p>
</li>
<li><p>To refer to cells (e.g. equations or figures), you can define a label as cell metadata.  See <a href="#Floating-Elements-and-References">Floating Elements and References</a> for details.</p>
</li>
<li><p>To refer to other notebooks, use a Markdown cross-reference to the notebook file, e.g. <a href="Fuzzer.html">the "Fuzzing" chapter</a>.  A special script will be run to take care of these links.  Reference chapters by name, not by number.</p>
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Citations">Citations<a class="anchor-link" href="#Citations">&#182;</a></h3><p>To cite papers, cite in LaTeX style.  The text</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\cite</span><span class="si">{Purdom1972}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>\cite{Purdom1972}
</pre>
</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>is expanded to [<a href="https://doi.org/10.1007/BF01932308">Purdom <em>et al</em>, 1972.</a>], which in HTML and PDF should be a nice reference.
The keys refer to BibTeX entries in <a href="fuzzingbook.bib">fuzzingbook.bib</a>.</p>
<ul>
<li>LaTeX/PDF output will have a "References" section appended.</li>
<li>HTML output will link to the URL field from the BibTeX entry. Be sure it points to the DOI.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Todo's">Todo's<a class="anchor-link" href="#Todo's">&#182;</a></h2><ul>
<li>To mark todo's, use <code>\todo{Thing to be done}.</code>  \todo{Expand this}</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Tables">Tables<a class="anchor-link" href="#Tables">&#182;</a></h2><p>Tables with fixed contents can be produced using Markdown syntax:</p>
<table>
<thead><tr>
<th>Tables</th>
<th style="text-align:right">Are</th>
<th style="text-align:right">Cool</th>
</tr>
</thead>
<tbody>
<tr>
<td>Zebra</td>
<td style="text-align:right">2</td>
<td style="text-align:right">30</td>
</tr>
<tr>
<td>Gnu</td>
<td style="text-align:right">20</td>
<td style="text-align:right">400</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If you want to produce tables from Python data, the <code>PrettyTable</code> package (included in the book) allows to <a href="http://blog.juliusschulz.de/blog/ultimate-ipython-notebook">produce tables with LaTeX-style formatting.</a></p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/numpy.html" class="import" target="_blank">numpy</a></span> <span class="k">as</span> <span class="nn"><a href="https://docs.python.org/3/library/np.html" class="import" target="_blank">np</a></span>
<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/fuzzingbook_utils.PrettyTable.html" class="import" target="_blank">fuzzingbook_utils.PrettyTable</a></span> <span class="k">as</span> <span class="nn"><a href="https://docs.python.org/3/library/pt.html" class="import" target="_blank">pt</a></span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">400</span><span class="p">]])</span>
<span class="n">pt</span><span class="o">.</span><span class="n">PrettyTable</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;$\frac</span><span class="si">{a}{b}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$b$&quot;</span><span class="p">,</span>
                      <span class="sa">r</span><span class="s2">&quot;$c$&quot;</span><span class="p">],</span> <span class="n">print_latex_longtable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

<table><tr><td>$\frac{a}{b}$</td><td>$b$</td><td>$c$</td></tr><tr><td>1</td><td>2</td><td>30</td></tr><tr><td>2</td><td>3</td><td>400</td></tr></table>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Plots-and-Data">Plots and Data<a class="anchor-link" href="#Plots-and-Data">&#182;</a></h2><p>It is possible to include plots in notebooks.  Here is an example of plotting a function:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/matplotlib.pyplot.html" class="import" target="_blank">matplotlib.pyplot</a></span> <span class="k">as</span> <span class="nn"><a href="https://docs.python.org/3/library/plt.html" class="import" target="_blank">plt</a></span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;A simple chirp&#39;</span><span class="p">);</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_png output_subarea ">
<img src="data:image/png;base64,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
"
>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>And here's an example of plotting data:</p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn"><a href="https://docs.python.org/3/library/matplotlib.pyplot.html" class="import" target="_blank">matplotlib.pyplot</a></span> <span class="k">as</span> <span class="nn"><a href="https://docs.python.org/3/library/plt.html" class="import" target="_blank">plt</a></span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">57</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Increase in data&#39;</span><span class="p">);</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_image output_png output_subarea ">
<img src="data:image/png;base64,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
"
>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Plots are available in all derived versions (HTML, PDF, etc.)  Plots with <code>plotly</code> are even nicer (and interactive, even in HTML),  However, at this point, we cannot export them to PDF, so <code>matplotlib</code> it is.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Slides">Slides<a class="anchor-link" href="#Slides">&#182;</a></h2><p>You can set up the notebooks such that they also can be presented as slides.  In the browser, select View -&gt; Cell Toolbar -&gt; Slideshow.  You can then select a slide type for each cell:</p>
<ul>
<li><code>New slide</code> starts a new slide with the cell (typically, every <code>## SECTION</code> in the chapter)</li>
<li><code>Sub-slide</code> starts a new sub-slide which you navigate "down" to (anything in the section)</li>
<li><code>Fragment</code> is a cell that gets revealed after a click (on the same slide)</li>
<li><code>Skip</code> is skipped during the slide show (e.g. <code>import</code> statements; navigation guides)</li>
<li><code>Notes</code> goes into presenter notes</li>
</ul>
<p>To create slides, do <code>make slides</code>; to view them, change into the <code>slides/</code> folder and open the created HTML files.  (The <code>reveal.js</code> package has to be in the same folder as the slide to be presented.)</p>
<p>The ability to use slide shows is a compelling argument for teachers and instructors in our audience.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>(Hint: In a slide presentation, type <code>s</code> to see presenter notes.)</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Writing-Tools">Writing Tools<a class="anchor-link" href="#Writing-Tools">&#182;</a></h2><p>When you're editing in the browser, you may find these extensions helpful:</p>
<h3 id="Jupyter-Notebook">Jupyter Notebook<a class="anchor-link" href="#Jupyter-Notebook">&#182;</a></h3><p><a href="https://github.com/ipython-contrib/jupyter_contrib_nbextensions">Jupyter Notebook Extensions</a> is a collection of productivity-enhancing tools (including spellcheckers).</p>
<p>I found these extensions to be particularly useful:</p>
<ul>
<li><p>Spell Checker (while you're editing)</p>
</li>
<li><p>Table of contents (for quick navigation)</p>
</li>
<li><p>Code prettify (to produce "nice" syntax)</p>
</li>
<li><p>Codefolding</p>
</li>
<li><p>Live Markdown Preview (while you're editing)</p>
</li>
</ul>
<h3 id="Jupyter-Lab">Jupyter Lab<a class="anchor-link" href="#Jupyter-Lab">&#182;</a></h3><p>Extensions for <em>Jupyter Lab</em> are much less varied and less supported, but things get better. I am running</p>
<ul>
<li><p><a href="https://github.com/ijmbarr/jupyterlab_spellchecker">Spell Checker</a></p>
</li>
<li><p><a href="https://github.com/jupyterlab/jupyterlab-toc">Table of Contents</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Interaction">Interaction<a class="anchor-link" href="#Interaction">&#182;</a></h2><p>It is possible to include interactive elements in a notebook, as in the following example:</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn"><a href="https://docs.python.org/3/library/ipywidgets.html" class="import" target="_blank">ipywidgets</a></span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">fixed</span><span class="p">,</span> <span class="n">interact_manual</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">interact</span><span class="p">(</span><span class="n">fuzzer</span><span class="p">,</span> <span class="n">char_start</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="n">char_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">96</span><span class="p">))</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>Note that such elements will be present in the notebook versions only, but not in the HTML and PDF versions, so use them sparingly (if at all).  To avoid errors during production of derived files, protect against <code>ImportError</code> exceptions as in the above example.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Read-More">Read More<a class="anchor-link" href="#Read-More">&#182;</a></h2><p>Here is some documentation on the tools we use:</p>
<ol>
<li><p><a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet">Markdown Cheatsheet</a> - general introduction to Markdown</p>
</li>
<li><p><a href="https://github.com/chrisjsewell/ipypublish">iPyPublish</a> - rich set of tools to create documents with citations and references</p>
</li>
</ol>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Alternative-Tool-Sets">Alternative Tool Sets<a class="anchor-link" href="#Alternative-Tool-Sets">&#182;</a></h2><p>We don't currently use these, but they are worth learning:</p>
<ol>
<li><p><a href="http://blog.juliusschulz.de/blog/ultimate-ipython-notebook">Making Publication-Ready Python Notebooks</a> - Another tool set on how to produce book chapters from notebooks</p>
</li>
<li><p><a href="https://sylvaindeville.net/2015/07/17/writing-academic-papers-in-plain-text-with-markdown-and-jupyter-notebook/">Writing academic papers in plain text with Markdown and Jupyter notebook</a> - Alternate ways on how to generate citations</p>
</li>
<li><p><a href="https://gist.github.com/goerz/d5019bedacf5956bcf03ca8683dc5217#file-revtex-tplx">A Jupyter LaTeX template</a> - How to define a LaTeX template</p>
</li>
<li><p><a href="https://towardsdatascience.com/jupyter-notebook-hints-1f26b08429ad">Boost Your Jupyter Notebook Productivity</a> - a collection of hints for debugging and profiling Jupyter notebooks</p>
</li>
</ol>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Title">Title<a class="anchor-link" href="#Title">&#182;</a></h1><p><em>Brief abstract/introduction/motivation.  State what the chapter is about in 1-2 paragraphs.</em>
<em>Then, have an introduction video:</em></p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fuzzingbook_utils</span> <span class="k">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s2">&quot;w4u5gCgPlmg&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="640"
            height="360"
            src="https://www.youtube.com/embed/w4u5gCgPlmg"
            frameborder="0"
            allowfullscreen
        ></iframe>

</div>

</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><strong>Prerequisites</strong></p>
<ul>
<li><em>Refer to earlier chapters as notebooks here, as here:</em> <a href="Fuzzer.html">Earlier Chapter</a>.</li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Section-1"><em>Section 1</em><a class="anchor-link" href="#Section-1">&#182;</a></h2><p>\todo{Add}</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Section-2"><em>Section 2</em><a class="anchor-link" href="#Section-2">&#182;</a></h2><p>\todo{Add}</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Section-3"><em>Section 3</em><a class="anchor-link" href="#Section-3">&#182;</a></h2><p>\todo{Add}</p>
<p><em>If you want to introduce code, it is helpful to state the most important functions, as in:</em></p>
<ul>
<li><code>random.randrange(start, end)</code> - return a random number [<code>start</code>, <code>end</code>]</li>
<li><code>range(start, end)</code> - create a list with integers from <code>start</code> to <code>end</code>.  Typically used in iterations.</li>
<li><code>for elem in list: body</code> executes <code>body</code> in a loop with <code>elem</code> taking each value from <code>list</code>.</li>
<li><code>for i in range(start, end): body</code> executes <code>body</code> in a loop with <code>i</code> from <code>start</code> to <code>end</code> - 1.</li>
<li><code>chr(n)</code> - return a character with ASCII code <code>n</code></li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># More code</span>
<span class="k">pass</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Even more code</span>
<span class="k">pass</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Section-4"><em>Section 4</em><a class="anchor-link" href="#Section-4">&#182;</a></h2><p>\todo{Add}</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Lessons-Learned">Lessons Learned<a class="anchor-link" href="#Lessons-Learned">&#182;</a></h2><ul>
<li><em>Lesson one</em></li>
<li><em>Lesson two</em></li>
<li><em>Lesson three</em></li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Next-Steps">Next Steps<a class="anchor-link" href="#Next-Steps">&#182;</a></h2><p><em>Link to subsequent chapters (notebooks) here, as in:</em></p>
<ul>
<li><a href="MutationFuzzer.html">use <em>mutations</em> on existing inputs to get more valid inputs</a></li>
<li><a href="Grammars.html">use <em>grammars</em> (i.e., a specification of the input format) to get even more valid inputs</a></li>
<li><a href="Reducer.html">reduce <em>failing inputs</em> for efficient debugging</a></li>
</ul>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Background">Background<a class="anchor-link" href="#Background">&#182;</a></h2><p><em>Cite relevant works in the literature and put them into context, as in:</em></p>
<p>The idea of ensuring that each expansion in the grammar is used at least once goes back to Burkhardt [<a href="https://doi.org/10.1007/BF02235512">Burkhardt <em>et al</em>, 1967.</a>], to be later rediscovered by Paul Purdom [<a href="https://doi.org/10.1007/BF01932308">Purdom <em>et al</em>, 1972.</a>].</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Exercises">Exercises<a class="anchor-link" href="#Exercises">&#182;</a></h2><p><em>Close the chapter with a few exercises such that people have things to do.  To make the solutions hidden (to be revealed by the user), have them start with</em></p>

<pre><code>markdown
**Solution.**</code></pre>
<p><em>Your solution can then extend up to the next title (i.e., any markdown cell starting with <code>#</code>).</em></p>
<p><em>Running <code>make metadata</code> will automatically add metadata to the cells such that the cells will be hidden by default, and can be uncovered by the user.  The button will be introduced above the solution.</em></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-1:-Title">Exercise 1: <em>Title</em><a class="anchor-link" href="#Exercise-1:-Title">&#182;</a></h3><p><em>Text of the exercise</em></p>
</div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Some code that is part of the exercise</span>
<span class="k">pass</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p><em>Some more text for the exercise</em></p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h3 id="Exercise-2:-Title">Exercise 2: <em>Title</em><a class="anchor-link" href="#Exercise-2:-Title">&#182;</a></h3><p><em>Text of the exercise</em></p>

    
<p><div class="solution_link"><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?filepath=docs/notebooks/book.ipynb#Exercises" target=_blank>Use the notebook</a> to work on the exercises and see solutions.</div></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h1 id="Oh-no!--We-are-not-ready-yet!">Oh no!  We are not ready yet!<a class="anchor-link" href="#Oh-no!--We-are-not-ready-yet!">&#182;</a></h1><p>We're sorry - this page does not exist (yet).</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Finding-Content">Finding Content<a class="anchor-link" href="#Finding-Content">&#182;</a></h2><p>Most likely, you have been looking for material that is not yet written or not yet published.  Go to the <a href="https://www.fuzzingbook.org/">home page</a> or choose from this list of chapters:</p>
<ol>
               <li><a href="https://www.fuzzingbook.org/"><i class="fa fa-fw fa-home"></i> About this book</a></li>
<li><a href="Intro_Testing.html">Introduction to Software Testing</a></li>
<li><a href="Fuzzer.html">Fuzzing: Breaking Things with Random Inputs</a></li>

</ol></div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><p>If you think this is an error, please <a href="https://github.com/uds-se/fuzzingbook//issues/">report an issue</a>.</p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Getting-Informed-About-New-Content">Getting Informed About New Content<a class="anchor-link" href="#Getting-Informed-About-New-Content">&#182;</a></h2><p>New chapters are coming out every week.  To get notified when a new chapter (or this one) comes out, <a href="https://twitter.com/FuzzingBook?ref_src=twsrc%5Etfw" data-show-count="false">follow us on Twitter</a>.</p>
<p><a class="twitter-timeline" data-width="500" data-chrome="noheader nofooter noborders transparent" data-link-color="#A93226" data-align="center" href="https://twitter.com/FuzzingBook?ref_src=twsrc%5Etfw">News from @FuzzingBook</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></p>
</div>
</div>
</div>
</div>

<div class="input_markdown">
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html"><h2 id="Error-Details">Error Details<a class="anchor-link" href="#Error-Details">&#182;</a></h2></div>
</div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">fuzzingbook_utils</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">NotFoundError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;404&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="input_code">
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn"><a href="ExpectError.html" class="import" target="_blank">ExpectError</a></span> <span class="k">import</span> <span class="n">ExpectError</span>

<span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="k">raise</span> <span class="n">NotFoundError</span>
</pre></div>

</div>
</div></div>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Traceback (most recent call last):
  File &#34;&lt;ipython-input-3-f7cd072299fb&gt;&#34;, line 4, in &lt;module&gt;
    raise NotFoundError
NotFoundError: &#39;404&#39; (expected)
</pre>
</div>

</div>

        
<p class="imprint">
<img style="float:right" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" alt="Creative Commons License">
The content of this project is licensed under the
<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target=_blank>Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
The source code that is part of the content, as well as the source code used to format and display that content is licensed under the <a href="https://github.com/github/choosealicense.com/blob/gh-pages/LICENSE.md">MIT License</a>.
<a href="https://github.com/uds-se/fuzzingbook/commits/master/notebooks/book.ipynb" target=_blank)>Last change: 2018-11-05 17:03:07+01:00</a> &bull; 
<a href="#citation" id="cite" onclick="revealCitation()">Cite</a> &bull;
<a href="https://www.uni-saarland.de/en/footer/dialogue/legal-notice.html" target=_blank>Imprint</a>
</p>

<script>
function revealCitation() {
    var c = document.getElementById("citation");
    c.style.display = "block";
}
</script>

<div id="citation" class="citation" style="display: none;">
<a name="citation"></a>
<h2>How to Cite this Work</h2>
<p>
Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler: "<a href="https://www.fuzzingbook.org/html/book.html">About this Book</a>".  In Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler (eds.), "<a href="https://www.fuzzingbook.org/">Generating Software Tests</a>", <a href="https://www.fuzzingbook.org/html/book.html">https://www.fuzzingbook.org/html/book.html</a>.  Retrieved 2018-11-05 17:03:07+01:00.
</p>
<pre>
@incollection{fuzzingbook2018:book,
    author = {Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler},
    booktitle = {Generating Software Tests},
    title = {About this Book},
    year = {2018},
    publisher = {Saarland University},
    howpublished = {\url{https://www.fuzzingbook.org/html/book.html}},
    note = {Retrieved 2018-11-05 17:03:07+01:00},
    url = {https://www.fuzzingbook.org/html/book.html},
    urldate = {2018-11-05 17:03:07+01:00}
}
</pre>
</div>

      </div>
    </div>
    </article>

 </body>

</html>